{"meta":{"title":"Hello_AlexCc","subtitle":"No pains, no gains.","description":"Technology Blog","author":"Hello_AlexCc","url":"http://yoursite.com","root":"/"},"pages":[{"title":"About ME","date":"2022-03-30T02:53:37.000Z","updated":"2022-03-31T02:37:39.820Z","comments":false,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":"StoryA long time ago â€¦ A cat is sleepingï¼Œvery very deep sleepingâ€¦ Suddently, He find a mouse â€¦ God damn it, a so cute mouse! He donâ€™t want to eat he, play with he."},{"title":"","date":"2022-11-30T03:01:38.680Z","updated":"2022-11-23T08:23:21.958Z","comments":false,"path":"demo/ObserverMode.html","permalink":"http://yoursite.com/demo/ObserverMode.html","excerpt":"","text":"è§‚å¯Ÿè€…æ¨¡å¼ ul { background-color: antiquewhite; } li { background-color: aqua; margin-top: 12px; } é¢åŒ…å±‘ 1 2 3 // ç›®æ ‡ class Subject { constructor() { this.observers = [] } add(ob) { this.observers.push(ob) } notify(text) { this.observers.forEach(o => { o.update(text) }) } } // è§‚å¯Ÿè€… class Observer { constructor(name) { this.ele = document.querySelector(name) } update(text) { this.ele.innerHTML = text } } const s = new Subject() const o1 = new Observer('.bread') s.add(o1) let oLi = document.querySelectorAll('.left li') for (let i = 0; i < oLi.length; i++) { oLi[i].onclick = function () { s.notify(this.innerHTML) } }"},{"title":"","date":"2022-11-30T03:01:38.694Z","updated":"2022-11-23T12:48:03.716Z","comments":false,"path":"demo/timeFragment.html","permalink":"http://yoursite.com/demo/timeFragment.html","excerpt":"","text":"æ—¶é—´åˆ†ç‰‡ // è®°å½•ä»»åŠ¡å¼€å§‹æ—¶é—´ let now = Date.now(); // æ’å…¥åä¸‡æ¡æ•°æ® const total = 100000; // è·å–å®¹å™¨ let ul = document.getElementById('container'); // å°†æ•°æ®æ’å…¥å®¹å™¨ä¸­ for (let i = 0; i < total; i++) { let li = document.createElement('li'); li.innerText = i ul.appendChild(li); } console.log('JSè¿è¡Œæ—¶é—´ï¼š', Date.now() - now); setTimeout(() => { console.log('æ€»è¿è¡Œæ—¶é—´ï¼š', Date.now() - now); }, 0) // // --------- åˆ†æ‰¹æ¸²æŸ“ --------- // //éœ€è¦æ’å…¥çš„å®¹å™¨ // let ul = document.getElementById('container'); // // æ’å…¥åä¸‡æ¡æ•°æ® // let total = 100000; // // ä¸€æ¬¡æ’å…¥ 20 æ¡ // let once = 20; // //æ€»é¡µæ•° // let page = total / once // //æ¯æ¡è®°å½•çš„ç´¢å¼• // let index = 0; // //å¾ªç¯åŠ è½½æ•°æ® // function loop(curTotal, curIndex) { // if (curTotal { // for (let i = 0; i < pageCount; i++) { // let li = document.createElement('li'); // li.innerText = curIndex + i + ' : ' + ~~(Math.random() * total) // ul.appendChild(li) // } // loop(curTotal - pageCount, curIndex + pageCount) // }, 0) // } // loop(total, index);"},{"title":"","date":"2022-11-30T03:05:16.656Z","updated":"2022-11-30T03:05:16.656Z","comments":false,"path":"demo/resizeObserver.html","permalink":"http://yoursite.com/demo/resizeObserver.html","excerpt":"","text":"Resize observer text test html { height: 100%; font-family: 'helvetica neue', arial, sans-serif; } body { height: inherit; margin: 0; display: flex; justify-content: center; align-items: center; } body>div { background-color: #eee; border: 1px solid #ccc; padding: 20px; width: 50%; min-width: 320px; } h1 { margin: 0; } p { line-height: 1.5; } form { width: 100%; } form>div { display: flex; } form label { flex: 2; } form input { flex: 3; } input[type=\"checkbox\"] { height: 2rem; } So what happened? https://developer.mozilla.org/zh-CN/docs/Web/API/ResizeObserver è®°ä½ï¼Œä¸è¦åšä»»ä½•å½±å“ä»»ä½•äº‹æƒ…çš„äº‹æƒ…ï¼Œé™¤éäº‹å®è¯æ˜ä½ åº”è¯¥è¿™ä¹ˆåšï¼Œé‚£æ ·çš„è¯ï¼Œçœ‹åœ¨ä¸Šå¸çš„ä»½ä¸Šï¼Œä¸è¦ä¸åšï¼æˆ‘çš„çµé­‚ï¼æˆ‘ä¸æƒ³è¢«æ•‘ã€‚ä½ ä»¬ä¸æ˜¯åœ£è¯è€äººï¼ä½ ä»¬éƒ½ä¸æ˜¯æœºå™¨äººã€‚æˆ‘å¾—æƒ³åŠæ³•é€ƒç¦»å¹´è½»æ—¶å¯æ€•çš„æ‘§æ®‹ã€‚çªç„¶é—´ï¼Œæˆ‘æ¯ä¸‰ä¸ªå°æ—¶å°±è¦ä¸Šä¸€æ¬¡å•æ‰€ã€‚ç¤¾ä¿å±€çš„é‚£äº›æ··è›‹ä¹Ÿä¸å†ç»™æˆ‘å¯„æ”¯ç¥¨äº†ã€‚ç°åœ¨æˆ‘å¾—ä»˜é’±ç»™ä»–ä»¬ï¼ Observer enabled: Adjust width: if (window.ResizeObserver) { const h1Elem = document.querySelector('h1'); const pElem = document.querySelector('p'); const divElem = document.querySelector('body > div'); const slider = document.querySelector('input[type=\"range\"]'); const checkbox = document.querySelector('input[type=\"checkbox\"]'); divElem.style.width = '600px'; slider.addEventListener('input', () => { divElem.style.width = slider.value + 'px'; }) const resizeObserver = new ResizeObserver(entries => { console.log('entries', entries) for (let entry of entries) { if (entry.contentBoxSize) { // The standard makes contentBoxSize an array... if (entry.contentBoxSize[0]) { h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize[0].inlineSize / 200) + 'rem'; pElem.style.fontSize = Math.max(1, entry.contentBoxSize[0].inlineSize / 600) + 'rem'; } else { // ...but old versions of Firefox treat it as a single item h1Elem.style.fontSize = Math.max(1.5, entry.contentBoxSize.inlineSize / 200) + 'rem'; pElem.style.fontSize = Math.max(1, entry.contentBoxSize.inlineSize / 600) + 'rem'; } } else { h1Elem.style.fontSize = Math.max(1.5, entry.contentRect.width / 200) + 'rem'; pElem.style.fontSize = Math.max(1, entry.contentRect.width / 600) + 'rem'; } } console.log('Size changed'); }); resizeObserver.observe(divElem); checkbox.addEventListener('change', () => { if (checkbox.checked) { resizeObserver.observe(divElem); } else { resizeObserver.unobserve(divElem); } }); } else { console.log('Resize observer not supported!'); }"},{"title":"","date":"2022-11-30T03:01:38.689Z","updated":"2022-11-23T09:03:02.974Z","comments":false,"path":"demo/PubSubMode.html","permalink":"http://yoursite.com/demo/PubSubMode.html","excerpt":"","text":"å‘å¸ƒè®¢é˜…è€…æ¨¡å¼ ul { background-color: antiquewhite; } li { background-color: aqua; margin-top: 12px; } é¢åŒ…å±‘ 1 2 3 const PubSub = { message: {}, // å°†äº‹ä»¶å­˜å‚¨æ•°ç»„ï¼Œæ”¹æˆå¯¹è±¡ï¼Œkey è¡¨ç¤ºäº‹ä»¶ç±»å‹ï¼Œvalue è¡¨ç¤ºè®¢é˜…çš„äº‹ä»¶æ•°ç»„ publist(type, text) { if (!this.message[type]) return this.message[type].forEach(cb => { cb(text) }) }, subscribe(type, cb) { if (!this.message[type]) { this.message[type] = [cb] // å¦‚æœäº‹ä»¶ type ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªäº‹ä»¶ç±»å‹æ•°ç»„ } else { this.message[type].push(cb) } }, unsubscribe(type, cb) { // å–æ¶ˆè®¢é˜… if (!this.message[type]) return if (!cb) { // å–æ¶ˆæ‰€æœ‰è®¢é˜…çš„äº‹ä»¶ this.message[type] = [] } else { this.message[type] = this.message[type].filter(i => i !== cb) } } } PubSub.subscribe('updateBread', function (text) { const breadEle = document.querySelector('.bread') breadEle.innerHTML = text }) let oLi = document.querySelectorAll('.left li') for (let i = 0; i < oLi.length; i++) { oLi[i].onclick = function () { PubSub.publist('updateBread', this.innerHTML) } }"},{"title":"","date":"2022-12-25T13:17:28.022Z","updated":"2022-12-25T13:17:28.022Z","comments":false,"path":"demo/Vue3Reactive.html","permalink":"http://yoursite.com/demo/Vue3Reactive.html","excerpt":"","text":"Vue3 å“åº”å¼åŸç† // å®šä¹‰ä¸€ä¸ªå­˜å‚¨å‰¯ä½œç”¨å‡½æ•°çš„é›†åˆï¼Œæ¯æ¬¡è®¾ç½®å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šå–å‡ºé›†åˆé‡Œé¢çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶æ‰§è¡Œ const bucket = new Set() const data = { text: 'helloworld' } const obj = new Proxy(data, { get(target, key) { // æ·»åŠ å‰¯ä½œç”¨å‡½æ•° // æ¯ä¸€æ¬¡è§¦å‘ get æ–¹æ³•ï¼Œéƒ½ä¼šå‘ é›†åˆ ä¸­æ·»åŠ ä¸€æ¬¡ effect æ–¹æ³• // ä½†æ˜¯é›†åˆæ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒçš„å€¼çš„ï¼ˆåŒ…æ‹¬ç›¸åŒçš„å†…å­˜åœ°å€ï¼‰ // æ‰€ä»¥è¿™é‡Œæ¯ä¸€æ¬¡æ‰§è¡Œ bucket.add æ–¹æ³•ï¼Œå› ä¸º effect åœ°å€æ²¡å˜ï¼Œæ‰€ä»¥é‡Œé¢ä¸€ç›´åªä¼šæœ‰ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°ã€‚ bucket.add(effect) return target[key] }, set(target, key, val) { target[key] = val // æ‰¹é‡æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•° bucket.forEach(fn => fn()) return true } }) // æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼Œä¼šè§¦å‘ä»£ç†å¯¹è±¡çš„ get æ–¹æ³•ï¼Œä»è€Œæ”¶é›†åˆ°å‰¯ä½œç”¨å‡½æ•° const effect = () => { document.body.innerHTML = obj.text } effect() // ä¸€ç§’é’Ÿåï¼Œæˆ‘ä»¬æ‰§è¡Œ ä»£ç†å¯¹è±¡çš„ set æ“ä½œï¼Œå‡ºå‘ set æ–¹æ³• setTimeout(() => { obj.text = 'update obj text' console.log('??',bucket) }, 1000);"},{"title":"","date":"2022-12-25T13:17:28.037Z","updated":"2022-12-25T13:17:28.036Z","comments":false,"path":"demo/Vue3Reactive1.html","permalink":"http://yoursite.com/demo/Vue3Reactive1.html","excerpt":"","text":"Document let activeEffect = undefined const data = { text: 'hello world @.@' } function effect(fn) { activeEffect = fn fn() } const bucket = new WeakMap() // target => Map const obj = new Proxy(data, { get(target, key) { if (!activeEffect) return target[key] let depsMap = bucket.get(target) if (!depsMap) { // å…³è” target å’Œ Map bucket.set(target, depsMap = new Map()) } let deps = depsMap.get(key) if (!deps) { // ä¾èµ–é›†åˆ depsMap.set(key, deps = new Set()) } deps.add(activeEffect) return target[key] }, set(target, key, val) { target[key] = val const depsMap = bucket.get(target) console.log('depsMap ', depsMap) if (!depsMap) return let effects = depsMap.get(key) effects && effects.forEach(fn => fn()) } }) // æ³¨å†Œå‰¯ä½œç”¨å‡½æ•° effect(() => { console.log('text effect') document.body.innerHTML = obj.text // è¯»å– }) // effect(() => { // console.log('title effect') // obj.title = 'æ ‡é¢˜123' // // document.title = obj.title // è¯»å– // }) setTimeout(() => { obj.notExist = 'hello vue3' }, 1000)"},{"title":"","date":"2022-12-25T13:17:28.044Z","updated":"2022-12-25T13:17:28.044Z","comments":false,"path":"demo/Vue3Reactive2.html","permalink":"http://yoursite.com/demo/Vue3Reactive2.html","excerpt":"","text":"æ”¶é›† key çš„ä¾èµ– // å­˜å‚¨è¢«æ³¨å†Œçš„å‰¯ä½œç”¨å‡½æ•° let activeEffect; const data = { ok: true, text: 'hello world' } const bucket = new WeakMap() // target => Map const obj = new Proxy(data, { get(target, key) { // è¿½è¸ªä¾èµ– track(target, key) return target[key] }, set(target, key, value) { target[key] = value // è§¦å‘ä¾èµ– trigger(target, key) } }) function track(target, key) { if (!activeEffect) return target[key] let depsMap = bucket.get(target) if (!depsMap) { bucket.set(target, depsMap = new Map()) } let deps = depsMap.get(key) if (!deps) { depsMap.set(key, deps = new Set()) } // æ·»åŠ å‰¯ä½œç”¨å‡½æ•° deps.add(activeEffect) // deps å­˜å‚¨ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³è”çš„ä¾èµ–é›†åˆ // å°†æ¥åœ¨ cleanup ä¸­é€šè¿‡ activeEffect.deps[i] delete effectFn æ—¶ï¼Œå…¶å®ï¼Œå°±æ˜¯å°† deps ä¸­çš„å‰¯ä½œç”¨å‡½æ•°åˆ é™¤äº† activeEffect.deps.push(deps) } function trigger(target, key) { const depsMap = bucket.get(target) if (!depsMap) return const effects = depsMap.get(key) const effectsToRun = new Set(effects) // effects && effects.forEach(fn => fn()) effectsToRun && effectsToRun.forEach(fn => fn()) } function effect(fn) { function effectFn() { activeEffect = effectFn cleanup(effectFn) fn() } effectFn.deps = [] // å­˜å‚¨æ‰€æœ‰åŒ…å«å½“å‰å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ– é›†åˆï¼Œåœ¨ get æ‹¦æˆªå‡½æ•°ä¸­å¤„ç† deps effectFn() } function cleanup(effectFn) { console.log('effectFn ', effectFn.deps) // æˆ‘ä»¬åˆ é™¤ effectFn.deps[i] ä¸­çš„ effectFnï¼Œå…¶å®å°±æ˜¯åˆ é™¤äº† 'xxx'(key) ä¸­å¯¹åº”çš„ä¾èµ–é›†åˆçš„å‰¯ä½œç”¨å‡½æ•° // effectFn.deps[i] ä¸­ï¼Œå­˜æ”¾çš„ä¾èµ–é›†åˆï¼Œå’Œ Map key å¯¹åº”çš„ä¾èµ–é›†åˆï¼Œæ˜¯åŒä¸€ä¸ªé›†åˆï¼Œåˆ é™¤æŸä¸€é¡¹ï¼Œè‡ªç„¶ä¼šå½±å“åˆ°å¦ä¸€ä¸ª // å½“æˆ‘ä»¬åœ¨ trigger ä¸­æ‰§è¡Œ effects æ—¶ï¼Œå°±æ˜¯æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•° // è¿™ä¸ªæ—¶å€™ï¼Œä¼šæ‰§è¡Œ cleanupï¼Œåˆ é™¤æ‰€æœ‰çš„ key å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œæœ€åæ‰§è¡Œ fnï¼Œé‡æ–°èµ° å±æ€§çš„è¯»å–é€»è¾‘ï¼Œè§¦å‘ get æ–¹æ³•ï¼Œé‡æ–°æ”¶é›†ä¾èµ– // å½“æˆ‘ä»¬è®¾ç½® obj.ok = false åï¼Œä¸ä¼šå†è¯»å– obj.text äº†ï¼Œä»è€Œä¸ä¼šå¯¹å…¶ key æ”¶é›†ä¾èµ–ã€‚ for(let i = 0; i < effectFn.deps.length; i++) { const deps = effectFn.deps[i] deps.delete(effectFn) } effectFn.deps.length = 0 } effect(() => { console.log(' obj.ok', obj.ok) // obj.ok = true ä¼šè§¦å‘ obj çš„ getæ‹¦æˆªæ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡ track å‡½æ•°æ”¶é›†åˆ°äº†å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶ä¸”å°†å…¶å­˜å‚¨åœ¨ deps ä¸­ document.body.innerHTML = obj.ok ? obj.text : 'ok not' }) setTimeout(() => { // obj.text = 'Vue3 Reactive' obj.ok = false console.log('bucket ', bucket) }, 1000) // setTimeout(() => { // console.log('æ‰§è¡Œäº†') // obj.text = 'Vue3 Reactive' // }, 3000)"},{"title":"","date":"2022-12-25T13:39:01.826Z","updated":"2022-12-25T13:39:01.826Z","comments":false,"path":"demo/Vue3Reactive3.html","permalink":"http://yoursite.com/demo/Vue3Reactive3.html","excerpt":"","text":"æ”¶é›† key çš„ä¾èµ– reactive let temp1, temp2; effect(function effect1() { console.log('effect1 æ‰§è¡Œ') effect(function effect2() { console.log('effect2 æ‰§è¡Œ') temp2 = obj.bar }) temp1 = obj.foo }) console.log('???', bucket) obj.foo = false // obj.bar = false"},{"title":"","date":"2022-12-25T14:13:05.830Z","updated":"2022-12-25T14:13:05.830Z","comments":false,"path":"demo/Vue3Reactive4.html","permalink":"http://yoursite.com/demo/Vue3Reactive4.html","excerpt":"","text":"æ”¶é›† key çš„ä¾èµ– reactive const data = { foo: 1 } const obj = handleProxy(data) // æ§åˆ¶æ¬¡æ•° const jobQueue = new Set() const p = Promise.resolve() let isFlushing = false function flushJob() { if (isFlushing) return isFlushing = true p.then(() => { jobQueue.forEach(job => job()) }).finally(() => { isFlushing = false }) } effect(() => { console.log(obj.foo) }, { scheduler(fn) { // è°ƒåº¦ // setTimeout(fn) // æ§åˆ¶æ¬¡æ•° // fn() // ä¼šä¾æ¬¡ä» 1 æ‰“å°åˆ° 6ï¼Œè€Œæˆ‘ä¸åœ¨è¿‡ç¨‹ï¼Œåªéœ€è¦ç»“æœ 6 // ç”±äº Set é›†åˆçš„ç‰¹æ®Šæ€§ï¼Œå¤šæ¬¡æ·»åŠ åŒä¸€ä¸ª fnï¼Œæœ€ç»ˆéƒ½åªä¼šæœ‰ä¸ª fn åœ¨ set ä¸­ jobQueue.add(fn) flushJob() } }) obj.foo++ obj.foo++ obj.foo++ obj.foo++ obj.foo++ console.log('ç»“æŸäº†')"},{"title":"","date":"2022-12-25T14:17:31.440Z","updated":"2022-12-25T14:17:31.440Z","comments":false,"path":"demo/reactive.js","permalink":"http://yoursite.com/demo/reactive.js","excerpt":"","text":"// å­˜å‚¨è¢«æ³¨å†Œçš„å‰¯ä½œç”¨å‡½æ•° let activeEffect; // å‰¯ä½œç”¨å‡½æ•°æ ˆï¼Œç”¨æ¥å­˜å‚¨å½“å‰æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°ï¼Œå½“å‰¯ä½œç”¨å‡½æ•°å‘ç”ŸåµŒå¥—æ—¶ï¼Œé¿å…å‡½æ•°é”™è¯¯çš„ä½¿ç”¨ const effectStack = [] const bucket = new WeakMap() // target => Map const handleProxy = data => { return new Proxy(data, { get(target, key) { // è¿½è¸ªä¾èµ– track(target, key) return target[key] }, set(target, key, value) { target[key] = value // è§¦å‘ä¾èµ– trigger(target, key) } }) } function track(target, key) { if (!activeEffect) return target[key] let depsMap = bucket.get(target) if (!depsMap) { bucket.set(target, depsMap = new Map()) } let deps = depsMap.get(key) if (!deps) { depsMap.set(key, deps = new Set()) } deps.add(activeEffect) activeEffect.deps.push(deps) } function trigger(target, key) { const depsMap = bucket.get(target) if (!depsMap) return const effects = depsMap.get(key) // é¿å…æ— é™å¾ªç¯ // const effectsToRun = new Set(effects) const effectsToRun = new Set() effects && effects.forEach(effectFn => { if (effectFn !== activeEffect) { effectsToRun.add(effectFn) } }) effectsToRun && effectsToRun.forEach(fn => { if (fn.options.scheduler) { fn.options.scheduler(fn) } else { fn() } }) } function effect(fn, options = {}) { function effectFn() { activeEffect = effectFn cleanup(effectFn) effectStack.push(effectFn) // æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•° fn() effectStack.pop() activeEffect = effectStack[effectStack.length - 1] } effectFn.options = options effectFn.deps = [] // å¼€å§‹æ‰§è¡Œ effectFn() } function cleanup(effectFn) { for(let i = 0; i < effectFn.deps.length; i++) { const deps = effectFn.deps[i] deps.delete(effectFn) } effectFn.deps.length = 0 }"},{"title":"","date":"2022-12-29T13:56:05.333Z","updated":"2022-12-29T13:56:05.333Z","comments":false,"path":"demo/theme/prefers-color-scheme.html","permalink":"http://yoursite.com/demo/theme/prefers-color-scheme.html","excerpt":"","text":"prefers-color-scheme .day { background: #eee; color: black; } .night { background: #333; color: white; } @media (prefers-color-scheme: dark) { .day.dark-scheme { background: #333; color: white; } .night.dark-scheme { background: black; color: red; } } @media (prefers-color-scheme: light) { .day.light-scheme { background: skyblue; color: #333; } .night.light-scheme { background: pink; color: #333; } } .day, .night { display: inline-block; padding: 1em; width: 7em; height: 7em; vertical-align: middle; } :root { --color: #333; --background-color: pink; } [data-theme=\"dark\"] { --color: #fff; --background-color: #000; } MDN: prefers-color-scheme CSS åª’ä½“ç‰¹æ€§ç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦æœ‰å°†ç³»ç»Ÿçš„ä¸»é¢˜è‰²è®¾ç½®ä¸ºäº®è‰²æˆ–è€…æš—è‰²ã€‚ Day (changes in light scheme) Day (changes in dark scheme) Night (changes in light scheme) Night (changes in dark scheme) dark mode window.onload = function() { // å¦‚æœåŒ¹é…æˆåŠŸï¼Œscheme.matches === true // ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯æš—é»‘è‰²ï¼Œé‚£ä¹ˆè¿™ä¸ª matches å°±æ˜¯trueï¼Œå¦åˆ™æ˜¯ false const scheme = window.matchMedia('(prefers-color-scheme: dark)') scheme.addEventListener('change', e => { console.log(e) if (e.matches) { // è¡¨ç¤ºäº®è‰²æ¨¡å¼ document.documentElement.setAttribute('data-theme', 'dark') } else { document.documentElement.setAttribute('data-theme', 'light') } }) const darkBtn = document.querySelector('.dark-btn') darkBtn.addEventListener('click', () => { // è®¾ç½®ä¸»é¢˜è‰² document.documentElement.setAttribute('data-theme', 'dark') // document.documentElement.style.setProperty('--color', '#fff') // document.documentElement.style.setProperty('--background-color', '#000') }) }"},{"title":"","date":"2022-12-28T07:21:33.621Z","updated":"2022-12-28T07:21:33.621Z","comments":false,"path":"demo/webcomponent/README.html","permalink":"http://yoursite.com/demo/webcomponent/README.html","excerpt":"","text":"Web Componentsä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å°½å¯èƒ½å¤šçš„é‡ç”¨ä»£ç æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚è¿™å¯¹äºè‡ªå®šä¹‰æ ‡è®°ç»“æ„æ¥è¯´é€šå¸¸ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ â€” æƒ³æƒ³å¤æ‚çš„ HTMLï¼ˆä»¥åŠç›¸å…³çš„æ ·å¼å’Œè„šæœ¬ï¼‰ï¼Œæœ‰æ—¶æ‚¨ä¸å¾—ä¸å†™ä»£ç æ¥å‘ˆç°è‡ªå®šä¹‰ UI æ§ä»¶ï¼Œå¹¶ä¸”å¦‚æœæ‚¨ä¸å°å¿ƒçš„è¯ï¼Œå¤šæ¬¡ä½¿ç”¨å®ƒä»¬ä¼šä½¿æ‚¨çš„é¡µé¢å˜å¾—ä¸€å›¢ç³Ÿã€‚ ç»„æˆ Custom elementsï¼ˆè‡ªå®šä¹‰å…ƒç´ ï¼‰ Shadow DOMï¼ˆå½±å­ DOMï¼‰ HTML templatesï¼ˆHTML æ¨¡æ¿ï¼‰ Custom elementsï¼ˆè‡ªå®šä¹‰å…ƒç´ ï¼‰Shadow DOMï¼ˆå½±å­ DOMï¼‰templates and slotså¤ç”¨ç»“æ„ï¼Œå‡å°‘ä½¿ç”¨ç›¸åŒçš„æ ‡è®°ç»“æ„ã€‚ ç»„ä»¶é€šä¿¡ Lightning Web Component åœ¨ LWC ä¸­ï¼Œå¯ä»¥é€šè¿‡å®ç° CustomEvent æ¥å£è¿›è¡Œè‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šè¿‡ EventTarget.dispatchEvent() æ¥åˆ†é…äº‹ä»¶ã€‚ æ³¨æ„ï¼š å®šä¹‰äº‹ä»¶æ—¶ï¼Œä¸éœ€è¦åœ¨äº‹ä»¶åå‰åŠ  onï¼Œå› ä¸ºåœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šé»˜è®¤åœ¨åç§°å‰ä½¿ç”¨ onï¼Œæ¯”å¦‚ï¼šå½“æˆ‘ä»¬å®šä¹‰äº† click äº‹ä»¶ï¼Œåœ¨ HTML ä»£ç ä¸­ç”¨ onclick æ¥è°ƒç”¨å®ƒ çˆ¶ç»„ä»¶ 123456789101112131415// parent compconnectedCallback() &#123; const child = this.shadowRoot.querySelector(&#x27;child-wc&#x27;) // 1. é€šè¿‡ DOM å±æ€§ä¼ å‚ï¼Œä¼šè§¦å‘å­ç»„ä»¶çš„ attributeChangedCallback é’©å­ child.setAttribute(&#x27;text&#x27;, &#x27;Parent changed the Text&#x27;) // 2. é€šè¿‡ç»„ä»¶å®ä¾‹ç›´æ¥ä¿®æ”¹å†…éƒ¨æ•°æ®ï¼ˆâš ï¸æœªè·å–åˆ°ï¼‰ // console.log(&#x27;??&#x27;, child) // 3. ç›‘å¬å­ç»„ä»¶å†…éƒ¨å®šä¹‰çš„äº‹ä»¶ child.addEventListener(&#x27;custom-event&#x27;, (&#123; detail &#125;) =&gt; &#123; console.log(&#x27;äº‹ä»¶è§¦å‘ &#x27;, detail.value); &#125;) &#125; å­ç»„ä»¶ 12345678910111213141516// child compconnectedCallback() &#123; // å®šä¹‰äº‹ä»¶ const event = new CustomEvent(&#x27;custom-event&#x27;, &#123; detail: &#123; value: &#x27;child web component&#x27; &#125; &#125;) this.dispatchEvent(event) const btn = this.shadowRoot.querySelector(&#x27;button&#x27;) btn.addEventListener(&#x27;click&#x27;, () =&gt; &#123; // è·å–çˆ¶ç»„ä»¶ this.getRootNode().host.sayHello(&#x27;Hello :&#x27;) &#125;)&#125; å­ç»„ä»¶ç›´æ¥è°ƒç”¨çˆ¶ç»„ä»¶å®ä¾‹ä¸Šçš„æ–¹æ³•123456789101112131415// parent compsayHello(msg) &#123; console.log(msg, this.data)&#125;// child compconnectedCallback() &#123; const btn = this.shadowRoot.querySelector(&#x27;button&#x27;) btn.addEventListener(&#x27;click&#x27;, () =&gt; &#123; // è·å–çˆ¶ç»„ä»¶å®ä¾‹ this.getRootNode().host.sayHello(&#x27;Hello :&#x27;) &#125;)&#125; ç›‘å¬ç»„ä»¶ä¸Šå±æ€§çš„å˜åŒ–1234567891011121314151617// parentconst child = this.shadowRoot.querySelector(&#x27;child-wc&#x27;)// 1. é€šè¿‡ DOM å±æ€§ä¼ å‚ï¼Œä¼šè§¦å‘å­ç»„ä»¶çš„ attributeChangedCallback é’©å­child.setAttribute(&#x27;text&#x27;, &#x27;Parent changed the Text&#x27;)// child// ç›‘å¬å±æ€§å˜åŒ–ï¼Œå¿…é¡»å®šé™æ€çš„ observedAttributes æ–¹æ³•static get observedAttributes() &#123; return [&#x27;text&#x27;];&#125;attributeChangedCallback(name, oldValue, newValue) &#123; console.log(&#x27;name&#x27;, name) console.log(&#x27;oldValue&#x27;, oldValue) console.log(&#x27;newValue&#x27;, newValue)&#125; å‚è€ƒé“¾æ¥ MDNå®˜æ–¹æ–‡æ¡£ WCå®˜æ–¹ç¤ºä¾‹ åŸºäº Web Components è·¨æ¡†æ¶ç»„ä»¶å¼€å‘ Shadow :host é€‰æ‹©å™¨"},{"title":"","date":"2022-12-27T03:08:10.412Z","updated":"2022-12-27T03:08:10.412Z","comments":false,"path":"demo/webcomponent/composed-path/index.html","permalink":"http://yoursite.com/demo/webcomponent/composed-path/index.html","excerpt":"","text":"Document composed and composedPath demo"},{"title":"","date":"2022-12-27T03:07:36.904Z","updated":"2022-12-27T03:07:36.904Z","comments":false,"path":"demo/webcomponent/element-details-template/index.html","permalink":"http://yoursite.com/demo/webcomponent/element-details-template/index.html","excerpt":"","text":"Document element-details-template details {font-family: \"Open Sans Light\",Helvetica,Arial} .name {font-weight: bold; color: #217ac0; font-size: 120%} h4 { margin: 10px 0 -8px 0; } h4 span { background: #217ac0; padding: 2px 6px 2px 6px } h4 span { border: 1px solid #cee9f9; border-radius: 4px } h4 span { color: white } .attributes { margin-left: 22px; font-size: 90% } .attributes p { margin-left: 16px; font-style: italic } dl { margin-left: 6px; } dt { font-weight: bold; color: #217ac0; font-size: 110% } dt { font-family: Consolas, \"Liberation Mono\", Courier } dd { margin-left: 16px } &lt;NEED NAME&gt; NEED DESCRIPTION Attributes None Hello_AlexCc A mechanism for holding client- side content that is not to be rendered when a page is loaded but may subsequently be instantiated during runtime using JavaScript. name The name of the slot."},{"title":"","date":"2022-12-27T03:17:25.840Z","updated":"2022-12-27T03:17:25.840Z","comments":false,"path":"demo/webcomponent/composed-path/main.js","permalink":"http://yoursite.com/demo/webcomponent/composed-path/main.js","excerpt":"","text":"customElements.define('open-shadow', class extends HTMLElement { constructor() { super(); } connectedCallback() { const pElem = document.createElement('p'); pElem.textContent = this.getAttribute('text'); const shadowRoot = this.attachShadow({mode: 'open'}); shadowRoot.appendChild(pElem); } } ); customElements.define('closed-shadow', class extends HTMLElement { constructor() { super(); } connectedCallback() { const pElem = document.createElement('p'); pElem.textContent = this.getAttribute('text'); const shadowRoot = this.attachShadow({mode: 'closed'}); shadowRoot.appendChild(pElem); } } ); document.querySelector('html').addEventListener('click', e => { console.log(e.composed); console.log(e.composedPath()); });"},{"title":"","date":"2022-12-27T06:41:41.012Z","updated":"2022-12-27T06:41:41.012Z","comments":false,"path":"demo/webcomponent/parent-send-data-to-child/index.html","permalink":"http://yoursite.com/demo/webcomponent/parent-send-data-to-child/index.html","excerpt":"","text":"Life cycle callbacks test 00 Child Button parent template"},{"title":"","date":"2022-12-27T07:37:18.375Z","updated":"2022-12-27T07:37:18.375Z","comments":false,"path":"demo/webcomponent/parent-send-data-to-child/main.js","permalink":"http://yoursite.com/demo/webcomponent/parent-send-data-to-child/main.js","excerpt":"","text":"class ParentWc extends HTMLElement { constructor() { super() this.data = { value: 'Parent instance value' } const template = document.getElementById('parent').content const shadowRoot = this.attachShadow({mode: 'open'}) shadowRoot.appendChild(template.cloneNode(true)) } sayHello(msg) { console.log(msg, this.data) } connectedCallback() { const child = this.shadowRoot.querySelector('child-wc') // 1. é€šè¿‡ DOM å±æ€§ä¼ å‚ // child.setAttribute('text', 'Parent changed the Text') // 2. é€šè¿‡ç»„ä»¶å®ä¾‹ç›´æ¥ä¿®æ”¹å†…éƒ¨æ•°æ®ï¼ˆç›®å‰ä¸»æµçš„å½¢å¼ï¼‰ // console.log('??', child) // 3. äº‹ä»¶ç›‘å¬ child.addEventListener('custom-event', ({ detail }) => { console.log('äº‹ä»¶è§¦å‘ ', detail.value); }) } } window.customElements.define('parent-wc', ParentWc) // childWc class ChildWc extends HTMLElement { constructor() { super() this.data = { value: 'Child instance value' } Object.defineProperty(this.data, 'text', { set: value => { console.log('data text changed: ', value) } }) const template = document.getElementById('child').content const shadowRoot = this.attachShadow({mode: 'open'}) shadowRoot.appendChild(template.cloneNode(true)) } // å¿…é¡»å…ˆç”³æ˜éœ€è¦ç›‘å¬çš„å±æ€§ static get observedAttributes() { return ['text']; } connectedCallback() { const event = new CustomEvent('custom-event', { detail: { value: 'child web component' } }) this.dispatchEvent(event) const btn = this.shadowRoot.querySelector('button') btn.addEventListener('click', () => { // è·å–çˆ¶ç»„ä»¶ this.getRootNode().host.sayHello('Hello :') }) } attributeChangedCallback(name, oldValue, newValue) { console.log('name', name) console.log('oldValue', oldValue) console.log('newValue', newValue) } } window.customElements.define('child-wc', ChildWc);"},{"title":"","date":"2022-12-26T16:05:08.235Z","updated":"2022-12-26T16:05:08.235Z","comments":false,"path":"demo/webcomponent/template&slot/main.js","permalink":"http://yoursite.com/demo/webcomponent/template&slot/main.js","excerpt":"","text":"// å•ç‹¬ä½¿ç”¨ // window.onload = function() { // let template = document.getElementById('my-paragraph'); // let templateContent = template.content; // document.body.appendChild(templateContent); // } // åœ¨ Web Components ä¸­ä½¿ç”¨æ¨¡æ¿ class MyParagraph extends HTMLElement { constructor() { super() } connectedCallback() { let template = document.getElementById('my-paragraph'); let templateContent = template.content; this.attachShadow({ mode: 'open' }) .appendChild(templateContent.cloneNode(true)) } } customElements.define('my-paragraph', MyParagraph)"},{"title":"","date":"2022-12-31T08:51:54.342Z","updated":"2022-12-31T08:51:54.342Z","comments":false,"path":"demo/webcomponent/template&slot/index.html","permalink":"http://yoursite.com/demo/webcomponent/template&slot/index.html","excerpt":"","text":"Document template & slot Default Title default slot My paragraph Slot title"},{"title":"","date":"2022-12-26T14:51:47.978Z","updated":"2022-12-26T14:51:47.978Z","comments":false,"path":"demo/webcomponent/popup-info-box/index.html","permalink":"http://yoursite.com/demo/webcomponent/popup-info-box/index.html","excerpt":"","text":"Document Pop-up info widget - web components Enter your CVC"},{"title":"","date":"2022-12-27T02:59:08.495Z","updated":"2022-12-27T02:59:08.495Z","comments":false,"path":"demo/webcomponent/element-details-template/main.js","permalink":"http://yoursite.com/demo/webcomponent/element-details-template/main.js","excerpt":"","text":"class DetailsElement extends HTMLElement { constructor() { super() const template = document.getElementById('element-details-template').content const shadowRoot = this.attachShadow({mode: 'open'}) shadowRoot.appendChild(template.cloneNode(true)) console.log('host ', shadowRoot.host === this) // ShadowRoot é™„åŠ çš„å®¿ä¸» DOM å…ƒç´ ã€‚ } } const a = customElements.define('details-element', DetailsElement) console.log('?? ', customElements.get('details-element')) console.log('?? a', a)"},{"title":"","date":"2022-12-26T14:55:34.842Z","updated":"2022-12-26T14:55:34.842Z","comments":false,"path":"demo/webcomponent/popup-info-box/main.js","permalink":"http://yoursite.com/demo/webcomponent/popup-info-box/main.js","excerpt":"","text":"// Create a class for the element class PopUpInfo extends HTMLElement { constructor() { // Always call super first in constructor super(); } connectedCallback() { /** * @name connectedCallbackå‡½æ•° * @desc å½“ custom element é¦–æ¬¡è¢«æ’å…¥æ–‡æ¡£ DOM æ—¶ï¼Œè¢«è°ƒç”¨ã€‚ */ // Create a shadow root const shadow = this.attachShadow({mode: 'open'}); // Create spans const wrapper = document.createElement('span'); wrapper.setAttribute('class', 'wrapper'); const icon = document.createElement('span'); icon.setAttribute('class', 'icon'); icon.setAttribute('tabindex', 0); const info = document.createElement('span'); info.setAttribute('class', 'info'); /** * @name ğŸ”¥ğŸ”¥ğŸ”¥ æˆ‘ä»¬æƒ³è¦è·å–å…ƒç´ ä¸Šçš„å±æ€§ï¼Œå¿…é¡»æ”¾åœ¨ connectedCallback å‡½æ•°å†…å»è·å– * @desc å› ä¸ºåªæœ‰å…ƒç´ æ’å…¥åˆ°äº† dom ä¸­ï¼Œæ‰èƒ½è·å–åˆ° */ const text = this.getAttribute('data-text'); info.textContent = text; // Insert icon let imgUrl; if(this.hasAttribute('img')) { imgUrl = this.getAttribute('img'); } else { // imgUrl = './img/avatar.jpg'; } const img = document.createElement('img'); img.src = imgUrl; icon.appendChild(img); // Create some CSS to apply to the shadow dom const style = document.createElement('style'); console.log(style.isConnected); style.textContent = ` .wrapper { position: relative; } .info { font-size: 0.8rem; width: 200px; display: inline-block; border: 1px solid black; padding: 10px; background: white; border-radius: 10px; opacity: 0; transition: 0.6s all; position: absolute; bottom: 20px; left: 10px; z-index: 3; } img { width: 1.2rem; } .icon:hover + .info, .icon:focus + .info { opacity: 1; } `; // Attach the created elements to the shadow dom shadow.appendChild(style); // ä¸€å¼€å§‹è¿™ä¸ªstyle.isConnected ä¸ºfalseï¼ŒæŠŠä»–æ·»åŠ ç»™shadow Rootå isConnectedå°±ä¸ºtrueäº† console.log(style.isConnected); shadow.appendChild(wrapper); wrapper.appendChild(icon); wrapper.appendChild(info); } } // Define the new element customElements.define('popup-info', PopUpInfo);"},{"title":"","date":"2022-12-26T15:33:34.314Z","updated":"2022-12-26T15:33:34.314Z","comments":false,"path":"demo/webcomponent/expanding-list/iframe.html","permalink":"http://yoursite.com/demo/webcomponent/expanding-list/iframe.html","excerpt":"","text":"iframe body { background-color: coral; } iframe body iframe page"},{"title":"","date":"2022-12-27T06:41:05.973Z","updated":"2022-12-27T06:41:05.973Z","comments":false,"path":"demo/webcomponent/expanding-list/main.js","permalink":"http://yoursite.com/demo/webcomponent/expanding-list/main.js","excerpt":"","text":"// Create a class for the element class Square extends HTMLElement { // Specify observed attributes so that // attributeChangedCallback will work static get observedAttributes() { return ['c', 'l']; } constructor() { // Always call super first in constructor super(); const shadow = this.attachShadow({mode: 'open'}); const div = document.createElement('div'); const style = document.createElement('style'); shadow.appendChild(style); shadow.appendChild(div); } connectedCallback() { console.log('connectedCallback å½“ custom element é¦–æ¬¡è¢«æ’å…¥æ–‡æ¡£ DOM æ—¶ï¼Œè¢«è°ƒç”¨ã€‚'); updateStyle(this); } disconnectedCallback() { console.log('Custom square element ä»é¡µé¢ä¸Šè¢«åˆ é™¤ï¼'); } adoptedCallback() { console.log('Custom square element ç§»åŠ¨åˆ°äº†ä¸€ä¸ªæ–°çš„é¡µé¢ï¼Ÿ'); } attributeChangedCallback(name, oldValue, newValue) { console.log('Custom square element å±æ€§å‘ç”Ÿäº†æ”¹å˜'); updateStyle(this); } } customElements.define('custom-square', Square); function updateStyle(elem) { const shadow = elem.shadowRoot; shadow.querySelector('style').textContent = ` div { width: ${elem.getAttribute('l')}px; height: ${elem.getAttribute('l')}px; background-color: ${elem.getAttribute('c')}; } `; } const add = document.querySelector('.add'); const update = document.querySelector('.update'); const remove = document.querySelector('.remove'); const move = document.querySelector('.move'); const other = document.querySelector('.other'); let square; update.disabled = true; remove.disabled = true; move.disabled = true; function random(min, max) { return Math.floor(Math.random() * (max - min + 1) + min); } add.onclick = function() { // Create a custom square element square = document.createElement('custom-square'); square.setAttribute('l', '100'); square.setAttribute('c', 'red'); document.body.appendChild(square); update.disabled = false; remove.disabled = false; move.disabled = false; add.disabled = true; }; update.onclick = function() { // Randomly update square's attributes square.setAttribute('l', random(50, 200)); square.setAttribute('c', `rgb(${random(0, 255)}, ${random(0, 255)}, ${random(0, 255)})`); }; remove.onclick = function() { // Remove the square document.body.removeChild(square); update.disabled = true; remove.disabled = true; add.disabled = false; }; move.onclick = function() { const square1 = document.querySelector('custom-square') // moveï¼Œæˆ‘ä»¥ä¸ºçš„ç§»åŠ¨åˆ°æ–°æ–‡æ¡£ other.appendChild(square1) /** * @result ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº: disconnectedCallback > connectedCallback * @desc å¾ˆå°´å°¬ï¼Œè¿™ä¸å«ç§»åŠ¨åˆ°æ–°çš„æ–‡æ¡£ä¹ˆï¼Ÿ */ // é‚£æˆ‘ä»¬æ¥è¯•è¯• iframe setTimeout(() => { const iframe = document.querySelector('iframe') iframe.contentDocument.querySelector('body').appendChild(square1) move.disabled = true }, 1500); // è¿™ä¸‹å°±å¯¹äº†ï¼Œç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº disconnectedCallback > adoptedCallback > connectedCallback };"},{"title":"","date":"2022-12-26T15:33:53.083Z","updated":"2022-12-26T15:33:53.083Z","comments":false,"path":"demo/webcomponent/expanding-list/index.html","permalink":"http://yoursite.com/demo/webcomponent/expanding-list/index.html","excerpt":"","text":"Life cycle callbacks test custom-square { margin: 20px; } .other { /* position: absolute; */ top: 20%; left: 50%; width: 200px; height: 200px; background-color: #808080; } Life cycle callbacks test Add custom-square to DOM Update attributes Remove custom-square from DOM Move custom-square to new Dom"},{"title":"","date":"2022-12-31T14:11:32.903Z","updated":"2022-12-31T14:11:32.903Z","comments":false,"path":"demo/replace$1.html","permalink":"http://yoursite.com/demo/replace$1.html","excerpt":"","text":"Document const name = \"Doe, John\"; name.replace(/(\\w+)\\s*, \\s*(\\w+)/, \"$2 $1\") // John, Doe console.log('\"a\", \"b\"'.replace(/\"([^\"]*)\"/g, \"'$1'\"))"}],"posts":[{"title":"Vue3é¡¹ç›®å®æˆ˜(äº”)ï¼šé€šç”¨åŠŸèƒ½å¼€å‘(å›½é™…åŒ–/æ¢è‚¤)","slug":"vue3-project-generalModule","date":"2022-12-29T03:00:23.000Z","updated":"2022-12-31T16:14:11.735Z","comments":true,"path":"/post/vue3-project-generalModule.html","link":"","permalink":"http://yoursite.com/post/vue3-project-generalModule.html","excerpt":"å›½é™…åŒ–/æ¢è‚¤/screenfull/headerSearch/tagView/guide","text":"é€šç”¨åŠŸèƒ½ å›½é™…åŒ– åŠ¨æ€æ¢è‚¤ screenfull headerSearch tagView guide å›½é™…åŒ–å®ç°åŸç†å…ˆæ¥çœ‹ä¸€ä¸ªéœ€æ±‚ï¼š æˆ‘ä»¬æœ‰ä¸€ä¸ªå˜é‡ msg ï¼Œä½†æ˜¯è¿™ä¸ª msg æœ‰ä¸”åªèƒ½æœ‰ä¸¤ä¸ªå€¼ï¼š hello world ä½ å¥½ä¸–ç•Œ è¦æ±‚ï¼šæ ¹æ®éœ€è¦åˆ‡æ¢ msg çš„å€¼ è¿™æ ·çš„ä¸€ä¸ªéœ€æ±‚å°±æ˜¯ å›½é™…åŒ– çš„éœ€æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥å®ç°è¿™ä¸ªéœ€æ±‚ 12345678910111213141516171819202122&lt;script&gt; // 1. å®šä¹‰ msg å€¼çš„æ•°æ®æº const messages = &#123; en: &#123; msg: &#x27;hello world&#x27; &#125;, zh: &#123; msg: &#x27;ä½ å¥½ä¸–ç•Œ&#x27; &#125; &#125; // 2. å®šä¹‰åˆ‡æ¢å˜é‡ let locale = &#x27;en&#x27; // 3. å®šä¹‰èµ‹å€¼å‡½æ•° function t(key) &#123; return messages[locale][key] &#125; // 4. ä¸º msg èµ‹å€¼ let msg = t(&#x27;msg&#x27;) console.log(msg); // ä¿®æ”¹ localeï¼Œ é‡æ–°æ‰§è¡Œ t æ–¹æ³•ï¼Œè·å–ä¸åŒè¯­è¨€ç¯å¢ƒä¸‹çš„å€¼&lt;/script&gt; æ€»ç»“ï¼š é€šè¿‡ä¸€ä¸ªå˜é‡æ¥ æ§åˆ¶ è¯­è¨€ç¯å¢ƒ æ‰€æœ‰è¯­è¨€ç¯å¢ƒä¸‹çš„æ•°æ®æºè¦ é¢„å…ˆ å®šä¹‰å¥½ é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ¥è·å– å½“å‰è¯­è¨€ ä¸‹ æŒ‡å®šå±æ€§ çš„å€¼ è¯¥å€¼å³ä¸ºå›½é™…åŒ–ä¸‹å±•ç¤ºå€¼ åŸºäº vue-i18n V9 çš„å›½é™…åŒ–å®ç°æ–¹æ¡ˆåˆ†æåœ¨ vue çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹å†™è¿™ä¹ˆå¤æ‚çš„ä¸€äº›åŸºç¡€ä»£ç ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ vue-i18n è¿›è¡Œå®ç°ï¼ˆæ³¨æ„ï¼švue3 ä¸‹éœ€è¦ä½¿ç”¨ V 9.x çš„ i18nï¼‰ vue-i18n çš„ä½¿ç”¨å¯ä»¥åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š åˆ›å»º messages æ•°æ®æº åˆ›å»º locale è¯­è¨€å˜é‡ åˆå§‹åŒ– i18n å®ä¾‹ æ³¨å†Œ i18n å®ä¾‹ é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±å»å®ç°ä»¥ä¸‹ï¼š å®‰è£… vue-i18n1npm install vue-i18n@next åˆ›å»º i18n/index.js æ–‡ä»¶ åˆ›å»º messages æ•°æ®æº 123456789101112const messages = &#123; en: &#123; msg: &#123; test: &#x27;hello world&#x27; &#125; &#125;, zh: &#123; msg: &#123; test: &#x27;ä½ å¥½ä¸–ç•Œ&#x27; &#125; &#125;&#125; åˆ›å»º locale è¯­è¨€å˜é‡ 1const locale = &#x27;en&#x27; åˆå§‹åŒ– i18n å®ä¾‹ 12345678910import &#123; createI18n &#125; from &#x27;vue-i18n&#x27;const i18n = createI18n(&#123; // ä½¿ç”¨ Composition API æ¨¡å¼ï¼Œåˆ™éœ€è¦å°†å…¶è®¾ç½®ä¸ºfalse legacy: false, // å…¨å±€æ³¨å…¥ $t å‡½æ•° globalInjection: true, locale, messages&#125;) æŠŠ i18n æ³¨å†Œåˆ° vue å®ä¾‹ 1export default i18n åœ¨ main.js ä¸­å¯¼å…¥ 1234// i18n ï¼ˆPSï¼šå¯¼å…¥æ”¾åˆ° APP.vue å¯¼å…¥ä¹‹å‰ï¼Œå› ä¸ºåé¢æˆ‘ä»¬ä¼šåœ¨ app.vue ä¸­ä½¿ç”¨å›½é™…åŒ–å†…å®¹ï¼‰import i18n from &#x27;@/i18n&#x27;...app.use(i18n) åœ¨ layout/components/Sidebar/index.vue ä¸­ä½¿ç”¨ i18n 123&lt;h1 class=&quot;logo-title&quot; v-if=&quot;$store.getters.sidebarOpened&quot;&gt; &#123;&#123; $t(&#x27;msg.test&#x27;) &#125;&#125;&lt;/h1&gt; ä¿®æ”¹ locale çš„å€¼ï¼Œå³å¯æ”¹å˜å±•ç¤ºçš„å†…å®¹ æˆªæ­¢åˆ°ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº† i18n çš„æœ€åŸºç¡€ç”¨æ³•ï¼Œé‚£ä¹ˆè§£ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ i18n å®Œæˆå›½é™…åŒ–ã€‚ é¡¹ç›®ä¸­å®Œæˆå›½é™…åŒ–åˆ†æˆä»¥ä¸‹å‡ æ­¥è¿›è¡Œ: å°è£… langSelect ç»„ä»¶ç”¨äºä¿®æ”¹ locale å¯¼å…¥ el-locale è¯­è¨€åŒ… åˆ›å»ºè‡ªå®šä¹‰è¯­è¨€åŒ… å°è£… langSelect ç»„ä»¶ å®šä¹‰ store/app.js 123456789101112131415161718192021import &#123; LANG &#125; from &#x27;@/constant&#x27;import &#123; getItem, setItem &#125; from &#x27;@/utils/storage&#x27;export default &#123; namespaced: true, state: () =&gt; (&#123; ... language: getItem(LANG) || &#x27;zh&#x27; &#125;), mutations: &#123; ... /** * è®¾ç½®å›½é™…åŒ– */ setLanguage(state, lang) &#123; setItem(LANG, lang) state.language = lang &#125; &#125;, actions: &#123;&#125;&#125; åœ¨ constant ä¸­å®šä¹‰å¸¸é‡ 12// å›½é™…åŒ–export const LANG = &#x27;language&#x27; åˆ›å»º components/LangSelect/index 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;template&gt; &lt;el-dropdown trigger=&quot;click&quot; class=&quot;international&quot; @command=&quot;handleSetLanguage&quot; &gt; &lt;div&gt; &lt;el-tooltip content=&quot;å›½é™…åŒ–&quot; :effect=&quot;effect&quot;&gt; &lt;svg-icon icon=&quot;language&quot; /&gt; &lt;/el-tooltip&gt; &lt;/div&gt; &lt;template #dropdown&gt; &lt;el-dropdown-menu&gt; &lt;el-dropdown-item :disabled=&quot;language === &#x27;zh&#x27;&quot; command=&quot;zh&quot;&gt; ä¸­æ–‡ &lt;/el-dropdown-item&gt; &lt;el-dropdown-item :disabled=&quot;language === &#x27;en&#x27;&quot; command=&quot;en&quot;&gt; English &lt;/el-dropdown-item&gt; &lt;/el-dropdown-menu&gt; &lt;/template&gt; &lt;/el-dropdown&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; useI18n &#125; from &#x27;vue-i18n&#x27;import &#123; defineProps, computed &#125; from &#x27;vue&#x27;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; ElMessage &#125; from &#x27;element-plus&#x27;defineProps(&#123; effect: &#123; type: String, default: &#x27;dark&#x27;, validator: function(value) &#123; // è¿™ä¸ªå€¼å¿…é¡»åŒ¹é…ä¸‹åˆ—å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ª return [&#x27;dark&#x27;, &#x27;light&#x27;].indexOf(value) !== -1 &#125; &#125;&#125;)const store = useStore()const language = computed(() =&gt; store.getters.language)// åˆ‡æ¢è¯­è¨€çš„æ–¹æ³•const i18n = useI18n()const handleSetLanguage = lang =&gt; &#123; i18n.locale.value = lang store.commit(&#x27;app/setLanguage&#x27;, lang) ElMessage.success(&#x27;æ›´æ–°æˆåŠŸ&#x27;)&#125;&lt;/script&gt; åœ¨ navbar ä¸­å¯¼å…¥ LangSelect 123456789101112131415161718192021222324252627282930313233343536373839&lt;template&gt; &lt;div class=&quot;navbar&quot;&gt; ... &lt;div class=&quot;right-menu&quot;&gt; &lt;lang-select class=&quot;right-menu-item hover-effect&quot; /&gt; &lt;!-- å¤´åƒ --&gt; ... &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import LangSelect from &#x27;@/components/LangSelect&#x27;...&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;.navbar &#123; ... .right-menu &#123; ... ::v-deep .right-menu-item &#123; display: inline-block; padding: 0 18px 0 0; font-size: 24px; color: #5a5e66; vertical-align: text-bottom; &amp;.hover-effect &#123; cursor: pointer; &#125; &#125; ...&#125;&lt;/style&gt; element-plus å›½é™…åŒ–å¤„ç†æˆªæ­¢åˆ°ç›®å‰ï¼Œæˆ‘ä»¬çš„å›½é™…åŒ–å†…å®¹å·²ç»åŸºæœ¬åŠŸèƒ½å·²ç»å¤„ç†å®Œæˆäº†ã€‚æ¥ä¸‹æ¥éœ€è¦å¤„ç†çš„å°±æ˜¯å¯¹åº”çš„è¯­è¨€åŒ…ï¼Œæœ‰äº†è¯­è¨€åŒ…å°±å¯ä»¥å®ç°æ•´ä¸ªé¡¹ç›®ä¸­çš„æ‰€æœ‰å›½é™…åŒ–å¤„ç†äº†ã€‚ é‚£ä¹ˆå¯¹äºè¯­è¨€åŒ…æ¥è¯´ï¼Œæˆ‘ä»¬æ•´ä¸ªé¡¹ç›®ä¸­ä¼šåˆ†æˆä¸¤éƒ¨åˆ†ï¼š element-plus è¯­è¨€åŒ…ï¼šç”¨æ¥å¤„ç† element ç»„ä»¶çš„å›½é™…åŒ–åŠŸèƒ½ è‡ªå®šä¹‰è¯­è¨€åŒ…ï¼šç”¨æ¥å¤„ç† éelement ç»„ä»¶çš„å›½é™…åŒ–åŠŸèƒ½ é‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬å…ˆæ¥å¤„ç† element-plus è¯­è¨€åŒ…ï¼š åœ¨ plugins/index ä¸­å¯¼å…¥ element çš„ä¸­æ–‡ã€è‹±æ–‡è¯­è¨€åŒ…ï¼š 12import zhCn from &#x27;element-plus/es/locale/lang/zh-cn&#x27;import en from &#x27;element-plus/lib/locale/lang/en&#x27; æ³¨å†Œ element æ—¶ï¼Œæ ¹æ®å½“å‰è¯­è¨€é€‰æ‹©ä½¿ç”¨å“ªç§è¯­è¨€åŒ… 1234567import store from &#x27;@/store&#x27;export default app =&gt; &#123; app.use(ElementPlus, &#123; locale: store.getters.language === &#x27;en&#x27; ? en : zhCn &#125;)&#125; è‡ªå®šä¹‰è¯­è¨€åŒ…å›½é™…åŒ–å¤„ç†å¤„ç†å®Œ element çš„å›½é™…åŒ–å†…å®¹ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¤„ç† è‡ªå®šä¹‰è¯­è¨€åŒ…ã€‚ åœ¨æœ¬åœ°åˆ›å»º lang æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åˆ›å»ºå¥½æœ¬åœ°éœ€è¦çš„è¯­è¨€åŒ…ï¼Œç”±äºæ¯”è¾ƒå¤šï¼Œå°±æ”¾ä¸€éƒ¨åˆ†æ¥çœ‹çœ‹ï¼š 123456789101112131415161718192021// en.tsexport default &#123; login: &#123; title: &#x27;User Login&#x27;, loginBtn: &#x27;Login&#x27;, usernameRule: &#x27;Username is required&#x27;, passwordRule: &#x27;Password cannot be less than 6 digits&#x27;, &#125;, // other....&#125;// zh.tsexport default &#123; login: &#123; title: &#x27;ç”¨æˆ·ç™»å½•&#x27;, loginBtn: &#x27;ç™»å½•&#x27;, usernameRule: &#x27;ç”¨æˆ·åä¸ºå¿…å¡«é¡¹&#x27;, passwordRule: &#x27;å¯†ç ä¸èƒ½å°‘äº6ä½&#x27;, &#125;, // other...&#125; åœ¨ lang/index ä¸­ï¼Œå¯¼å…¥è¯­è¨€åŒ… 12import mZhLocale from &#x27;./lang/zh&#x27;import mEnLocale from &#x27;./lang/en&#x27; åœ¨ messages ä¸­æ³¨å†Œåˆ°è¯­è¨€åŒ… 123456789101112const messages = &#123; en: &#123; msg: &#123; ...mEnLocale &#125; &#125;, zh: &#123; msg: &#123; ...mZhLocale &#125; &#125;&#125; å¤„ç†é¡¹ç›®å›½é™…åŒ–å†…å®¹åœ¨å¤„ç†å¥½äº†å›½é™…åŒ–çš„è¯­è¨€åŒ…ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åº”ç”¨å›½é™…åŒ–åŠŸèƒ½åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ å¯¹äºæˆ‘ä»¬ç›®å‰çš„é¡¹ç›®è€Œè¨€ï¼Œéœ€è¦è¿›è¡Œå›½é™…åŒ–å¤„ç†çš„åœ°æ–¹ä¸»è¦åˆ†ä¸ºï¼š ç™»å½•é¡µé¢ navbar åŒºåŸŸ sidebar åŒºåŸŸ é¢åŒ…å±‘åŒºåŸŸ é‚£ä¹ˆè¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å…ˆæ¥å¤„ç†å‰ä¸¤ä¸ª ç™»å½•é¡µé¢ï¼š login/index 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;template&gt; &lt;div class=&quot;login-container&quot;&gt; ... &lt;div class=&quot;title-container&quot;&gt; &lt;h3 class=&quot;title&quot;&gt;&#123;&#123; $t(&#x27;msg.login.title&#x27;) &#125;&#125;&lt;/h3&gt; &lt;lang-select class=&quot;lang-select&quot; effect=&quot;light&quot;&gt;&lt;/lang-select&gt; &lt;/div&gt; ... &lt;el-button type=&quot;primary&quot; style=&quot;width: 100%; margin-bottom: 30px&quot; :loading=&quot;loading&quot; @click=&quot;handleLogin&quot; &gt;&#123;&#123; $t(&#x27;msg.login.loginBtn&#x27;) &#125;&#125;&lt;/el-button &gt; &lt;div class=&quot;tips&quot; v-html=&quot;$t(&#x27;msg.login.desc&#x27;)&quot;&gt;&lt;/div&gt; &lt;/el-form&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; useI18n &#125; from &#x27;vue-i18n&#x27;...// éªŒè¯è§„åˆ™const i18n = useI18n()const loginRules = ref(&#123; username: [ &#123; ... message: i18n.t(&#x27;msg.login.usernameRule&#x27;) &#125; ], ...&#125;)...&lt;/script&gt; login/rules 1234567891011import i18n from &#x27;@/i18n&#x27;export const validatePassword = () =&gt; &#123; return (rule, value, callback) =&gt; &#123; if (value.length &lt; 6) &#123; callback(new Error(i18n.global.t(&#x27;msg.login.passwordRule&#x27;))) &#125; else &#123; callback() &#125; &#125;&#125; navbar åŒºåŸŸ layout/components/navbar 1234567891011121314151617181920&lt;template&gt; &lt;div class=&quot;navbar&quot;&gt; ... &lt;template #dropdown&gt; &lt;el-dropdown-menu class=&quot;user-dropdown&quot;&gt; &lt;router-link to=&quot;/&quot;&gt; &lt;el-dropdown-item&gt; &#123;&#123; $t(&#x27;msg.navBar.home&#x27;) &#125;&#125; &lt;/el-dropdown-item&gt; &lt;/router-link&gt; &lt;a target=&quot;_blank&quot; href=&quot;&quot;&gt; &lt;el-dropdown-item&gt;&#123;&#123; $t(&#x27;msg.navBar.course&#x27;) &#125;&#125;&lt;/el-dropdown-item&gt; &lt;/a&gt; &lt;el-dropdown-item divided @click=&quot;logout&quot;&gt; &#123;&#123; $t(&#x27;msg.navBar.logout&#x27;) &#125;&#125; &lt;/el-dropdown-item&gt; &lt;/el-dropdown-menu&gt; &lt;/template&gt; &lt;/el-dropdown&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt; components/LangSelect/index 123456&lt;el-tooltip :content=&quot;$t(&#x27;msg.navBar.lang&#x27;)&quot; :effect=&quot;effect&quot;&gt;const handleSetLanguage = lang =&gt; &#123; ... ElMessage.success(i18n.t(&#x27;msg.toast.switchLangSuccess&#x27;))&#125; sidebar ä¸ é¢åŒ…å±‘ åŒºåŸŸçš„å›½é™…åŒ–å¤„ç†sidebar åŒºåŸŸ ç›®å‰å¯¹äº sidebar è€Œè¨€ï¼Œæ˜¾ç¤ºçš„æ–‡æœ¬æ˜¯æˆ‘ä»¬åœ¨å®šä¹‰è·¯ç”±è¡¨æ—¶çš„ title 1&lt;span&gt;&#123;&#123; title &#125;&#125;&lt;/span&gt; æˆ‘ä»¬å¯ä»¥ æŠŠ title ä½œä¸ºè¯­è¨€åŒ…å†…å®¹çš„ key è¿›è¡Œå¤„ç† åˆ›å»º utils/i18n å·¥å…·æ¨¡å—ï¼Œç”¨äº å°† title è½¬åŒ–ä¸ºå›½é™…åŒ–å†…å®¹ 12345import i18n from &#x27;@/i18n&#x27;export function generateTitle(title) &#123; return i18n.global.t(&#x27;msg.route.&#x27; + title)&#125; åœ¨ layout/components/Sidebar/MenuItem.vue ä¸­å¯¼å…¥è¯¥æ–¹æ³•ï¼š 12345678910&lt;template&gt; ... &lt;span&gt;&#123;&#123; generateTitle(title) &#125;&#125;&lt;/span&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; generateTitle &#125; from &#x27;@/utils/i18n&#x27;...&lt;/script&gt; æœ€åä¿®æ”¹ä¸‹ sidebarHeader çš„å†…å®¹ 123&lt;h1 class=&quot;logo-title&quot; v-if=&quot;$store.getters.sidebarOpened&quot;&gt; &#123;&#123; $t(&#x27;msg.logo&#x27;) &#125;&#125;&lt;/h1&gt; é¢åŒ…å±‘åŒºåŸŸï¼š åœ¨ components/Breadcrumb/index 123456789101112131415161718&lt;template&gt;... &lt;!-- ä¸å¯ç‚¹å‡»é¡¹ --&gt; &lt;span v-if=&quot;index === breadcrumbData.length - 1&quot; class=&quot;no-redirect&quot;&gt;&#123;&#123; generateTitle(item.meta.title) &#125;&#125;&lt;/span&gt; &lt;!-- å¯ç‚¹å‡»é¡¹ --&gt; &lt;a v-else class=&quot;redirect&quot; @click.prevent=&quot;onLinkClick(item)&quot;&gt;&#123;&#123; generateTitle(item.meta.title) &#125;&#125;&lt;/a&gt;...&lt;/template&gt;&lt;script setup&gt;import &#123; generateTitle &#125; from &#x27;@/utils/i18n&#x27;...&lt;/script&gt; å›½é™…åŒ–ç¼“å­˜å¤„ç†æˆ‘ä»¬å¸Œæœ›åœ¨ åˆ·æ–°é¡µé¢åï¼Œå½“å‰çš„å›½é™…åŒ–é€‰æ‹©å¯ä»¥è¢«ä¿ç•™ï¼Œæ‰€ä»¥æƒ³è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œ å›½é™…åŒ–çš„ç¼“å­˜å¤„ç† æ­¤å¤„çš„ç¼“å­˜ï¼Œæˆ‘ä»¬ä¾ç„¶é€šè¿‡ä¸¤ä¸ªæ–¹é¢è¿›è¡Œï¼š vuex ç¼“å­˜ LocalStorage ç¼“å­˜ åªä¸è¿‡è¿™é‡Œçš„ç¼“å­˜ï¼Œæˆ‘ä»¬å·²ç»åœ¨å¤„ç† langSelect ç»„ä»¶æ—¶ å¤„ç†å®Œæˆäº†ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ç¼“å­˜ä¸‹æ¥çš„æ•°æ®å³å¯ã€‚ åœ¨ i18n/index ä¸­ï¼Œåˆ›å»º getLanguage æ–¹æ³•ï¼š 1234567import store from &#x27;@/store&#x27;/** * è¿”å›å½“å‰ lang */function getLanguage() &#123; return store &amp;&amp; store.getters &amp;&amp; store.getters.language&#125; ä¿®æ”¹ createI18n çš„ locale ä¸º getLanguage() 1234const i18n = createI18n(&#123; ... locale: getLanguage()&#125;) å›½é™…åŒ–æ–¹æ¡ˆæ€»ç»“å›½é™…åŒ–æ˜¯å‰ç«¯é¡¹ç›®ä¸­çš„ä¸€ä¸ªéå¸¸å¸¸è§çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨å‰ç«¯é¡¹ç›®ä¸­å®ç°å›½é™…åŒ–ä¸»è¦ä¾é çš„å°±æ˜¯ vue-i18n è¿™ä¸ªç¬¬ä¸‰æ–¹çš„åŒ…ã€‚ å…³äºå›½é™…åŒ–çš„å®ç°åŸç†å¤§å®¶å¯ä»¥å‚ç…§ å›½é™…åŒ–å®ç°åŸç† è¿™ä¸€å°èŠ‚ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸å†èµ˜è¿°äº†ã€‚ è€Œ i18n çš„ä½¿ç”¨ï¼Œæ•´ä½“æ¥è¯´å°±åˆ†ä¸ºè¿™ä¹ˆå››æ­¥ï¼š åˆ›å»º messages æ•°æ®æº åˆ›å»º locale è¯­è¨€å˜é‡ åˆå§‹åŒ– i18n å®ä¾‹ æ³¨å†Œ i18n å®ä¾‹ æ ¸å¿ƒçš„å†…å®¹å…¶å®å°±æ˜¯ æ•°æ®æºçš„éƒ¨åˆ†ï¼Œä½†æ˜¯å¤§å®¶éœ€è¦æ³¨æ„ï¼Œå¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨äº† ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ ï¼Œé‚£ä¹ˆä¸è¦å¿˜è®° ç¬¬ä¸‰æ–¹ç»„ä»¶åº“çš„æ•°æ®æº éœ€è¦ å•ç‹¬ è¿›è¡Œå¤„ç†ï¼ åŠ¨æ€æ¢è‚¤åŸç†åˆ†ææƒ³è¦å®ç° åŠ¨æ€æ¢è‚¤ çš„ä¸€ä¸ªå‰ç½®æ¡ä»¶å°±æ˜¯ï¼šè‰²å€¼ä¸å¯ä»¥å†™æ­»ï¼ é¦–å…ˆæˆ‘ä»¬å…ˆæ¥è¯´ä¸€ä¸‹åŠ¨æ€æ¢è‚¤çš„å®ç°æ–¹å¼ã€‚ åœ¨ scss ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ $å˜é‡å:å˜é‡å€¼ çš„æ–¹å¼å®šä¹‰ css å˜é‡ ï¼Œç„¶åé€šè¿‡è¯¥ css æ¥å»æŒ‡å®šæŸä¸€å— DOM å¯¹åº”çš„é¢œè‰²ã€‚ é‚£ä¹ˆå¤§å®¶å¯ä»¥æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘æ­¤æ—¶æ”¹å˜äº†è¯¥ css å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆå¯¹åº”çš„ DOM é¢œè‰²æ˜¯ä¸æ˜¯ä¹Ÿä¼šåŒæ­¥å‘ç”Ÿå˜åŒ–ã€‚ å½“å¤§é‡çš„ DOM éƒ½ä¾èµ–è¿™ä¸ª css å˜é‡ è®¾ç½®é¢œè‰²æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯åªéœ€è¦æ”¹å˜è¿™ä¸ª css å˜é‡ ï¼Œé‚£ä¹ˆæ‰€æœ‰ DOM çš„é¢œè‰²æ˜¯ä¸æ˜¯éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€è°“çš„ åŠ¨æ€æ¢è‚¤ æ˜¯ä¸æ˜¯å°±å¯ä»¥å®ç°äº†ï¼ è¿™ä¸ªå°±æ˜¯ åŠ¨æ€æ¢è‚¤ çš„å®ç°åŸç†! å®ç°æ¢è‚¤å’Œä¸»é¢˜å¤§è‡´æœ‰ä¸¤ç§æ–¹æ¡ˆ: ä½¿ç”¨åŸç”Ÿæ”¯æŒçš„ css var é€šè¿‡ä¸€äº›æ‰‹æ®µè¦†ç›– element plus æ ·å¼ æˆ‘ä»¬å…ˆçœ‹æ¥çœ‹çœ‹ css var çš„å®ç°å§ã€‚ csså˜é‡ https://developer.mozilla.org/zh-CN/docs/Web/CSS/:root å˜é‡ ä¸ colorã€font-size ç­‰æ­£å¼å±æ€§æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œåªæ˜¯æ²¡æœ‰é»˜è®¤å«ä¹‰ã€‚ æ‰€ä»¥ CSS å˜é‡ï¼ˆCSS variableï¼‰åˆå«åšâ€CSS è‡ªå®šä¹‰å±æ€§â€ï¼ˆCSS custom propertiesï¼‰ã€‚å› ä¸ºå˜é‡ä¸è‡ªå®šä¹‰çš„ CSS å±æ€§å…¶å®æ˜¯ä¸€å›äº‹ã€‚ å˜é‡å¯ä»¥åˆ†ä¸º å…¨å±€å˜é‡ å±€éƒ¨å˜é‡ å…¨å±€å˜é‡é€šè¿‡ :root å»å®šä¹‰ï¼Œå…¶ä»–æ‰€æœ‰çš„å…ƒç´ éƒ½å¯ä»¥é€šè¿‡ var(--xxx) çš„å½¢å¼å»ä½¿ç”¨å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­: var()å‡½æ•°è¿˜å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå˜é‡çš„é»˜è®¤å€¼ã€‚å¦‚æœè¯¥å˜é‡ä¸å­˜åœ¨ï¼Œå°±ä¼šä½¿ç”¨è¿™ä¸ªé»˜è®¤å€¼ã€‚ 123456789101112&lt;style&gt; :root &#123; --color: skyblue; &#125; .use-global &#123; color: var(--color) &#125;&lt;/style&gt;// body&lt;div class=&quot;use-global&quot;&gt;ä½¿ç”¨äº†å…¨å±€å˜é‡&lt;/div&gt; :root :root è¿™ä¸ª CSS ä¼ªç±»åŒ¹é…æ–‡æ¡£æ ‘çš„æ ¹å…ƒç´ ã€‚å¯¹äº HTML æ¥è¯´ï¼Œ:root è¡¨ç¤º å…ƒç´ ï¼Œé™¤äº†ä¼˜å…ˆçº§æ›´é«˜ä¹‹å¤–ï¼Œä¸ html é€‰æ‹©å™¨ç›¸åŒã€‚ è‡ªå®šä¹‰å±æ€§ (â€“*)ï¼šCSS å˜é‡ å¸¦æœ‰å‰ç¼€â€“çš„å±æ€§åï¼Œæ¯”å¦‚â€“exampleâ€“nameï¼Œè¡¨ç¤ºçš„æ˜¯å¸¦æœ‰å€¼çš„è‡ªå®šä¹‰å±æ€§ï¼Œå…¶å¯ä»¥é€šè¿‡ var å‡½æ•°åœ¨å…¨æ–‡æ¡£èŒƒå›´å†…å¤ç”¨çš„ã€‚ å±€éƒ¨å˜é‡ æˆ‘ä»¬å¯ä»¥åœ¨æŸä¸ªé€‰æ‹©å™¨ä¸‹å»å®šä¹‰å˜é‡ï¼Œæˆ–è€…åœ¨å…ƒç´ çš„ style å±æ€§ä¸Šå®šä¹‰å˜é‡ï¼š 1234567891011121314151617// style:root &#123; --color: skyblue;&#125;.parent &#123; --color: pink; // ä¼˜å…ˆçº§æ›´é«˜&#125;h3 &#123; color: var(--color)&#125;// html&lt;div class=&quot;parent&quot;&gt; &lt;h3&gt;child title&lt;/h3&gt;&lt;/div&gt; è¿™é‡Œ h3 æ ‡ç­¾ä¼šæ˜¾ç¤ºçº¢è‰²ã€‚è™½ç„¶æˆ‘ä»¬åœ¨ :root ä¸Šä¹Ÿå®šä¹‰äº† --color å˜é‡ï¼Œä½†æ˜¯æ ¹æ®å°±è¿‘åŸåˆ™ï¼Œh3 ä¼šå–çˆ¶çº§å®šä¹‰çš„å˜é‡ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ style å±æ€§ä¸Šå®šä¹‰å˜é‡ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª --bg å˜é‡ï¼Œå…¶å­å…ƒç´ å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå˜é‡ã€‚ 123456789101112.parent &#123; --color: pink;&#125;h3 &#123; color: var(--color); background-color: var(--bg);&#125;&lt;div class=&quot;parent&quot; style=&quot;--bg: black;&quot;&gt; &lt;h3&gt;child title&lt;/h3&gt;&lt;/div&gt; ä¿®æ”¹ css å˜é‡è¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªä¿®æ”¹å…¨å±€çš„ï¼ˆæ ¹ç»„ä»¶ï¼‰çš„å˜é‡ï¼Œä¸€ä¸ªç”¨æ¥ä¿®æ”¹ç‰¹å®šå…ƒç´ ä¸Šçš„å®šä¹‰çš„å˜é‡ï¼š 12&lt;button class=&quot;btn&quot;&gt;change root&lt;/button&gt;&lt;button class=&quot;variable&quot;&gt;change local variable&lt;/button&gt; ä¿®æ”¹å…¨å±€å˜é‡ 1234567const btn = document.querySelector(&#x27;.btn&#x27;)btn.addEventListener(&#x27;click&#x27;, () =&gt; &#123; const html = document.documentElement html.style.setProperty(&#x27;--color&#x27;, &#x27;red&#x27;)&#125;) ä¿®æ”¹å±€éƒ¨å˜é‡ 1234567const variableBtn = document.querySelector(&#x27;.variable&#x27;)variableBtn.addEventListener(&#x27;click&#x27;, () =&gt; &#123; const parent = document.querySelector(&#x27;.parent&#x27;) parent.style.setProperty(&#x27;--color&#x27;, &#x27;green&#x27;)&#125;) æš—é»‘æ¨¡å¼åŸç†åˆ†æ prefers-color-scheme prefers-color-scheme CSS åª’ä½“ç‰¹æ€§: ç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦æœ‰å°†ç³»ç»Ÿçš„ä¸»é¢˜è‰²è®¾ç½®ä¸ºäº®è‰²æˆ–è€…æš—è‰²ã€‚ ä¸»é¢˜è‰²å®ç°åŸç†é€šè¿‡ åª’ä½“æŸ¥è¯¢ å»ç›‘å¬ç³»ç»Ÿä¸»é¢˜è‰²çš„å˜åŒ–ã€‚ 12345678910111213141516171819202122232425// style@media (prefers-color-scheme: dark) &#123; .day.dark-scheme &#123; background: #333; color: white; &#125; .night.dark-scheme &#123; background: black; color: red; &#125;&#125;@media (prefers-color-scheme: light) &#123; .day.light-scheme &#123; background: skyblue; color: #333; &#125; .night.light-scheme &#123; background: pink; color: #333; &#125;&#125;.day, .night &#123; display: inline-block; padding: 1em; width: 7em; height: 7em; vertical-align: middle;&#125;// html&lt;div class=&quot;day light-scheme&quot;&gt;Day (changes in light scheme)&lt;/div&gt;&lt;div class=&quot;day dark-scheme&quot;&gt;Day (changes in dark scheme)&lt;/div&gt; &lt;br&gt;&lt;div class=&quot;night light-scheme&quot;&gt;Night (changes in light scheme)&lt;/div&gt;&lt;div class=&quot;night dark-scheme&quot;&gt;Night (changes in dark scheme)&lt;/div&gt; ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å»åˆ‡æ¢ç³»ç»Ÿçš„ä¸»é¢˜è‰²ï¼Œå°±ä¼šå‘ç°é¡µé¢ä¸Šçš„é¢œè‰²è·Ÿç€å˜åŒ–äº†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬é€šè¿‡ @media ç›‘å¬ prefers-color-scheme èµ·ä½œç”¨äº†ã€‚ window.matchMediaè™½ç„¶æˆ‘ä»¬é€šè¿‡ css @media èƒ½å¤Ÿåº”å¯¹ç³»ç»Ÿçš„ä¸»é¢˜è‰²åˆ‡æ¢ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•åœ¨ js ä¸­å»ç›‘å¬å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯é€šè¿‡ window.matchMedia æ–¹æ³•ï¼š 1234567891011// å¦‚æœåŒ¹é…æˆåŠŸï¼Œscheme.matches === true// ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯æš—é»‘è‰²ï¼Œé‚£ä¹ˆè¿™ä¸ª matches å°±æ˜¯trueï¼Œå¦åˆ™æ˜¯ falseconst scheme = window.matchMedia(&#x27;(prefers-color-scheme: dark)&#x27;)scheme.addEventListener(&#x27;change&#x27;, e =&gt; &#123; if (e.matches) &#123; // æš—é»‘è‰² &#125; else &#123; // äº®è‰² &#125;&#125;) ä¿®æ”¹ä¸»é¢˜è‰²åˆ°æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“äº†ä¸»é¢˜è‰²çš„å®ç°åŸç†ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨é¡¹ç›®é‡Œå»å®ç°ä¸»é¢˜è‰²çš„åˆ‡æ¢å‘¢ï¼Ÿ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å¥½ å…¨å±€å˜é‡ï¼Œé‡Œé¢åŒ…å«äº†ä¸€äº› äº®è‰²æ¨¡å¼ ä¸‹çš„å˜é‡ï¼š 12345678910:root &#123; --color: #333; --background-color: pink;&#125;&lt;h1 style=&quot;background-color: var(--background-color); color: var(--color)&quot;&gt; æˆ‘æ˜¯ä¸€ä¸ªæ ‡é¢˜ã€‚ï¼ï¼ï¼&lt;/h1&gt;&lt;button class=&quot;dark-btn&quot;&gt;dark mode&lt;/button&gt; åœ¨é¡µé¢åˆå§‹æ—¶ï¼Œæˆ‘ä»¬çš„èƒŒæ™¯è‰²æ˜¯ç²‰è‰²ï¼Œé¢œè‰²æ˜¯æµ…é»‘è‰²ã€‚ ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œæ¥ä¿®æ”¹ä¸»é¢˜é¢œè‰²ï¼Œè¿™ä¸ªä¹‹å‰å®ç°è¿‡äº†å¾ˆç®€å•å¯¹å§ã€‚ 1234567const darkBtn = document.querySelector(&#x27;.dark-btn&#x27;)darkBtn.addEventListener(&#x27;click&#x27;, () =&gt; &#123; // ä¿®æ”¹å˜é‡ document.documentElement.style.setProperty(&#x27;--color&#x27;, &#x27;#fff&#x27;) document.documentElement.style.setProperty(&#x27;--background-color&#x27;, &#x27;#000&#x27;)&#125;) å¥½æ— ç–‘é—®è¿™æ ·æ˜¯å¯ä»¥å®ç°çš„ï¼Œä½†æ˜¯ï¼Œå¦‚æœå˜é‡å¤šèµ·æ¥äº†ï¼Œå‡ åä¸Šç™¾ä¸ªï¼Œæˆ‘ä»¬ä¹Ÿè¦ä¸€ä¸ªä¸ªå»ä¿®æ”¹å—ï¼Ÿ æ—¢ç„¶æˆ‘ä»¬çš„å˜é‡éƒ½å®šä¹‰åœ¨æ ¹å…ƒç´ ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡å– å±æ€§è¦†ç›– çš„å½¢å¼ã€‚ æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª [data-theme=&quot;dark&quot;] æ ·å¼è¡¨ï¼Œä¸“é—¨ç”¨æ¥å¤„ç† æš—é»‘æ¨¡å¼ ä¸‹çš„å˜é‡ï¼Œè¿™é‡Œæ˜¯é»‘è‰²èƒŒæ™¯ç™½è‰²å­—ä½“ã€‚ 1234[data-theme=&quot;dark&quot;] &#123; --color: #fff; --background-color: #000;&#125; æˆ–è€…å±æ€§é€‰æ‹©å™¨ï¼š 1234567891011/* æµ…è‰²æ¨¡å¼ */html[data-theme=&quot;light&quot;]:root &#123; --body-background: #efefef; --text-color: #333;&#125;/* æ·±è‰²æ¨¡å¼ */html[data-theme=&quot;dark&quot;]:root &#123; --body-background: #000; --text-color: #ededed;&#125; ä¸€å¼€å§‹ï¼Œè¿™ä¸ªæ ·å¼è¡¨å¹¶ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºæ ¹æ ‡ç­¾ä¸Šæ ¹æœ¬æ²¡æœ‰ data-theme=&quot;dark&quot; å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‰é’®æ¥ä¿®æ”¹ï¼š 123darkBtn.addEventListener(&#x27;click&#x27;, () =&gt; &#123; document.documentElement.setAttribute(&#x27;data-theme&#x27;, &#x27;dark&#x27;)&#125;) æˆ‘ä»¬ç»™æ ¹æ ‡ç­¾è®¾ç½®äº† data-theme=&quot;dark&quot; å±æ€§ï¼ŒåŒæ—¶å†…éƒ¨å®šäº†æš—é»‘ç›¸å…³çš„å˜é‡ï¼Œè¿™æ—¶ï¼Œdata-theme=&quot;dark&quot; å†…éƒ¨çš„å˜é‡å°±ä¼šè¦†ç›– :root ä¸­çš„å˜é‡äº†ï¼Œä»è€Œè¾¾åˆ°åˆ‡æ¢ä¸»é¢˜è‰²çš„æ•ˆæœã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ç³»ç»Ÿçš„ä¸»é¢˜è‰²ï¼Œæ¥è®¾ç½®é¡¹ç›®çš„ä¸»é¢˜è‰²ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ° window.matchMedia æ–¹æ³•äº†ã€‚ å¦‚æœåœ¨ Vue é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å»å®ç°: 1234567891011121314151617181920212223242526272829303132const theme = computed(() =&gt; store.state.settings.theme);// æŸ¥çœ‹å½“å‰æ˜¯å¦æ˜¯ æš—é»‘æ¨¡å¼const mediaQueryListDark = window.matchMedia(&#x27;(prefers-color-scheme: dark)&#x27;);const changeTheme = (theme) =&gt; &#123; // æ‰¹é‡è¦†ç›–å…¨å±€çš„å˜é‡ document.documentElement.setAttribute(&#x27;data-theme&#x27;, theme);&#125;;const handleColorSchemeChange = evt =&gt; &#123; if (evt.matches) &#123; changeTheme(&#x27;dark&#x27;); &#125; else &#123; changeTheme(&#x27;light&#x27;); &#125;&#125;;watchEffect(() =&gt; &#123; if (theme.value === &#x27;Follow System&#x27;) &#123; // åˆå§‹å€¼ï¼šè·Ÿéšç³»ç»Ÿè®¾ç½® handleColorSchemeChange(mediaQueryListDark); // ç›‘å¬ç³»ç»Ÿä¸»é¢˜çš„å˜åŒ– mediaQueryListDark.addEventListener(&#x27;change&#x27;, handleColorSchemeChange); &#125; else if (theme.value) &#123; changeTheme(theme.value.toLowerCase()); // å¦‚æœä¸æ˜¯è·Ÿéšç³»ç»Ÿè®¾ç½®ä¸»é¢˜äº†ï¼Œç”¨æˆ·è‡ªå·±è®¾ç½®çš„ä¸»é¢˜è‰²ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦ç›‘å¬ç³»ç»Ÿçš„ä¸»é¢˜è‰²åˆ‡æ¢äº† mediaQueryListDark.removeEventListener(&#x27;change&#x27;, handleColorSchemeChange); &#125;&#125;); æ€»ç»“åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬èŠ±äº†å¤§é‡çš„æ—¶é—´å’Œå®ä¾‹å¯¹æ¢è‚¤å’Œä¸»é¢˜çš„åŸç†è¿›è¡Œäº†ç ”ç©¶ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦è¿›å…¥æ­£å¼çš„é¡¹ç›®å¼€å‘ç¯èŠ‚äº†ã€‚ å®˜æ–¹æ¢è‚¤æ–¹æ¡ˆ å®˜æ–¹æ ·å¼è·¯å¾„ï¼š/node_modules/element-plus/theme-chalk/src/common/var.scss å®šä¹‰è‡ªå·±çš„ scss æ–‡ä»¶ï¼Œç„¶ååœ¨ main.ts å¯¼å…¥ã€‚ 123456789101112131415161718192021222324252627$--colors: ( &quot;primary&quot;: ( &quot;base&quot;: pink, ), &quot;success&quot;: ( &quot;base&quot;: blue, ), &quot;warning&quot;: ( &quot;base&quot;: #f2711c, ), &quot;danger&quot;: ( &quot;base&quot;: #db2828, ), &quot;error&quot;: ( &quot;base&quot;: #db2828, ), &quot;info&quot;: ( &quot;base&quot;: #42b8dd, ),);@forward &#x27;element-plus/theme-chalk/src/common/var.scss&#x27; with ( $colors: $--colors,);/* å¯¼å…¥æ‰€æœ‰çš„æ ·å¼å˜é‡ */@use &quot;element-plus/theme-chalk/src/index.scss&quot; as *; ä¿®æ”¹ main.ts 123456// æ³¨é‡ŠåŸå¯¼å…¥çš„ element-plus æ ·å¼// import &#x27;element-plus/dist/index.css&#x27;// å¯¼å…¥æˆ‘ä»¬è‡ªå·±çš„å®šä¹‰çš„æ ·å¼import &#x27;@/styles/cover-element-plus.scss&#x27; é€šè¿‡ CSS å˜é‡è®¾ç½®å¦‚æœä¸é€šè¿‡ä¸Šé¢é‚£ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰å…¨å±€çš„å˜é‡ï¼Œæ¥è¦†ç›–å®˜æ–¹çš„æ ·å¼ã€‚ åœ¨è‡ªå·±çš„æ ·å¼æ–‡ä»¶ä¸­å†™å…¥éœ€è¦è¦†ç›–çš„æ ·å¼å˜é‡ï¼š 123:root &#123; --el-color-primary: green;&#125; å¦‚æœä½ åªæƒ³è‡ªå®šä¹‰ä¸€ä¸ªç‰¹å®šçš„ç»„ä»¶ï¼Œåªéœ€ä¸ºæŸäº›ç»„ä»¶å•ç‹¬æ·»åŠ å†…è”æ ·å¼ã€‚ 1&lt;el-tag style=&quot;--el-tag-bg-color: red&quot;&gt;Tag&lt;/el-tag&gt; å‡ºäºæ€§èƒ½åŸå› ï¼Œæ›´åŠ æ¨èä½ åœ¨ç±»åä¸‹æ·»åŠ è‡ªå®šä¹‰ css å˜é‡ï¼Œè€Œä¸æ˜¯åœ¨å…¨å±€çš„ :root ä¸‹ã€‚ 123.custom-class &#123; --el-tag-bg-color: red;&#125; å¦‚æœæ‚¨æƒ³è¦é€šè¿‡ js æ§åˆ¶ css å˜é‡ï¼Œå¯ä»¥è¿™æ ·åšï¼š 123456789// document.documentElement æ˜¯å…¨å±€å˜é‡æ—¶const el = document.documentElement// const el = document.getElementById(&#x27;xxx&#x27;)// è·å– css å˜é‡getComputedStyle(el).getPropertyValue(`--el-color-primary`)// è®¾ç½® css å˜é‡el.style.setProperty(&#x27;--el-color-primary&#x27;, &#x27;red&#x27;) æ€»ç»“ã€‚ç›¸å½“äºæˆ‘ä»¬é‡æ–°å®šä¹‰äº†å˜é‡ï¼Œè¦†ç›–äº†å®˜æ–¹è‡ªå·±å®šä¹‰çš„å˜é‡ï¼Œå¦‚æœæˆ‘ä»¬é¡¹ç›®åªéœ€è¦ä¸€ç§é¢œè‰²ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ¡ˆæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æˆ‘ä»¬é¡¹ç›®éœ€è¦æ”¯æŒç”¨æˆ·é€‰æ‹©ä¸»é¢˜æ¥æ›¿æ¢ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ¡ˆå°±ä¸é€‚ç”¨äº†ã€‚ é‚£ä¹ˆæˆ‘æ¥ç”¨å¦ä¸€ç§æ–¹æ¡ˆæ¥å®ç°å§ã€‚ æ¢è‚¤æ–¹æ¡ˆè½åœ°åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æƒ³è¦å®ç°åŠ¨æ€æ¢è‚¤ï¼Œéœ€è¦åŒæ—¶å¤„ç†ä¸¤ä¸ªæ–¹é¢çš„å†…å®¹ï¼š element-plus ä¸»é¢˜ é element-plus ä¸»é¢˜ æ˜ç¡®å¥½äº†åŸç†ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ç†ä¸€ä¸‹å’±ä»¬çš„å®ç°æ€è·¯ã€‚ ä»åŸç†ä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¸¤ä¸ªå…³é”®ä¿¡æ¯ï¼š åŠ¨æ€æ¢è‚¤çš„å…³é”®æ˜¯ä¿®æ”¹ css å˜é‡ çš„å€¼ æ¢è‚¤éœ€è¦åŒæ—¶å…¼é¡¾ element-plus é element-plus é‚£ä¹ˆæ ¹æ®ä»¥ä¸Šå…³é”®ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºå¯¹åº”çš„å®ç°æ–¹æ¡ˆ: åˆ›å»ºä¸€ä¸ªç»„ä»¶ ThemeSelect ç”¨æ¥å¤„ç†ä¿®æ”¹ä¹‹åçš„ css å˜é‡ çš„å€¼ æ ¹æ®æ–°å€¼ä¿®æ”¹ element-plus ä¸»é¢˜è‰² æ ¹æ®æ–°å€¼ä¿®æ”¹é element-plus ä¸»é¢˜è‰² åˆ›å»º ThemeSelect ç»„ä»¶ThemeSelect ç»„ä»¶å°†ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š navbar ä¸­çš„å±•ç¤ºå›¾æ ‡ é€‰æ‹©é¢œè‰²çš„å¼¹å‡ºå±‚ è¿™æ˜¯æ•ˆæœå›¾ï¼š åˆ›å»º components/ThemeSelect/index ç»„ä»¶ 123456789101112131415161718192021222324252627282930313233&lt;template&gt; &lt;!-- ä¸»é¢˜å›¾æ ‡ v-bindï¼šhttps://v3.cn.vuejs.org/api/instance-properties.html#attrs --&gt; &lt;el-dropdown v-bind=&quot;$attrs&quot; trigger=&quot;click&quot; class=&quot;theme&quot; @command=&quot;handleSetTheme&quot; &gt; &lt;div&gt; &lt;el-tooltip :content=&quot;$t(&#x27;msg.navBar.themeChange&#x27;)&quot;&gt; &lt;svg-icon icon=&quot;change-theme&quot; /&gt; &lt;/el-tooltip&gt; &lt;/div&gt; &lt;template #dropdown&gt; &lt;el-dropdown-menu&gt; &lt;el-dropdown-item command=&quot;color&quot;&gt; &#123;&#123; $t(&#x27;msg.theme.themeColorChange&#x27;) &#125;&#125; &lt;/el-dropdown-item&gt; &lt;/el-dropdown-menu&gt; &lt;/template&gt; &lt;/el-dropdown&gt; &lt;!-- å±•ç¤ºå¼¹å‡ºå±‚ --&gt; &lt;div&gt; ... &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;const handleSetTheme = command =&gt; &#123;&#125;&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt; åœ¨ layout/components/navbar ä¸­è¿›è¡Œå¼•ç”¨ 1234567&lt;div class=&quot;right-menu&quot;&gt; &lt;theme-picker class=&quot;right-menu-item hover-effect&quot;&gt;&lt;/theme-picker&gt;&lt;/div&gt;... import ThemePicker from &#x27;@/components/ThemeSelect/index&#x27; åˆ›å»º SelectColor ç»„ä»¶ åœ¨æœ‰äº† ThemeSelect ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å»å¤„ç†é¢œè‰²é€‰æ‹©çš„ç»„ä»¶ SelectColorï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¼šç”¨åˆ° element ä¸­çš„ el-color-picker ç»„ä»¶ å¯¹äº SelectColor çš„å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æˆä¸¤æ­¥è¿›è¡Œï¼š å®Œæˆ SelectColor å¼¹çª—å±•ç¤ºçš„åŒå‘æ•°æ®ç»‘å®š æŠŠé€‰ä¸­çš„è‰²å€¼è¿›è¡Œæœ¬åœ°ç¼“å­˜ é‚£ä¹ˆä¸‹é¢å’±ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€æ­¥ï¼šå®Œæˆ SelectColor å¼¹çª—å±•ç¤ºçš„åŒå‘æ•°æ®ç»‘å®š åˆ›å»º components/ThemePicker/components/SelectColor.vue 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&lt;template&gt; &lt;el-dialog title=&quot;æç¤º&quot; :model-value=&quot;modelValue&quot; @close=&quot;closed&quot; width=&quot;22%&quot;&gt; &lt;div class=&quot;center&quot;&gt; &lt;p class=&quot;title&quot;&gt;&#123;&#123; $t(&#x27;msg.theme.themeColorChange&#x27;) &#125;&#125;&lt;/p&gt; &lt;el-color-picker v-model=&quot;mColor&quot; :predefine=&quot;predefineColors&quot; &gt;&lt;/el-color-picker&gt; &lt;/div&gt; &lt;template #footer&gt; &lt;span class=&quot;dialog-footer&quot;&gt; &lt;el-button @click=&quot;closed&quot;&gt;&#123;&#123; $t(&#x27;msg.universal.cancel&#x27;) &#125;&#125;&lt;/el-button&gt; &lt;el-button type=&quot;primary&quot; @click=&quot;comfirm&quot;&gt;&#123;&#123; $t(&#x27;msg.universal.confirm&#x27;) &#125;&#125;&lt;/el-button&gt; &lt;/span&gt; &lt;/template&gt; &lt;/el-dialog&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; defineProps, defineEmits, ref &#125; from &#x27;vue&#x27;defineProps(&#123; modelValue: &#123; type: Boolean, required: true &#125;&#125;)const emits = defineEmits([&#x27;update:modelValue&#x27;])// é¢„å®šä¹‰è‰²å€¼const predefineColors = [ &#x27;#ff4500&#x27;, &#x27;#ff8c00&#x27;, &#x27;#ffd700&#x27;, &#x27;#90ee90&#x27;, &#x27;#00ced1&#x27;, &#x27;#1e90ff&#x27;, &#x27;#c71585&#x27;, &#x27;rgba(255, 69, 0, 0.68)&#x27;, &#x27;rgb(255, 120, 0)&#x27;, &#x27;hsv(51, 100, 98)&#x27;, &#x27;hsva(120, 40, 94, 0.5)&#x27;, &#x27;hsl(181, 100%, 37%)&#x27;, &#x27;hsla(209, 100%, 56%, 0.73)&#x27;, &#x27;#c7158577&#x27;]// é»˜è®¤è‰²å€¼const mColor = ref(&#x27;#00ff00&#x27;)/** * å…³é—­ */const closed = () =&gt; &#123; emits(&#x27;update:modelValue&#x27;, false)&#125;/** * ç¡®å®š * 1. ä¿®æ”¹ä¸»é¢˜è‰² * 2. ä¿å­˜æœ€æ–°çš„ä¸»é¢˜è‰² * 3. å…³é—­ dialog */const comfirm = async () =&gt; &#123; closed()&#125;&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;.center &#123; text-align: center; .title &#123; margin-bottom: 12px; &#125;&#125;&lt;/style&gt; åœ¨ ThemePicker/index ä¸­ä½¿ç”¨è¯¥ç»„ä»¶ 123456789101112131415161718&lt;template&gt; ... &lt;!-- å±•ç¤ºå¼¹å‡ºå±‚ --&gt; &lt;div&gt; &lt;select-color v-model=&quot;selectColorVisible&quot;&gt;&lt;/select-color&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import SelectColor from &#x27;./components/SelectColor.vue&#x27;import &#123; ref &#125; from &#x27;vue&#x27;const selectColorVisible = ref(false)const handleSetTheme = command =&gt; &#123; selectColorVisible.value = true&#125;&lt;/script&gt; å®ŒæˆåŒå‘æ•°æ®ç»‘å®šä¹‹åï¼Œæˆ‘ä»¬æ¥å¤„ç†ç¬¬äºŒæ­¥ï¼šæŠŠé€‰ä¸­çš„è‰²å€¼è¿›è¡Œæœ¬åœ°ç¼“å­˜ ç¼“å­˜çš„æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼š vuex æœ¬åœ°å­˜å‚¨ åœ¨ constants/index ä¸‹æ–°å»ºå¸¸é‡å€¼ 1234// ä¸»é¢˜è‰²ä¿å­˜çš„ keyexport const MAIN_COLOR = &#x27;mainColor&#x27;// é»˜è®¤è‰²å€¼export const DEFAULT_COLOR = &#x27;#409eff&#x27; åˆ›å»º store/modules/theme æ¨¡å—ï¼Œç”¨æ¥å¤„ç† ä¸»é¢˜è‰² ç›¸å…³å†…å®¹ 1234567891011121314151617import &#123; getItem, setItem &#125; from &#x27;@/utils/storage&#x27;import &#123; MAIN_COLOR, DEFAULT_COLOR &#125; from &#x27;@/constant&#x27;export default &#123; namespaced: true, state: () =&gt; (&#123; mainColor: getItem(MAIN_COLOR) || DEFAULT_COLOR &#125;), mutations: &#123; /** * è®¾ç½®ä¸»é¢˜è‰² */ setMainColor(state, newColor) &#123; state.mainColor = newColor setItem(MAIN_COLOR, newColor) &#125; &#125;&#125; åœ¨ store/getters ä¸‹æŒ‡å®šå¿«æ·è®¿é—® 1mainColor: state =&gt; state.theme.mainColor åœ¨ store/index ä¸­å¯¼å…¥ theme 12345678910...import theme from &#x27;./modules/theme.js&#x27;export default createStore(&#123; getters, modules: &#123; ... theme &#125;&#125;) åœ¨ selectColor ä¸­ï¼Œè®¾ç½®åˆå§‹è‰²å€¼ å’Œ ç¼“å­˜è‰²å€¼ 12345678910111213141516171819202122232425262728...&lt;script setup&gt;import &#123; defineProps, defineEmits, ref &#125; from &#x27;vue&#x27;import &#123; useStore &#125; from &#x27;vuex&#x27;...const store = useStore()// é»˜è®¤è‰²å€¼const mColor = ref(store.getters.mainColor).../** * ç¡®å®šæŒ‰é’® * * 1. ä¿®æ”¹ä¸»é¢˜è‰² * 2. ä¿å­˜æœ€æ–°çš„ä¸»é¢˜è‰² * 3. å…³é—­ dialog * */const comfirm = async () =&gt; &#123; // 2. ä¿å­˜æœ€æ–°çš„ä¸»é¢˜è‰² store.commit(&#x27;theme/setMainColor&#x27;, mColor.value) // 3. å…³é—­ dialog closed()&#125;&lt;/script&gt; scss mixæ–¹æ³•123456789// ç»™å½“å‰çš„é¢œè‰²å€¼ï¼Œæ·»åŠ ä¸Š 50% çš„ç™½è‰².white &#123; color: mix(white, $color, 50%);&#125;// ç»™å½“å‰çš„é¢œè‰²å€¼ï¼Œæ·»åŠ ä¸Š 50% çš„é»‘è‰².black &#123; color: mix(black, $color, 50%);&#125; å¤„ç† element-plus ä¸»é¢˜è‰²å˜æ›´åŸç†ä¸æ­¥éª¤åˆ†æå¯¹äº element-plus çš„ä¸»é¢˜å˜æ›´ï¼Œç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥è¯´æ•´ä¸ªè¿‡ç¨‹æˆ‘ä»¬ä¼šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š å®ç°åŸç† å®ç°æ­¥éª¤ å®ç°è¿‡ç¨‹ å®ç°åŸç†ï¼š åœ¨ä¹‹å‰æˆ‘ä»¬åˆ†æä¸»é¢˜å˜æ›´çš„å®ç°åŸç†æ—¶ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œæ ¸å¿ƒçš„åŸç†æ˜¯ï¼š*é€šè¿‡ä¿®æ”¹ scss å˜é‡ * çš„å½¢å¼ä¿®æ”¹ä¸»é¢˜è‰²å®Œæˆä¸»é¢˜å˜æ›´ ä½†æ˜¯å¯¹äº element-plus è€Œè¨€ï¼Œæˆ‘ä»¬æ€ä¹ˆå»ä¿®æ”¹è¿™æ ·çš„ä¸»é¢˜è‰²å‘¢ï¼Ÿ å…¶å®æ•´ä½“çš„åŸç†éå¸¸ç®€å•ï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼š è·å–å½“å‰ element-plus çš„æ‰€æœ‰æ ·å¼ æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦æ›¿æ¢çš„æ ·å¼éƒ¨åˆ†ï¼Œé€šè¿‡æ­£åˆ™å®Œæˆæ›¿æ¢ æŠŠæ›¿æ¢åçš„æ ·å¼å†™å…¥åˆ° style æ ‡ç­¾ä¸­ï¼Œåˆ©ç”¨æ ·å¼ä¼˜å…ˆçº§çš„ç‰¹æ€§ï¼Œæ›¿ä»£å›ºæœ‰æ ·å¼ å®ç°æ­¥éª¤ï¼š é‚£ä¹ˆæ˜ç¡®äº†åŸç†ä¹‹åï¼Œæˆ‘ä»¬çš„å®ç°æ­¥éª¤ä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œå¯¹åº”åŸç†æ€»ä½“å¯åˆ†ä¸ºå››æ­¥ï¼š è·å–å½“å‰ element-plus çš„æ‰€æœ‰æ ·å¼ å®šä¹‰æˆ‘ä»¬è¦æ›¿æ¢ä¹‹åçš„æ ·å¼ åœ¨åŸæ ·å¼ä¸­ï¼Œåˆ©ç”¨æ­£åˆ™æ›¿æ¢æ–°æ ·å¼ æŠŠæ›¿æ¢åçš„æ ·å¼å†™å…¥åˆ° style æ ‡ç­¾ä¸­ åˆ›å»º utils/theme å·¥å…·ç±»ï¼Œå†™å…¥ä¸¤ä¸ªæ–¹æ³• 123456789101112131415/** * å†™å…¥æ–°æ ·å¼åˆ° style * @param &#123;*&#125; elNewStyle element-plus çš„æ–°æ ·å¼ * @param &#123;*&#125; isNewStyleTag æ˜¯å¦ç”Ÿæˆæ–°çš„ style æ ‡ç­¾ */export const writeNewStyle = elNewStyle =&gt; &#123; &#125;/** * æ ¹æ®ä¸»è‰²å€¼ï¼Œç”Ÿæˆæœ€æ–°çš„æ ·å¼è¡¨ */export const generateNewStyle = primaryColor =&gt; &#123; &#125; é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å…ˆå®ç°ç¬¬ä¸€ä¸ªæ–¹æ³• generateNewStyleï¼Œåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸¤ä¸ªå·¥å…·ç±»ï¼š rgb-hexï¼šè½¬æ¢RGB(A)é¢œè‰²ä¸ºåå…­è¿›åˆ¶ css-color-functionï¼šåœ¨ CSS ä¸­ Tab Atkins æå‡ºçš„é¢œè‰²å‡½æ•°çš„è§£æå™¨å’Œè½¬æ¢å™¨ã€‚ ç¤ºä¾‹ 1234567891011121314151617181920212223import rgbHex from &#x27;rgb-hex&#x27;rgbHex(65, 131, 196);//=&gt; &#x27;4183c4&#x27;rgbHex(&#x27;rgb(40, 42, 54)&#x27;);//=&gt; &#x27;282a36&#x27;rgbHex(65, 131, 196, 0.2);//=&gt; &#x27;4183c433&#x27;rgbHex(40, 42, 54, &#x27;75%&#x27;);//=&gt; &#x27;282a36bf&#x27;rgbHex(&#x27;rgba(40, 42, 54, 75%)&#x27;);//=&gt; &#x27;282a36bf&#x27;------------------------------------------------import color from &#x27;css-color-function&#x27; color.convert(&#x27;color(red tint(50%))&#x27;);// &quot;rgb(255, 128, 128)&quot; ç„¶åè¿˜éœ€è¦å†™å…¥ä¸€ä¸ª é¢œè‰²è½¬åŒ–è®¡ç®—å™¨ formula.jsonï¼Œå®šä¹‰é¢œè‰²ä¸å…³é”®å­—ä¹‹é—´çš„å¯¹åº”å…³ç³» åˆ›å»º constants/formula.json 12345678910111213141516&#123; &quot;shade-1&quot;: &quot;color(primary shade(10%))&quot;, &quot;light-1&quot;: &quot;color(primary tint(10%))&quot;, &quot;light-2&quot;: &quot;color(primary tint(20%))&quot;, &quot;light-3&quot;: &quot;color(primary tint(30%))&quot;, &quot;light-4&quot;: &quot;color(primary tint(40%))&quot;, &quot;light-5&quot;: &quot;color(primary tint(50%))&quot;, &quot;light-6&quot;: &quot;color(primary tint(60%))&quot;, &quot;light-7&quot;: &quot;color(primary tint(70%))&quot;, &quot;light-8&quot;: &quot;color(primary tint(80%))&quot;, &quot;light-9&quot;: &quot;color(primary tint(90%))&quot;, &quot;subMenuHover&quot;: &quot;color(primary tint(70%))&quot;, &quot;subMenuBg&quot;: &quot;color(primary tint(80%))&quot;, &quot;menuHover&quot;: &quot;color(primary tint(90%))&quot;, &quot;menuBg&quot;: &quot;color(primary)&quot;&#125; shade tint æ–¹æ³•å…¶å®å°±æ˜¯åˆ©ç”¨äº† scss çš„ mix æ–¹æ³•ï¼Œcss-color-function åº“å†…éƒ¨è°ƒç”¨è¿›è¡Œè§£æã€‚ 123456789101112131415161718// scss// ç»™å½“å‰çš„é¢œè‰²å€¼ï¼Œæ·»åŠ ä¸Š 50% çš„ç™½è‰².white &#123; color: mix(white, $color, 50%);&#125;// ç»™å½“å‰çš„é¢œè‰²å€¼ï¼Œæ·»åŠ ä¸Š 50% çš„é»‘è‰².black &#123; color: mix(black, $color, 50%);&#125;@function tint($color, $parcent) &#123; @return mix(white, $color, $parcent)&#125;@function shade($color, $parcent) &#123; @return mix(black, $color, $parcent)&#125; å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬æ¥å®ç° generateNewStyle æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122// https://www.npmjs.com/package/css-color-functionimport color from &#x27;css-color-function&#x27;// https://www.npmjs.com/package/rgb-heximport rgbHex from &#x27;rgb-hex&#x27;import axios from &#x27;axios&#x27;import formula from &#x27;@/constants/formula.json&#x27;/** * å†™å…¥æ–°æ ·å¼åˆ° style * @param &#123;*&#125; cssText element-plus çš„æ–°æ ·å¼ * @param &#123;*&#125; isNewStyleTag æ˜¯å¦ç”Ÿæˆæ–°çš„ style æ ‡ç­¾ */export const writeNewStyle = (cssText: string) =&gt; &#123; const style = document.createElement(&#x27;style&#x27;) style.innerText = cssText document.head.appendChild(style)&#125;/** * æ ¹æ®ä¸»è‰²å€¼ï¼Œç”Ÿæˆæœ€æ–°çš„æ ·å¼è¡¨ */type TObject = &#123; [key: string]: string &#125;export const generateNewStyle = async (primaryColor: string) =&gt; &#123; // colors ===&gt; &#123; primary: &#x27;rgba(8, 12, 132, 0.68)&#x27;, shade-1: &#x27;#070b77ad&#x27;, light-1: &#x27;#212490ad&#x27;, ...... &#125; const colors: TObject = generateColors(primaryColor) as TObject // æ‹¿åˆ°æ•´ä¸ª element plus æ ·å¼è¡¨ï¼Œå¹¶å¯¹éœ€è¦ä¿®æ”¹çš„å˜é‡æ‰“ä¸Šäº†æ ‡è®° let cssText = await getOriginalStyle() // éå†ç”Ÿæˆçš„æ ·å¼è¡¨ï¼Œåœ¨ CSS çš„åŸæ ·å¼ä¸­è¿›è¡Œå…¨å±€æ›¿æ¢ Object.keys(colors).forEach(key =&gt; &#123; // reg pattern // /(:|\\s+)primary/g // /(:|\\s+)shade-1/g // /(:|\\s+)menuBg/g // ... // è¿™ä¸ªæ¨¡å¼ä¸­çš„ (:|\\\\s+) è¡¨ç¤ºä¸€ä¸ªå†’å·æˆ–ä¸€ä¸ªæˆ–å¤šä¸ªç©ºç™½å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦ï¼‰ã€‚ // \\\\s+ çš„ç¬¬ä¸€ä¸ª \\ æ˜¯è½¬ä¹‰å­—ç¬¦ // key æ˜¯ä¸€ä¸ªå˜é‡ï¼Œä»£è¡¨ä¸€ä¸ªéœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚åŒ¹é… `primary` // &#x27;$1&#x27; + colors[key] // å…³äºä¸ºä»€ä¹ˆè¦åœ¨è‰²å€¼å‰é¢åŠ ä¸Š $1ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ replace æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ // åœ¨è¿™é‡Œï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­çš„ $1 ä¼šè¢«æ›¿æ¢æˆç¬¬ä¸€ä¸ªæ‹¬å·æ•è·ç»„ï¼ˆå³ (:|\\\\s+)ï¼‰åŒ¹é…åˆ°çš„æ–‡æœ¬ã€‚ // æ‰€ä»¥åŠ ä¸Š $1 å°±æ˜¯ä¸ºäº†åœ¨ã€æ›¿æ¢çš„æ–‡æœ¬ã€‘ä¸­ã€ä¿ç•™åŸæœ¬åŒ¹é…åˆ°çš„æ–‡æœ¬ã€‘ã€‚ cssText = cssText.replace( new RegExp(&#x27;(:|\\\\s+)&#x27; + key, &#x27;g&#x27;), &#x27;$1&#x27; + colors[key] ) &#125;) // æœ€ç»ˆï¼Œæ–°çš„æ ·å¼è¡¨ä¸­ï¼Œå«æœ‰æˆ‘ä»¬è‡ªå®šä¹‰çš„é¢œè‰²ä¸»é¢˜ return cssText&#125;/** * æ ¹æ®ä¸»è‰²ç”Ÿæˆè‰²å€¼è¡¨ */type TFormulaKey = keyof typeof formulaexport const generateColors = (primary: string) =&gt; &#123; if (!primary) return const colors: &#123; [key: string]: string &#125; = &#123; primary &#125; ;(Object.keys(formula) as Array&lt;TFormulaKey&gt;).forEach( &lt;K extends TFormulaKey&gt;(key: K) =&gt; &#123; // å°†æ‰€æœ‰çš„ä¸»è‰²ï¼Œæ›¿æ¢æˆæˆ‘ä»¬é€‰ä¸­çš„ä¸»é¢˜è‰²ï¼Œå½¢å¼å¦‚ &gt;&gt;&gt; color(rgba(255, 69, 0, 1) shade(10%)) const value = formula[key].replace(/primary/g, primary) // é€šè¿‡ color çš„ conver æ–¹æ³•ï¼Œè®¡ç®—å‡º rgba è‰²å€¼ // color.convert(value) ===&gt;&gt;&gt; rgba(0, 12, 230, 0.68) // æœ€ç»ˆå°†è½¬ä¸ºæ¯ä¸ªé¢œè‰²ï¼Œè½¬ä¸ºåå…­è¿›åˆ¶ï¼š#030420adï¼Œå†™å…¥åˆ° colors å¯¹è±¡ä¸­ï¼Œå¹¶è¿”å› colors[key] = &#x27;#&#x27; + rgbHex(color.convert(value)) &#125; ) return colors&#125;/** * è·å–å½“å‰ element-plus çš„é»˜è®¤æ ·å¼è¡¨ */const getOriginalStyle = async () =&gt; &#123; const version = require(&#x27;element-plus/package.json&#x27;).version const url = `https://unpkg.com/element-plus@$&#123;version&#125;/dist/index.css` const &#123; data &#125; = await axios(url) // æŠŠè·å–åˆ°çš„æ•°æ®ç­›é€‰ä¸ºåŸæ ·å¼æ¨¡æ¿ return getStyleTemplate(data)&#125;/** * è¿”å› style çš„ template */const getStyleTemplate = (data: string) =&gt; &#123; // element-plus é»˜è®¤è‰²å€¼ const colorMap: &#123; [key: string]: string &#125; = &#123; &#x27;#3a8ee6&#x27;: &#x27;shade-1&#x27;, &#x27;#409eff&#x27;: &#x27;primary&#x27;, // element-plus ä¸­å«æœ‰å˜é‡ `--el-color-primary: #409eff` &#x27;#53a8ff&#x27;: &#x27;light-1&#x27;, &#x27;#66b1ff&#x27;: &#x27;light-2&#x27;, &#x27;#79bbff&#x27;: &#x27;light-3&#x27;, &#x27;#8cc5ff&#x27;: &#x27;light-4&#x27;, &#x27;#a0cfff&#x27;: &#x27;light-5&#x27;, &#x27;#b3d8ff&#x27;: &#x27;light-6&#x27;, &#x27;#c6e2ff&#x27;: &#x27;light-7&#x27;, &#x27;#d9ecff&#x27;: &#x27;light-8&#x27;, &#x27;#ecf5ff&#x27;: &#x27;light-9&#x27; &#125; // æ ¹æ®é»˜è®¤è‰²å€¼ä¸ºè¦æ›¿æ¢çš„è‰²å€¼æ‰“ä¸Šæ ‡è®° Object.keys(colorMap).forEach(key =&gt; &#123; const value = colorMap[key] data = data.replace(new RegExp(key, &#x27;ig&#x27;), value) &#125;) // æ›¿æ¢å®Œä¹‹å // `--el-color-primary: #409eff` å°±å˜æˆäº† `--el-color-primary: primary` // `--el-color-primary-light-9: #ecf5ff` å˜æˆäº† `--el-color-primary-light-9: light-9` return data&#125; æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ theme.ts ä¸­å‡½æ•°çš„æ‰§è¡Œæµç¨‹ é¦–å…ˆï¼Œå¤–éƒ¨è°ƒç”¨ generateNewStyle æ–¹æ³•ï¼Œä¼ å…¥ primaryColorï¼Œæˆ‘ä»¬é€šè¿‡ el-color-picker é€‰ä¸­åçš„å€¼ï¼Œå°±æ˜¯ primaryColorï¼Œå®ƒçš„è‰²å€¼é•¿è¿™æ · rgba(8, 12, 132, 0.68)ã€‚ é€šè¿‡ generateColors æ–¹æ³•ç”Ÿæˆè‰²å€¼è¡¨ é€šè¿‡ css-color-function å¤„ç†æˆ‘ä»¬çš„é¢œè‰²è½¬åŒ–è®¡ç®—å™¨formula.json 1color(rgba(255, 69, 0, 1) shade(10%)) &gt;&gt;&gt; color.convert(value) &gt;&gt;&gt; rgba(0, 12, 230, 0.68) ä½¿ç”¨ rgbHex æ–¹æ³•å°† rgba è½¬åŒ–ä¸ºåå…­è¿›åˆ¶æ ¼å¼ 1rgbHex(color.convert(value)) ===&gt;&gt;&gt; &#x27;#030420ad&#x27; è¿”å›å¤„ç†è¿‡åçš„è‰²å€¼è¡¨ colors 1234567&#123; primary: &#x27;rgba(8, 12, 132, 0.68)&#x27;, // ä¿ç•™äº†åŸå§‹çš„rgbaæ ¼å¼ shade-1: &#x27;#070b77ad&#x27;, light-1: &#x27;#212490ad&#x27;, light-2: &#x27;#393d9dad&#x27;, ......&#125; é€šè¿‡ getOriginalStyle æ–¹æ³•ï¼Œè·å– element plus æ ·å¼è¡¨ æ‹¿åˆ° element plus æ ·å¼æ•°æ®åï¼Œé€šè¿‡ getStyleTemplate æ–¹æ³•ï¼Œæ ¹æ®é»˜è®¤è‰²å€¼ colorMap ä¸ºè¦æ›¿æ¢çš„è‰²å€¼æ‰“ä¸Šæ ‡è®° element-plus ä¸­å«æœ‰å˜é‡ --el-color-primary: #409effï¼Œè€Œæˆ‘ä»¬å®šä¹‰çš„é»˜è®¤å€¼ &#39;#409eff&#39;: &#39;primary&#39;ï¼Œåå…­è¿›åˆ¶å€¼æ˜¯å¯¹ç­‰çš„ æ›¿æ¢å®Œä¹‹åï¼Œvalue å°±è¢«æ ‡è®°ä¸Šäº†æˆ‘ä»¬å®šä¹‰çš„å€¼12`--el-color-primary: #409eff` å°±å˜æˆäº† `--el-color-primary: primary``--el-color-primary-light-9: #ecf5ff` å˜æˆäº† `--el-color-primary-light-9: light-9` è¿”å›å¤„ç†è¿‡åçš„ element plus æ ·å¼è¡¨ cssTextï¼Œè¿™ä¸ªæ ·å¼è¡¨ä¸­å·²ç»è¢«æ ‡è®°äº†æˆ‘ä»¬è¦ä¿®æ”¹çš„å˜é‡å€¼ æ¥ç€ï¼Œæˆ‘ä»¬é€šè¿‡æ­£åˆ™ä»¥åŠç¬¬äºŒæ­¥ generateColors æ–¹æ³•è¿”å›çš„ colorsï¼Œå°† cssText ä¸­æ¯ä¸ªæ‰“äº†æ ‡è®°çš„å˜é‡å€¼æ›¿æ¢ 1cssText = cssText.replace(new RegExp(&#x27;(:|\\\\s+)&#x27; + key, &#x27;g&#x27;), &#x27;$1&#x27; + colors[key]) è¿™ä¸ªæ¨¡å¼ä¸­çš„ (:|\\s+) è¡¨ç¤ºä¸€ä¸ªå†’å·æˆ–ä¸€ä¸ªã€æˆ–ã€‘å¤šä¸ªç©ºç™½å­—ç¬¦(\\s+)ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦ï¼‰ \\s+ çš„ç¬¬ä¸€ä¸ª \\ æ˜¯è½¬ä¹‰å­—ç¬¦ key æ˜¯ä¸€ä¸ªå˜é‡ï¼Œä»£è¡¨ä¸€ä¸ªéœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚åŒ¹é… primary &#39;$1&#39; + colors[key]: replace ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­çš„ $1 ä¼šè¢«æ›¿æ¢æˆç¬¬ä¸€ä¸ªæ‹¬å·æ•è·ç»„ï¼ˆå³ (:|\\s+)ï¼‰åŒ¹é…åˆ°çš„æ–‡æœ¬ã€‚æ‰€ä»¥åŠ ä¸Š $1 å°±æ˜¯ä¸ºäº†åœ¨ã€æ›¿æ¢çš„æ–‡æœ¬ã€‘ä¸­ã€ä¿ç•™åŸæœ¬åŒ¹é…åˆ°çš„æ–‡æœ¬ã€‘ã€‚ æœ€åè¿”å› cssTextï¼Œæ–°çš„æ ·å¼è¡¨ä¸­ï¼Œå«æœ‰æˆ‘ä»¬è‡ªå®šä¹‰çš„é¢œè‰²ä¸»é¢˜ æœ€åï¼Œé€šè¿‡ writeNewStyle å°†æ–°çš„æ ·å¼è¡¨ cssText æ’å…¥åˆ°æ–‡æ¡£ä¸­ã€‚ 123const style = document.createElement(&#x27;style&#x27;)style.innerText = cssTextdocument.head.appendChild(style) æ€»ç»“ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹ element plus çš„ä¸»é¢˜æ¢è‚¤å°±å®Œæˆäº†ã€‚ element-plus æ–°ä¸»é¢˜çš„ç«‹å³ç”Ÿæ•ˆåˆ°ç›®å‰æˆ‘ä»¬å·²ç»å®Œæˆäº† element-plus çš„ä¸»é¢˜å˜æ›´ï¼Œä½†æ˜¯å½“å‰çš„ä¸»é¢˜å˜æ›´è¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œé‚£å°±æ˜¯ï¼šåœ¨åˆ·æ–°é¡µé¢åï¼Œæ–°ä¸»é¢˜ä¼šå¤±æ•ˆ é‚£ä¹ˆå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› ï¼Œéå¸¸ç®€å•ï¼šå› ä¸ºæ²¡æœ‰å†™å…¥æ–°çš„ style æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨ åº”ç”¨åŠ è½½åï¼Œå†™å…¥ style å³å¯ é‚£ä¹ˆå†™å…¥çš„æ—¶æœºï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å…¥åˆ° app.vue ä¸­ 123456789&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; generateNewStyle, writeNewStyle &#125; from &#x27;@/utils/theme&#x27;const store = useStore()generateNewStyle(store.getters.mainColor).then(newStyleText =&gt; &#123; writeNewStyle(newStyleText)&#125;)&lt;/script&gt; è‡ªå®šä¹‰ä¸»é¢˜å˜æ›´è‡ªå®šä¹‰ä¸»é¢˜å˜æ›´ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œå› ä¸º è‡ªå·±çš„ä»£ç æ›´åŠ å¯æ§ã€‚ ç›®å‰åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œéœ€è¦è¿›è¡Œ è‡ªå®šä¹‰ä¸»é¢˜å˜æ›´ ä¸º menu èœå•èƒŒæ™¯è‰² è€Œç›®å‰æŒ‡å®š menu èœå•èƒŒæ™¯è‰²çš„ä½ç½®åœ¨ layout/components/sidebar/SidebarMenu.vue ä¸­ 123456789&lt;el-menu :default-active=&quot;activeMenu&quot; :collapse=&quot;!$store.getters.sidebarOpened&quot; :background-color=&quot;$store.getters.cssVar.menuBg&quot; :text-color=&quot;$store.getters.cssVar.menuText&quot; :active-text-color=&quot;$store.getters.cssVar.menuActiveText&quot; :unique-opened=&quot;true&quot; router&gt; æ­¤å¤„çš„ èƒŒæ™¯è‰²æ˜¯é€šè¿‡ getters è¿›è¡ŒæŒ‡å®šçš„ï¼Œè¯¥ cssVar çš„ getters ä¸ºï¼š 1cssVar: state =&gt; variables, æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³è¦ä¿®æ”¹ è‡ªå®šä¹‰ä¸»é¢˜ ï¼Œåªéœ€è¦ä»è¿™é‡Œå…¥æ‰‹å³å¯ã€‚ æ ¹æ®å½“å‰ä¿å­˜çš„ mainColor è¦†ç›–åŸæœ‰çš„é»˜è®¤è‰²å€¼ 1234567891011121314151617import variables from &#x27;@/styles/variables.scss&#x27;import &#123; MAIN_COLOR &#125; from &#x27;@/constant&#x27;import &#123; getItem &#125; from &#x27;@/utils/storage&#x27;import &#123; generateColors &#125; from &#x27;@/utils/theme&#x27;const getters = &#123; ... cssVar: state =&gt; &#123; return &#123; ...variables, ...generateColors(getItem(MAIN_COLOR)) &#125; &#125;, ...&#125;export default getters ä½†æ˜¯æˆ‘ä»¬è¿™æ ·è®¾å®šä¹‹åï¼Œæ•´ä¸ªè‡ªå®šä¹‰ä¸»é¢˜å˜æ›´ï¼Œè¿˜å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š menuBg èƒŒæ™¯é¢œè‰²æ²¡æœ‰å˜åŒ– è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºå’±ä»¬çš„ sidebar çš„èƒŒæ™¯è‰²æœªè¢«æ›¿æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ layout/index ä¸­è®¾ç½® sidebar çš„ backgroundColor 12345&lt;sidebar id=&quot;guide-sidebar&quot; class=&quot;sidebar-container&quot; :style=&quot;&#123; backgroundColor: $store.getters.cssVar.menuBg &#125;&quot;/&gt; ä¸»é¢˜è‰²æ›¿æ¢ä¹‹åï¼Œéœ€è¦åˆ·æ–°é¡µé¢æ‰å¯å“åº” è¿™ä¸ªæ˜¯å› ä¸º getters ä¸­æ²¡æœ‰ç›‘å¬åˆ° ä¾èµ–å€¼çš„å“åº”å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›ä¿®æ”¹ä¾èµ–å€¼ åœ¨ store/modules/theme ä¸­ 1234567891011121314151617181920...import variables from &#x27;@/styles/variables.scss&#x27;export default &#123; namespaced: true, state: () =&gt; (&#123; ... variables &#125;), mutations: &#123; /** * è®¾ç½®ä¸»é¢˜è‰² */ setMainColor(state, newColor) &#123; ... state.variables.menuBg = newColor ... &#125; &#125;&#125; åœ¨ getters ä¸­ 1234567891011121314....const getters = &#123; ... cssVar: state =&gt; &#123; return &#123; ...state.theme.variables, ...generateColors(getItem(MAIN_COLOR)) &#125; &#125;, ...&#125;export default getters é‚£ä¹ˆåˆ°è¿™é‡Œæ•´ä¸ªè‡ªå®šä¹‰ä¸»é¢˜æˆ‘ä»¬å°±å¤„ç†å®Œæˆäº†ã€‚ å¯¹äº è‡ªå®šä¹‰ä¸»é¢˜è€Œè¨€ï¼Œæ ¸å¿ƒçš„åŸç†å…¶å®å°±æ˜¯ ä¿®æ”¹scsså˜é‡æ¥è¿›è¡Œå®ç°ä¸»é¢˜è‰²å˜åŒ– æ˜ç¡®å¥½äº†åŸç†ä¹‹åï¼Œå¯¹åç»­å®ç°çš„æ­¥éª¤å°±å…·ä½“æƒ…å†µå…·ä½“åˆ†æäº†ã€‚ å¯¹äº element-plusï¼šå› ä¸º element-plus æ˜¯ç¬¬ä¸‰æ–¹çš„åŒ…ï¼Œæ‰€ä»¥å®ƒ ä¸æ˜¯å®Œå…¨å¯æ§ çš„ï¼Œé‚£ä¹ˆå¯¹äºè¿™ç§æœ€ç®€å•ç›´ç™½çš„æ–¹æ¡ˆï¼Œå°±æ˜¯ç›´æ¥æ‹¿åˆ°å®ƒç¼–è¯‘åçš„ css è¿›è¡Œè‰²å€¼æ›¿æ¢ï¼Œåˆ©ç”¨ style å†…éƒ¨æ ·å¼è¡¨ ä¼˜å…ˆçº§é«˜äº å¤–éƒ¨æ ·å¼è¡¨ çš„ç‰¹æ€§ï¼Œæ¥è¿›è¡Œä¸»é¢˜æ›¿æ¢ å¯¹äºè‡ªå®šä¹‰ä¸»é¢˜ï¼šå› ä¸ºè‡ªå®šä¹‰ä¸»é¢˜æ˜¯ å®Œå…¨å¯æ§ çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®ç°èµ·æ¥å°±è½»æ¾å¾ˆå¤šï¼Œåªéœ€è¦ä¿®æ”¹å¯¹åº”çš„ scsså˜é‡å³å¯ é‚£ä¹ˆåœ¨ä¹‹åå¤§å®¶é‡åˆ° è‡ªå®šä¹‰ä¸»é¢˜ çš„å¤„ç†æ—¶ï¼Œå°±å¯ä»¥æŒ‰ç…§è¿™é‡Œæ‰€æ¢³ç†çš„æ–¹æ¡ˆè¿›è¡Œå¤„ç†äº†ã€‚ ç»“æŸè¯­è¿™ä¸€ç« æˆ‘ä»¬èŠ±äº†å¤§é‡çš„ç¯‡å¹…æ¥ä»‹ç»æ¢è‚¤çš„åŸç†ä»¥åŠä¸šåŠ¡åœºæ™¯å¦‚ä½•å®ç°æ¢è‚¤ï¼Œç¯‡å¹…æœ‰ç‚¹é•¿ï¼Œå°±ä¸åœ¨æ­¤æ·»åŠ å…¶ä»–åŠŸèƒ½çš„æè¿°äº†ã€‚ å¦‚ä¸‹åŠŸèƒ½æˆ‘ä»¬æ”¾åˆ°ä¸‹ä¸€ç« èŠ‚å»å®ç°ï¼š screenfull headerSearch tagView guide å‚è€ƒé“¾æ¥ CSSå˜é‡æ•™ç¨‹","categories":[],"tags":[{"name":"å·¥ç¨‹åŒ–,Vue3,é€šç”¨åŠŸèƒ½","slug":"å·¥ç¨‹åŒ–-Vue3-é€šç”¨åŠŸèƒ½","permalink":"http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3-%E9%80%9A%E7%94%A8%E5%8A%9F%E8%83%BD/"}]},{"title":"Vue3é¡¹ç›®å®æˆ˜(å››)ï¼šLayoutæ¶æ„å®ç°","slug":"vue3-project-layout","date":"2022-12-24T07:00:48.000Z","updated":"2022-12-25T12:34:25.143Z","comments":true,"path":"/post/vue3-project-layout.html","link":"","permalink":"http://yoursite.com/post/vue3-project-layout.html","excerpt":"layoutæ¶æ„å®ç°ï¼ŒåŒ…æ‹¬åŠ¨æ€èœå•æ ã€åŠ¨æ€çš„é¢åŒ…å±‘ç­‰æ–¹æ¡ˆã€ä¾§è¾¹æ ä¼¸ç¼©åŠ¨ç”»ã€é€€å‡ºçš„é€šç”¨é€»è¾‘å°è£…ä»¥åŠVue3.2ç‰ˆæœ¬ä¸­çš„ç»„ä»¶çŠ¶æ€é©±åŠ¨çš„åŠ¨æ€ CSS å€¼ç­‰ç­‰ã€‚","text":"å®ç° layout å¸ƒå±€é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ”¹é€  layout/index.vueï¼Œå…ˆå®šä¹‰å¥½ç»“æ„ï¼Œç„¶åå†™æ ·å¼å³å¯ã€‚ 1234567891011121314&lt;div class=&quot;app-wrapper&quot;&gt; &lt;!-- å·¦ä¾§ menu --&gt; &lt;siderbar class=&quot;sidebar-container&quot;&gt;&lt;/siderbar&gt; &lt;div class=&quot;main-container&quot;&gt; &lt;div class=&quot;fixed-header&quot;&gt; &lt;!-- é¡¶éƒ¨ --&gt; &lt;nav-bar&gt;&lt;/nav-bar&gt; &lt;/div&gt; &lt;!-- ä¸»è¦å†…å®¹ --&gt; &lt;app-main&gt;&lt;/app-main&gt; &lt;/div&gt;&lt;/div&gt; ç»“æ„å®šä¹‰å¥½äº†ï¼Œæˆ‘å†å®šä¹‰æ ·å¼ä»¥åŠæ ·å¼æ–‡ä»¶ã€‚åœ¨ src ä¸‹åˆ›å»º styles æ–‡ä»¶å¤¹ï¼Œä¸»è¦å­˜æ”¾ scss çš„ä¸€äº›æ ·å¼æ–‡ä»¶ï¼Œå…¶ä¸­å°±åŒ…æ‹¬é€šç”¨çš„ reset.scss æ–‡ä»¶ï¼Œå¤„ç†åŸºç¡€çš„ html å…ƒç´ æ ·å¼ã€‚mixin.scss ç¼–å†™é€šç”¨çš„æ ·å¼è¡¨ï¼Œå®šä¹‰é€šç”¨çš„æ ·å¼å˜é‡ variables.scssã€‚ 123456// styles/index.scss@import &#x27;./reset.scss&#x27;;@import &#x27;./variables.scss&#x27;;@import &#x27;./mixin.scss&#x27;;@import &#x27;./sidebar.scss&#x27;; scss çš„ä½¿ç”¨æŠ€å·§è¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ä¸‹ mixin.scss å’Œ variables.scss çš„ä¸€äº›æŠ€å·§å’Œç”¨æ³•ï¼š mixin.scss 1234567891011121314151617181920212223242526272829303132/* æ¸…é™¤æµ®åŠ¨ï¼Œåœ¨ .vue æ–‡ä»¶ä¸­ä½¿ç”¨çš„æ—¶å€™ç›´æ¥å¼•ç”¨å³å¯ï¼š@include clearfix; */@mixin clearfix &#123; &amp;:after &#123; content: &#x27;&#x27;; display: table; clear: both; &#125;&#125;/* æ»šåŠ¨æ¡çš„è®¾ç½® */@mixin scrollBar &#123; &amp;::-webkit-scrollbar-track-piece &#123; background: #d3dce6; &#125; &amp;::-webkit-scrollbar &#123; width: 6px; &#125; &amp;::-webkit-scrollbar-thumb &#123; background: #99a9bf; border-radius: 20px; &#125;&#125;@mixin relative &#123; position: relative; width: 100%; height: 100%;&#125; variables.scss 12345678910111213141516171819202122232425262728// sidebar$menuText: #bfcbd9;$menuActiveText: #ffffff;$subMenuActiveText: #f4f4f5;$menuBg: #304156;$menuHover: #263445;$subMenuBg: #1f2d3d;$subMenuHover: #001528;$sideBarWidth: 210px;$hideSideBarWidth: 54px;$sideBarDuration: 0.28s;// https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass// JS ä¸ scss å…±äº«å˜é‡ï¼Œåœ¨ scss ä¸­é€šè¿‡ :export è¿›è¡Œå¯¼å‡ºï¼Œåœ¨ js ä¸­å¯é€šè¿‡ ESM è¿›è¡Œå¯¼å…¥:export &#123; menuText: $menuText; menuActiveText: $menuActiveText; subMenuActiveText: $subMenuActiveText; menuBg: $menuBg; menuHover: $menuHover; subMenuBg: $subMenuBg; subMenuHover: $subMenuHover; sideBarWidth: $sideBarWidth;&#125; å…³äº :export çš„ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥é˜…ä¸€äº›æ–‡æ¡£ï¼š https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass ç¼–å†™ layout/index.vue æ ·å¼12345678910111213141516171819&lt;style lang=&quot;scss&quot; scoped&gt;@import &#x27;~@/styles/mixin.scss&#x27;;@import &#x27;~@/styles/variables.scss&#x27;;.app-wrapper &#123; @include clearfix; // ä½¿ç”¨ mixin ä¸­çš„æ ·å¼ position: relative; height: 100%; width: 100%;&#125;.fixed-header &#123; position: fixed; top: 0; right: 0; z-index: 9; width: calc(100% - #&#123;$sideBarWidth&#125;);&#125;&lt;/style&gt; ç»™ SideBar èµ‹äºˆåŠ¨æ€çš„èƒŒæ™¯è‰²1234567891011121314&lt;template&gt;... &lt;!-- å·¦ä¾§ menu --&gt; &lt;sidebar class=&quot;sidebar-container&quot; :style=&quot;&#123; backgroundColor: variables.menuBg &#125;&quot; /&gt;...&lt;/template&gt;&lt;script setup&gt;// scss é€šè¿‡ :export å¯¼å‡ºäº†å˜é‡import variables from &#x27;@/styles/variables.scss&#x27;&lt;/script&gt; scriptå¯¼å…¥scssæ–‡ä»¶æŠ¥é”™åœ¨ vue é¡¹ç›®é‡Œå¼•ç”¨.scssæ–‡ä»¶ï¼Œvscodeç¼–è¾‘å™¨ä¼šæœ‰çº¢è‰²æ³¢æµªçº¿ï¼Œæç¤ºæ‰¾ä¸åˆ°æ¨¡å— æ‰¾åˆ° shims-vue.d.ts å£°æ˜æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç : 1234567declare module &#x27;*.scss&#x27; &#123; const css: &#123; // å®šä¹‰çš„å˜é‡ï¼Œé€šè¿‡ `variables.menuBg` å–å€¼æ—¶ï¼Œå°±ä¸ä¼šæŠ¥é”™äº† menuBg: string; &#125; export default css&#125; å°†æ¥ï¼Œæ–°å¢äº†æ–°çš„æ ·å¼å˜é‡ï¼Œæˆ‘ä»¬åœ¨ css ä¸‹æ·»åŠ å³å¯ã€‚ è®¾ç½®NavBaræ ·å¼å’Œå¤´åƒå¸ƒå±€1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677&lt;template&gt; &lt;div class=&quot;navbar&quot;&gt; &lt;div class=&quot;right-menu&quot;&gt; &lt;el-dropdown class=&quot;avatar-container&quot; trigger=&quot;click&quot;&gt; &lt;div class=&quot;avatar-wrapper&quot;&gt; &lt;el-avatar shape=&quot;square&quot; :size=&quot;40&quot; :src=&quot;&#x27;https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg&#x27;&quot; &gt;&lt;/el-avatar&gt; &lt;el-icon&gt;&lt;Tools /&gt;&lt;/el-icon&gt; &lt;/div&gt; &lt;template #dropdown&gt; &lt;el-dropdown-menu class=&quot;user-dropdown&quot;&gt; &lt;router-link to=&quot;/&quot;&gt; &lt;el-dropdown-item&gt; ä¸»é¡µ &lt;/el-dropdown-item&gt; &lt;/router-link&gt; &lt;a target=&quot;_blank&quot; href=&quot;&quot;&gt; &lt;el-dropdown-item&gt;Vue3&lt;/el-dropdown-item&gt; &lt;/a&gt; &lt;el-dropdown-item divided&gt; é€€å‡º &lt;/el-dropdown-item&gt; &lt;/el-dropdown-menu&gt; &lt;/template&gt; &lt;/el-dropdown&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;import &#123; ref, reactive &#125; from &#x27;vue&#x27;import &#123; Tools &#125; from &#x27;@element-plus/icons-vue&#x27;&lt;/script&gt;&lt;style scoped lang=&quot;scss&quot;&gt;.navbar &#123; height: 50px; overflow: hidden; position: relative; background: #fff; box-shadow: 0 1px 4px rgba(0, 21, 41, 0.08); .right-menu &#123; display: flex; align-items: center; float: right; padding-right: 16px; ::v-deep .right-menu-item &#123; display: inline-block; padding: 0 18px 0 0; font-size: 24px; color: #5a5e66; vertical-align: text-bottom; &amp;.hover-effect &#123; cursor: pointer; transition: background 0.3s; &amp;:hover &#123; background: rgba(0, 0, 0, 0.025); &#125; &#125; &#125; ::v-deep .avatar-container &#123; cursor: pointer; .avatar-wrapper &#123; margin-top: 5px; position: relative; .el-avatar &#123; --el-avatar-background-color: none; margin-right: 12px; &#125; &#125; &#125; &#125;&#125;&lt;/style&gt; æ•ˆæœå›¾ è·å–ç”¨æˆ·ä¿¡æ¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¤´åƒæ˜¯é™æ€çš„ï¼Œä¹Ÿæ²¡æœ‰å®ç°ç™»å‡ºçš„é€»è¾‘ï¼Œç°åœ¨æ¥å®ç°ä¸€ä¸‹ã€‚ è®¾ç½®è¯·æ±‚å¤´æˆ‘ä»¬ä¸å¸Œæœ›æ¯æ¬¡è°ƒæ¥å£æ—¶ï¼Œéƒ½å»è®¾ç½® tokenï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ è¯·æ±‚æ‹¦æˆªå™¨ ä¸­å»è®¾ç½®: 123456789101112service.interceptors.request.use( config =&gt; &#123; if (store.getters.token) &#123; config.headers.Authorization = `Baerer $&#123;store.getters.token&#125;` &#125; return config &#125;, error =&gt; &#123; return Promise.reject(error) &#125;) ç¼–å†™ userInfo æ¥å£ç®€å•å®ç°ä¸€ä¸‹ /userinfo æ¥å£ï¼Œä¸»è¦æ˜¯æ¨¡æ‹Ÿå‰åç«¯è”è°ƒçš„æµç¨‹ã€‚ 123456789101112131415161718192021222324const express = require(&#x27;express&#x27;);const app = express()app.get(&#x27;/userinfo&#x27;, (req, res) =&gt; &#123; // å­˜åœ¨ tokenï¼Œå¯ä»¥è¿”å›ç”¨æˆ·ä¿¡æ¯ if (req.headers[&#x27;authorization&#x27;]) &#123; res.json(&#123; code: 0, data: &#123; avatar: &#x27;https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg&#x27;, name: &#x27;Hello_AlexCc&#x27;, id: 1, role: &#x27;super_admin&#x27; &#125;, message: &#x27;è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ&#x27;, success: true, &#125;) &#125;&#125;)app.listen(9999, () =&gt; &#123; console.log(&#x27;server site an port 9999 ...&#x27;)&#125;) è°ƒç”¨ userInfo æ¥å£æ—¶æœºæˆ‘ä»¬çš„ userInfo æ¥å£å·²ç»ç¼–å†™å¥½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å‘¢ï¼Ÿ å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ permission.ts ä¸­å»è°ƒç”¨ï¼Œå½“ç”¨æˆ·ç™»å½•æ‰æœ‰ tokenï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ token å­˜åœ¨æ—¶ï¼Œå¹¶ä¸” to.path ä¸ç­‰äº /login çš„æ—¶å€™å»è°ƒç”¨ç”¨æˆ·ä¿¡æ¯æ¥å£ã€‚ 12345678910if (store.getters.token) &#123; if (to.path === &#x27;/login&#x27;) &#123; next(&#x27;/&#x27;) &#125; else &#123; // è°ƒç”¨ç”¨æˆ·ä¿¡æ¯æ¥å£ await store.dispatch(&#x27;user/getUserInfo&#x27;) next() &#125;&#125; æˆ‘ä»¬è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£çš„åŠ¨ä½œï¼Œæ”¾åœ¨äº† module user çš„ actions ä¸­ï¼š 1234567891011121314// module/user.ts// statestate: () =&gt; (&#123; token: getItem(&#x27;token&#x27;) || &#x27;&#x27;, userinfo: &#123;&#125;&#125;),// actionsasync getUserInfo(context) &#123; const info = await getUserInfo() context.commit(&#x27;setUserInfo&#x27;, info) return info&#125;, æ–¹ä¾¿ä½¿ç”¨ userInfoï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ”¾åˆ° getters ä¸­ï¼š 1234const getters = &#123; token: (state) =&gt; state.user.token, userInfo: (state) =&gt; state.user.userinfo&#125; æœ€åï¼Œæˆ‘ä»¬å°±èƒ½åœ¨ NavBar ä½¿ç”¨è·å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯äº†ã€‚ 12345&lt;el-avatar shape=&quot;square&quot; :size=&quot;40&quot; :src=&quot;$store.getters.userInfo.avatar&quot;&gt;&lt;/el-avatar&gt; é¿å…é‡å¤è°ƒç”¨ userInfo æ¥å£ æˆ‘ä»¬å‘ç°ï¼Œæ¯æ¬¡åˆ‡æ¢è·¯ç”±æ—¶ï¼Œéƒ½ä¼šè§¦å‘è·¯ç”±çš„å‰ç½®å®ˆå«ï¼Œä»è€Œå¤šæ¬¡è§¦å‘ getUserInfo æ¥å£ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé—®é¢˜è§£å†³ä¸€ä¸‹ åœ¨ store ä¸­å®šä¹‰ hasUserInfoï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦å·²ç»æœ‰ç”¨æˆ·ä¿¡æ¯äº†ï¼Œå¦‚æœæœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±ä¸è¦å†è§¦å‘ getUserInfo æ¥å£äº† 123456// getters.tshasUserInfo: (state) =&gt; &#123; // å¦‚æœç”¨æˆ·ä¿¡æ¯å­˜åœ¨ï¼Œreturn true return JSON.stringify(state.user.userinfo) !== &#x27;&#123;&#125;&#x27;&#125; ä¿®æ”¹ permission.ts æ–‡ä»¶ï¼Œåªæœ‰ hasUserInfo ä¸º false æ—¶ï¼Œæˆ‘ä»¬æ‰è°ƒç”¨ç”¨æˆ·ä¿¡æ¯æ¥å£ 1234567891011if (store.getters.token) &#123; if (to.path === &#x27;/login&#x27;) &#123; next(&#x27;/&#x27;) &#125; else &#123; if (!store.getters.hasUserInfo) &#123; await store.dispatch(&#x27;user/getUserInfo&#x27;) &#125; next() &#125;&#125; ç™»å‡ºé€»è¾‘ç™»å‡ºåˆ†ä¸ºä¸¤ç§å½¢å¼ï¼š ç”¨æˆ·ä¸»åŠ¨é€€å‡º ç”¨æˆ·è¢«åŠ¨ç™»å½•ï¼ˆtoken è¿‡å» | è´¦å·è¢«æŒ¤ï¼‰ ä¸ç®¡ä»¥ä½•ç§å½¢å¼é€€å‡ºï¼Œç™»å‡ºçš„é€»è¾‘éƒ½æ˜¯ç›¸åŒçš„ã€‚ æ¸…ç†æ‰ç”¨æˆ·çš„ç¼“å­˜æ•°æ® æ¸…ç†æ‰æƒé™ç›¸å…³çš„é…ç½® è¿”å›åˆ°ç™»å½•é¡µ ç™»å‡ºçš„é€»è¾‘ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å†™åœ¨ module user ä¸­å»å¤„ç†ã€‚ ä¸»è¦æ‰§è¡Œ 3 ä¸ªæ­¥éª¤ï¼š æ¸…ç©º store token æ¸…é™¤æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ è·³è½¬åˆ° login é¡µ 12345logout(context: any) &#123; context.commit(&#x27;setToken&#x27;, &#x27;&#x27;) removeAllItem() router.push(&#x27;/login&#x27;)&#125; ä¸»åŠ¨é€€å‡ºç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œé€šè¿‡ store dispatch è§¦å‘ action çš„ logout å³å¯ã€‚ è¢«åŠ¨é€€å‡ºè¢«åŠ¨é€€å‡ºå¤§æ¦‚åˆ†ä¸ºä¸¤ç§ï¼š token å¤±æ•ˆ è´¦å·è¢«æŒ¤ä¸‹å» é‚£ä¹ˆè¿™ä¸¤ç§åœºæ™¯ä¸‹ï¼Œåœ¨å‰ç«¯å¯¹åº”çš„å¤„ç†æ–¹æ¡ˆä¸€å…±ä¹Ÿåˆ†ä¸ºä¸¤ç§ï¼Œå…±åˆ†ä¸º ä¸»åŠ¨å¤„ç† ã€è¢«åŠ¨å¤„ç† ä¸¤ç§ ï¼š ä¸»åŠ¨å¤„ç†ï¼šä¸»è¦åº”å¯¹ token å¤±æ•ˆ è¢«åŠ¨å¤„ç†ï¼šåŒæ—¶åº”å¯¹ token å¤±æ•ˆ ä¸ å•ç‚¹ç™»å½•ï¼ˆè´¦å·è¢«æŒ¤ï¼‰ ç”¨æˆ·è¢«åŠ¨é€€å‡ºè§£å†³æ–¹æ¡ˆä¹‹ä¸»åŠ¨å¤„ç†ä¸ºäº†ä¿è¯ç”¨æˆ·çš„ä¿¡æ¯å®‰å…¨ï¼Œé‚£ä¹ˆå¯¹äº token è€Œè¨€å°±è¢«åˆ¶å®šäº†å¾ˆå¤šçš„å®‰å…¨ç­–ç•¥ï¼Œæ¯”å¦‚ï¼š åŠ¨æ€ tokenï¼ˆå¯å˜ tokenï¼‰ åˆ·æ–° token æ—¶æ•ˆ tokenâ€¦ æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨ æ—¶æ•ˆ tokenã€‚ é‚£ä¹ˆå¯¹åº”åˆ°æˆ‘ä»¬ä»£ç ä¸­çš„å®ç°æ–¹æ¡ˆä¸ºï¼š åœ¨ç”¨æˆ·ç™»é™†æ—¶ï¼Œè®°å½•å½“å‰ ç™»å½•æ—¶é—´ åˆ¶å®šä¸€ä¸ª å¤±æ•ˆæ—¶é•¿ åœ¨æ¥å£è°ƒç”¨æ—¶ï¼Œæ ¹æ® å½“å‰æ—¶é—´ å¯¹æ¯” ç™»å½•æ—¶é—´ ï¼Œçœ‹æ˜¯å¦è¶…è¿‡äº† æ—¶æ•ˆæ—¶é•¿ å¦‚æœæœªè¶…è¿‡ï¼Œåˆ™æ­£å¸¸è¿›è¡Œåç»­æ“ä½œ å¦‚æœè¶…è¿‡ï¼Œåˆ™è¿›è¡Œ é€€å‡ºç™»å½• æ“ä½œ ä»£ç å®ç°åˆ›å»º utils/auth.js æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324import &#123; TIME_STAMP, TOKEN_TIMEOUT_VALUE &#125; from &#x27;@/constant&#x27;import &#123; setItem, getItem &#125; from &#x27;@/utils/storage&#x27;/** * è·å–æ—¶é—´æˆ³ */export function getTimeStamp() &#123; return getItem(TIME_STAMP)&#125;/** * è®¾ç½®æ—¶é—´æˆ³ */export function setTimeStamp() &#123; setItem(TIME_STAMP, Date.now())&#125;/** * æ˜¯å¦è¶…æ—¶ */export function isCheckTimeout() &#123; // å½“å‰æ—¶é—´æˆ³ var currentTime = Date.now() // ç¼“å­˜æ—¶é—´æˆ³ var timeStamp = getTimeStamp() return currentTime - timeStamp &gt; TOKEN_TIMEOUT_VALUE&#125; åœ¨ constant ä¸­å£°æ˜å¯¹åº”å¸¸é‡ï¼š 1234// token æ—¶é—´æˆ³export const TIME_STAMP = &#x27;timeStamp&#x27;// è¶…æ—¶æ—¶é•¿(æ¯«ç§’) ä¸¤å°æ—¶export const TOKEN_TIMEOUT_VALUE = 2 * 60 * 60 * 1000 åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åå»è®¾ç½®æ—¶é—´ï¼Œåˆ° store/user.js çš„ login ä¸­ï¼š 1234567891011121314import &#123; setTimeStamp &#125; from &#x27;@/utils/auth&#x27;login(context, userInfo) &#123; ... return new Promise((resolve, reject) =&gt; &#123; ... .then(data =&gt; &#123; ... // ä¿å­˜ç™»å½•æ—¶é—´ setTimeStamp() resolve() &#125;) &#125;)&#125;, åœ¨ utils/request å¯¹åº”çš„è¯·æ±‚æ‹¦æˆªå™¨ä¸­è¿›è¡Œ ä¸»åŠ¨ä»‹å…¥ 123456789101112import &#123; isCheckTimeout &#125; from &#x27;@/utils/auth&#x27;if (store.getters.token) &#123; if (isCheckTimeout()) &#123; // ç™»å‡ºæ“ä½œ store.dispatch(&#x27;user/logout&#x27;) // å¤±è´¥çš„è¯ï¼Œä¼šèµ°åˆ° interceptors.response çš„ error æ–¹æ³•ã€‚ return Promise.reject(new Error(&#x27;token å¤±æ•ˆ&#x27;)) &#125; ...&#125; é‚£ä¹ˆè‡³æ­¤æˆ‘ä»¬å°±å®Œæˆäº† ä¸»åŠ¨å¤„ç† å¯¹åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚ ç”¨æˆ·è¢«åŠ¨é€€å‡ºè§£å†³æ–¹æ¡ˆä¹‹è¢«åŠ¨å¤„ç†èƒŒæ™¯ï¼š é¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆæ˜ç¡® è¢«åŠ¨å¤„ç† éœ€è¦åº”å¯¹ä¸¤ç§ä¸šåŠ¡åœºæ™¯ï¼š token è¿‡æœŸ å•ç‚¹ç™»å½• ç„¶åæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥å»çœ‹ï¼Œé¦–å…ˆæ˜¯ token è¿‡æœŸ æˆ‘ä»¬çŸ¥é“å¯¹äº token è€Œè¨€ï¼Œæœ¬èº«å°±æ˜¯å…·å¤‡æ—¶æ•ˆçš„ï¼Œè¿™ä¸ªæ˜¯åœ¨æœåŠ¡ç«¯ç”Ÿæˆ token æ—¶å°±å·²ç»ç¡®å®šçš„ã€‚ è€Œæ­¤æ—¶æˆ‘ä»¬æ‰€è°“çš„ token è¿‡æœŸæŒ‡çš„å°±æ˜¯ï¼š æœåŠ¡ç«¯ç”Ÿæˆçš„ token è¶…è¿‡ æœåŠ¡ç«¯æŒ‡å®šæ—¶æ•ˆ çš„è¿‡ç¨‹ï¼Œå°±åƒæˆ‘ä»¬å‰ç«¯é¡¹ç›®æŒ‡å®š token çš„å¤±æ•ˆæ€§ä¸€æ ·ã€‚ è€Œå¯¹äº å•ç‚¹ç™»å½• è€Œè¨€ï¼ŒæŒ‡çš„æ˜¯ï¼š å½“ç”¨æˆ· A ç™»å½•ä¹‹åï¼Œtoken è¿‡æœŸä¹‹å‰ã€‚ ç”¨æˆ· A çš„è´¦å·åœ¨å…¶ä»–çš„è®¾å¤‡ä¸­è¿›è¡Œäº†äºŒæ¬¡ç™»å½•ï¼Œå¯¼è‡´ç¬¬ä¸€æ¬¡ç™»å½•çš„ A è´¦å·è¢« â€œé¡¶ä¸‹æ¥â€ çš„è¿‡ç¨‹ã€‚ å³ï¼šåŒä¸€è´¦æˆ·ä»…å¯ä»¥åœ¨ä¸€ä¸ªè®¾å¤‡ä¸­ä¿æŒåœ¨çº¿çŠ¶æ€ é‚£ä¹ˆæ˜ç¡®å¥½äº†å¯¹åº”çš„èƒŒæ™¯ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹å¯¹åº”çš„ä¸šåŠ¡å¤„ç†åœºæ™¯ï¼š ä»èƒŒæ™¯ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œä»¥ä¸Šçš„ä¸¤ç§æƒ…å†µï¼Œéƒ½æ˜¯åœ¨ æœåŠ¡ç«¯è¿›è¡Œåˆ¤æ–­çš„ï¼Œè€Œå¯¹äºå‰ç«¯è€Œè¨€å…¶å®æ˜¯ æœåŠ¡ç«¯é€šçŸ¥å‰ç«¯çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚ æ‰€ä»¥è¯´å¯¹äºå…¶ä¸šåŠ¡å¤„ç†ï¼Œå°†éµå¾ªä»¥ä¸‹é€»è¾‘ï¼š æœåŠ¡ç«¯è¿”å›æ•°æ®æ—¶ï¼Œä¼šé€šè¿‡ç‰¹å®šçš„çŠ¶æ€ç é€šçŸ¥å‰ç«¯ å½“å‰ç«¯æ¥æ”¶åˆ°ç‰¹å®šçŠ¶æ€ç æ—¶ï¼Œè¡¨ç¤ºé‡åˆ°äº†ç‰¹å®šçŠ¶æ€ï¼štoken æ—¶æ•ˆ æˆ– å•ç‚¹ç™»å½• æ­¤æ—¶è¿›è¡Œ é€€å‡ºç™»å½• å¤„ç† è¿™é‡Œåªåšäº† token çš„è¿‡æœŸå¤„ç†ï¼Œå¦‚æœéœ€è¦åˆ° å•ç‚¹ç™»å½• æ—¶ï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªçŠ¶æ€ç åˆ¤æ–­å³å¯ã€‚ æœåŠ¡ç«¯è¶…æ—¶é—´é€»è¾‘æˆ‘ä»¬æ¥ç®€å•å®ç°ä¸€ä¸‹åç«¯çš„è¶…æ—¶é€»è¾‘ã€‚ æˆ‘ä»¬é€šè¿‡ app.use æ·»åŠ äº†ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ¯ä¸€æ¬¡å‰ç«¯è§¦å‘äº†æ¥å£è¯·æ±‚ï¼Œéƒ½ä¼šå…ˆèµ°è¿™ä¸ªä¸­é—´ä»¶é€»è¾‘ã€‚ æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬æŠŠ now å’Œ current è®¾ç½®å½“å‰æ—¶é—´æˆ³ï¼Œå½“æœ‰ä¸€ä¸ªæ¥å£è§¦å‘äº†ï¼Œä¼šå°† current è®¾ç½®æ–°çš„æ—¶é—´æˆ³ã€‚ 1234567891011121314151617181920212223242526272829303132const express = require(&#x27;express&#x27;);const app = express()// token è¶…æ—¶ 2hconst TOKEN_TIMEOUT_VALUE = 2 * 60 * 60 * 1000let now = Date.now()let current = Date.now()app.use(function(req, res, next) &#123; // æ¯æ¬¡æœ‰æ¥å£è°ƒç”¨ï¼Œè§¦å‘ä¸­é—´ä»¶ï¼Œå°† current æ›´æ–° current = Date.now() // å¦‚æœæ˜¯ç™»å½•é€»è¾‘ï¼Œæˆ‘ä»¬å°† now è®¾ç½®ä¸º currentï¼Œè¿™æ ·å°±ä¸ä¼šè§¦å‘è¶…æ—¶é€»è¾‘ // é‡æ–°ç™»å½•ï¼Œç»§ç»­èµ°æ­¤åˆ¤æ–­ï¼Œå°† now è®¾ç½®ä¸º current if (req.path === &#x27;/login&#x27;) &#123; now = current &#125; // æ¯æ¬¡ä¸­é—´ä»¶éƒ½ä¼šå°† current æ›´æ–°ä¸ºå½“å‰æ—¶é—´æˆ³ï¼Œä¸€æ—¦æ—¶é—´æˆ³çš„å·®å€¼ï¼Œå¤§äºäº† 2hï¼Œå°±ä¼šè§¦å‘ è¶…æ—¶é€»è¾‘ if (current - now &gt; TOKEN_TIMEOUT_VALUE) &#123; // è¶…æ—¶ res.status(401).send(&#123; code: 401, message: &#x27;æœåŠ¡ç«¯message: token å¤±æ•ˆå•¦&#x27;, success: false, &#125;) &#125; else &#123; // æ²¡æœ‰è¶…æ—¶ï¼Œå°†æ‰§è¡Œæƒäº¤ç»™ä¸‹ä¸€ä¸ªè·¯ç”± next() &#125;&#125;) é‚£ä¹ˆæ˜ç¡®å¥½äº†ä¸šåŠ¡ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°å‰ç«¯å¯¹åº”ä»£ç ï¼š åœ¨ utils/request çš„å“åº”æ‹¦æˆªå™¨ä¸­ï¼Œå¢åŠ ä»¥ä¸‹é€»è¾‘ï¼š 1234567891011121314151617181920212223// å“åº”æ‹¦æˆªå™¨service.interceptors.response.use( response =&gt; &#123; ... &#125;, error =&gt; &#123; // å¤„ç† token è¶…æ—¶é—®é¢˜ if ( error.response &amp;&amp; error.response.data &amp;&amp; error.response.data.code === 401 ) &#123; store.dispatch(&#x27;user/logout&#x27;) &#125; if (error.response &amp;&amp; error.response.data &amp;&amp; error.response.data.message) &#123; ElMessage.error(error.response.data.message) // æç¤ºæœåŠ¡ç«¯æŠ›å‡ºçš„é”™è¯¯ä¿¡æ¯ &#125; else &#123; ElMessage.error(error.message) &#125; return Promise.reject(error) &#125;) é‚£ä¹ˆè‡³æ­¤ï¼Œæˆ‘ä»¬å°±å·²ç»å®Œæˆäº† æ•´ä¸ªç”¨æˆ·é€€å‡º æ–¹æ¡ˆã€‚ Sidebar åŠ¨æ€èœå•æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¤„ç† åŠ¨æ€menuèœå•ã€‚ ä¸´æ—¶çš„ menu èœå•ï¼Œåˆ›å»º layout/Sidebar/SidebarMenu æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132&lt;template&gt; &lt;!-- ä¸€çº§ menu èœå• --&gt; &lt;el-menu &#123;/* åªå…è®¸ä¸€ä¸ªèœå•å±•å¼€ */&#125; :uniqueOpened=&quot;true&quot; default-active=&quot;1&quot; background-color=&quot;#545c64&quot; text-color=&quot;#fff&quot; active-text-color=&quot;#ffd04b&quot; &gt; &lt;!-- å­é›† menu èœå• --&gt; &lt;el-sub-menu index=&quot;1&quot;&gt; &lt;template #title&gt; &lt;el-icon&gt;&lt;location /&gt;&lt;/el-icon&gt; &lt;span&gt;å¯¼èˆªä¸€&lt;/span&gt; &lt;/template&gt; &lt;el-menu-item index=&quot;1-1&quot;&gt;é€‰é¡¹1&lt;/el-menu-item&gt; &lt;el-menu-item index=&quot;1-2&quot;&gt;é€‰é¡¹2&lt;/el-menu-item&gt; &lt;/el-sub-menu&gt; &lt;!-- å…·ä½“èœå•é¡¹ --&gt; &lt;el-menu-item index=&quot;4&quot;&gt; &lt;el-icon&gt;&lt;setting /&gt;&lt;/el-icon&gt; &lt;template #title&gt;å¯¼èˆªå››&lt;/template&gt; &lt;/el-menu-item&gt; &lt;/el-menu&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;import &#123; ref, reactive &#125; from &#x27;vue&#x27;import &#123; Location, Setting &#125; from &#x27;@element-plus/icons-vue&#x27;&lt;/script&gt;&lt;style scoped&gt;&lt;/style&gt; åœ¨ layout/Sidebar/index ä¸­å¯¼å…¥è¯¥ç»„ä»¶ 12345678910111213&lt;template&gt; &lt;div class=&quot;&quot;&gt; &lt;h1&gt;å ä½&lt;/h1&gt; &lt;el-scrollbar&gt; &lt;sidebar-menu&gt;&lt;/sidebar-menu&gt; &lt;/el-scrollbar&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import SidebarMenu from &#x27;./SidebarMenu&#x27;import &#123;&#125; from &#x27;vue&#x27;&lt;/script&gt; é‚£ä¹ˆè‡³æ­¤æˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªä¸´æ—¶çš„ menu èœå•ï¼Œä»è¿™ä¸ªä¸´æ—¶çš„ menu èœå•å‡ºå¯ä»¥çœ‹åˆ°ï¼Œel-menu å…¶å®åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼š el-menuï¼šæ•´ä¸ª menu èœå• el-submenuï¼šå­é›† menu èœå• el-menu-itemï¼šå…·ä½“èœå•é¡¹ é‚£ä¹ˆæ˜ç¡®å¥½äº†è¿™äº›å†…å®¹ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ¥å»åˆ†æä¸€ä¸‹ åŠ¨æ€ menu èœå•å¦‚ä½•ç”Ÿæˆäº† åŠ¨æ€menuèœå•å¤„ç†æ–¹æ¡ˆè§£æåŠ¨æ€menuèœå• å…¶å®ä¸»è¦æ˜¯å’Œ åŠ¨æ€è·¯ç”±è¡¨ é…åˆæ¥å»å®ç° ç”¨æˆ·æƒé™ çš„ã€‚ ä½†æ˜¯ ç”¨æˆ·æƒé™å¤„ç† ç›®å‰è¿˜æœªæ¶‰åŠåˆ°ï¼Œå› ä¸ºå’±ä»¬æƒ³è¦å¤„ç† ç”¨æˆ·æƒé™ è¿˜éœ€è¦å…ˆå»å¤„ç†å¾ˆå¤šçš„ä¸šåŠ¡åœºæ™¯ï¼Œæ‰€ä»¥æš‚æ—¶å…ˆåªå¤„ç† åŠ¨æ€menuèœå• ã€‚ æ‰€è°“ åŠ¨æ€menuèœå• æŒ‡çš„æ˜¯ï¼š æ ¹æ®è·¯ç”±è¡¨çš„é…ç½®ï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ menu èœå•ã€‚ å½“è·¯ç”±è¡¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œmenu èœå•è‡ªåŠ¨å‘ç”Ÿå˜åŒ– é‚£ä¹ˆæ˜ç¡®äº† åŠ¨æ€menuèœå• çš„å«ä¹‰ä¹‹åï¼Œæ¥ä¸‹æ¥å’±ä»¬å°±éœ€è¦æ¥æ˜ç¡® åŠ¨æ€menuèœå• çš„å®ç°æ–¹æ¡ˆï¼š å®šä¹‰ è·¯ç”±è¡¨ å¯¹åº” menu èœå•è§„åˆ™ æ ¹æ®è§„åˆ™åˆ¶å®š è·¯ç”±è¡¨ æ ¹æ®è§„åˆ™ï¼Œä¾æ® è·¯ç”±è¡¨ ï¼Œç”Ÿæˆ menu èœå• é‚£ä¹ˆæ ¹æ®æˆ‘ä»¬çš„å®ç°æ–¹æ¡ˆå¯ä»¥å‘ç°ï¼Œå®ç° åŠ¨æ€menuèœå• æœ€æ ¸å¿ƒçš„å…³é”®ç‚¹å…¶å®å°±åœ¨æ­¥éª¤ä¸€ï¼Œä¹Ÿå°±æ˜¯ å®šä¹‰ è·¯ç”±è¡¨ å¯¹åº” menu èœå•è§„åˆ™ é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ï¼Œè¿™ä¸ªè§„åˆ™å¦‚ä½•åˆ¶å®šï¼š å¯¹äºå•ä¸ªè·¯ç”±è§„åˆ™è€Œè¨€ï¼ˆå¾ªç¯ï¼‰ï¼š å¦‚æœå­˜åœ¨ meta &amp;&amp; meta.title &amp;&amp; meta.icon ï¼šåˆ™æ˜¾ç¤ºåœ¨ menu èœå•ä¸­ï¼Œå…¶ä¸­ title ä¸ºæ˜¾ç¤ºçš„å†…å®¹ï¼Œicon ä¸ºæ˜¾ç¤ºçš„å›¾æ ‡ å¦‚æœå­˜åœ¨ children ï¼šåˆ™ä»¥ el-sub-menuï¼ˆå­èœå•ï¼‰ å±•ç¤º å¦åˆ™ï¼šåˆ™ä»¥ el-menu-itemï¼ˆèœå•é¡¹ï¼‰ å±•ç¤º å¦åˆ™ï¼šä¸æ˜¾ç¤ºåœ¨ menu èœå•ä¸­ é‚£ä¹ˆæ˜ç¡®å¥½äº†å¯¹åº”çš„è§„åˆ™ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ¥å»çœ‹ä¸€ä¸‹å¦‚ä½•è¿›è¡Œå®ç°å•¦ï¼ ç”Ÿæˆé¡¹ç›®é¡µé¢ç»„ä»¶æ˜ç¡®äº†å¯¹åº”çš„æ–¹æ¡ˆä¹‹åï¼Œé‚£ä¹ˆä¸‹é¢å’±ä»¬å°±æ¥å®ç°å¯¹åº”çš„ä»£ç é€»è¾‘ã€‚ æ ¹æ®æˆ‘ä»¬çš„åˆ†æï¼Œæƒ³è¦å®ŒæˆåŠ¨æ€çš„ menuï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æŒ‰ç…§ä»¥ä¸‹çš„æ­¥éª¤æ¥å»å®ç°ï¼š åˆ›å»ºé¡µé¢ç»„ä»¶ ç”Ÿæˆè·¯ç”±è¡¨ è§£æè·¯ç”±è¡¨ ç”Ÿæˆ menu èœå• é‚£ä¹ˆæ˜ç¡®å¥½äº†æ­¥éª¤ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å…ˆæ¥å®ç°ç¬¬ä¸€æ­¥ åˆ›å»ºé¡µé¢ç»„ä»¶ åœ¨ views æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºå¦‚ä¸‹é¡µé¢ï¼š åˆ›å»ºæ–‡ç« ï¼šarticle-create æ–‡ç« è¯¦æƒ…ï¼šarticle-detail æ–‡ç« æ’åï¼šarticle-ranking é”™è¯¯é¡µé¢ï¼šerror-page 404 401 å¯¼å…¥ï¼šimport æƒé™åˆ—è¡¨ï¼špermission-list ä¸ªäººä¸­å¿ƒï¼šprofile è§’è‰²åˆ—è¡¨ï¼šrole-list ç”¨æˆ·ä¿¡æ¯ï¼šuser-info ç”¨æˆ·ç®¡ç†ï¼šuser-manage åˆ›å»ºç»“æ„è·¯ç”±è¡¨æƒ³è¦å®ç°ç»“æ„è·¯ç”±è¡¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“æœ€ç»ˆæˆ‘ä»¬è¦å®ç°çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œå¤§å®¶æ¥çœ‹ä¸‹é¢çš„æˆªå›¾ï¼š è¿™æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦å®ç°çš„ menu æˆªå›¾ã€‚ æ ¹æ®æ­¤æˆªå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸¤ç‚¹å†…å®¹ï¼š æˆ‘ä»¬åˆ›å»ºçš„é¡µé¢å¹¶æ²¡æœ‰å…¨éƒ¨è¿›è¡Œå±•ç¤º ä¸æ˜¾ç¤ºé¡µé¢è¡¨ç¤º ä¸æ»¡è¶³ è¯¥æ¡ä»¶ meta &amp;&amp; meta.title &amp;&amp; meta.icon menu èœå•å°†å…·å¤‡çˆ¶å­çº§çš„ç»“æ„ æŒ‰ç…§æ­¤ç»“æ„è§„åˆ’æ•°æ®ï¼Œåˆ™æ•°æ®åº”ä¸º123456789101112131415161718192021222324252627282930313233343536[ &#123; &quot;title&quot;: &quot;ä¸ªäººä¸­å¿ƒ&quot;, &quot;path&quot;: &quot;&quot; &#125;, &#123; &quot;title&quot;: &quot;ç”¨æˆ·&quot;, &quot;children&quot;: [ &#123; &quot;title&quot;: &quot;å‘˜å·¥ç®¡ç†&quot;, &quot;path&quot;: &quot;&quot; &#125;, &#123; &quot;title&quot;: &quot;è§’è‰²åˆ—è¡¨&quot;, &quot;path&quot;: &quot;&quot; &#125;, &#123; &quot;title&quot;: &quot;æƒé™åˆ—è¡¨&quot;, &quot;path&quot;: &quot;&quot; &#125; ] &#125;, &#123; &quot;title&quot;: &quot;æ–‡ç« &quot;, &quot;children&quot;: [ &#123; &quot;title&quot;: &quot;æ–‡ç« æ’å&quot;, &quot;path&quot;: &quot;&quot; &#125;, &#123; &quot;title&quot;: &quot;åˆ›å»ºæ–‡ç« &quot;, &quot;path&quot;: &quot;&quot; &#125; ] &#125;] åˆå› ä¸ºå°†æ¥æˆ‘ä»¬éœ€è¦è¿›è¡Œ ç”¨æˆ·æƒé™å¤„ç†ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬éœ€è¦å…ˆå¯¹è·¯ç”±è¡¨è¿›è¡Œä¸€ä¸ªåˆ’åˆ†ï¼š ç§æœ‰è·¯ç”±è¡¨ privateRoutes ï¼šæƒé™è·¯ç”± å…¬æœ‰è·¯ç”±è¡¨ publicRoutesï¼šæ— æƒé™è·¯ç”± æ ¹æ®ä»¥ä¸Šç†è®ºï¼Œç”Ÿæˆä»¥ä¸‹è·¯ç”±è¡¨ç»“æ„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139/** * ç§æœ‰è·¯ç”±è¡¨ */const privateRoutes = [ &#123; path: &#x27;/user&#x27;, component: layout, redirect: &#x27;/user/manage&#x27;, meta: &#123; title: &#x27;user&#x27;, icon: &#x27;personnel&#x27; &#125;, children: [ &#123; path: &#x27;/user/manage&#x27;, component: () =&gt; import(&#x27;@/views/user-manage/index&#x27;), meta: &#123; title: &#x27;userManage&#x27;, icon: &#x27;personnel-manage&#x27; &#125; &#125;, &#123; path: &#x27;/user/role&#x27;, component: () =&gt; import(&#x27;@/views/role-list/index&#x27;), meta: &#123; title: &#x27;roleList&#x27;, icon: &#x27;role&#x27; &#125; &#125;, &#123; path: &#x27;/user/permission&#x27;, component: () =&gt; import(&#x27;@/views/permission-list/index&#x27;), meta: &#123; title: &#x27;permissionList&#x27;, icon: &#x27;permission&#x27; &#125; &#125;, &#123; path: &#x27;/user/info/:id&#x27;, name: &#x27;userInfo&#x27;, component: () =&gt; import(&#x27;@/views/user-info/index&#x27;), meta: &#123; title: &#x27;userInfo&#x27; &#125; &#125;, &#123; path: &#x27;/user/import&#x27;, name: &#x27;import&#x27;, component: () =&gt; import(&#x27;@/views/import/index&#x27;), meta: &#123; title: &#x27;excelImport&#x27; &#125; &#125; ] &#125;, &#123; path: &#x27;/article&#x27;, component: layout, redirect: &#x27;/article/ranking&#x27;, meta: &#123; title: &#x27;article&#x27;, icon: &#x27;article&#x27; &#125;, children: [ &#123; path: &#x27;/article/ranking&#x27;, component: () =&gt; import(&#x27;@/views/article-ranking/index&#x27;), meta: &#123; title: &#x27;articleRanking&#x27;, icon: &#x27;article-ranking&#x27; &#125; &#125;, &#123; path: &#x27;/article/:id&#x27;, component: () =&gt; import(&#x27;@/views/article-detail/index&#x27;), meta: &#123; title: &#x27;articleDetail&#x27; &#125; &#125;, &#123; path: &#x27;/article/create&#x27;, component: () =&gt; import(&#x27;@/views/article-create/index&#x27;), meta: &#123; title: &#x27;articleCreate&#x27;, icon: &#x27;article-create&#x27; &#125; &#125;, &#123; path: &#x27;/article/editor/:id&#x27;, component: () =&gt; import(&#x27;@/views/article-create/index&#x27;), meta: &#123; title: &#x27;articleEditor&#x27; &#125; &#125; ] &#125;]/** * å…¬å¼€è·¯ç”±è¡¨ */const publicRoutes = [ &#123; path: &#x27;/login&#x27;, component: () =&gt; import(&#x27;@/views/login/index&#x27;) &#125;, &#123; path: &#x27;/&#x27;, // æ³¨æ„ï¼šå¸¦æœ‰è·¯å¾„â€œ/â€çš„è®°å½•ä¸­çš„ç»„ä»¶â€œé»˜è®¤â€æ˜¯ä¸€ä¸ªä¸è¿”å› Promise çš„å‡½æ•° component: layout, redirect: &#x27;/profile&#x27;, children: [ &#123; path: &#x27;/profile&#x27;, name: &#x27;profile&#x27;, component: () =&gt; import(&#x27;@/views/profile/index&#x27;), meta: &#123; title: &#x27;profile&#x27;, icon: &#x27;el-icon-user&#x27; &#125; &#125;, &#123; path: &#x27;/404&#x27;, name: &#x27;404&#x27;, component: () =&gt; import(&#x27;@/views/error-page/404&#x27;) &#125;, &#123; path: &#x27;/401&#x27;, name: &#x27;401&#x27;, component: () =&gt; import(&#x27;@/views/error-page/401&#x27;) &#125; ] &#125;]const router = createRouter(&#123; history: createWebHashHistory(), routes: [...publicRoutes, ...privateRoutes]&#125;) æœ€åä¸è¦å¿˜è®°åœ¨ layout/appMain ä¸‹è®¾ç½®è·¯ç”±å‡ºå£ 12345&lt;template&gt; &lt;div class=&quot;app-main&quot;&gt; &lt;router-view&gt;&lt;/router-view&gt; &lt;/div&gt;&lt;/template&gt; è§£æè·¯ç”±è¡¨ï¼Œè·å–ç»“æ„åŒ–æ•°æ®æƒ³è¦è·å–è·¯ç”±è¡¨æ•°æ®ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æ–¹å¼ï¼š router.options.routesï¼šåˆå§‹è·¯ç”±åˆ—è¡¨ï¼ˆæ–°å¢çš„è·¯ç”± æ— æ³•è·å–åˆ°ï¼‰ router.getRoutes()ï¼šè·å–æ‰€æœ‰ è·¯ç”±è®°å½• çš„å®Œæ•´åˆ—è¡¨ æ‰€ä»¥ï¼Œæˆ‘ä»¬æ­¤æ—¶ä½¿ç”¨ router.getRoutes() æ–¹æ³•è·å–å®Œæ•´çš„è·¯ç”±åˆ—è¡¨ åœ¨ layout/components/Sidebar/SidebarMenu ä¸‹å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 123456&lt;script setup&gt;import &#123; useRouter &#125; from &#x27;vue-router&#x27;const router = useRouter()console.log(router.getRoutes())&lt;/script&gt; ä»è¿”å›çš„æ•°æ®æ¥çœ‹ï¼Œå®ƒä¸æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ç»“æ„ç›¸å»ç”šè¿œã€‚ å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› ï¼Œæ˜¯å› ä¸ºå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ª å®Œæ•´çš„è·¯ç”±è¡¨ è¿™ä¸ªè·¯ç”±è¡¨è·ç¦»æˆ‘ä»¬æƒ³è¦çš„å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š å­˜åœ¨é‡å¤çš„è·¯ç”±æ•°æ® ä¸æ»¡è¶³è¯¥æ¡ä»¶ meta &amp;&amp; meta.title &amp;&amp; meta.icon çš„æ•°æ®ä¸åº”è¯¥å­˜åœ¨ é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±åº”è¯¥æ¥å¤„ç†è¿™ä¸¤ä¸ªé—®é¢˜ åˆ›å»º utils/route.ts æ–‡ä»¶ï¼Œåˆ›å»ºä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«å¤„ç†å¯¹åº”çš„ä¸¤ä¸ªé—®é¢˜ï¼š filterRouters generateMenus å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import path from &#x27;path&#x27;/** * è¿”å›æ‰€æœ‰å­è·¯ç”± */const getChildrenRoutes = routes =&gt; &#123; const result = [] routes.forEach(route =&gt; &#123; if (route.children &amp;&amp; route.children.length &gt; 0) &#123; result.push(...route.children) &#125; &#125;) return result&#125;/** * å¤„ç†è„±ç¦»å±‚çº§çš„è·¯ç”±ï¼šæŸä¸ªä¸€çº§è·¯ç”±ä¸ºå…¶ä»–å­è·¯ç”±ï¼Œåˆ™å‰”é™¤è¯¥ä¸€çº§è·¯ç”±ï¼Œä¿ç•™è·¯ç”±å±‚çº§ * @param &#123;*&#125; routes router.getRoutes() */export const filterRouters = routes =&gt; &#123; const childrenRoutes = getChildrenRoutes(routes) return routes.filter(route =&gt; &#123; return !childrenRoutes.find(childrenRoute =&gt; &#123; return childrenRoute.path === route.path &#125;) &#125;)&#125;/** * åˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºç©ºå€¼ */function isNull(data) &#123; if (!data) return true if (JSON.stringify(data) === &#x27;&#123;&#125;&#x27;) return true if (JSON.stringify(data) === &#x27;[]&#x27;) return true return false&#125;/** * æ ¹æ® routes æ•°æ®ï¼Œè¿”å›å¯¹åº” menu è§„åˆ™æ•°ç»„ */export function generateMenus(routes, basePath = &#x27;&#x27;) &#123; const result = [] // éå†è·¯ç”±è¡¨ routes.forEach(item =&gt; &#123; // ä¸å­˜åœ¨ children &amp;&amp; ä¸å­˜åœ¨ meta ç›´æ¥ return if (isNull(item.meta) &amp;&amp; isNull(item.children)) return // å­˜åœ¨ children ä¸å­˜åœ¨ metaï¼Œè¿›å…¥è¿­ä»£ if (isNull(item.meta) &amp;&amp; !isNull(item.children)) &#123; result.push(...generateMenus(item.children)) return &#125; // åˆå¹¶ path ä½œä¸ºè·³è½¬è·¯å¾„ const routePath = path.resolve(basePath, item.path) // è·¯ç”±åˆ†ç¦»ä¹‹åï¼Œå­˜åœ¨åŒåçˆ¶è·¯ç”±çš„æƒ…å†µï¼Œéœ€è¦å•ç‹¬å¤„ç† let route = result.find(item =&gt; item.path === routePath) if (!route) &#123; route = &#123; ...item, path: routePath, children: [] &#125; // icon ä¸ title å¿…é¡»å…¨éƒ¨å­˜åœ¨ if (route.meta.icon &amp;&amp; route.meta.title) &#123; // meta å­˜åœ¨ç”Ÿæˆ route å¯¹è±¡ï¼Œæ”¾å…¥ arr result.push(route) &#125; &#125; // å­˜åœ¨ children è¿›å…¥è¿­ä»£åˆ°children if (item.children) &#123; route.children.push(...generateMenus(item.children, route.path)) &#125; &#125;) return result&#125; åœ¨ SidebarMenu ä¸­è°ƒç”¨è¯¥æ–¹æ³• 123456789101112&lt;script setup&gt;import &#123; computed &#125; from &#x27;vue&#x27;import &#123; useRouter &#125; from &#x27;vue-router&#x27;import &#123; filterRouters, generateMenus &#125; from &#x27;@/utils/route&#x27;const router = useRouter()const routes = computed(() =&gt; &#123; const filterRoutes = filterRouters(router.getRoutes()) return generateMenus(filterRoutes)&#125;)console.log(JSON.stringify(routes.value))&lt;/script&gt; å¾—åˆ°è¯¥æ•°æ®ç»“æ„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091[ &#123; &quot;path&quot;:&quot;/profile&quot;, &quot;name&quot;:&quot;profile&quot;, &quot;meta&quot;:&#123; &quot;title&quot;:&quot;profile&quot;, &quot;icon&quot;:&quot;el-icon-user&quot; &#125;, &#125;, &#123; &quot;path&quot;:&quot;/user&quot;, &quot;redirect&quot;:&quot;/user/manage&quot;, &quot;meta&quot;:&#123; &quot;title&quot;:&quot;user&quot;, &quot;icon&quot;:&quot;personnel&quot; &#125;, &quot;props&quot;:&#123; &quot;default&quot;:false &#125;, &quot;children&quot;:[ &#123; &quot;path&quot;:&quot;/user/manage&quot;, &quot;name&quot;:&quot;userManage&quot;, &quot;meta&quot;:&#123; &quot;title&quot;:&quot;userManage&quot;, &quot;icon&quot;:&quot;personnel-manage&quot; &#125;, &quot;children&quot;:[ ] &#125;, &#123; &quot;path&quot;:&quot;/user/role&quot;, &quot;name&quot;:&quot;userRole&quot;, &quot;meta&quot;:&#123; &quot;title&quot;:&quot;roleList&quot;, &quot;icon&quot;:&quot;role&quot; &#125;, &quot;children&quot;:[ ] &#125;, &#123; &quot;path&quot;:&quot;/user/permission&quot;, &quot;name&quot;:&quot;userPermission&quot;, &quot;meta&quot;:&#123; &quot;title&quot;:&quot;permissionList&quot;, &quot;icon&quot;:&quot;permission&quot; &#125;, &quot;children&quot;:[ ] &#125; ], &#125;, &#123; &quot;path&quot;:&quot;/article&quot;, &quot;redirect&quot;:&quot;/article/ranking&quot;, &quot;meta&quot;:&#123; &quot;title&quot;:&quot;article&quot;, &quot;icon&quot;:&quot;article&quot; &#125;, &quot;props&quot;:&#123; &quot;default&quot;:false &#125;, &quot;children&quot;:[ &#123; &quot;path&quot;:&quot;/article/ranking&quot;, &quot;name&quot;:&quot;articleRanking&quot;, &quot;meta&quot;:&#123; &quot;title&quot;:&quot;articleRanking&quot;, &quot;icon&quot;:&quot;article-ranking&quot; &#125;, &quot;children&quot;:[ ] &#125;, &#123; &quot;path&quot;:&quot;/article/create&quot;, &quot;name&quot;:&quot;articleCreate&quot;, &quot;meta&quot;:&#123; &quot;title&quot;:&quot;articleCreate&quot;, &quot;icon&quot;:&quot;article-create&quot; &#125;, &quot;children&quot;:[ ] &#125; ], &#125;] ç”ŸæˆåŠ¨æ€ menu èœå•æœ‰äº†æ•°æ®ç»“æ„ä¹‹åï¼Œæœ€åçš„æ­¥éª¤å°±æ°´åˆ°æ¸ æˆäº† æ•´ä¸ª menu èœå•ï¼Œæˆ‘ä»¬å°†åˆ†æˆä¸‰ä¸ªç»„ä»¶æ¥è¿›è¡Œå¤„ç† SidebarMenuï¼šå¤„ç†æ•°æ®ï¼Œä½œä¸ºæœ€é¡¶å±‚ menu è½½ä½“ SidebarItemï¼šæ ¹æ®æ•°æ®å¤„ç† å½“å‰é¡¹ä¸º el-submenu || el-menu-item MenuItemï¼šå¤„ç† el-menu-item æ ·å¼ é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥å¤„ç† é¦–å…ˆæ˜¯ SidebarMenu 12345678910111213&lt;template&gt; &lt;!-- ä¸€çº§ menu èœå• --&gt; &lt;el-menu ... &gt; &lt;sidebar-item v-for=&quot;item in routes&quot; :key=&quot;item.path&quot; :route=&quot;item&quot; &gt;&lt;/sidebar-item&gt; &lt;/el-menu&gt;&lt;/template&gt; åˆ›å»º SidebarItem ç»„ä»¶ï¼Œç”¨æ¥æ ¹æ®æ•°æ®å¤„ç† å½“å‰é¡¹ä¸º el-sub-menu || el-menu-item 123456789101112131415161718192021222324252627282930&lt;template&gt; &lt;!-- æ”¯æŒæ¸²æŸ“å¤šçº§ menu èœå• --&gt; &lt;el-sub-menu v-if=&quot;route.children.length &gt; 0&quot; :index=&quot;route.path&quot;&gt; &lt;template #title&gt; &lt;menu-item :title=&quot;route.meta.title&quot; :icon=&quot;route.meta.icon&quot;&gt;&lt;/menu-item&gt; &lt;/template&gt; &lt;!-- å¾ªç¯æ¸²æŸ“ --&gt; &lt;sidebar-item v-for=&quot;item in route.children&quot; :key=&quot;item.path&quot; :route=&quot;item&quot; &gt;&lt;/sidebar-item&gt; &lt;/el-sub-menu&gt; &lt;!-- æ¸²æŸ“ item é¡¹ --&gt; &lt;el-menu-item v-else :index=&quot;route.path&quot;&gt; &lt;menu-item :title=&quot;route.meta.title&quot; :icon=&quot;route.meta.icon&quot;&gt;&lt;/menu-item&gt; &lt;/el-menu-item&gt;&lt;/template&gt;&lt;script setup&gt;import MenuItem from &#x27;./MenuItem&#x27;import &#123; defineProps &#125; from &#x27;vue&#x27;// å®šä¹‰ propsdefineProps(&#123; route: &#123; type: Object, required: true &#125;&#125;)&lt;/script&gt; åˆ›å»º MenuItem ç”¨æ¥å¤„ç† el-menu-item æ ·å¼ 12345678910111213141516171819202122&lt;template&gt; &lt;i v-if=&quot;icon.includes(&#x27;el-icon&#x27;)&quot; class=&quot;sub-el-icon&quot; :class=&quot;icon&quot;&gt;&lt;/i&gt; &lt;svg-icon v-else :icon=&quot;icon&quot;&gt;&lt;/svg-icon&gt; &lt;span&gt;&#123;&#123; title &#125;&#125;&lt;/span&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; defineProps &#125; from &#x27;vue&#x27;defineProps(&#123; title: &#123; type: String, required: true &#125;, icon: &#123; type: String, required: true &#125;&#125;)&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt; è‡³æ­¤ï¼Œæ•´ä¸ªçš„ menu èœå•ç»“æ„å°±å·²ç»å®Œæˆäº†ï¼ ä¿®å¤æœ€åæ®‹ä½™é—®é¢˜ç›®å‰ menu èœå•å­˜åœ¨ä¸‰ä¸ªé—®é¢˜ æ ·å¼é—®é¢˜ è·¯ç”±è·³è½¬é—®é¢˜ é»˜è®¤æ¿€æ´»é¡¹ æ ·å¼é—®é¢˜ï¼š é¦–å…ˆå¤„ç†æ ·å¼ï¼Œå› ä¸ºåé¢æˆ‘ä»¬éœ€è¦å¤„ç† ä¸»é¢˜æ›¿æ¢ ï¼Œæ‰€ä»¥æ­¤å¤„æˆ‘ä»¬ä¸èƒ½æŠŠæ ·å¼å†™æ­»ã€‚å› ä¸ºæˆ‘ä»¬çš„æ ·å¼å˜é‡éƒ½æ”¾åœ¨ variables.scss æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡ :export å¯¼å‡ºäº†å˜é‡ä»¥ä¾› js å¯¼å…¥ï¼Œæ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦å¯¼å…¥ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ”¾åœ¨ store getters ä¸­ï¼Œä»¥ä¾¿ å¿«æ·è®¿é—®ã€‚ 12345import variables from &#x27;@/styles/variables.scss&#x27;const getters = &#123; cssVar: () =&gt; variables&#125;export default getters åœ¨ SidebarMenu ä¸­å†™å…¥å¦‚ä¸‹æ ·å¼ 123456&lt;el-menu :background-color=&quot;$store.getters.cssVar.menuBg&quot; :text-color=&quot;$store.getters.cssVar.menuText&quot; :active-text-color=&quot;$store.getters.cssVar.menuActiveText&quot; :unique-opened=&quot;true&quot;&gt; è·¯ç”±è·³è½¬é—®é¢˜ï¼š ä¸º el-menu æŒ‡å®š router 1234&lt;el-menu ... router&gt; æ·»åŠ  router å±æ€§ è¡¨ç¤ºæ˜¯å¦å¯ç”¨ vue-router æ¨¡å¼ã€‚ å¯ç”¨è¯¥æ¨¡å¼ä¼šåœ¨æ¿€æ´»å¯¼èˆªæ—¶ä»¥ index ä½œä¸º path è¿›è¡Œè·¯ç”±è·³è½¬ ä½¿ç”¨ default-active æ¥è®¾ç½®åŠ è½½æ—¶çš„æ¿€æ´»é¡¹ã€‚ é»˜è®¤æ¿€æ´»é¡¹ï¼š æ ¹æ®å½“å‰ url è¿›è¡Œåˆ¤æ–­å³å¯ 123456789101112131415&lt;el-menu :default-active=&quot;activeMenu&quot; ...&gt;&lt;script setup&gt;...// è®¡ç®—é«˜äº® menu çš„æ–¹æ³•const route = useRoute()const activeMenu = computed(() =&gt; &#123; const &#123; path &#125; = route return path&#125;)&lt;/script&gt; è‡³æ­¤æ•´ä¸ª åŠ¨æ€menuå®Œæˆ å·¦ä¾§èœå•ä¼¸ç¼©åŠŸèƒ½å®ç°ä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªæ ‡å‡†åŒ–åŠŸèƒ½ å·¦ä¾§èœå•ä¼¸ç¼© ï¼Œå¯¹äºè¿™ä¸ªåŠŸèƒ½æ ¸å¿ƒçš„ç‚¹åœ¨äºåŠ¨ç”»å¤„ç† æ ·å¼çš„æ”¹å˜æ€»æ˜¯ç”±æ•°æ®è¿›è¡Œé©±åŠ¨ï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘ä»¬å»åˆ›å»ºå¯¹åº”çš„æ•°æ® åˆ›å»º store/app æ¨¡å—ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç  12345678910111213export default &#123; namespaced: true, state: () =&gt; (&#123; sidebarOpened: true &#125;), mutations: &#123; triggerSidebarOpened(state) &#123; state.sidebarOpened = !state.sidebarOpened &#125; &#125;, actions: &#123;&#125;&#125; åœ¨ store/index ä¸­è¿›è¡Œå¯¼å…¥ 123456789...import app from &#x27;./modules/app&#x27;export default createStore(&#123; getters, modules: &#123; ... app &#125;&#125;) åœ¨ store/getters ä¸­åˆ›å»ºå¿«æ·è®¿é—® 1sidebarOpened: state =&gt; state.app.sidebarOpened åˆ›å»º components/hamburger ç»„ä»¶ï¼Œç”¨æ¥æ§åˆ¶æ•°æ® 12345678910111213141516171819202122232425262728293031&lt;template&gt; &lt;div class=&quot;hamburger-container&quot; @click=&quot;toggleClick&quot;&gt; &lt;svg-icon class=&quot;hamburger&quot; :icon=&quot;icon&quot;&gt;&lt;/svg-icon&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; computed &#125; from &#x27;vue&#x27;import &#123; useStore &#125; from &#x27;vuex&#x27;const store = useStore()const toggleClick = () =&gt; &#123; store.commit(&#x27;app/triggerSidebarOpened&#x27;)&#125;const icon = computed(() =&gt; store.getters.sidebarOpened ? &#x27;hamburger-opened&#x27; : &#x27;hamburger-closed&#x27;)&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;.hamburger-container &#123; padding: 0 16px; .hamburger &#123; display: inline-block; vertical-align: middle; width: 20px; height: 20px; &#125;&#125;&lt;/style&gt; åœ¨ navbar ä¸­ä½¿ç”¨è¯¥ç»„ä»¶ 123456789101112131415161718192021222324252627282930313233&lt;template&gt; &lt;div class=&quot;navbar&quot;&gt; &lt;hamburger class=&quot;hamburger-container&quot; /&gt; ... &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import Hamburger from &#x27;@/components/Hamburger&#x27;...&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;.navbar &#123; ... .hamburger-container &#123; line-height: 46px; height: 100%; float: left; cursor: pointer; // hover åŠ¨ç”» transition: background 0.5s; &amp;:hover &#123; background: rgba(0, 0, 0, 0.1); &#125; &#125; ...&#125;&lt;/style&gt; åœ¨ SidebarMenu ä¸­ï¼Œæ§åˆ¶ el-menu çš„ collapse å±æ€§ 123&lt;el-menu :collapse=&quot;!$store.getters.sidebarOpened&quot; ... åœ¨ layout/index ä¸­æŒ‡å®š æ•´ä¸ªä¾§è¾¹æ çš„å®½åº¦å’Œç¼©æ”¾åŠ¨ç”» 12345&lt;div class=&quot;app-wrapper&quot; :class=&quot;[$store.getters.sidebarOpened ? &#x27;openSidebar&#x27; : &#x27;hideSidebar&#x27;]&quot; &gt; ... åœ¨ layout/index ä¸­ å¤„ç† navbar çš„å®½åº¦ 12345678910111213141516&lt;style lang=&quot;scss&quot; scoped&gt;....fixed-header &#123; position: fixed; top: 0; right: 0; z-index: 9; width: calc(100% - #&#123;$sideBarWidth&#125;); transition: width 0.28s;&#125;.hideSidebar .fixed-header &#123; width: calc(100% - #&#123;$hideSideBarWidth&#125;);&#125;&lt;/style&gt; åœ¨ styles/variables.scss ä¸­æŒ‡å®š hideSideBarWidth 1$hideSideBarWidth: 54px; SidebarHeader å¤„ç†æ•´ä¸ªå·¦ä¾§çš„ menu èœå•ï¼Œåˆ°ç°åœ¨å’±ä»¬è¿˜å‰©ä¸‹æœ€åä¸€ä¸ª header æ²¡æœ‰è¿›è¡Œå¤„ç† åœ¨ sidebar/index ä¸­å†™å…¥å¦‚ä¸‹ä»£ç  12345678910111213141516171819202122232425262728293031323334&lt;template&gt; &lt;div class=&quot;&quot;&gt; &lt;div class=&quot;logo-container&quot;&gt; &lt;el-avatar size=&quot;44&quot; shape=&quot;square&quot; src=&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot; /&gt; &lt;h1 class=&quot;logo-title&quot; v-if=&quot;$store.getters.sidebarOpened&quot;&gt; imooc-admin &lt;/h1&gt; &lt;/div&gt; ... &lt;/div&gt;&lt;/template&gt;&lt;style lang=&quot;scss&quot; scoped&gt;.logo-container &#123; height: 44px; padding: 10px 0 22px 0; display: flex; align-items: center; justify-content: center; .logo-title &#123; margin-left: 10px; color: #fff; font-weight: 600; line-height: 50px; font-size: 16px; white-space: nowrap; &#125;&#125;&lt;/style&gt; åˆ›å»º styles/element.scss æ–‡ä»¶ï¼Œç»Ÿä¸€å¤„ç† el-avatar çš„èƒŒæ™¯é—®é¢˜ 123.el-avatar &#123; --el-avatar-background-color: none;&#125; åœ¨ styles/index.scss ä¸­å¯¼å…¥ 12...@import &#x27;./element.scss&#x27;; ç»Ÿä¸€å¤„ç†ä¸‹åŠ¨ç”»æ—¶é•¿çš„é—®é¢˜ï¼Œåœ¨ styles/variables.scss ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹å˜é‡ 1$sideBarDuration: 0.28s; ä¸º styles/sidebar.scss ä¿®æ”¹æ—¶é•¿ 123456789.main-container &#123; transition: margin-left #&#123;$sideBarDuration&#125;; ...&#125;.sidebar-container &#123; transition: width #&#123;$sideBarDuration&#125;; ...&#125; ä¸º layout/index ä¿®æ”¹æ ·å¼ 1234.fixed-header &#123; ... transition: width #&#123;$sideBarDuration&#125;;&#125; Vue3.2ï¼šç»„ä»¶çŠ¶æ€é©±åŠ¨çš„åŠ¨æ€ CSS å€¼åœ¨ vue 3.2 æœ€æ–°æ›´æ–°ä¸­ï¼Œé™¤äº†ä¹‹å‰æˆ‘ä»¬ä»‹ç»çš„ å“åº”å¼å˜åŒ– ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªå¾ˆé‡è¦çš„æ›´æ–°ï¼Œé‚£å°±æ˜¯ ç»„ä»¶çŠ¶æ€é©±åŠ¨çš„åŠ¨æ€ CSS å€¼ ï¼Œå¯¹åº”çš„æ–‡æ¡£ä¹Ÿå·²ç»å…¬å¸ƒï¼Œå¤§å®¶å¯ä»¥ ç‚¹å‡»è¿™é‡Œ æŸ¥çœ‹ é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±ä½¿ç”¨ä¸‹æœ€æ–°çš„ç‰¹æ€§ï¼Œæ¥ä¸º logo-container æŒ‡å®šä¸‹é«˜åº¦ï¼š 1234567891011121314151617181920&lt;template&gt; ... &lt;el-avatar :size=&quot;logoHeight&quot; ...&lt;/template&gt;&lt;script setup&gt;...const logoHeight = 44&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;.logo-container &#123; height: v-bind(logoHeight) + &#x27;px&#x27;;...&#125;&lt;/style&gt; åŠ¨æ€é¢åŒ…å±‘æ–¹æ¡ˆåˆ†æé¢åŒ…å±‘å¯¼èˆªåˆ†ä¸ºï¼š é™æ€é¢åŒ…å±‘ åŠ¨æ€é¢åŒ…å±‘ é™æ€é¢åŒ…å±‘ï¼š æŒ‡çš„æ˜¯ï¼šåœ¨æ¯ä¸ªé¡µé¢ä¸­å†™æ­»å¯¹åº”çš„é¢åŒ…å±‘èœå•ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š æ¯ä¸ªé¡µé¢éƒ½å¾—å†™ä¸€é é¡µé¢è·¯å¾„ç»“æ„å˜åŒ–äº†ï¼Œå¾—æ‰‹åŠ¨æ›´æ”¹ ç®€å•æ¥è¯´å°±æ˜¯ ä¸å¥½ç»´æŠ¤ï¼Œä¸å¥½æ‰©å±• ã€‚ åŠ¨æ€é¢åŒ…å±‘ï¼š æ ¹æ®å½“å‰çš„ url è‡ªåŠ¨ç”Ÿæˆé¢åŒ…å±‘å¯¼èˆªèœå• æ— è®ºä¹‹åè·¯å¾„å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼ŒåŠ¨æ€é¢åŒ…å±‘ éƒ½ä¼šæ­£ç¡®çš„è¿›è¡Œè®¡ç®— é‚£ä¹ˆåœ¨åé¢çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šåˆ†æˆä¸‰å¤§æ­¥æ¥å®ç° åˆ›å»ºã€æ¸²æŸ“åŸºæœ¬çš„é¢åŒ…å±‘ç»„ä»¶ è®¡ç®—é¢åŒ…å±‘ç»“æ„æ•°æ® æ ¹æ®æ•°æ®æ¸²æŸ“åŠ¨æ€é¢åŒ…å±‘å†…å®¹ æ¸²æŸ“åŸºæœ¬çš„é¢åŒ…å±‘ç»„ä»¶å®Œæˆç¬¬ä¸€æ­¥ï¼Œå…ˆå»åˆ›å»ºå¹¶æ¸²æŸ“å‡ºåŸºæœ¬çš„ é¢åŒ…å±‘ ç»„ä»¶ åˆ›å»º components/Breadcrumb/indexï¼Œå¹¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930&lt;template&gt; &lt;el-breadcrumb class=&quot;breadcrumb&quot; separator=&quot;/&quot;&gt; &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/&#x27; &#125;&quot;&gt;é¦–é¡µ&lt;/el-breadcrumb-item&gt; &lt;el-breadcrumb-item&gt;&lt;a href=&quot;/&quot;&gt;æ´»åŠ¨ç®¡ç†&lt;/a&gt;&lt;/el-breadcrumb-item&gt; &lt;el-breadcrumb-item&gt;æ´»åŠ¨åˆ—è¡¨&lt;/el-breadcrumb-item&gt; &lt;!-- é¢åŒ…å±‘çš„æœ€åä¸€é¡¹ --&gt; &lt;el-breadcrumb-item&gt; &lt;span class=&quot;no-redirect&quot;&gt;æ´»åŠ¨è¯¦æƒ…&lt;/span&gt; &lt;/el-breadcrumb-item&gt; &lt;/el-breadcrumb&gt;&lt;/template&gt;&lt;script setup&gt;import &#123;&#125; from &#x27;vue&#x27;&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;.breadcrumb &#123; display: inline-block; font-size: 14px; line-height: 50px; margin-left: 8px; ::v-deep .no-redirect &#123; color: #97a8be; cursor: text; &#125;&#125;&lt;/style&gt; åœ¨ layout/components/Navbar ç»„ä»¶ä¸‹å¯¼å…¥ 1234567891011121314151617181920&lt;template&gt; &lt;div class=&quot;navbar&quot;&gt; &lt;hamburger class=&quot;hamburger-container&quot; /&gt; &lt;breadcrumb class=&quot;breadcrumb-container&quot; /&gt; ... &lt;/div&gt;&lt;/template&gt;...&lt;style lang=&quot;scss&quot; scoped&gt;.navbar &#123; ... .breadcrumb-container &#123; float: left; &#125; ...&#125;&lt;/style&gt; åŠ¨æ€è®¡ç®—é¢åŒ…å±‘ç»“æ„æ•°æ®ç°åœ¨æˆ‘ä»¬æ˜¯å®Œæˆäº†ä¸€ä¸ªé™æ€çš„ é¢åŒ…å±‘ï¼Œæ¥ä¸‹æ¥å’±ä»¬å°±éœ€è¦ä¾æ‰˜è¿™ä¸ªé™æ€çš„èœå•æ¥å®ŒæˆåŠ¨æ€çš„ã€‚ å¯¹äºç°åœ¨çš„é™æ€é¢åŒ…å±‘æ¥è¯´ï¼Œä»–åˆ†æˆäº†ä¸¤ä¸ªç»„ä»¶ï¼š el-breadcrumbï¼šåŒ…è£¹æ€§è´¨çš„å®¹å™¨ el-breadcrumb-itemï¼šæ¯ä¸ªå•ç‹¬é¡¹ å¦‚æœæˆ‘ä»¬æƒ³è¦å®ŒæˆåŠ¨æ€çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ *ä¾æ®åŠ¨æ€æ•°æ®ï¼Œæ¸²æŸ“ el-breadcrumb-item * æ‰€ä»¥è¯´æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…å°±å¾ˆç®€å•äº† åŠ¨æ€æ•°æ® æ¸²æŸ“ el-breadcrumb-item å’±ä»¬å…ˆæ¥çœ‹ åŠ¨æ€æ•°æ®å¦‚ä½•åˆ¶ä½œ æˆ‘ä»¬å¸Œæœ›å¯ä»¥åˆ¶ä½œå‡ºä¸€ä¸ª æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ª item éƒ½è¡¨ç¤ºä¸€ä¸ª è·¯ç”±ä¿¡æ¯ï¼š åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥ç”Ÿæˆæ•°ç»„æ•°æ®ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è¦ä½¿ç”¨åˆ° route.match å±æ€§æ¥ï¼šè·å–ä¸ç»™å®šè·¯ç”±åœ°å€åŒ¹é…çš„æ ‡å‡†åŒ–çš„è·¯ç”±è®°å½•æ•°ç»„ å¦‚ä½•ç†è§£ä¸Šé¢è¿™å¥è¯å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬å°† route.matched æ‰“å°å‡ºæ¥å°±å¯ä»¥å‘ç°ï¼Œä½ æ¯æ¬¡åˆ‡æ¢èœå•ï¼ˆæˆ–è€…è¯´æ›´æ¢äº†è·¯ç”±ï¼‰ï¼Œæ‰“å°å‡ºæ¥çš„å°±æ˜¯å½“å‰è·¯ç”±çš„è·¯ç”±è¡¨ï¼ˆåŒ…å«çˆ¶çº§ã€å­é›†çš„è·¯ç”±ä¿¡æ¯ï¼‰ã€‚ 123456789101112131415161718192021222324252627&lt;script setup&gt;import &#123; ref, reactive, watch &#125; from &#x27;vue&#x27;import &#123; useRoute, RouteRecordRaw &#125; from &#x27;vue-router&#x27;const breadcrumbData = ref&lt;RouteRecordRaw[]&gt;([]) // å­˜æ”¾è®¡ç®—å‡ºçš„é¢åŒ…å±‘æ•°æ®const route = useRoute()const getBreadcrumbData = () =&gt; &#123; console.log(route.matched) // åªæœ‰å­˜åœ¨ meta å¹¶ä¸” meta.title çš„è·¯ç”±ï¼Œæˆ‘ä»¬æ‰ä¼šæ˜¾ç¤ºåˆ°é¢åŒ…å±‘ä¸­ // å°±åƒ menu èœå•ä¸€æ ·ï¼Œç±»ä¼¼ 404 login çš„æˆ‘ä»¬ä¸è¦æ˜¾ç¤º breadcrumbData.value = route.matched.filter(r =&gt; r.meta &amp;&amp; r.meta.title)&#125;// ç›‘å¬è·¯ç”±å˜åŒ–æ—¶è§¦å‘watch( route, () =&gt; &#123; getBreadcrumbData() &#125;, &#123; immediate: true &#125;)&lt;/script&gt; ä¾æ®åŠ¨æ€æ•°æ®ï¼Œæ¸²æŸ“é¢åŒ…å±‘æœ‰äº†æ•°æ®ä¹‹åï¼Œæ ¹æ®æ•°æ®æ¥å»æ¸²æŸ“é¢åŒ…å±‘å°±æ¯”è¾ƒç®€å•äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970&lt;template&gt; &lt;el-breadcrumb class=&quot;breadcrumb&quot; separator=&quot;/&quot;&gt; &lt;el-breadcrumb-item v-for=&quot;(item, index) in breadcrumbData&quot; :key=&quot;item.path&quot; &gt; &lt;!-- ä¸å¯ç‚¹å‡»é¡¹ --&gt; &lt;span v-if=&quot;index === breadcrumbData.length - 1&quot; class=&quot;no-redirect&quot;&gt;&#123;&#123; item.meta.title &#125;&#125;&lt;/span&gt; &lt;!-- å¯ç‚¹å‡»é¡¹ --&gt; &lt;a v-else class=&quot;redirect&quot; @click.prevent=&quot;onLinkClick(item)&quot;&gt;&#123;&#123; item.meta.title &#125;&#125;&lt;/a&gt; &lt;/el-breadcrumb-item&gt; &lt;/el-breadcrumb&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; ref, watch &#125; from &#x27;vue&#x27;import &#123; useRoute, useRouter, RouteRecordRaw &#125; from &#x27;vue-router&#x27;import &#123; useStore &#125; from &#x27;vuex&#x27;const breadcrumbData = ref&lt;RouteRecordRaw[]&gt;([]) // å­˜æ”¾è®¡ç®—å‡ºçš„é¢åŒ…å±‘æ•°æ®const store = useStore()const route = useRoute()const router = useRouter()const getBreadcrumbData = () =&gt; &#123; console.log(route.matched) // åªæœ‰å­˜åœ¨ meta å¹¶ä¸” meta.title çš„è·¯ç”±ï¼Œæˆ‘ä»¬æ‰ä¼šæ˜¾ç¤ºåˆ°é¢åŒ…å±‘ä¸­ // å°±åƒ menu èœå•ä¸€æ ·ï¼Œç±»ä¼¼ 404 login çš„æˆ‘ä»¬ä¸è¦æ˜¾ç¤º breadcrumbData.value = route.matched.filter(r =&gt; r.meta &amp;&amp; r.meta.title)&#125;watch( route, () =&gt; &#123; getBreadcrumbData() &#125;, &#123; immediate: true &#125;)// è·³è½¬è·¯ç”±const onLinkClick = (item: RouteRecordRaw) =&gt; &#123; router.push(item.path)&#125;// å°†æ¥éœ€è¦è¿›è¡Œä¸»é¢˜æ›¿æ¢ï¼Œæ‰€ä»¥è¿™é‡Œè·å–ä¸‹åŠ¨æ€æ ·å¼const linkHoverColor = ref(store.getters.cssVars.menuBg)&lt;/script&gt;&lt;style lang=&quot;scss&quot; scoped&gt;.breadcrumb &#123; ... .redirect &#123; color: #666; font-weight: 600; &#125; .redirect:hover &#123; color: v-bind(linkHoverColor); // åº”å¯¹ä¸»é¢˜åˆ‡æ¢ &#125;&#125;&lt;/style&gt; é¢åŒ…å±‘åŠ¨ç”»vue3å¯¹ åŠ¨ç”» è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼ˆvue åŠ¨ç”»è¿ç§»æ–‡æ¡£ï¼‰ ä¸»è¦çš„ä¿®æ”¹å…¶å®åªæœ‰ä¸¤ä¸ªï¼š è¿‡æ¸¡ç±»å v-enter ä¿®æ”¹ä¸º v-enter-from è¿‡æ¸¡ç±»å v-leave ä¿®æ”¹ä¸º v-leave-from é‚£ä¹ˆä¾æ®ä¿®æ”¹ä¹‹åçš„åŠ¨ç”»ï¼Œæˆ‘ä»¬æ¥ä¸ºé¢åŒ…å±‘å¢åŠ ä¸€äº›åŠ¨ç”»æ ·å¼ï¼š åœ¨ Breadcrumb/index ä¸­å¢åŠ  transition-group 1234567&lt;template&gt; &lt;el-breadcrumb class=&quot;breadcrumb&quot; separator=&quot;/&quot;&gt; &lt;transition-group name=&quot;breadcrumb&quot;&gt; ... &lt;/transition-group&gt; &lt;/el-breadcrumb&gt;&lt;/template&gt; æ–°å»º styles/transition æ ·å¼æ–‡ä»¶ 1234567891011121314.breadcrumb-enter-active,.breadcrumb-leave-active &#123; transition: all 0.5s;&#125;.breadcrumb-enter-from,.breadcrumb-leave-active &#123; opacity: 0; transform: translateX(20px);&#125;.breadcrumb-leave-active &#123; position: absolute;&#125; åœ¨ styles/index ä¸­å¯¼å…¥ 1@import &#x27;./transition.scss&#x27;; æ€»ç»“åˆ°è¿™é‡Œæˆ‘ä»¬çš„ layout æ•´ä½“æ¶æ„å°±å·²ç»åšå®Œäº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•ˆæœå§ã€‚","categories":[],"tags":[{"name":"å·¥ç¨‹åŒ–,Vue3","slug":"å·¥ç¨‹åŒ–-Vue3","permalink":"http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3/"}]},{"title":"Vue3é¡¹ç›®å®æˆ˜(ä¸‰)ï¼šç™»å½•/è¯·æ±‚æ¨¡å—/é‰´æƒ","slug":"vue3-project-generalLogin","date":"2022-12-23T15:34:24.000Z","updated":"2022-12-29T02:59:39.272Z","comments":true,"path":"/post/vue3-project-generalLogin.html","link":"","permalink":"http://yoursite.com/post/vue3-project-generalLogin.html","excerpt":"axiosæ¨¡å—/æ¥å£è¯·æ±‚æ¨¡å—/ç™»å½•è¯·æ±‚åŠ¨ä½œ/Tokenç¼“å­˜/é‰´æƒ","text":"é…ç½®ç¯å¢ƒå˜é‡ / å°è£… axioså°è£…çš„ axios æ¨¡å—ï¼Œè‡³å°‘å…·å¤‡ä¸€ç§èƒ½åŠ›ï¼Œæ ¹æ®å½“å‰ç¯å¢ƒçš„ä¸åŒï¼Œè®¾å®šä¸åŒçš„ baseUrl @vue/cli æ¨¡å¼ å®˜ç½‘ï¼šhttps://cli.vuejs.org/zh/guide/mode-and-env.html#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F è¯·æ³¨æ„ï¼Œåªæœ‰ NODE_ENVï¼ŒBASE_URL å’Œä»¥ VUE_APP_ å¼€å¤´çš„å˜é‡å°†é€šè¿‡ webpack.DefinePlugin é™æ€åœ°åµŒå…¥åˆ°å®¢æˆ·ç«¯ä¾§çš„ä»£ç ä¸­ã€‚è¿™æ˜¯ä¸ºäº†é¿å…æ„å¤–å…¬å¼€æœºå™¨ä¸Šå¯èƒ½å…·æœ‰ç›¸åŒåç§°çš„ç§é’¥ã€‚ é™¤äº† VUE_APP_* å˜é‡ä¹‹å¤–ï¼Œåœ¨ä½ çš„åº”ç”¨ä»£ç ä¸­å§‹ç»ˆå¯ç”¨çš„è¿˜æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å˜é‡ï¼š NODE_ENV - ä¼šæ˜¯ â€œdevelopmentâ€ã€â€productionâ€ æˆ– â€œtestâ€ ä¸­çš„ä¸€ä¸ªã€‚å…·ä½“çš„å€¼å–å†³äºåº”ç”¨è¿è¡Œçš„æ¨¡å¼ã€‚ BASE_URL - ä¼šå’Œ vue.config.js ä¸­çš„ publicPath é€‰é¡¹ç›¸ç¬¦ï¼Œå³ä½ çš„åº”ç”¨ä¼šéƒ¨ç½²åˆ°çš„åŸºç¡€è·¯å¾„ã€‚ 12345// .env.developmentusername=chenghaolun // ä¸ä¼šæš´éœ²å‡ºæ¥VUE_APP_BASE_API=/api // æš´éœ²å‡ºæ¥ï¼Œå¯ä»¥é€šè¿‡ process.env è·å– æ‰€æœ‰è§£æå‡ºæ¥çš„ç¯å¢ƒå˜é‡éƒ½å¯ä»¥åœ¨ public/index.html ä¸­ä»¥ HTML æ’å€¼ä¸­ä»‹ç»çš„æ–¹å¼ä½¿ç”¨ã€‚ 1&lt;title&gt;ç½‘ç«™æ ‡é¢˜ &lt;%= VUE_APP_BASE_API %&gt;&lt;/title&gt; æˆ‘ä»¬å¯ä»¥æ‰“å° process.env çœ‹çœ‹ï¼š 12345&#123; BASE_URL: &quot;/&quot;, NODE_ENV: &quot;development&quot;, VUE_APP_BASE_API: &quot;/api&quot;,&#125; æ ¹æ®ç¯å¢ƒå˜é‡åˆ‡æ¢ baseUrl12345678import axios from &#x27;axios&#x27;const service = axios.create(&#123; baseURL: process.env.VUE_APP_BASE_API, timeout: 5000&#125;)export default service å°è£…æ¥å£è¯·æ±‚æ¨¡å—åœ¨ src ä¸‹åˆ›å»º api æ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»º sys.ts æ–‡ä»¶ï¼Œç”¨äºå¤„ç†ç³»ç»Ÿçš„ä¸€äº›æ¥å£è¯·æ±‚ï¼š 123456789import request from &#x27;@/utils/request&#x27;export const login = data =&gt; &#123; return request(&#123; url: &#x27;/sys/login&#x27;, method: &#x27;POST&#x27;, data &#125;)&#125; å°è£…ç™»å½•è¯·æ±‚åŠ¨ä½œæˆ‘ä»¬ä¸å¸Œæœ›åœ¨ç‚¹å‡»ç™»å½•æŒ‰é’®æ—¶ï¼Œå°±ç«‹é©¬è°ƒç”¨ç™»å½•æ¥å£ï¼Œè€Œæ˜¯å°†å…¶å°è£…åˆ° vuex ä¸­ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ piniaã€‚ åœ¨ store ä¸‹åˆ›å»º modules æ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»º user.ts æ¨¡å—ï¼Œç”¨äºå¤„ç†æ‰€æœ‰çš„ ç”¨æˆ·ç›¸å…³ çš„å†…å®¹ï¼ˆtokenè·å–ã€ç”¨æˆ·ä¿¡æ¯è·å–ã€é€€å‡ºç™»å½•â€¦ï¼‰ æ³¨æ„ å½“æˆ‘ä»¬åˆ›å»ºå¥½äº† store æ—¶ï¼Œåœ¨ vue template é‡Œé¢ä½¿ç”¨ $store.state.globalName å¯èƒ½ä¼šçˆ†çº¢ï¼ŒåŸå› æ˜¯æ²¡æœ‰å£°æ˜ $store 123456789101112131415// src/vuex.d.tsimport &#123; Store &#125; from &#x27;vuex&#x27;declare module &#x27;@vue/runtime-core&#x27; &#123; // å£°æ˜è‡ªå·±çš„ store state interface State &#123; globalName: string &#125; // ä¸º `this.$store` æä¾›ç±»å‹å£°æ˜ interface ComponentCustomProperties &#123; $store: Store&lt;State&gt; &#125;&#125; åˆ›å»º user.ts æ¨¡å— 123456789101112131415// store/index.jsimport &#123; createStore &#125; from &#x27;vuex&#x27;import user from &#x27;./modules/user&#x27;export default createStore(&#123; state() &#123; return &#123; globalName: &#x27;Hello_AlexCc&#x27; &#125; &#125;, modules: &#123; user &#125;&#125;) åˆ›å»º modules æ–‡ä»¶å¤¹ 12345678910111213141516171819202122232425import md5 from &#x27;md5&#x27;import &#123; login &#125; from &#x27;@/api/sys&#x27;export default &#123; namespaced: true, state: () =&gt; (&#123;&#125;), mutations: &#123;&#125;, actions: &#123; login(context: any, userInfo: any) &#123; const &#123; username, password &#125; = userInfo return new Promise((resolve, reject) =&gt; &#123; login(&#123; username, password: md5(password) &#125;) .then(res =&gt; &#123; resolve(res) &#125;) .catch(err =&gt; &#123; reject(err) &#125;) &#125;) &#125; &#125;&#125; åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç™»å½•è¯·æ±‚åŠ¨ä½œå°±å®Œæˆäº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç‚¹å‡»ç™»å½•æŒ‰é’®æ—¶ï¼Œè·å–åˆ° store å¹¶ dispatch login æ–¹æ³•å³å¯ï¼š 12345678910111213// è·å–åˆ° store å®ä¾‹const store = useStore()// user.value æ˜¯ç™»å½•è¡¨å•çš„ refstore .dispatch(&#x27;user/login&#x27;, user.value) .then(res =&gt; &#123; console.log(&#x27;login res&#x27;, res) &#125;) .catch(err =&gt; &#123; console.log(&#x27;err &#x27;, err) &#125;) å†™ä¸€ä¸ªç®€å•çš„ node æœåŠ¡å™¨12345678910111213const express = require(&#x27;express&#x27;);const app = express()app.get(&#x27;/user&#x27;, (req, res) =&gt; &#123; res.json(&#123; code: 0, msg: &quot;hello server 9999&quot; &#125;)&#125;)app.listen(9999, () =&gt; &#123; console.log(&#x27;server site an port 9999 ...&#x27;)&#125;) é…ç½® devServeræˆ‘ä»¬å°† é¡¹ç›® å’Œ node æœåŠ¡è·‘èµ·æ¥ä¹‹åï¼Œç‚¹å‡»ç™»å½•ï¼Œå‘ç°æŠ¥é”™äº† 404ï¼Œæ˜¯å› ä¸ºè¯·æ±‚ http://localhost:8080/#/api/user å¹¶ä¸å­˜åœ¨ï¼Œæ¥å£è¯·æ±‚åœ°å€èµ„æºæ‰¾ä¸åˆ°ï¼Œæˆ‘ä»¬çš„æ¥å£å†™åœ¨ node ç«¯ï¼Œé‚£ä¹ˆ node æœåŠ¡è·‘èµ·æ¥åï¼Œæˆ‘ä»¬æ€ä¹ˆå»è®¿é—®å‘¢ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ° webpack çš„ devServer äº†ã€‚ 123456789101112131415161718// vue.config.jsdevServer: &#123; // é…ç½®ä»£ç† proxy: &#123; // å½“åœ°å€ä¸­æœ‰/apiçš„æ—¶å€™ä¼šè§¦å‘ä»£ç†æœºåˆ¶ï¼Œå› ä¸ºæˆ‘ä»¬é…ç½®äº† axios baseURLï¼Œæ‰€ä»¥æ¯ä¸ªè¯·æ±‚ä¸­ï¼Œéƒ½ä¼šä»¥ `/api` å¼€å¤´ &#x27;/api&#x27;: &#123; // è¦ä»£ç†çš„æœåŠ¡å™¨åœ°å€ è¿™é‡Œä¸ç”¨å†™ api // node æœåŠ¡ target: &#x27;http://localhost:9999&#x27;, changeOrigin: true, // æ˜¯å¦è·¨åŸŸ pathRewrite: &#123; // å¿…é¡»å¾—å¸¦ä¸Š,å¦åˆ™ï¼ŒçœŸæ­£çš„è¯·æ±‚ä¸­å°±ä¼šå¸¦ä¸Š &#x27;/api&#x27;ï¼Œ&#x27;http://localhost:9999/api/user&#x27; &#x27;^/api&#x27;: &#x27;&#x27; &#125; &#125; &#125;&#125;, æœ€åï¼Œæˆ‘ä»¬å†é‡å¯é¡¹ç›®ï¼Œç‚¹å‡»ç™»å½•ï¼Œå°±ä¼šæ‹¿åˆ° user æ¥å£è¿”å›çš„çš„ç»“æœäº†ã€‚ æœ¬åœ°ç¼“å­˜å¤„ç†æ–¹æ¡ˆå­˜å‚¨ token åˆ†ä¸ºä¸¤ç§ï¼š æœ¬åœ°ç¼“å­˜ï¼šlocalstorage å…¨å±€çŠ¶æ€ç®¡ç†ï¼švuex ä¿å­˜åœ¨ localstorage ä¸­ï¼Œæ˜¯ä¸ºäº†åœ¨ token æ²¡è¿‡æœŸçš„æƒ…å†µä¸‹ï¼Œè®©ç”¨æˆ·è‡ªåŠ¨ç™»å½•ã€‚ä¿å­˜åœ¨ vuex ä¸­ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨å…¶ä»–ä½ç½®ä½¿ç”¨ã€‚ é‚£ä¹ˆæˆ‘ä»¬æ¥å®šä¹‰ localstorage çš„ç›¸å…³æ–¹æ³•å§ï¼ 123456789101112131415161718192021222324252627282930313233343536373839// utils/storage.ts/** * å­˜å‚¨æ•°æ® */export const setItem = (key: string, value: unknown): void =&gt; &#123; // å°†æ•°ç»„ã€å¯¹è±¡ç±»å‹çš„æ•°æ®è½¬åŒ–ä¸º JSON å­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨ if (typeof value === &#x27;object&#x27;) &#123; value = JSON.stringify(value) &#125; window.localStorage.setItem(key, value as string)&#125;/** * è·å–æ•°æ® */export const getItem = (key: string): unknown =&gt; &#123; const data = window.localStorage.getItem(key) as string try &#123; return JSON.parse(data) &#125; catch (err) &#123; // å¦‚æœæŠ¥é”™äº†ï¼Œç›´æ¥å°†æ•°æ®å‘é€ç»™ä½¿ç”¨ç«¯ return data &#125;&#125;/** * åˆ é™¤æ•°æ® */export const removeItem = (key: string): void =&gt; &#123; window.localStorage.removeItem(key)&#125;/** * åˆ é™¤æ‰€æœ‰æ•°æ® */export const removeAllItem = (key: string): void =&gt; &#123; window.localStorage.clear()&#125; ç„¶åï¼Œæˆ‘ä»¬æ¥å¤„ç† vuex user æ¨¡å—ï¼Œåœ¨ state ä¸­å®šä¹‰ tokenï¼Œä»¥åŠè®¾ç½® token çš„ mutations æ–¹æ³•ã€‚ 123456789101112131415161718import &#123; setItem, getItem &#125; from &#x27;@/utils/storage&#x27;// æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå¸¸é‡æ–‡ä»¶å¤¹ï¼Œç”¨æ¥è®¾ç½® TOKEN å¸¸é‡ï¼Œæˆ–è€…å„ç§å…¶ä»–å¸¸é‡å€¼const TOKEN = &#x27;token&#x27;&#123; state: () =&gt; (&#123; token: getItem(TOKEN) || &#x27;&#x27; &#125;), mutations: &#123; setToken(state: IState, token: string): void &#123; state.token = token // æœ¬åœ°å­˜å‚¨ token setItem(TOKEN, token) &#125; &#125;,&#125; åœ¨ actions login æ–¹æ³•ä¸­ï¼Œè¯·æ±‚æˆåŠŸåæˆ‘ä»¬éœ€è¦ commit ä¸€ä¸ª mutationï¼Œæ¥è§¦å‘ setToken æ–¹æ³•: 1context.commit(&#x27;setToken&#x27;, res.data.data.token) åˆ°è¿™ï¼Œæˆ‘ä»¬çš„ token å­˜å‚¨å°±å®Œæˆäº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸Šå°†å…¶æ˜¾ç¤ºå‡ºæ¥çœ‹çœ‹ã€‚ 1&lt;p&gt;token: &#123;&#123; $store.state.user.token || &#x27;æš‚æ— Token&#x27; &#125;&#125;&lt;/p&gt; æ¥å£å“åº”æ•°æ®ç»Ÿä¸€å¤„ç†æˆ‘ä»¬åœ¨ vuex user æ¨¡å—ä¸­é€šè¿‡ login æ¥å£è·å–åˆ°äº† tokenï¼Œå½“æˆ‘ä»¬å¤„ç†æ•°æ®æ—¶ï¼Œä¼šå‘ç°éœ€è¦é€šè¿‡å¥½å‡ ä¸ª . çš„æ–¹å¼å»æ‹¿åˆ°tokenï¼Œå±‚çº§å¤ªæ·±äº†ï¼Œä¸å¤ªæ–¹ä¾¿ã€‚ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ axios çš„å“åº”æ‹¦æˆªå™¨æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚ 12345678910111213141516171819import &#123; ElMessage &#125; from &#x27;element-plus&#x27;// å“åº”æ‹¦æˆªå™¨service.interceptors.response.use( response =&gt; &#123; const &#123; success, message, data &#125; = response.data if (success) &#123; return data &#125; else &#123; ElMessage.error(message) return Promise.reject(new Error(message)) &#125; &#125;, error =&gt; &#123; ElMessage.error(error.message) // æç¤ºé”™è¯¯ä¿¡æ¯ return Promise.reject(error) &#125;) ä¿®æ”¹å¥½ axios å“åº”æ‹¦æˆªå™¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹å†™ä¸€ä¸‹ vuex user ä¸‹çš„ actions login æ–¹æ³•äº†ã€‚ 1234.then(res =&gt; &#123; context.commit(&#x27;setToken&#x27;, res.token) // è¿™æ ·è·å– token æ˜¯ä¸æ˜¯å°±æ–¹ä¾¿å¾ˆå¤šäº† resolve(res)&#125;) ç™»å½•åæ“ä½œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª src/layout æ–‡ä»¶å¤¹ï¼Œç™»å½•æˆåŠŸåï¼Œç”¨æ¥æ˜¾ç¤ºçš„ä¸»å®¹å™¨ï¼Œå°† layout/index.vue é…ç½®åœ¨ router è·¯ç”±è¡¨ä¸­ 1234&#123; path: &#x27;/&#x27;, component: () =&gt; import(&#x27;@/layout/index.vue&#x27;)&#125; ç™»å½•æˆåŠŸåï¼Œè·³è½¬åˆ° layout é¡µé¢ 12345678910// login/index.vuestore .dispatch(&#x27;user/login&#x27;, user.value) .then(() =&gt; &#123; router.replace(&#x27;/&#x27;) &#125;) .catch(err =&gt; &#123; console.log(&#x27;err &#x27;, err) &#125;) ç™»å½•é‰´æƒåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç‚¹å‡»ç™»å½•ï¼Œå°±å¯ä»¥è·³è½¬åˆ° layout é¡µé¢äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœåœ¨åœ°å€æ æ‰‹åŠ¨è¾“å…¥ /loginï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥å›åˆ° login é¡µé¢ï¼Œæ˜æ˜æˆ‘ä»¬ç™»å½•æˆåŠŸï¼Œæœ‰äº† token è¿˜ä¼šè·³åˆ° login é¡µé¢ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ å› ä¸ºæˆ‘ä»¬åˆ°è¿™é‡Œï¼Œè¿˜æœªåšç™»å½•é‰´æƒï¼Œå³ä½¿å­˜åœ¨tokenï¼Œæˆ‘ä»¬å¹¶æœªåšä»»ä½•çš„æƒé™æ§åˆ¶å’Œå¤„ç†ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¦åšä»€ä¹ˆå¤„ç†å‘¢ï¼Ÿ å½“ç”¨æˆ·æœªç™»å½•æ—¶ï¼Œä¸å…è®¸è¿›å…¥é™¤ login ä¹‹å¤–çš„ä»»ä½•é¡µé¢ ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œtoken æœªè¿‡æœŸä¹‹å‰ï¼Œä¸è®©ç”¨æˆ·è¿›å…¥ login é¡µé¢ å®ç°è¿™ä¸ªåŠŸèƒ½çš„æ ¸å¿ƒå°±æ˜¯ä½¿ç”¨ vue-router çš„ è·¯ç”±å®ˆå« ä¼ é€é—¨ï¼šhttps://router.vuejs.org/zh/guide/advanced/navigation-guards.html é‚£ä¹ˆæˆ‘ä»¬åˆ›å»º permission.ts æ¥å¤„ç†è·¯ç”±å®ˆå«å§ï¼š å› ä¸ºæˆ‘ä»¬çš„ token å®šä¹‰åœ¨ modules user ä¸­ï¼Œæ¯æ¬¡è·å– tokenï¼Œéœ€è¦ä½¿ç”¨ store.state.user.tokenï¼Œè¿™æ ·æ˜¾å¾—å¤ªé•¿äº†ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ store gettersï¼Œæ¥æ–¹ä¾¿è·å– tokenï¼š 12345// getters.tsconst getters = &#123; token: (state: any) =&gt; state.user.token&#125;export default getters ç„¶åå°†å…¶æ”¾å…¥ store çš„ getters ä¸­ 12345678910111213import getters from &#x27;./getters&#x27;export default createStore(&#123; state() &#123; return &#123; globalName: &#x27;Hello_AlexCc&#x27; &#125; &#125;, getters, modules: &#123; user &#125;&#125;) ç„¶ååˆ›å»º permissions.ts æ–‡ä»¶ï¼Œå®šä¹‰è·¯ç”±å‰ç½®å®ˆå«ã€‚ åˆ¤æ–­ token æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ tokenï¼Œå¹¶ä¸” to.path ç­‰äº /loginï¼Œé‚£ä¹ˆä¸è®©è·³è½¬åˆ°ç™»å½•é¡µï¼Œè€Œæ˜¯å» layout é¡µé¢ã€‚ å¦‚æœ to.path ä¸æ˜¯ /loginï¼Œç›´æ¥æ‰§è¡Œ next æ–¹æ³•å³å¯ã€‚ å¦‚æœ token ä¸å­˜åœ¨ï¼Œå¹¶ä¸” to.path æ˜¯ /loginï¼Œç›´æ¥è·³è½¬ next() å¦‚æœ token ä¸å­˜åœ¨å¹¶ä¸” to.path ä¸æ˜¯ /loginï¼Œæˆ‘ä»¬è®©å…¶è·³è½¬åˆ°ç™»å½•é¡µ next(&#39;/login&#39;) 123456789101112131415161718192021// permissions.tsimport router from &#x27;./router&#x27;import store from &#x27;./store&#x27;router.beforeEach((to, from, next) =&gt; &#123; // åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ if (store.getters.token) &#123; if (to.path === &#x27;/login&#x27;) &#123; next(&#x27;/&#x27;) &#125; else &#123; next() &#125; &#125; else &#123; if (to.path === &#x27;/login&#x27;) &#123; next() &#125; else &#123; next(&#x27;/login&#x27;) &#125; &#125;&#125;) åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç‚¹å‡»ç™»å½•ï¼Œå°±ä¼šå»åˆ°æ ¹è·¯å¾„ä¸‹ â€˜/â€˜ï¼Œä¹Ÿå°±æ˜¯ layout é¡µé¢ã€‚è¿™æ—¶æˆ‘ä»¬åœ¨åœ°å€æ è¾“å…¥ /loginï¼Œå°±ä¸ä¼šå†å»ç™»å½•é¡µé¢äº†ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥æ”¹è¿›ä¸€ä¸‹ï¼Œå½“ token ä¸å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬åˆ¤æ–­äº† to.path === &#39;/login&#39;ï¼Œè¿™æ ·é™åˆ¶æ­»äº†ï¼Œå°†æ¥æˆ‘ä»¬è¿˜æœ‰ /404 ä»¥åŠ /401 ç­‰é¡µé¢ï¼Œè¿™äº›é¡µé¢ä¹Ÿæ˜¯ä¸éœ€è¦ token å°±èƒ½è®¿é—®çš„ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›åœ¨ if è¯­å¥é‡Œé¢åŠ å¤ªå¤šçš„åˆ¤æ–­é€»è¾‘ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª ç™½åå•ï¼Œä¸“é—¨å¤„ç†ä¸éœ€è¦ token çš„è·¯å¾„: 1234567const whiteList = [&#x27;/login&#x27;]if (whiteList.indexOf(to.path) &gt; -1) &#123; next()&#125; else &#123; next(&#x27;/login&#x27;)&#125;","categories":[],"tags":[{"name":"å·¥ç¨‹åŒ–,Vue3,Config","slug":"å·¥ç¨‹åŒ–-Vue3-Config","permalink":"http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3-Config/"}]},{"title":"Vue3é¡¹ç›®å®æˆ˜(äºŒ)ï¼šIconå›¾æ ‡ï¼ˆSVGï¼‰","slug":"vue3-project-traning","date":"2022-12-23T04:16:55.000Z","updated":"2022-12-29T14:21:17.354Z","comments":true,"path":"/post/vue3-project-traning.html","link":"","permalink":"http://yoursite.com/post/vue3-project-traning.html","excerpt":"è‡ªå®šä¹‰ SvgIcon ç»„ä»¶ï¼Œæ”¯æŒå¤–éƒ¨é“¾æ¥æ˜¾ç¤ºä»¥åŠæœ¬åœ° svg å›¾ç‰‡æ˜¾ç¤º","text":"ä½¿ç”¨ Element plus Icon https://element-plus.gitee.io/zh-CN/component/icon.html è‡ªå®šä¹‰ SVG å›¾æ ‡å¯¹äº element plus çš„å›¾æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ el-icon æ¥æ˜¾ç¤ºã€‚ 12345678910111213&lt;template&gt; &lt;div&gt; &lt;el-icon :size=&quot;size&quot; :color=&quot;color&quot;&gt; &lt;Edit /&gt; &lt;/el-icon&gt; &lt;!-- æˆ–è€…ç‹¬ç«‹ä½¿ç”¨å®ƒï¼Œä¸ä»çˆ¶çº§è·å–å±æ€§ --&gt; &lt;!-- ç”±äºSVGå›¾æ ‡é»˜è®¤ä¸æºå¸¦ä»»ä½•å±æ€§ï¼Œä½ éœ€è¦ç›´æ¥æä¾›å®ƒä»¬ --&gt; &lt;Edit /&gt; &lt;Edit style=&quot;width: 1em; height: 1em; margin-right: 8px&quot; /&gt; &lt;Share style=&quot;width: 1em; height: 1em; margin-right: 8px&quot; /&gt; &lt;/div&gt;&lt;/template&gt; ä½†æ˜¯è‡ªå®šä¹‰çš„å›¾æ ‡ï¼Œæˆ‘ä»¬å´æ²¡æœ‰æ˜¾ç¤ºçš„æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶ï¼Œæ¥å±•ç¤ºè‡ªå®šä¹‰çš„ svg å›¾æ ‡ã€‚ å¯¹äºè¿™ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶ï¼Œå®ƒéœ€è¦æ‹¥æœ‰ä¸¤ç§èƒ½åŠ›ï¼š æ˜¾ç¤ºå¤–éƒ¨çš„ svg å›¾æ ‡ï¼ˆé“¾æ¥çš„æ–¹å¼ï¼‰ æ˜¾ç¤ºé¡¹ç›®å†…çš„ svg å›¾æ ‡ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å®ç°è‡ªå®šä¹‰ç»„ä»¶ã€‚ æ˜¾ç¤ºå¤–éƒ¨çš„ svg å›¾æ ‡css mask:mask å±æ€§å…è®¸ä½¿ç”¨è€…é€šè¿‡é®ç½©æˆ–è€…è£åˆ‡ç‰¹å®šåŒºåŸŸçš„å›¾ç‰‡çš„æ–¹å¼æ¥ éšè—ä¸€ä¸ªå…ƒç´ çš„éƒ¨åˆ† æˆ–è€… å…¨éƒ¨å¯è§åŒºåŸŸã€‚ css mask: https://juejin.cn/post/6846687594693001223 æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ç»„ä»¶ SvgIcon: 123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;template&gt; &lt;div v-if=&quot;isExternal&quot; :style=&quot;styleExternalIcon&quot; class=&quot;svg-external-icon svg-icon&quot; :class=&quot;className&quot; /&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;import &#123; defineProps, computed &#125; from &#x27;vue&#x27;const props = withDefaults(defineProps&lt;&#123; icon: string className?: string&#125;&gt;(), &#123; className: &#x27;&#x27;, icon: &#x27;&#x27;&#125;)// åˆ¤æ–­æ˜¯å¦ä¸ºå¤–éƒ¨å›¾æ ‡const isExternal = computed(() =&gt; /^(https?:|mailto:|tel:)/.test(props.icon))// å¤–éƒ¨å›¾æ ‡æ ·å¼const styleExternalIcon = computed(() =&gt; (&#123; mask: `url($&#123;props.icon&#125;) no-repeat 50% 50%`, &#x27;-webkit-mask&#x27;: `url($&#123;props.icon&#125;) no-repeat 50% 50%`&#125;))&lt;/script&gt;&lt;style scoped&gt;.svg-icon &#123; width: 1em; height: 1em; vertical-align: -0.15em; fill: currentColor; overflow: hidden;&#125;.svg-external-icon &#123; background-color: currentColor; mask-size: cover !important; display: inline-block;&#125;&lt;/style&gt; è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ é“¾æ¥ çš„å½¢å¼ï¼Œæ¥ä½¿ç”¨ svg å›¾æ ‡äº†ï¼š 1&lt;svg-icon icon=&quot;https://res.lgdsunday.club/user.svg&quot;&gt;&lt;/svg-icon&gt; å±•ç¤ºå†…éƒ¨å›¾æ ‡å¦‚æœä¸æ˜¯å¤–éƒ¨é“¾æ¥çš„è¯ï¼Œæˆ‘ä»¬å°±å±•ç¤ºé¡¹ç›®å†…éƒ¨çš„ svg å›¾æ ‡ã€‚ é€šè¿‡ use çš„ xlink href å±æ€§ï¼Œæ‰¾åˆ° body ä¸‹å·²ç»å¤„ç†çš„è¿‡çš„ svg sprite å…ƒç´ å†…å®¹ï¼Œå®ƒå…¶ä¸­å°±åŒ…å«äº† symbol å…ƒç´ ï¼Œæ¯ä¸ª symbol å…ƒç´ ä¸Šéƒ½æœ‰ä¸€ä¸ª idï¼Œè¿™ä¸ª id å°±æ˜¯å’Œ xlink:href ä¸ä¹‹å¯¹åº”çš„ã€‚ 123456// ...&lt;svg v-else class=&quot;svg-icon&quot; :class=&quot;className&quot; aria-hidden=&quot;true&quot;&gt; &lt;use :xlink:href=&quot;iconName&quot; /&gt;&lt;/svg&gt;const iconName = computed(() =&gt; `#icon-$&#123;props.icon&#125;`) // å½“æˆ‘ä»¬å®šä¹‰å¥½äº†ç»„ä»¶ä¹‹åï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨é¡¹ç›®ä¸­ï¼Œå¯¼å…¥æ‰€æœ‰çš„ svg å›¾æ ‡äº†ã€‚ 1234// icons/index.tsrequire(&#x27;./svg/user.svg&#x27;)require(&#x27;./svg/password.svg&#x27;) å‡è®¾æˆ‘ä»¬æœ‰å‡ ç™¾ä¸Šåƒä¸ª svg å›¾æ ‡ï¼Œæˆ‘ä»¬éƒ½è¦è¿™æ ·å­å¼•å…¥å—ï¼Ÿä¼šä¸ä¼šå¤ªéš¾å—äº† ~~ è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ webpack æä¾›çš„ require.context æ–¹æ³•ï¼Œæ¥ æ‰¹é‡ å¯¼å…¥ svg å›¾æ ‡: 12345678// https://webpack.docschina.org/guides/dependency-management/#requirecontext// é€šè¿‡ require.context() å‡½æ•°æ¥åˆ›å»ºè‡ªå·±çš„ contextconst svgRequire = require.context(&#x27;./svg&#x27;, false, /\\.svg$/)// æ­¤æ—¶è¿”å›ä¸€ä¸ª require çš„å‡½æ•°ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ª request çš„å‚æ•°ï¼Œç”¨äº require çš„å¯¼å…¥ã€‚// è¯¥å‡½æ•°æä¾›äº†ä¸‰ä¸ªå±æ€§ï¼Œå¯ä»¥é€šè¿‡ require.keys() è·å–åˆ°æ‰€æœ‰çš„ svg å›¾æ ‡ [&#x27;./xxx1.svg&#x27;, &#x27;./xxx2.svg&#x27;]// éå†å›¾æ ‡ï¼ŒæŠŠå›¾æ ‡ä½œä¸º request ä¼ å…¥åˆ° require å¯¼å…¥å‡½æ•°ä¸­ï¼Œå®Œæˆæœ¬åœ° svg å›¾æ ‡çš„å¯¼å…¥svgRequire.keys().forEach(svgIcon =&gt; svgRequire(svgIcon)) è¿™æ ·ï¼Œå°±å®Œæˆäº†æ‰€æœ‰çš„æœ¬åœ° svg å›¾ç‰‡å¯¼å…¥ã€‚ ç„¶åæˆ‘ä»¬æ³¨å†Œå…¨å±€çš„ SvgIcon ç»„ä»¶ï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚ 12345678// icons/index.tsimport type &#123; App &#125; from &#x27;vue&#x27;import SvgIcon from &#x27;@/components/SvgIcon/index.vue&#x27;export default (app: App): void =&gt; &#123; app.component(&#x27;svg-icon&#x27;, SvgIcon)&#125; åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å»é¡µé¢ä¸Šä½¿ç”¨ &lt;svg-icon icon=&quot;user&quot; /&gt;ï¼Œå‘ç°æ²¡æœ‰æ•ˆæœï¼Œå›¾æ ‡å±•ç¤ºä¸å‡ºæ¥ã€‚ è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬è™½ç„¶åœ¨ icons/index.ts ä¸­ï¼Œé€šè¿‡ require.context å¯¼å…¥äº†æ‰€æœ‰çš„ svg å›¾ç‰‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åšå¤„ç†ï¼Œsvg-icon å†…éƒ¨çš„ &lt;use :xlink:href=&quot;#icon-user&quot; /&gt; æ‰¾ä¸åˆ°ä»»ä½•è·Ÿ #icon-user æœ‰å…³çš„ svg å›¾æ ‡ã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° svg-sprite-loader äº†ã€‚ svg-sprite-loadersvg-sprite-loader çš„å®˜æ–¹è§£é‡Šæ˜¯ï¼šä¸€ä¸ªç”¨äºåˆ›å»º svg é›ªç¢§å›¾çš„ Webpack åŠ è½½å™¨ã€‚è¿™ä¸ªåŠ è½½å™¨ç°åœ¨å·²ç»è¢« JetBrains å…¬å¸æ”¶å½•å’Œç»´æŠ¤äº†ã€‚ é€šä¿—çš„è®²ï¼šsvg-sprite-loader ä¼šæŠŠä½ å¼•å…¥çš„ svg å¡åˆ°ä¸€ä¸ªä¸ª symbol ä¸­ï¼Œåˆæˆä¸€ä¸ªå¤§çš„ svgï¼Œæœ€åå°†è¿™ä¸ªå¤§çš„ svg æ”¾å…¥ body ä¸­ã€‚symbol çš„ id å¦‚æœä¸ç‰¹åˆ«æŒ‡å®šï¼Œå°±æ˜¯ä½ çš„æ–‡ä»¶åã€‚åœ¨é¡µé¢ä¸Šå½¢æˆè¿™æ ·çš„å…ƒç´ ï¼Œä¸‹é¢æ˜¯å¯¼å…¥äº†æœ¬åœ°çš„ user.svg å’Œ password.svgï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ª symbol ä¸Šï¼Œéƒ½æœ‰ä¸€ä¸ª id å±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ SvgIcon ä¸­æŒ‡å®šäº† use çš„ :xlink:hrefï¼Œä½¿ç”¨æ—¶ï¼Œå°±èƒ½æ‰¾åˆ°é¡µé¢ä¸Šå¯¹åº”çš„å›¾æ ‡äº†ã€‚ æ¥ç€ï¼Œæˆ‘ä»¬æ¥é…ç½® svg-sprite-loaderï¼Œæ‰“å¼€ vue.config.js: 1234567891011121314151617181920212223242526272829303132333435const path = require(&#x27;path&#x27;)function resolve(dir) &#123; return path.join(__dirname, dir)&#125;module.exports = &#123; chainWebpack(config) &#123; // ä½¿ç”¨äº† config.module.rule(&#x27;svg&#x27;) æ–¹æ³•æ¥è·å–å¯¹ SVG æ–‡ä»¶çš„å¤„ç†è§„åˆ™ã€‚ // ç„¶åï¼Œå®ƒä½¿ç”¨äº† exclude å±æ€§æ¥æ·»åŠ ä¸€ä¸ªæ’é™¤è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™ä¼šæ’é™¤ resolve(&#x27;src/icons&#x27;) ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚ // æœ€åï¼Œå®ƒä½¿ç”¨äº† end æ–¹æ³•æ¥ç»“æŸè¿™ä¸ªé“¾å¼è°ƒç”¨ã€‚ // è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯åœ¨ Webpack æ„å»ºæµç¨‹ä¸­æ’é™¤ src/icons ç›®å½•ä¸­çš„æ‰€æœ‰ SVG æ–‡ä»¶ã€‚è¿™æ„å‘³ç€ Webpack åœ¨æ„å»ºæ—¶ä¸ä¼šå¤„ç†è¿™äº›æ–‡ä»¶ã€‚ config.module.rule(&#x27;svg&#x27;).exclude.add(resolve(&#x27;src/icons&#x27;)).end() // ä½¿ç”¨äº† config.module.rule(&#x27;icons&#x27;) æ–¹æ³•æ¥è·å–å¯¹å›¾æ ‡æ–‡ä»¶çš„å¤„ç†è§„åˆ™ã€‚ // ç„¶åï¼Œå®ƒä½¿ç”¨äº† test å±æ€§æ¥è®¾ç½®è¿™ä¸ªè§„åˆ™åº”ç”¨äºå“ªäº›æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºåªæœ‰ä»¥ .svg ç»“å°¾çš„æ–‡ä»¶æ‰ä¼šè¢«å¤„ç†ã€‚ // æ¥ç€ï¼Œå®ƒä½¿ç”¨äº† include å±æ€§æ¥æ·»åŠ ä¸€ä¸ªåŒ…å«è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™åªä¼šåŒ…å« resolve(&#x27;src/icons&#x27;) ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ // æœ€åï¼Œå®ƒä½¿ç”¨äº† use æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªæ–°çš„è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™ä½¿ç”¨äº† svg-sprite-loader æ¥å¤„ç† SVG æ–‡ä»¶ã€‚ // è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯åœ¨ Webpack æ„å»ºæµç¨‹ä¸­å¤„ç† src/icons ç›®å½•ä¸­çš„ SVG æ–‡ä»¶ã€‚ // å®ƒä¼šä½¿ç”¨ svg-sprite-loader åŠ è½½å™¨æ¥å°†è¿™äº› SVG æ–‡ä»¶è½¬æ¢ä¸ºå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨çš„ç²¾çµå›¾ï¼ˆSpriteï¼‰ã€‚ config.module .rule(&#x27;icons&#x27;) .test(/\\.svg$/) .include.add(resolve(&#x27;src/icons&#x27;)) .end() .use(&#x27;svg-sprite-loader&#x27;) .loader(&#x27;svg-sprite-loader&#x27;) .options(&#123; symbolId: &#x27;icon-[name]&#x27; // æŒ‡å®šç²¾çµçš„ç¬¦å· ID åº”ä¸º icon-[name]ã€‚ &#125;) .end() &#125;&#125; è¿™ä¸¤æ¡è§„åˆ™åœ¨ webpack é…ç½®ä¸­è®¾ç½®äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥å¤„ç† SVG æ–‡ä»¶ï¼šä¸€ç§ç”¨äºæ’é™¤ä½äº src/icons ç›®å½•ä¸­çš„ SVG æ–‡ä»¶ï¼Œå¦ä¸€ç§ç”¨äºä½¿ç”¨ svg-sprite-loader å¤„ç†ä½äº src/icons ç›®å½•ä¸­çš„ SVG æ–‡ä»¶ã€‚ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å®Œæˆäº† svg-sprite-loader çš„é…ç½®ï¼Œç„¶åé‡æ–°å¯åŠ¨é¡¹ç›®ï¼Œå°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨æœ¬åœ°çš„ svg äº†ã€‚ 12345&lt;svg-icon icon=&quot;user&quot;&gt;&lt;/svg-icon&gt;&lt;svg-icon icon=&quot;password&quot;&gt;&lt;/svg-icon&gt; é¡µé¢ä¸Šçš„æ•ˆæœæ˜¯è¿™æ ·çš„ æ€»ç»“ç»è¿‡ svg-sprite-loader åŠ è½½ä¹‹åï¼Œä¸ä»…å¯ä»¥é€šè¿‡æŒ‡å®š id çš„æ–¹å¼å¼•å…¥ iconï¼Œè€Œä¸”ç›¸æ¯”å›¾ç‰‡å¼•å…¥çš„æ–¹å¼ï¼Œæœ€å¤§çš„ä¼˜ç‚¹å°±åœ¨äºå¯ä»¥é€šè¿‡ç»™ svg æ ‡ç­¾æ·»åŠ  fill å±æ€§æ¥è°ƒæ•´ icon çš„é¢œè‰²ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ç»™ svg æ·»åŠ  class æ¥è°ƒæ•´ icon çš„æ ·å¼ï¼Œè™½ç„¶è¯´å›¾ç‰‡å¼•å…¥çš„æ–¹å¼ä¹Ÿèƒ½åšåˆ°ï¼Œä½†æ˜¯å¦‚æœå›¾ç‰‡æŒ‡å®šå®½é«˜ä¸åŸå›¾çš„å®½é«˜ä¸æˆæ¯”ä¾‹ï¼Œå°±ä¼šå¯¼è‡´å›¾ç‰‡çš„å¤±çœŸï¼Œè€Œ svg ä¸ä¼šã€‚å³ä½¿éšæ„è°ƒæ•´ svg çš„å®½é«˜æ ·å¼ï¼Œå®ƒä¹Ÿæ˜¯æŒ‰ç…§åŸå°ºå¯¸è¿›è¡Œç¼©æ”¾ï¼Œè¾¾åˆ°é«˜ä¿çœŸçš„æ•ˆæœã€‚ è€Œä¸”é€šè¿‡svg-sprite-loaderçš„å¤„ç†åï¼Œç”Ÿæˆäº†ç²¾çµå›¾ï¼Œå®ƒæ˜¯ä¸€ç§å°†å¤šä¸ªå›¾æ ‡æ”¾åœ¨ä¸€å¼ å›¾ç‰‡ä¸­çš„æŠ€æœ¯ï¼Œå¯ä»¥å‡å°‘ HTTP è¯·æ±‚æ•°ï¼Œä»è€Œæå‡ç½‘ç«™æ€§èƒ½ã€‚","categories":[],"tags":[{"name":"å·¥ç¨‹åŒ–,Vue3","slug":"å·¥ç¨‹åŒ–-Vue3","permalink":"http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3/"}]},{"title":"Vue3é¡¹ç›®å®æˆ˜(ä¸€)ï¼šå·¥ç¨‹åŒ–é…ç½®","slug":"vue3-project-config","date":"2022-12-23T04:16:55.000Z","updated":"2022-12-23T15:02:10.667Z","comments":true,"path":"/post/vue3-project-config.html","link":"","permalink":"http://yoursite.com/post/vue3-project-config.html","excerpt":"å·¥ç¨‹åŒ–/ç¼–ç¨‹è§„èŒƒ/é¡¹ç›®åŸºç¡€é…ç½®/...","text":"ç¼–ç¨‹è§„èŒƒç¼–ç¨‹è§„èŒƒçš„é‡è¦ä½œç”¨ï¼š è§„èŒƒçš„ä»£ç å¯ä»¥ä¿ƒè¿›å›¢é˜Ÿåˆä½œ è§„èŒƒçš„ä»£ç å¯ä»¥å‡å°‘bugå¤„ç†ï¼Œè§„èŒƒä¸æ˜¯å¯¹å¼€å‘çš„åˆ¶çº¦ï¼Œè€Œç¡®å®æ˜¯æœ‰åŠ©äºæé«˜å¼€å‘æ•ˆç‡çš„ è§„èŒƒçš„ä»£ç å¯ä»¥é™ä½ç»´æŠ¤æˆæœ¬ è§„èŒƒçš„ä»£ç æœ‰åŠ©äºä»£ç å®¡æŸ¥ å…»æˆä»£ç è§„èŒƒçš„ä¹ æƒ¯ï¼Œæœ‰åŠ©äºè‡ªèº«çš„æˆé•¿ ESLint + Prettier è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç  VSCode å®‰è£… ESLint æ’ä»¶ï¼Œåœ¨æ ¹ç›®å½•åˆ›å»º .eslintrc é…ç½®æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233module.exports = &#123; root: true, // è¡¨ç¤ºå½“å‰ç›®å½•ä¸ºæ ¹ç›®å½• env: &#123; node: true, &#125;, // ESLint ä¸­åŸºç¡€é…ç½®éœ€è¦ç»§æ‰¿çš„é…ç½® extends: [ &quot;plugin:vue/vue3-essential&quot;, &quot;eslint:recommended&quot;, &quot;@vue/typescript/recommended&quot;, &quot;@vue/prettier&quot;, &quot;@vue/prettier/@typescript-eslint&quot;, ], parserOptions: &#123; ecmaVersion: 2020, &#125;, // é”™è¯¯è§„åˆ™ï¼šoff(0) warn(1) error(2) rules: &#123; &quot;no-console&quot;: process.env.NODE_ENV === &quot;production&quot; ? &quot;warn&quot; : &quot;off&quot;, &quot;no-debugger&quot;: process.env.NODE_ENV === &quot;production&quot; ? &quot;warn&quot; : &quot;off&quot;, // å…³é—­ no-used æ£€æŸ¥ &quot;@typescript-eslint/no-unused-vars&quot;: &quot;off&quot;, &#125;, overrides: [&#123; files: [ &quot;**/__tests__/*.&#123;j,t&#125;s?(x)&quot;, &quot;**/tests/unit/**/*.spec.&#123;j,t&#125;s?(x)&quot;, ], env: &#123; jest: true, &#125;, &#125;, ],&#125;; VSCode å®‰è£… Prettier æ’ä»¶ï¼Œåœ¨æ ¹ç›®å½•åˆ›å»º .prettierrc é…ç½®æ–‡ä»¶ 123456&#123; &quot;semi&quot;: false, // æ˜¯å¦åŠ åˆ†å· &quot;singleQuote&quot;: true, // å•å¼•å· &quot;arrowParens&quot;: &quot;avoid&quot;, // (x) =&gt; &#123;&#125; ç®­å¤´å‡½æ•°å‚æ•°åªæœ‰ä¸€ä¸ªæ—¶ï¼Œæ˜¯å¦è¦å°æ‹¬å·ï¼Œ avoid: çœç•¥å°æ‹¬å· &quot;trailingComma&quot;: &quot;none&quot; // ä»¥å¤šä¸ªé€—å·ç›¸éš”çš„ï¼Œæœ€åæ˜¯å¦åŠ é€—å·&#125; æˆ‘ä»¬æ‰“å¼€ VSCode è®¾ç½®ï¼Œåˆ‡æ¢åˆ° å·¥ä½œåŒºï¼Œæ‰¾åˆ° Code Action on Saveï¼Œä¿®æ”¹é…ç½®ï¼š 123456&quot;editor.codeActionsOnSave&quot;: &#123; &quot;source.fixAll&quot;: true, &quot;source.fixAll.eslint&quot;: true, &quot;source.fixAll.stylelint&quot;: true, &quot;source.fixAll.tslint&quot;: true,&#125;, æ³¨æ„é¡¹ å¯¹ VSCode è€Œè¨€ï¼Œé»˜è®¤ä¸€ä¸ª tab ç­‰äº 4 ä¸ªç©ºæ ¼ï¼Œè€Œ ESlint é»˜è®¤ä¸ºä¸¤ä¸ªç©ºæ ¼ï¼Œæˆ‘ä»¬åœ¨ VSCode è®¾ç½®ä¸­ï¼Œæ‰¾åˆ° tab size æ”¹ä¸º 2 å°±è¡Œã€‚ å¯èƒ½å®‰è£…äº†å¤šä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œæˆ‘ä»¬å³é”®æ–‡ä»¶ï¼Œæ‰¾åˆ° ä½¿ç”¨...æ ¼å¼åŒ–æ–‡æ¡£ï¼Œè®¾ç½®é»˜è®¤çš„ä¸º Prettier å³å¯ã€‚ æœ‰å¯èƒ½ Prettier å’Œ eslint è§„åˆ™å­˜åœ¨å†²çªï¼Œæ¯”å¦‚ eslint å¸Œæœ›æ–¹æ³•åå’Œæ‹¬å·ä¹‹é—´æœ‰ç©ºæ ¼ï¼Œè€Œ Prettier ä¸å¸Œæœ›æœ‰ç©ºæ ¼ï¼Œæ§åˆ¶å°å°±ä¼šæŠ¥å‡º ESlint é”™è¯¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ° ESlint é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ° rulesï¼Œå°† space-before-function-paren è®¾ç½®ä¸º 0 æˆ–è€… off å³å¯ã€‚ Git æäº¤è§„èŒƒ12345&lt;ç±»å‹&gt;[å¯é€‰ èŒƒå›´]: &lt;æè¿°&gt;[å¯é€‰ æ­£æ–‡][å¯é€‰ è„šæ³¨] CommitizenGithub: cz-cli å½“ä½ ä½¿ç”¨ commitizen è¿›è¡Œä»£ç æäº¤æ—¶ï¼Œcommitizen ä¼šæäº¤ä½ åœ¨æäº¤æ—¶å¡«å†™æ‰€æœ‰å¿…é¡»å¾—æäº¤å­—æ®µ å…¨å±€å®‰è£… 1npm install -g commitizen@4.2.4 é¡¹ç›®é…ç½® å®‰è£… cz-customizable 1npm install cz-customizable@6.3.0 --save-dev åœ¨ package.json ä¸­é…ç½® è¡¨ç¤º commitizen çš„é…ç½®åœ¨ node_modules ä¸­çš„ç¬¬ä¸‰æ–¹åŒ…ä¹‹ä¸­ã€‚ 1234567...&quot;config&quot;: &#123; &quot;commitizen&quot;: &#123; &quot;path&quot;: &quot;node_modules/cz-customizable&quot; &#125;&#125;... 3.é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º .cz-config.jsï¼Œé…ç½®è‡ªå®šä¹‰æç¤ºæ–‡ä»¶ 1234567891011121314151617181920212223242526module.exports = &#123; types: [ &#123; value: &#x27;feat&#x27;, name: &#x27;feat: æ–°åŠŸèƒ½&#x27; &#125;, &#123; value: &#x27;fix&#x27;, name: &#x27;fix: ä¿®å¤&#x27; &#125;, &#123; value: &#x27;docs&#x27;, name: &#x27;docs: æ–‡æ¡£å˜æ›´&#x27; &#125;, &#123; value: &#x27;style&#x27;, name: &#x27;style: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰&#x27; &#125;, &#123; value: &#x27;refactor&#x27;, name: &#x27;refactor: é‡æ„ï¼ˆæ—¢ä¸æ˜¯å¢åŠ  featureï¼Œä¹Ÿä¸æ˜¯ä¿®å¤ bugï¼‰&#x27; &#125;, &#123; value: &#x27;perf&#x27;, name: &#x27;perf: æ€§èƒ½ä¼˜åŒ–&#x27; &#125;, &#123; value: &#x27;test&#x27;, name: &#x27;test: å¢åŠ æµ‹è¯•&#x27; &#125;, &#123; value: &#x27;chore&#x27;, name: &#x27;chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨&#x27; &#125;, &#123; value: &#x27;revert&#x27;, name: &#x27;revert: å›é€€&#x27; &#125;, &#123; value: &#x27;build&#x27;, name: &#x27;build: æ‰“åŒ…&#x27; &#125;, ], // æ­¥éª¤ messages: &#123; type: &#x27;è¯·é€‰æ‹©æäº¤çš„ç±»å‹&#x27;, customScope: &#x27;è¯·è¾“å…¥ä¿®æ”¹çš„èŒƒå›´ï¼ˆå¯é€‰ï¼‰&#x27;, subject: &#x27;è¯·ç®€è¦æè¿°æäº¤å†…å®¹ï¼ˆå¿…å¡«ï¼‰&#x27;, body: &#x27;è¯·è¾“å…¥è¯¦ç»†çš„æè¿°ï¼ˆå¯é€‰ï¼‰&#x27;, footer: &#x27;è¯·è¾“å…¥è¦å…³é—­çš„ issueï¼ˆå¯é€‰ï¼‰&#x27;, confirmCommit: &#x27;ç¡®è®¤è¦ä½¿ç”¨ä»¥ä¸Šä¿¡æ¯æäº¤?(y/n)&#x27;, &#125;, // éœ€è¦è·³è¿‡çš„é—®é¢˜ skipQuestions: [&#x27;body&#x27;, &#x27;footer&#x27;], subjectLimit: 72, // æè¿°å†…å®¹çš„é™åˆ¶&#125; ä½¿ç”¨ git cz ä»£æ›¿ git commit æœ€å æˆ‘ä»¬å¯ä»¥é€šè¿‡ git cz è§„èŒƒåŒ–äº† git æäº¤ï¼Œé‚£ä¹ˆå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ git cz æäº¤ï¼Œæ‰èƒ½è§„èŒƒåŒ–ï¼Œå¦‚æœæˆ‘ä»¬å¿˜è®°äº†ä½¿ç”¨ git czï¼Œä¾ç„¶ä½¿ç”¨çš„ git commit ç›´æ¥æäº¤äº†æ€ä¹ˆåŠå‘¢ï¼Ÿ é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•é™åˆ¶è¿™ç§é”™è¯¯çš„å‡ºç°ï¼Ÿ ä½¿ç”¨ git hooks Git Hookså½“ã€Šæäº¤æè¿°ä¿¡æ¯ã€‹ä¸ç¬¦åˆ çº¦å®šå¼æäº¤è§„èŒƒ çš„æ—¶å€™ï¼Œé˜»æ­¢å½“å‰çš„æäº¤ï¼Œå¹¶æŠ›å‡ºç›¸åº”çš„é”™è¯¯æç¤ºã€‚ é€šè¿‡ git hooks åœ¨æ‰§è¡ŒæŸä¸ªäº‹ä»¶ä¹‹å‰æˆ–è€…ä¹‹åè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œã€‚ git hooks éå¸¸å¤šï¼Œå®é™…ç”¨çš„æ¯”è¾ƒå¤šçš„å°±ä¸¤ä¸ªï¼š pre-commitï¼šgit commit æ‰§è¡Œå‰ï¼Œåœ¨è·å–æäº¤æ—¥å¿—ä¿¡æ¯å¹¶è¿›è¡Œæäº¤ä¹‹å‰è°ƒç”¨ commit-msgï¼šgit commit æ‰§è¡Œå‰ï¼Œå¯ç”¨äºå°†æ¶ˆæ¯è§„èŒƒåŒ–ä¸ºæŸç§é¡¹ç›®æ ‡å‡†æ ¼å¼ ä½¿ç”¨ husky + commitlint æ£€æŸ¥æäº¤ä¿¡æ¯ä½¿ç”¨ git hookså»æ£€éªŒæˆ‘ä»¬çš„æäº¤ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªå·¥å…·ï¼š commitlint: ç”¨äºæ£€æŸ¥æäº¤ä¿¡æ¯ husky: git hooks å·¥å…· ä¸»è¦: npm ç‰ˆæœ¬éœ€è¦åœ¨ 7.x ä»¥ä¸Š å®‰è£…ä¾èµ–: 1npm install @commitlint/config-conventional@12.1.4 @commitlint/cli@12.1.4 --save-dev åˆ›å»º commitlint-config.js 123module.exports = &#123; extends: [&#x27;@commitlint/config-conventional&#x27;]&#125; å¢åŠ é…ç½®é¡¹ 12345678910111213141516module.exports = &#123; extends: [&#x27;@commitlint/config-conventional&#x27;], rules: &#123; // type çš„ç±»å‹å®šä¹‰ï¼Œè¡¨ç¤º git æäº¤çš„ type å¿…é¡»åœ¨ä»¥ä¸‹èŒƒå›´å†… &#x27;type-enum&#x27;: [ // å½“å‰éªŒè¯çš„é”™è¯¯çº§åˆ« 2, // åœ¨ä»€ä¹ˆæƒ…å†µä¸‹éªŒè¯ &#x27;always&#x27;, // æšä¸¾çš„å†…å®¹ [&#x27;feat&#x27;, &#x27;fix&#x27;, &#x27;docs&#x27;, &#x27;style&#x27;, &#x27;refactor&#x27;, &#x27;perf&#x27;, &#x27;test&#x27;, &#x27;chore&#x27;, &#x27;revert&#x27;, &#x27;build&#x27;], ], // subject å¤§å°å†™ä¸åšæ ¡éªŒ &#x27;subject-case&#x27;: [0] &#125;&#125; æ³¨æ„: å¿…é¡»ç¡®ä¿æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä¿å­˜ä¸º utf-8 çš„ç¼–ç æ ¼å¼ï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™ã€‚ æ‰“å¼€é…ç½®æ–‡ä»¶ï¼ŒæŸ¥çœ‹ vscode å³ä¸‹è§’ï¼Œæ˜¯å¦æ˜¾ç¤ºäº† utf-8ï¼Œå¦‚æœä¸æ˜¯å°±è¦å°†å…¶åˆ‡æ¢ä¸ºæ­£ç¡®çš„ç¼–ç æ ¼å¼ã€‚ å®‰è£… husky æ£€æµ‹ git hooks çš„å·¥å…· å®‰è£… 1npm install husky@7.0.1 --save-dev å¯åŠ¨ hooksï¼Œåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ .husky æ–‡ä»¶å¤¹ 1npx husky install åœ¨ package.json ä¸­ç”Ÿæˆ prepare æŒ‡ä»¤ï¼ˆnpm &gt; 7ï¼‰ 12// æ‰§è¡ŒæŒ‡ä»¤ï¼Œä¼šåœ¨ npm scripts ä¸­ç”Ÿæˆé…ç½®npm set-script prepare &quot;husky install&quot; æ‰§è¡Œ prepare æŒ‡ä»¤ 1npm run prepare æ·»åŠ  commitlint çš„ hook åˆ° husky ä¸­ï¼Œå¹¶åœ¨ commit-msg çš„ hooks ä¸‹ï¼Œæ‰§è¡Œ npx --no-install commitlint --edit &quot;$1&quot; 1npx husky add .husky/commit-msg &#x27;npx --no-install commitlint --edit &quot;$1&quot;&#x27; æ‰“å¼€ .huskyï¼Œå°±å¯ä»¥çœ‹åˆ° commit-msg æ–‡ä»¶äº†ã€‚ 123456// commit-msg#!/bin/sh. &quot;$&#123;dirname &quot;$&#123;0&#125;&quot;&#125;/_/husky.sh&quot;npx --no-install commitlint --edit $1 æœ€åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„æäº¤äº†ã€‚ pre-commit æ£€æµ‹ä»£ç æäº¤è§„èŒƒè™½ç„¶æˆ‘ä»¬ä½¿ç”¨äº† eslint + prettier åœ¨æœ¬åœ°è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä½†æ˜¯ï¼Œæœ‰å¯èƒ½æœ‰çš„å°ä¼™ä¼´ï¼Œå¿˜è®°å°† vscode çš„è‡ªåŠ¨ä¿å­˜æ ¼å¼åŒ–æ‰“å¼€äº†ï¼Œå¹¶ä¸”å†™çš„ä»£ç æ ¼å¼ä¸ç¬¦åˆè§„èŒƒï¼Œä¹Ÿæ˜¯å¯ä»¥æäº¤ä¸Šå»çš„ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±å¾—åŠ ä¸€äº›é…ç½®ï¼Œæ¥æ£€æµ‹å°ä¼™ä¼´ä»¬æäº¤çš„ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒäº†ã€‚ è¦å®Œæˆè¿™ä¸€æ“ä½œï¼Œå°±éœ€è¦ä½¿ç”¨ husky é…åˆ eslint æ¥å®ç°äº†ã€‚ æˆ‘ä»¬æœŸæœ›é€šè¿‡ husky æ£€æµ‹ pre-commit é’©å­ï¼Œåœ¨è¯¥é’©å­ä¸‹æ‰§è¡Œ npx eslint --ext .js,.vue, src æŒ‡ä»¤å»è¿›è¡Œç›¸å…³çš„æ£€æµ‹ã€‚ æ‰§è¡Œ npx husky add .husky/pre-commit &quot;npx eslint --ext .js,.vue, src&quot; å‘½ä»¤ ä¼šåœ¨ .husky æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œç”Ÿæˆ pre-commit æ–‡ä»¶ 123456// pre-commit#!/bin/sh. &quot;$&#123;dirname &quot;$&#123;0&#125;&quot;&#125;/_/husky.sh&quot;npx eslint --ext .js,.vue, src æ¯æ¬¡æˆ‘ä»¬æäº¤ä»£ç ï¼Œéƒ½ä¼šè§¦å‘ pre-commit é’©å­ï¼Œä»è€Œä½¿ç”¨ eslint å»æ£€æµ‹æˆ‘ä»¬çš„ä»£ç æ–‡ä»¶ã€‚ å…³é—­è‡ªåŠ¨ä¿å­˜ï¼Œä¿®æ”¹ä»£ç æäº¤è¯•è¯•å§ lint staged è‡ªåŠ¨ä¿®å¤é”™è¯¯æˆ‘ä»¬é€šè¿‡ pre-commit + husky å¤„ç†äº†ä»£ç æäº¤æ—¶çš„è§„èŒƒåŒ–é—®é¢˜ï¼Œå½“æˆ‘ä»¬è¿›è¡Œä»£ç æäº¤æ—¶ï¼Œä¼šæ£€æµ‹æ‰€æœ‰çš„ä»£ç æ ¼å¼è§„èŒƒã€‚ ä½†æ˜¯è¿™æ ·å°±æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š æˆ‘ä»¬åªä¿®æ”¹äº†ä¸ªåˆ«æ–‡ä»¶ï¼Œæ²¡æœ‰å¿…è¦æ£€æµ‹æ‰€æœ‰çš„æ–‡ä»¶ä»£ç æ ¼å¼ å®ƒåªèƒ½ç»™æˆ‘ä»¬æç¤ºå‡ºå¯¹åº”çš„é”™è¯¯ï¼Œç«Ÿç„¶è¿˜éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œä¿®å¤ï¼Ÿä¸åˆç† æˆ‘ä»¬ä½¿ç”¨ lint-staged æ’ä»¶ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚ lint-staged å¯ä»¥ åªæ£€æµ‹æœ¬æ¬¡æ›´æ–°çš„ä»£ç ï¼Œå¹¶åœ¨é”™è¯¯å‡ºç°çš„æ—¶å€™ï¼Œè‡ªåŠ¨ä¿®å¤å¹¶ä¸”æ¨é€ å®‰è£… ä½¿ç”¨ vue-cli ç”Ÿæˆé¡¹ç›®æ—¶ï¼Œlint-staged ä¸éœ€è¦å®‰è£…äº†ï¼Œé¡¹ç›®å·²ç»æœ‰äº†ã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±éœ€è¦å•ç‹¬å®‰è£… ä¿®æ”¹ package.jsonï¼š 123456&quot;lint-staged&quot;: &#123; &quot;src/**/*.&#123;js,jsx,vue&#125;&quot;: &#123; &quot;eslint --fix&quot;, &quot;git add&quot; &#125;&#125; ä¿®æ”¹ .husky/pre-commit æ–‡ä»¶ 12345678// pre-commit#!/bin/sh. &quot;$&#123;dirname &quot;$&#123;0&#125;&quot;&#125;/_/husky.sh&quot;// npx eslint --ext .js,.vue, src // åˆ é™¤npx lint-staged // æ–°å¢ å°è¯•å°†ä»£ç ä¿®æ”¹ä¸ºä¸ç¬¦åˆè§„èŒƒçš„ï¼Œé€šè¿‡ git cz å†æ¬¡æäº¤è¯•è¯•ï¼ lint-staged ä¼šå°è¯•è‡ªåŠ¨ä¿®å¤é”™è¯¯ é”™è¯¯ä¿®å¤å®Œæˆï¼Œç»§ç»­æ‰§è¡Œï¼Œå¹¶å°†ä»£ç æäº¤","categories":[],"tags":[{"name":"å·¥ç¨‹åŒ–,Vue3","slug":"å·¥ç¨‹åŒ–-Vue3","permalink":"http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3/"}]},{"title":"Vue3çš„å“åº”å¼ç³»ç»Ÿ","slug":"vue3-reactive","date":"2022-12-22T13:34:30.000Z","updated":"2022-12-22T14:41:46.770Z","comments":true,"path":"/post/vue3-reactive.html","link":"","permalink":"http://yoursite.com/post/vue3-reactive.html","excerpt":"å“åº”å¼ç³»ç»Ÿçš„ä½œç”¨ä¸å®ç°","text":"å“åº”å¼ç³»ç»Ÿå®ç°å“åº”å¼åŸºç¡€ é€šè¿‡ proxy ä»£ç†å¯¹è±¡ï¼Œè¯»å–å±æ€§æ—¶è§¦å‘ get æ–¹æ³•ï¼Œè®¾ç½®å±æ€§æ—¶è§¦å‘ set æ–¹æ³• åœ¨ get æ–¹æ³•ä¸­æ”¶é›†å‰¯ä½œç”¨å‡½æ•°ï¼Œåœ¨ set æ–¹æ³•ä¸­è§¦å‘å‰¯ä½œç”¨å‡½æ•° å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªå¯¹è±¡ï¼š&#123; ok: true, text: &#39;hello world&#39; &#125;ï¼Œæ³¨å†Œå‰¯ä½œç”¨å‡½æ•° 123effect(() =&gt; &#123; document.body.innerHTML = obj.ok ? obj.text : &#x27;ok not&#x27;&#125;) å½“ ok ä¸º trueï¼Œæˆ‘ä»¬ä¼šèµ° obj.text çš„è¯»å–é€»è¾‘ï¼Œè§¦å‘ get æ‹¦æˆªæ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™é¡µé¢ä¸Šä¼šæ˜¾ç¤º hello worldï¼Œå½“æˆ‘ä»¬å°† obj.ok è®¾ç½®ä¸º false åï¼Œæˆ‘ä»¬ä¼šæœ‰å‰¯ä½œç”¨é—ç•™å‡½æ•°ï¼ˆtextçš„ï¼‰ï¼Œå› ä¸º ok ä¸º falseï¼Œæ°¸è¿œä¸ä¼šå†è¯»å– obj.text äº†ã€‚ ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹ obj.text æ—¶ï¼Œ effect å‰¯ä½œç”¨å‡½æ•°ä¾ç„¶ä¼šè§¦å‘ï¼Œè™½ç„¶é¡µé¢ä¸Šæ°¸è¿œæ˜¯ ok notã€‚ æ¸…é™¤ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•° è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œ åˆ†æ”¯åˆ‡æ¢å’Œ cleanup å‡½æ•°äº†ï¼Œé€šè¿‡ cleanup å‡½æ•°ï¼Œæˆ‘ä»¬å°†åªæ”¶é›†ä½¿ç”¨åˆ°çš„ key çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ ok ä¸ºfalse æ—¶ï¼Œæˆ‘ä»¬ä¸å†å¯¹ obj.text è¿›è¡Œä¾èµ–æ‰‹æœºï¼Œæ— è®ºæˆ‘ä»¬å¦‚ä½•ä¿®æ”¹ obj.textï¼Œéƒ½ä¸ä¼šè§¦å‘ effect æ–¹æ³•ã€‚ æˆ‘ä»¬å¯¹æ³¨å†Œå‰¯ä½œç”¨å‡½æ•°ï¼Œåšä¸€äº›æ”¹å˜ï¼Œåœ¨æ³¨å†Œå‡½æ•°å†…éƒ¨ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ–°çš„å‰¯ä½œç”¨å‡½æ•°æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨æ‰§è¡Œ åˆ é™¤å‰¯ä½œç”¨å‡½æ•°çš„æ–¹æ³• å’ŒçœŸæ­£çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆè®¾ç½® document.body å†…å®¹ï¼‰ åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜åœ¨ å‰¯ä½œç”¨å‡½æ•° ä¸Šå®šä¹‰äº†ä¸€ä¸ª deps å±æ€§ï¼Œç”¨æ¥å­˜å‚¨ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³è”çš„ä¾èµ–é›†åˆï¼Œå°†æ¥åœ¨ cleanup ä¸­é€šè¿‡ activeEffect.deps[i] delete effectFn æ—¶ï¼Œå…¶å®ï¼Œå°±æ˜¯å°† æŸä¸ª key çš„ deps ä¸­çš„å‰¯ä½œç”¨å‡½æ•°åˆ é™¤äº† 1234567891011121314function effect(fn) &#123; function effectFn() &#123; activeEffect = effectFn cleanup(effectFn) // åˆ é™¤æ‰€æœ‰key æ”¶é›†åˆ°çš„ä¾èµ– fn() // é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼Œé‡æ–°æ”¶é›†ä¾èµ– &#125; effectFn.deps = [] effectFn()&#125; å®šä¹‰ cleanup å‡½æ•°ï¼Œæ¯ä¸€æ¬¡è§¦å‘ set æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šå…ˆåˆ é™¤æ‰€æœ‰ key å¯¹åº”çš„ä¾èµ–ï¼Œç„¶åé‡æ–°æ‰§è¡Œ effectFn å†…éƒ¨çš„ fn å‡½æ•°ï¼Œé‡æ–°æ”¶é›†ä¾èµ– å› ä¸º obj.ok = false äº†ï¼Œä¸ä¼šå†è¯»å– obj.textï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šå†å¯¹ obj.text æ”¶é›†ä¾èµ–äº†ã€‚ 12345678910function cleanup(effectFn) &#123; for(let i = 0; i &lt; effectFn.deps.length; i++) &#123; const deps = effectFn.deps[i] // Set é›†åˆ deps.delete(effectFn) &#125; effectFn.deps.length = []&#125; æ³¨æ„ æˆ‘ä»¬åˆ é™¤ effectFn.deps[i] ä¸­çš„ effectFnï¼Œå…¶å®å°±æ˜¯åˆ é™¤äº† â€˜okã€textâ€™ ä¸­å¯¹åº”çš„ä¾èµ–é›†åˆï¼ˆSetï¼‰çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œå› ä¸º effectFn.deps ä¸­å­˜æ”¾çš„é›†åˆ å’Œ Map key å¯¹åº”çš„ Value çš„é›†åˆï¼Œæ˜¯åŒä¸€ä¸ªé›†åˆ åˆ é™¤åï¼ŒMap ä¸­çš„æ‰€æœ‰ value éƒ½æ˜¯ç©ºçš„ Set ç„¶åæ‰§è¡Œ fn å‡½æ•°ï¼Œé‡æ–°è¿›è¡Œè¯»å– obj å±æ€§ï¼Œè¿›è¡Œä¾èµ–æ”¶é›†ã€‚ ç«Ÿç„¶æ— é™å¾ªç¯ï¼Ÿ æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ”¹é€ ä¸€ä¸‹ trigger å‡½æ•°ï¼Œå¦åˆ™ä¼šé€ æˆ æ— é™å¾ªç¯ 1234567891011function trigger(target, key) &#123; const depsMap = bucket.get(target) if (!depsMap) return const effects = depsMap.get(key) const effectsToRun = new Set(effects) // effects &amp;&amp; effects.forEach(fn =&gt; fn()) effectsToRun &amp;&amp; effectsToRun.forEach(fn =&gt; fn())&#125; ä¸ºä»€ä¹ˆæ–°å»ºä¸€ä¸ª Set é›†åˆå‘¢? const effectsToRun = new Set(effects) å› ä¸ºï¼Œæˆ‘ä»¬éå† effects æ—¶ï¼Œæ‰§è¡Œäº†æ¯ä¸€ä¸ª å‰¯ä½œç”¨ å‡½æ•°ï¼Œå½“å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šè°ƒç”¨ cleanup è¿›è¡Œæ¸…é™¤ï¼Œå®é™…ä¸Šå°±æ˜¯ä» effects é›†åˆä¸­å¥–å½“å‰æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°å‰”é™¤ ä½†æ˜¯ï¼Œå‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œ fn() ä¼šè§¦å‘å±æ€§çš„è¯»å–æ“ä½œï¼Œæ‰§è¡Œ trackï¼Œå¯¼è‡´å‰¯ä½œç”¨å‡½æ•°é‡æ–°è¢«æ”¶é›†åˆ°ä¾èµ–ä¸­ï¼Œè€Œå¯¹äº effectsé›†åˆçš„éå†ä»ç„¶åœ¨æ‰§è¡Œï¼Œä»è€Œé€ æˆ æ— é™å¾ªç¯ã€‚ è§£å†³åŠæ³•å°±æ˜¯ï¼šæ ¹æ® effects é‡æ–°å»ºç«‹ä¸€ä¸ªé›†åˆï¼Œè¿›è¡Œéå†ã€‚ å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;title&gt;æ”¶é›† key çš„ä¾èµ–&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;script&gt; // å­˜å‚¨è¢«æ³¨å†Œçš„å‰¯ä½œç”¨å‡½æ•° let activeEffect; const data = &#123; ok: true, text: &#x27;hello world&#x27; &#125; const bucket = new WeakMap() // target =&gt; Map const obj = new Proxy(data, &#123; get(target, key) &#123; // è¿½è¸ªä¾èµ– track(target, key) return target[key] &#125;, set(target, key, value) &#123; target[key] = value // è§¦å‘ä¾èµ– trigger(target, key) &#125; &#125;) function track(target, key) &#123; if (!activeEffect) return target[key] let depsMap = bucket.get(target) if (!depsMap) &#123; bucket.set(target, depsMap = new Map()) &#125; let deps = depsMap.get(key) if (!deps) &#123; depsMap.set(key, deps = new Set()) &#125; // æ·»åŠ å‰¯ä½œç”¨å‡½æ•° deps.add(activeEffect) // deps å­˜å‚¨ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³è”çš„ä¾èµ–é›†åˆ // å°†æ¥åœ¨ cleanup ä¸­é€šè¿‡ activeEffect.deps[i] delete effectFn æ—¶ï¼Œå…¶å®ï¼Œå°±æ˜¯å°† deps ä¸­çš„å‰¯ä½œç”¨å‡½æ•°åˆ é™¤äº† activeEffect.deps.push(deps) &#125; function trigger(target, key) &#123; const depsMap = bucket.get(target) if (!depsMap) return const effects = depsMap.get(key) const effectsToRun = new Set(effects) // effects &amp;&amp; effects.forEach(fn =&gt; fn()) effectsToRun &amp;&amp; effectsToRun.forEach(fn =&gt; fn()) &#125; function effect(fn) &#123; function effectFn() &#123; activeEffect = effectFn cleanup(effectFn) fn() &#125; effectFn.deps = [] // å­˜å‚¨æ‰€æœ‰åŒ…å«å½“å‰å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ– é›†åˆï¼Œåœ¨ get æ‹¦æˆªå‡½æ•°ä¸­å¤„ç† deps effectFn() &#125; function cleanup(effectFn) &#123; console.log(&#x27;effectFn &#x27;, effectFn.deps) // æˆ‘ä»¬åˆ é™¤ effectFn.deps[i] ä¸­çš„ effectFnï¼Œå…¶å®å°±æ˜¯åˆ é™¤äº† &#x27;xxx&#x27;(key) ä¸­å¯¹åº”çš„ä¾èµ–é›†åˆçš„å‰¯ä½œç”¨å‡½æ•° // effectFn.deps[i] ä¸­ï¼Œå­˜æ”¾çš„ä¾èµ–é›†åˆï¼Œå’Œ Map key å¯¹åº”çš„ä¾èµ–é›†åˆï¼Œæ˜¯åŒä¸€ä¸ªé›†åˆï¼Œåˆ é™¤æŸä¸€é¡¹ï¼Œè‡ªç„¶ä¼šå½±å“åˆ°å¦ä¸€ä¸ª // å½“æˆ‘ä»¬åœ¨ trigger ä¸­æ‰§è¡Œ effects æ—¶ï¼Œå°±æ˜¯æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•° // è¿™ä¸ªæ—¶å€™ï¼Œä¼šæ‰§è¡Œ cleanupï¼Œåˆ é™¤æ‰€æœ‰çš„ key å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œæœ€åæ‰§è¡Œ fnï¼Œé‡æ–°èµ° å±æ€§çš„è¯»å–é€»è¾‘ï¼Œè§¦å‘ get æ–¹æ³•ï¼Œé‡æ–°æ”¶é›†ä¾èµ– // å½“æˆ‘ä»¬è®¾ç½® obj.ok = false åï¼Œä¸ä¼šå†è¯»å– obj.text äº†ï¼Œä»è€Œä¸ä¼šå¯¹å…¶ key æ”¶é›†ä¾èµ–ã€‚ for(let i = 0; i &lt; effectFn.deps.length; i++) &#123; const deps = effectFn.deps[i] deps.delete(effectFn) &#125; effectFn.deps.length = 0 &#125; effect(() =&gt; &#123; console.log(&#x27; obj.ok&#x27;, obj.ok) // obj.ok = true ä¼šè§¦å‘ obj çš„ getæ‹¦æˆªæ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡ track å‡½æ•°æ”¶é›†åˆ°äº†å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶ä¸”å°†å…¶å­˜å‚¨åœ¨ deps ä¸­ document.body.innerHTML = obj.ok ? obj.text : &#x27;ok not&#x27; &#125;) setTimeout(() =&gt; &#123; // obj.text = &#x27;Vue3 Reactive&#x27; obj.ok = false console.log(&#x27;bucket &#x27;, bucket) &#125;, 1000) // setTimeout(() =&gt; &#123; // console.log(&#x27;æ‰§è¡Œäº†&#x27;) // obj.text = &#x27;Vue3 Reactive&#x27; // &#125;, 3000) &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;","categories":[],"tags":[{"name":"Reactive,Vue3","slug":"Reactive-Vue3","permalink":"http://yoursite.com/tags/Reactive-Vue3/"}]},{"title":"Nginx å®æˆ˜","slug":"nginx","date":"2022-12-17T03:30:00.000Z","updated":"2022-12-17T03:46:00.578Z","comments":true,"path":"/post/nginx.html","link":"","permalink":"http://yoursite.com/post/nginx.html","excerpt":"Never too old to learn.","text":"æŸ¥çœ‹ Nginx å‘½ä»¤æŸ¥çœ‹å®‰è£…ç›®å½• whereis nginx nginx: /usr/bin/nginx æŸ¥çœ‹ nginx è¿›ç¨‹ ps -ef | grep nginx æŸ¥çœ‹ nginx å¯æ‰§è¡Œæ–‡ä»¶ ps -ef | grep nginx /www/server/nginx/conf/nginx.conf è¡¨ç¤ºé…ç½®æ–‡ä»¶ æˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ nginx -t æ¥æŸ¥çœ‹é…ç½®æ–‡ä»¶åœ¨å“ªï¼Œè™½ç„¶è¿™ä¸ªå‘½ä»¤æ˜¯æ£€æµ‹ nginx é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼š 12nginx: the configuration file /www/server/nginx/conf/nginx.conf syntax is oknginx: configuration file /www/server/nginx/conf/nginx.conf test is successful é…ç½®æ–‡ä»¶ nginx.conf å…¨å±€æ¨¡å—worker_processes auto; // è¿›ç¨‹æ•°é‡error_log /www/wwwlogs/nginx_error.log crit; // é”™è¯¯æ—¥å¿—å­˜æ”¾è·¯å¾„pid /www/server/nginx/logs/nginx.pid; // å­˜æ”¾ pid æ–‡ä»¶ eventsworker_connections 51200; // å•ä¸ªè¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°ï¼šè¿æ¥æ•°+è¿›ç¨‹æ•°ï¼‰ http å— include å¼•å…¥å…¶ä»–çš„é…ç½®æ–‡ä»¶ default_type æ–‡ä»¶ç±»å‹ è§£å†³è·¨åŸŸé—®é¢˜é¦–å…ˆå¯åŠ¨ nginx æœåŠ¡ï¼Œè¾“å…¥å‘½ä»¤ nginxï¼Œä¿®æ”¹æ ¹è·¯å¾„ä¸‹çš„ index.html æ–‡ä»¶ 1234567891011121314151617181920212223242526// nginx é…ç½®ï¼Œè®¿é—® localhost:8080/ æ—¶ï¼Œä¼šæ‰“å¼€ index.htmllocation / &#123; root html; index index.html index.htm;&#125;// ä¿®æ”¹index.html&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&lt;button id=&quot;btn&quot;&gt;send&lt;/button&gt;&lt;script&gt; btn.onclick = () =&gt; &#123; const xhr = new XMLHttpRequest() xhr.open(&#x27;GET&#x27;, &#x27;http://localhost:9999/list&#x27;) xhr.onreadystatechange = () =&gt; &#123; if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) &#123; console.log(&#x27;è¿”å›ç»“æœ&#x27;, xhr.responseText) &#125; &#125; xhr.send(null) &#125;&lt;/script&gt;&lt;/body&gt; èµ·ä¸€ä¸ªæœ¬åœ° node æœåŠ¡ 9999 123456789101112const express = require(&#x27;express&#x27;);const app = express()app.get(&#x27;/list&#x27;, (req, res) =&gt; &#123; res.json(&#123; code: 0, msg: &quot;hello server&quot; &#125;)app.listen(9999, () =&gt; &#123; console.log(&#x27;server site an port 9999 ...&#x27;)&#125;) å½“æˆ‘ä»¬ç‚¹å‡»å‘é€æŒ‰é’®æ—¶ï¼Œä¼šå‡ºç°è·¨åŸŸé—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨ åŒæºç­–ç•¥é™åˆ¶ï¼Œåè®®ã€åŸŸåã€ç«¯å£å·ä¸åŒï¼Œä¼šå½¢æˆè·¨åŸŸã€‚ è¿™é‡Œæ˜¯ç«¯å£ä¸åŒã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ nginx æ¥è§£å†³ã€‚ æ‰“å¼€ nginx.confï¼Œæ–°å¢ä¸€æ¡è½¬å‘è§„åˆ™ï¼Œè¡¨ç¤ºé‡åˆ° api å¼€å¤´çš„ï¼Œéƒ½å°†è½¬å‘åˆ°æŸä¸ªæœåŠ¡ä¸‹ æ¯”å¦‚ xhr.open(&#39;GET&#39;, &#39;/api/list&#39;), ä¼šå°† api æ›¿æ¢æˆ http://localhost:9999/ 12345// æ·»åŠ location /api/ &#123; proxy_pass http://localhost:9999/;&#125; ä¿®æ”¹è°ƒç”¨æ¥å£çš„åœ°æ–¹: 1xhr.open(&#x27;GET&#x27;, &#x27;/api/list&#x27;) æ­¤æ—¶ï¼Œå†æ¬¡ç‚¹å‡» å‘é€,ä¸ä¼šå†å‡ºç°è·¨åŸŸäº†ã€‚ Vue Router History æ¨¡å¼ 404 é—®é¢˜Vue é¡¹ç›®ï¼Œé‡‡ç”¨ history çš„è·¯ç”±æ¨¡å¼ï¼Œæ‰“åŒ…åæ”¾åˆ° nginx ä¸Šéƒ¨ç½²ï¼Œåˆ‡æ¢è·¯ç”±æ—¶å‡ºç° 404 ç°è±¡ã€‚ è§£å†³æ–¹æ¡ˆï¼štry_files $uri $uri/ /index.html; 123456location / &#123; root html; index index.html index.htm; try_files $uri $uri/ /index.html;&#125; è´Ÿè½½å‡è¡¡æˆ‘ä»¬å¯ä»¥å»º 3 ä¸ªï¼ˆæˆ–è€…æ›´å¤šï¼‰node æœåŠ¡æ¥æ¨¡æ‹Ÿå®ç°ï¼Œå¯ä»¥é€šè¿‡ count è®¡æ•°ï¼Œæ¥æŸ¥çœ‹æ¯ä¸ªæœåŠ¡è¢«åˆ†é…åˆ°çš„è¯·æ±‚æ•° server1 1234567891011121314151617181920const express = require(&#x27;express&#x27;);const app = express()let count = 1app.get(&#x27;/list&#x27;, (req, res) =&gt; &#123; res.json(&#123; code: 0, msg: &quot;hello server 9999&quot; &#125;) console.log(`server 9999 ------ $&#123;count&#125;`) count++&#125;)app.listen(9999, () =&gt; &#123; console.log(&#x27;server site an port 9999 ...&#x27;)&#125;) é€šè¿‡ pm2 log æŸ¥çœ‹æ—¥å¿— 1234567// package.json&quot;start&quot;: &quot;pm2 start index.js index2.js index3.js --watch&quot;,&quot;stop&quot;: &quot;pm2 stop index.js&quot;,&quot;allList&quot;: &quot;pm2 list&quot;,&quot;monit&quot;: &quot;pm2 monit&quot;,&quot;log&quot;: &quot;pm2 log&quot; server2ã€server3 åªæ˜¯ç«¯å£ä¸ä¸€æ · ä¿®æ”¹ nginx é…ç½®é…ç½®æ ¹è·¯å¾„ï¼Œä»£ç†åˆ°æœ¬åœ°æœåŠ¡ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ nginxï¼Œè®¿é—® http://localhost:8080/ æ—¶ï¼ŒæœåŠ¡ä¼šä»£ç†åˆ°æˆ‘ä»¬é…ç½®çš„ upstream node æœåŠ¡ä¸Šï¼Œè®¿é—® http://localhost:8080/list å³å¯è°ƒç”¨å’±ä»¬å†™å¥½çš„ node æ¥å£ã€‚ 1234567891011upstream node &#123;server 127.0.0.1:9997;server 127.0.0.1:9998;server 127.0.0.1:9999;&#125;server &#123; location / &#123; proxy_pass http://node; // node æ˜¯ upstream æŒ‡å®šçš„ name &#125;&#125; æœ€åæˆ‘ä»¬å¯ä»¥é€šè¿‡ postman æˆ– apifox æ¥è¿›è¡Œå‹æµ‹äº†ã€‚ 1æ¥å£ï¼šhttp://localhost:8080/list è¿™é‡Œè®¾ç½®çš„æ¥å£å¾ªç¯æ¬¡æ•°æ˜¯ 33ï¼Œæ„å‘³ç€æˆ‘ä»¬å°†è¦è°ƒç”¨ 33 æ¬¡æ¥å£ï¼Œè¿è¡Œä¹‹åï¼Œ33æ¬¡å‡å¯ä»¥æˆåŠŸè·‘é€šã€‚ æ¥çœ‹ä¸‹ç»“æœï¼š æ¯ä¸ª server åˆ†é…å‡åŒ€ï¼Œ33æ¬¡ï¼Œæ¯ä¸ªæœåŠ¡åˆ†é…äº† 11 æ¬¡è¯·æ±‚ã€‚ æƒé‡è¿˜å¯ä»¥ç»™æœåŠ¡è®¾ç½®æƒé‡ weightï¼Œæ•°å€¼è¶Šå¤§ï¼Œæƒé‡è¶Šé«˜ï¼Œè¯·æ±‚æ•°è¶Šå¤šã€‚ 123server 127.0.0.1:9997 weight=3;server 127.0.0.1:9998 weight=2;server 127.0.0.1:9999 weight=1; ä¿®æ”¹å®Œé…ç½®åï¼Œé‡å¯ nginx nginx -s reloadï¼Œç»§ç»­è¿è¡Œ apifox å‹æµ‹æ¥å£ï¼š æƒé‡æœ€é«˜çš„ 9997 è¯·æ±‚è¢«åˆ†é…äº† 17 æ¬¡ï¼Œæƒé‡æœ€ä½çš„ 9999 åªåˆ†é…äº† 5 æ¬¡è¯·æ±‚ã€‚ è¶…æ—¶è®¾ç½®è¶…æ—¶å¤‡ç”¨æ¨¡å¼ï¼Œå¦‚æœå­˜åœ¨è¶…æ—¶ï¼Œå°±ä¼šé€‰ç”¨å¤‡ç”¨çš„æœåŠ¡ 9003ï¼Œå¦‚æœä¸å­˜åœ¨è¶…æ—¶è¯·æ±‚ï¼Œåˆ™ä¸ä¼šæœ‰è¯·æ±‚æ‰“åˆ° 9999 æœåŠ¡ä¸Šã€‚ 12345upstream node &#123; server 127.0.0.1:9997 fail_timeout=60; server 127.0.0.1:9998 fail_timeout=20; server 127.0.0.1:9999 backup;&#125; å‚è€ƒèµ„æ–™å°æ»¡ä»‹ç»Nginx â†©å®‰è£…Nginx â†©Nginxç›¸å…³ â†©","categories":[],"tags":[{"name":"Nginx","slug":"Nginx","permalink":"http://yoursite.com/tags/Nginx/"}]},{"title":"åœ¨Linuxä¸Šéƒ¨ç½² Node æ¥å£","slug":"nodejs","date":"2022-12-16T06:00:00.000Z","updated":"2022-12-16T13:55:24.244Z","comments":true,"path":"/post/nodejs.html","link":"","permalink":"http://yoursite.com/post/nodejs.html","excerpt":"Never too old to learn.","text":"è¿æ¥è¿œç¨‹æœåŠ¡å™¨æ‰“å¼€ mac ç»ˆç«¯: 123ssh root@124.221.230.105 (å…¬ç½‘IP)// æ¥ç€è¾“å…¥å¯†ç ï¼Œå³å¯ç™»å½•è¿œç¨‹æœåŠ¡å™¨ ç™»å½•è¿›å»ï¼Œè¾“å…¥ pwdï¼Œä¼šè¾“å‡º /rootï¼Œè¿™æ—¶æˆ‘ä»¬åˆ‡åˆ° â€˜/â€˜ ç›®å½•ä¸‹: cd .. åœ¨è¿œç¨‹å®‰è£… nodejs1wget https://cdn.npmmirror.com/binaries/node/v14.19.1/node-v14.19.1-linux-x64.tar.xz è§£å‹å‹ç¼©åŒ…ä½¿ç”¨ tar å‘½ä»¤ -c å‹ç¼© -x è§£å‹ -t æŸ¥çœ‹å†…å®¹ -r æƒ³å‹ç¼©å½’æ¡£æ–‡ä»¶æœ«å°¾è¿½åŠ æ–‡ä»¶ -v æ˜¾ç¤ºæ‰€æœ‰è¿‡ç¨‹ -f ä½¿ç”¨æ¡£æ¡ˆåå­—ï¼Œåˆ‡è®°ï¼Œè¿™æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œæœ€ååªèƒ½æ¥æ¡£æ¡ˆå 1tar -xvf node-v14.19.1-linux-x64.tar.xz é…ç½®ç¯å¢ƒå˜é‡æ‰¾åˆ°æ ¹ç›®å½• â€˜/â€˜ ä¸‹çš„ etcæ–‡ä»¶å¤¹ï¼Œè¿›å»é‡Œé¢ï¼Œæ‰“å¼€ profile æ–‡ä»¶ï¼Œæ‰“å¼€ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š 12345// &#x27;/&#x27;cd etcvim profile åœ¨æœ€åä¸€è¡ŒåŠ ä¸Šå¦‚ä¸‹è¿™å¥ï¼š 1export PATH=$PATH:/node-v14.19.1-linux-x64/bin æœ€åï¼Œä½¿æ–‡ä»¶ç”Ÿæ•ˆ 12// /etcsource profile æŸ¥çœ‹ node ç‰ˆæœ¬ 123node -vnpm -v å®‰è£… pm21npm install -g pm2 éƒ¨ç½² node æ¥å£åœ¨æ ¹ç›®å½•ä¸‹ /ï¼Œåˆ›å»º node-server æ–‡ä»¶å¤¹ å¯ä»¥é€šè¿‡ express å»ºç«‹ä¸€ä¸ª node æœåŠ¡ 123456789101112131415const express = require(&quot;express&quot;);const app = express()app.get(&#x27;/list&#x27;, (req, res) =&gt; &#123; console.log(&#x27;current IP&#x27;, req.ip) res.json(&#123; code: 200, msg: &#x27;linux node server&#x27; &#125;)&#125;)app.listen(9999, () =&gt; &#123; console.log(&#x27;node server at port 9999...&#x27;)&#125;) é€šè¿‡ pm2 å¯åŠ¨nodeæœåŠ¡12// node-serverpm2 start index.js --watch é€šè¿‡ pm2 monit æŸ¥çœ‹ node æœåŠ¡çš„æ‰“å°æ—¥å¿— æ³¨æ„è®¿é—®æ¥å£ï¼Œå¦‚æœæ‰“ä¸å¼€ï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºæ²¡æœ‰æ”¾å¼€é˜²ç«å¢™ã€‚ http://124.221.230.105:9999/list æ‰¾åˆ°æœåŠ¡å™¨åœ°å€ï¼Œæ”¾å¼€ node æœåŠ¡å¯¹åº”çš„ç«¯å£å· æ­¤æ—¶ä¾ç„¶æ— æ³•æ‰“å¼€å¯¹åº”çš„æ¥å£ ç™»å½•æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹é˜²ç«å¢™æ‰€æœ‰çš„ç«¯å£ firewall-cmd â€“zone=public â€“list-ports æ·»åŠ æ–°çš„ç«¯å£ firewall-cmd â€“zone=public â€“add-port=9999/tcp â€“permanent åˆ é™¤ firewall-cmd â€“zone=public â€“remove-port=9999/tcp â€“permanent è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ é‡å¯é˜²ç«å¢™ firewall-cmd â€“reload è‡³æ­¤ï¼Œå°±å¯ä»¥è®¿é—®æœåŠ¡å™¨ä¸Š node æœåŠ¡çš„æ¥å£äº†ã€‚ å‚è€ƒèµ„æ–™å°æ»¡Linuxä»‹ç» â†©","categories":[],"tags":[{"name":"Nodejs","slug":"Nodejs","permalink":"http://yoursite.com/tags/Nodejs/"}]},{"title":"Vue Router 4+","slug":"vue-router4","date":"2022-12-16T04:22:00.000Z","updated":"2022-12-16T04:39:36.629Z","comments":true,"path":"/post/vue-router4.html","link":"","permalink":"http://yoursite.com/post/vue-router4.html","excerpt":"å¯Œæœ‰è¡¨ç°åŠ›çš„è·¯ç”±è¯­æ³•ã€ç»†è‡´çš„å¯¼èˆªæ§åˆ¶ã€åŸºäºç»„ä»¶çš„é…ç½®æ–¹æ³•ã€æ”¯æŒå†å²æ¨¡å¼ã€ æ”¯æŒæ»šåŠ¨æ§åˆ¶ã€æ”¯æŒè‡ªåŠ¨ç¼–ç ","text":"Vue Routerhistory1234const router = VueRouter.createRouter(&#123; history: VueRouter.createWebHashHistory(), // hash æ¨¡å¼ routes,&#125;) hash æ¨¡å¼åº•å±‚æ˜¯é€šè¿‡ hashchange ç›‘å¬çš„ï¼š 1window.addEventListener(&#x27;hashchange&#x27;, () =&gt; &#123; ... &#125;) history æ¨¡å¼ (createWebHistory)ï¼Œåº•å±‚æ˜¯é€šè¿‡ popstate ç›‘å¬çš„: 1window.addEventListener(&#x27;popstate&#x27;, () =&gt; &#123; ... &#125;) åœ¨ setup ä¸­è®¿é—®è·¯ç”±å’Œå½“å‰è·¯ç”±å› ä¸ºæˆ‘ä»¬åœ¨ setup é‡Œé¢æ²¡æœ‰è®¿é—® thisï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å†ç›´æ¥è®¿é—® this.$router æˆ– this.$routeã€‚ 1234567891011121314151617import &#123; useRouter, useRoute &#125; from &#x27;vue-router&#x27;export default &#123; setup() &#123; const router = useRouter() const route = useRoute() function pushWithQuery(query) &#123; router.push(&#123; name: &#x27;search&#x27;, query: &#123; ...route.query, &#125;, &#125;) &#125; &#125;,&#125; route å¯¹è±¡æ˜¯ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒçš„ä»»ä½•å±æ€§éƒ½å¯ä»¥è¢«ç›‘å¬ï¼Œä½†ä½ åº”è¯¥é¿å…ç›‘å¬æ•´ä¸ª route å¯¹è±¡ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ç›´æ¥ç›‘å¬ä½ æœŸæœ›æ”¹å˜çš„å‚æ•°ã€‚ è¯·æ³¨æ„ï¼Œåœ¨æ¨¡æ¿ä¸­æˆ‘ä»¬ä»ç„¶å¯ä»¥è®¿é—® $router å’Œ $routeï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨ setup ä¸­è¿”å› router æˆ– routeã€‚","categories":[],"tags":[{"name":"JS,Vue-Router,Vue3,","slug":"JS-Vue-Router-Vue3","permalink":"http://yoursite.com/tags/JS-Vue-Router-Vue3/"}]},{"title":"æ·±å…¥æµ…å‡ºVue3","slug":"vue3","date":"2022-12-01T10:09:04.000Z","updated":"2022-12-23T14:57:41.953Z","comments":true,"path":"/post/vue3.html","link":"","permalink":"http://yoursite.com/post/vue3.html","excerpt":"æ¸è¿›å¼ JavaScript æ¡†æ¶ã€‚æ˜“å­¦æ˜“ç”¨ï¼Œæ€§èƒ½å‡ºè‰²ï¼Œé€‚ç”¨åœºæ™¯ä¸°å¯Œçš„ Web å‰ç«¯æ¡†æ¶","text":"ref å’Œ reactive ä½¿ç”¨ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«? ref æ”¯æŒæ‰€æœ‰çš„ç±»å‹ï¼Œreactive åªæ¥æ”¶å¼•ç”¨ç±»å‹ï¼ˆArray/Object/Map/Setï¼‰ ref å–å€¼å’Œèµ‹å€¼éƒ½éœ€è¦åŠ  .valueï¼Œreactive ä¸éœ€è¦ .value reactive ä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Œå¦åˆ™ä¼šç ´åå“åº”å¼ï¼ˆproxyï¼‰ å¦‚æœè¦æ”¹å˜æ•°ç»„ï¼Œå¯ä»¥é€šè¿‡ push æ–¹æ³•ï¼Œå°†è¦ push çš„æ•°ç»„ç»“æ„ (xx.push(â€¦arr)) å¦‚ä½•æŠ‰æ‹©å‘¢ï¼Ÿå› ä¸ºç¤¾åŒºå¤§ä½¬ basvanmeursæå‡ºäº†ä¸€ä¸ªæ–°çš„ PRï¼Œå¤§æ¦‚å°±æ˜¯é‡æ„äº†å“åº”å¼çš„éƒ¨åˆ†å†…å®¹ï¼Œç”±äºé‡æ„å†…å®¹è¿‡äºåºå¤§ï¼Œæ‰€ä»¥ä¸€ç›´ç­‰åˆ° 2021 å¹´ 8 æœˆ 5 å·ï¼Œä¼´éšç€ Vue3.2 çš„å‘å¸ƒï¼Œå°¤å¤§å¤§æ‰åˆå¹¶å¯¹åº”çš„ä»£ç ã€‚ ref è¢«é‡æ„ä¹‹åï¼Œæœ‰äº†æ›´é«˜æ•ˆçš„å®ç°ï¼ˆæå‡äº† çº¦ 260% çš„è¯»å–é€Ÿåº¦ / çº¦ 50% çš„å†™å…¥é€Ÿåº¦ï¼‰ï¼Œä¾èµ–è·Ÿè¸ªé€Ÿåº¦æé«˜äº†çº¦ 40%ï¼Œå†…å­˜ä½¿ç”¨é‡å‡å°‘äº†çº¦ 17%ï¼Œæ¯«æ— ç–‘é—®è¿™æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„å˜åŒ–ã€‚ é‚£ä¹ˆï¼Œåœ¨ä»¥åçš„ä½¿ç”¨è¿‡ç¨‹å½“ä¸­ï¼Œèƒ½ä½¿ç”¨ ref å°±ç”¨ refå§ï¼Œæ¯•ç«Ÿå®ƒçš„æ€§èƒ½å¾—åˆ°äº†å¦‚æ­¤å¤§çš„æå‡ã€‚ defineProps å¦‚ä½•å®šä¹‰é»˜è®¤å€¼ï¼Ÿ é’ˆå¯¹ç±»å‹çš„ defineProps å£°æ˜çš„ä¸è¶³ä¹‹å¤„åœ¨äºï¼Œå®ƒæ²¡æœ‰å¯ä»¥ç»™ props æä¾›é»˜è®¤å€¼çš„æ–¹å¼ã€‚ ä½¿ç”¨TS ç‰¹æœ‰çš„é»˜è®¤å€¼æ–¹å¼ withDefaults å‡½æ•°ï¼Œæ— é¡»å¼•å…¥å¼€ç®±å³ç”¨ï¼Œæ¥å—ä¸€ä¸ªpropså‡½æ•°ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡è®¾ç½®é»˜è®¤å€¼ã€‚ 123456789export interface Props &#123; msg?: string labels?: string[]&#125;const props = withDefaults(defineProps&lt;Props&gt;(), &#123; msg: &#x27;hello&#x27;, labels: () =&gt; [&#x27;one&#x27;, &#x27;two&#x27;]&#125;) æ³¨æ„ å¦‚æœä½¿ç”¨ withDefaults æŠ¥é”™ &#39;withDefaults&#39; is not definedï¼Œæˆ‘ä»¬ä¿®æ”¹ .eslintrc æ–‡ä»¶ æ·»åŠ å¦‚ä¸‹é…ç½®ä»£ç ï¼š 123globals: &#123; withDefaults: &#x27;readonly&#x27;&#125;, åŠ¨æ€ç»„ä»¶ component è¦æ¸²æŸ“çš„å®é™…ç»„ä»¶ç”± is prop å†³å®šã€‚ å½“ is æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒæ—¢å¯ä»¥æ˜¯ HTML æ ‡ç­¾åä¹Ÿå¯ä»¥æ˜¯ç»„ä»¶çš„æ³¨å†Œåã€‚ æˆ–è€…ï¼Œis ä¹Ÿå¯ä»¥ç›´æ¥ç»‘å®šç»„ä»¶ã€‚ æŒ‰æ³¨å†Œåæ¸²æŸ“ç»„ä»¶ 1234567891011121314151617&lt;script&gt;import Foo from &#x27;./Foo.vue&#x27;import Bar from &#x27;./Bar.vue&#x27;export default &#123; components: &#123; Foo, Bar &#125;, data() &#123; return &#123; view: &#x27;Foo&#x27; &#125; &#125;&#125;&lt;/script&gt;&lt;template&gt; &lt;component :is=&quot;view&quot; /&gt;&lt;/template&gt; æŒ‰å®šä¹‰æ¸²æŸ“ç»„ä»¶ &lt;script setup&gt; ç»„åˆå¼ APIï¼š 1&lt;component :is=&quot;Math.random() &gt; 0.5 ? Foo : Bar&quot; /&gt; æ¸²æŸ“ HTML å…ƒç´  1&lt;component :is=&quot;href ? &#x27;a&#x27; : &#x27;span&#x27;&quot;&gt;&lt;/component&gt; æ’æ§½é»˜è®¤æ’æ§½ã€å…·åæ’æ§½ã€‚ ä½œç”¨åŸŸæ’æ§½ï¼š:headerName=&quot;&#39;æˆ‘æ˜¯å¤´éƒ¨&#39;&quot;ï¼Œçˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡ v-slot=&quot;&#123; headerName &#125;&quot; æ‹¿åˆ°ç»„ä»¶å†…éƒ¨æš´éœ²å‡ºæ¥çš„æ•°æ® 1234567891011121314// SlotComp.vue&lt;template&gt; &lt;div class=&quot;slot-wrapper&quot;&gt; &lt;header class=&quot;header&quot;&gt; &lt;slot name=&quot;header&quot; :headerName=&quot;&#x27;æˆ‘æ˜¯å¤´éƒ¨&#x27;&quot;&gt;&lt;/slot&gt; &lt;/header&gt; &lt;main class=&quot;content&quot;&gt; &lt;slot&gt;&lt;/slot&gt; &lt;/main&gt; &lt;footer class=&quot;footer&quot;&gt; &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt; &lt;/footer&gt; &lt;/div&gt;&lt;/template&gt; ä½¿ç”¨å…·æœ‰æ’æ§½çš„ç»„ä»¶ï¼ŒheaderName æ˜¯ä½œç”¨åŸŸæ’æ§½ä»å†…éƒ¨æä¾›çš„ 12345&lt;SlotComp&gt; &lt;template v-slot:header=&quot;&#123; headerName &#125;&quot;&gt;&#123;&#123; headerName &#125;&#125;&lt;/template&gt; &lt;template v-slot&gt;default slot&lt;/template&gt; &lt;template v-slot:footer&gt;footer&lt;/template&gt;&lt;/SlotComp&gt; æ’æ§½ç®€å†™æ–¹å¼ # 12345&lt;SlotComp&gt; &lt;template #header=&quot;&#123; headerName &#125;&quot;&gt;&#123;&#123; headerName &#125;&#125;&lt;/template&gt; &lt;template #default&gt;default slot&lt;/template&gt; &lt;template #footer&gt;footer&lt;/template&gt;&lt;/SlotComp&gt; åŠ¨æ€æ’æ§½ 1234567&lt;SlotComp&gt; &lt;template #[slotName]&gt;åŠ¨æ€æ’æ§½&lt;/template&gt;&lt;/SlotComp&gt;// jsconst slotName = ref(&#x27;header&#x27;) å¼‚æ­¥ç»„ä»¶å®˜æ–¹æè¿° åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ‹†åˆ†åº”ç”¨ä¸ºæ›´å°çš„å—ï¼Œå¹¶ä»…åœ¨éœ€è¦æ—¶å†ä»æœåŠ¡å™¨åŠ è½½ç›¸å…³ç»„ä»¶ã€‚Vue æä¾›äº† defineAsyncComponent æ–¹æ³•æ¥å®ç°æ­¤åŠŸèƒ½ï¼š 12345678import &#123; defineAsyncComponent &#125; from &#x27;vue&#x27;const AsyncComp = defineAsyncComponent(() =&gt; &#123; return new Promise((resolve, reject) =&gt; &#123; // ...ä»æœåŠ¡å™¨è·å–ç»„ä»¶ resolve(/* è·å–åˆ°çš„ç»„ä»¶ */) &#125;)&#125;) ES æ¨¡å—åŠ¨æ€å¯¼å…¥ ä¹Ÿä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œæ‰€ä»¥å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå°†å®ƒå’Œ defineAsyncComponent æ­é…ä½¿ç”¨ã€‚ç±»ä¼¼ Vite å’Œ Webpack è¿™æ ·çš„æ„å»ºå·¥å…·ä¹Ÿæ”¯æŒæ­¤è¯­æ³• (å¹¶ä¸”ä¼šå°†å®ƒä»¬ä½œä¸ºæ‰“åŒ…æ—¶çš„ä»£ç åˆ†å‰²ç‚¹ åˆ†åŒ…ã€æ€§èƒ½ä¼˜åŒ–) 12345import &#123; defineAsyncComponent &#125; from &#x27;vue&#x27;const AsyncComp = defineAsyncComponent(() =&gt; import(&#x27;./components/MyComponent.vue&#x27;)) æœ€åå¾—åˆ°çš„ AsyncComp æ˜¯ä¸€ä¸ªå¤–å±‚åŒ…è£…è¿‡çš„ç»„ä»¶ï¼Œä»…åœ¨é¡µé¢éœ€è¦å®ƒæ¸²æŸ“æ—¶ æ‰ä¼šè°ƒç”¨åŠ è½½å†…éƒ¨å®é™…ç»„ä»¶çš„å‡½æ•°ã€‚ é¡¶å±‚ await&lt;script setup&gt; ä¸­å¯ä»¥ä½¿ç”¨é¡¶å±‚ awaitã€‚ç»“æœä»£ç ä¼šè¢«ç¼–è¯‘æˆ async setup()ï¼š 123&lt;script setup&gt;const post = await fetch(`/api/post/1`).then((r) =&gt; r.json())&lt;/script&gt; æ­é… Suspense ç»„ä»¶ä½¿ç”¨ å®šä¹‰å¼‚æ­¥ç»„ä»¶ Sync.vue 123456789101112131415&lt;template&gt; &lt;div&gt; Name: &#123;&#123; name &#125;&#125; &lt;/div&gt;&lt;/template&gt;&lt;script setup lang=&#x27;ts&#x27;&gt;import &#123;ref, reactive&#125; from &#x27;vue&#x27;import iTools from &#x27;@/utils/Tools&#x27;const name = ref(&#x27;&#x27;)const &#123; data &#125; = await iTools.Axios.get(&#x27;./sync-data.json&#x27;) // å®šä¹‰åœ¨ public ä¸‹çš„jsonæ–‡ä»¶name.value = data.name&lt;/script&gt; é€šè¿‡ defineAsyncComponent åŠ¨æ€å¯¼å…¥ Sync.vue ç»„ä»¶ 1const Sync = defineAsyncComponent(() =&gt; import(&#x27;@/components/Sync.vue&#x27;)) ä½¿ç”¨ Suspense å†…ç½®ç»„ä»¶ åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œä¼šä¸€ç›´æ˜¾ç¤º loadingâ€¦ çŠ¶æ€ï¼ŒçœŸå®é¡¹ç›®ä¸­æˆ‘ä»¬å¯ä»¥æ›¿æ¢æˆéª¨æ¶å±ã€‚å½“æ¥å£è¯·æ±‚æˆåŠŸï¼Œæ‰ä¼šæ˜¾ç¤º Sync.vue çš„å†…å®¹ã€‚ 123456789&lt;Suspense&gt; &lt;template #default&gt; &lt;Sync /&gt; &lt;/template&gt; &lt;template #fallback&gt; Loading... &lt;/template&gt;&lt;/Suspense&gt; æ€§èƒ½ä¼˜åŒ–å½“æˆ‘ä»¬ä½¿ç”¨äº† defineAsyncComponent åŠ¨æ€å¯¼å…¥ç»„ä»¶ï¼Œbuild é¡¹ç›®æ—¶ï¼Œä¼šå•ç‹¬å°† Sync.vue çš„ js åŒ…æ‹å‡ºæ¥ï¼Œä¸ä¼šå°†å…¶æ‰“åŒ…åˆ°index.js ä¸­ï¼Œé€šè¿‡æ‹†åŒ…çš„æ–¹å¼ï¼Œå‡å°‘å…¥å£æ–‡ä»¶çš„å¤§å°ï¼Œä»è€Œå‡å°‘ç™½å±çš„æ—¶é—´ã€‚ Teleport ä¼ é€é—¨å°†å…¶æ’æ§½å†…å®¹æ¸²æŸ“åˆ° DOM ä¸­çš„å¦ä¸€ä¸ªä½ç½®ã€‚ 12345678910111213141516171819interface TeleportProps &#123; /** * å¿…å¡«é¡¹ã€‚æŒ‡å®šç›®æ ‡å®¹å™¨ã€‚ * å¯ä»¥æ˜¯é€‰æ‹©å™¨æˆ–å®é™…å…ƒç´ ã€‚ */ to: string | HTMLElement /** * å½“å€¼ä¸º `true` æ—¶ï¼Œå†…å®¹å°†ä¿ç•™åœ¨å…¶åŸå§‹ä½ç½® * è€Œä¸æ˜¯ç§»åŠ¨åˆ°ç›®æ ‡å®¹å™¨ä¸­ã€‚ * å¯ä»¥åŠ¨æ€æ›´æ”¹ã€‚ */ disabled?: boolean&#125;// examples&lt;teleport to=&quot;#some-id&quot; /&gt;&lt;teleport to=&quot;.some-class&quot; /&gt;&lt;teleport to=&quot;[data-teleport]&quot; /&gt;&lt;teleport to=&quot;body&quot; /&gt; MittVue 2å¯ä»¥æ”¯æŒ$onï¼Œ$offæ¥å®ç°event busï¼Œä½†æ˜¯ Vue3 å·²ç»ä¸æ”¯æŒè¿™äº›å±æ€§ï¼Œä¸è¿‡Vue 3å¯ä»¥æ”¯æŒç¬¬ä¸‰æ–¹event busæ¥å®ç°äº‹ä»¶é€šä¿¡ï¼Œ è¿™é‡Œä½¿ç”¨ mittï¼Œå®˜æ–¹åœ°å€ï¼šhttps://github.com/developit/mitt 1234import mitt from &#x27;mitt&#x27;// vue3æŒ‚è½½åˆ°å…¨å±€app.config.globalProperties.$mitt = mitt() tsx å®‰è£…æ’ä»¶ npm install @vitejs/plugin-vue-jsx -D å®‰è£…å¦‚æœå¤±è´¥ï¼Œå°† node ç‰ˆæœ¬åˆ‡æ¢è‡³ v14.16.0 ä½¿ç”¨æ’ä»¶ 123456import vueJsx from &quot;@vitejs/plugin-vue-jsx&quot;;export default defineConfig(&#123; plugins: [vue(), vueJsx()], // ...&#125;) ä½†æ˜¯å¯¼å…¥ .tsx æ–‡ä»¶ï¼ŒTypeScript ä¼šæŠ¥é”™ï¼š 12345// æ‰¾ä¸åˆ°æ¨¡å—â€œ@/components/Fooâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜ã€‚import Foo from &#x27;@/components/Foo&#x27; // çœç•¥äº† .tsx åç¼€// å¯¼å…¥è·¯å¾„ä¸èƒ½ä»¥â€œ.tsxâ€æ‰©å±•åç»“æŸã€‚è€ƒè™‘æ”¹ä¸ºå¯¼å…¥â€œ@/components/Bar.jsâ€ã€‚import Bar from &#x27;@/components/Bar.tsx&#x27; é…ç½® tsconfig.json: 12345678&#123; &quot;compilerOptions&quot;: &#123; &quot;baseUrl&quot;: &quot;.&quot;, &quot;paths&quot;: &#123; &quot;@/*&quot;: [&quot;src/*&quot;] &#125;, &#125;&#125; ä¹‹åæˆ‘ä»¬å¯¼å…¥ tsx ç±»å‹çš„ç»„ä»¶ï¼Œå°±ä¸è¦å¸¦ä¸Šåç¼€äº†ã€‚ ç¼–å†™ tsx ç»„ä»¶çš„3ä¸­æ–¹å¼ å‡½æ•°æ¨¡å¼ 12345export default function() &#123; return ( &lt;h1&gt;TSX componen111t&lt;/h1&gt; )&#125; options API æ¨¡å¼ 1234567891011121314import &#123; defineComponent &#125; from &#x27;vue&#x27;export default defineComponent(&#123; data() &#123; return &#123; compname: &#x27;jsx comp&#x27; &#125; &#125;, render() &#123; return ( &lt;div&gt;&#123;this.compname&#125;&lt;/div&gt; ) &#125;&#125;) setup å‡½æ•°æ¨¡å¼ 1234567891011121314151617181920interface IProps &#123; name?: string;&#125;export default defineComponent(&#123; props: &#123; name: String, &#125;, emits: [&#x27;on-click&#x27;], setup(props: IProps) &#123; const is = true // è¿”å›æ¸²æŸ“å‡½æ•° return () =&gt; &#123; return ( &lt;h1 v-show=&#123;is&#125;&gt;setup æ¸²æŸ“å‡½æ•° &#123;props?.name&#125;&lt;/h1&gt; ) &#125; &#125;&#125;) tsx slot ä½¿ç”¨12345678910111213141516171819const Foo = (_, &#123; slots &#125;) =&gt; &#123; return (&lt;&gt; &lt;p&gt;&#123; slots?.header?.()&#125;&lt;/p&gt; &lt;h3&gt;slot comp&lt;/h3&gt; &lt;p&gt;&#123; slots.default ? slots.default() : &#x27;é»˜è®¤æ’æ§½&#x27; &#125;&lt;/p&gt; &lt;/&gt;)&#125;&lt;Foo v-slots=&#123;&#123; default() &#123; return &#x27;setup default slot&#x27; &#125;, header() &#123; return &#x27;header&#x27; &#125;&#125;&#125; /&gt; è‡ªåŠ¨å¼•å…¥ å®‰è£…æ’ä»¶ unplugin-auto-import/vite https://github.com/antfu/unplugin-auto-import æ³¨å†Œå®Œ plugin ä¹‹åï¼Œä¸å†å¼•å…¥ ref, reactive ç­‰ç­‰æ–¹æ³•äº†ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚ v-model å®˜ç½‘ï¼šhttps://cn.vuejs.org/guide/components/events.html v-model åœ¨åŸç”Ÿå…ƒç´ ä¸Šçš„ç”¨æ³•ï¼š 12345678&lt;input v-model=&quot;searchText&quot; /&gt;// ç­‰ä»·äº&lt;input :value=&quot;searchText&quot; @input=&quot;searchText = $event.target.value&quot;/&gt; è€Œå½“ä½¿ç”¨åœ¨ä¸€ä¸ªç»„ä»¶ä¸Šæ—¶ï¼Œv-model ä¼šè¢«å±•å¼€ä¸ºå¦‚ä¸‹çš„å½¢å¼ï¼š 123456789101112131415161718&lt;CustomInput :modelValue=&quot;searchText&quot; @update:modelValue=&quot;newValue =&gt; searchText = newValue&quot;/&gt;// å†…éƒ¨å®šä¹‰ props å’Œ æ–¹æ³•const props = defineProps&lt;&#123; modelValue: boolean&#125;&gt;()const emits = defineEmits([&#x27;update:modelValue&#x27;])// è°ƒç”¨emits(&#x27;update:modelValue&#x27;, !props.modelValue) å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™ v-model æŒ‡å®šä¸€ä¸ªå‚æ•°ï¼Œä¸ä½¿ç”¨é»˜è®¤çš„ modelValue: 12345&lt;MyComponent v-model:title=&quot;bookTitle&quot; /&gt;// å®šä¹‰ propsdefineProps([&#x27;title&#x27;])defineEmits([&#x27;update:title&#x27;]) æˆ‘ä»¬è¿˜å¯ä»¥ç»‘å®šå¤šä¸ª v-model: 1234&lt;UserName v-model:first-name=&quot;first&quot; v-model:last-name=&quot;last&quot;/&gt; è‡ªå®šä¹‰æŒ‡ä»¤ https://cn.vuejs.org/guide/reusability/custom-directives.html 12345678910111213141516171819const myDirective = &#123; // åœ¨ç»‘å®šå…ƒç´ çš„ attribute å‰ // æˆ–äº‹ä»¶ç›‘å¬å™¨åº”ç”¨å‰è°ƒç”¨ created(el, binding, vnode, prevVnode) &#123;&#125;, // åœ¨å…ƒç´ è¢«æ’å…¥åˆ° DOM å‰è°ƒç”¨ beforeMount(el, binding, vnode, prevVnode) &#123;&#125;, // åœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶ // åŠä»–è‡ªå·±çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æŒ‚è½½å®Œæˆåè°ƒç”¨ mounted(el, binding, vnode, prevVnode) &#123;&#125;, // ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶æ›´æ–°å‰è°ƒç”¨ beforeUpdate(el, binding, vnode, prevVnode) &#123;&#125;, // åœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶ // åŠä»–è‡ªå·±çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æ›´æ–°åè°ƒç”¨ updated(el, binding, vnode, prevVnode) &#123;&#125;, // ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶å¸è½½å‰è°ƒç”¨ beforeUnmount(el, binding, vnode, prevVnode) &#123;&#125;, // ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶å¸è½½åè°ƒç”¨ unmounted(el, binding, vnode, prevVnode) &#123;&#125;&#125; 123456789&lt;div v-example:foo.bar=&quot;baz&quot;&gt;// binding å‚æ•°ä¼šæ˜¯ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼š&#123; arg: &#x27;foo&#x27;, modifiers: &#123; bar: true &#125;, value: /* `baz` çš„å€¼ */, oldValue: /* ä¸Šä¸€æ¬¡æ›´æ–°æ—¶ `baz` çš„å€¼ */&#125; å…¨å±€å‡½æ•°æˆ–å˜é‡åœ¨ Vue2 ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å°†å…¨å±€ç”¨åˆ°çš„å‡½æ•°å®šä¹‰åœ¨ Vue çš„ prototype ä¸Šï¼Œåœ¨ Vue3 ä¸­å·²ç»ä¸è¿™æ ·ä½¿ç”¨äº†: 123456789const app = createApp(App)app.config.globalProperties.$env = &#x27;dev&#x27;app.config.globalProperties.$filters = &#123; format&lt;T&gt;(str: T): string &#123; return str.trim() &#125;&#125; æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸éœ€è¦å¯¼å…¥ä»€ä¹ˆï¼Œç›´æ¥åœ¨ .vue æ–‡ä»¶ä½¿ç”¨å³å¯: 12345678&lt;div&gt;env &#123;&#123;$env&#125;&#125;&lt;/div&gt;&lt;script setup lang=&quot;ts&quot;&gt; const app = getCurrentInstance() console.log(app?.proxy?.$filters.format(&#x27;getCurrentInstance&#x27;))&lt;/script&gt; åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å…¨å±€çš„å˜é‡æˆ–è€…å‡½æ•°æ—¶ï¼Œä¼šå‡ºç° ts æŠ¥é”™ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å»å£°æ˜å®ƒçš„ç±»å‹: 12345678declare module &#x27;vue&#x27; &#123; export interface ComponentCustomProperties &#123; $filters: &#123; format&lt;T&gt;(str: T): string, &#125;, $env: string, &#125;&#125; è‡ªå®šä¹‰æ’ä»¶ ä¸€ä¸ªæ’ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªæ‹¥æœ‰ install() æ–¹æ³•çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ˜¯ä¸€ä¸ªå®‰è£…å‡½æ•°æœ¬èº«ã€‚ æ’ä»¶æ²¡æœ‰ä¸¥æ ¼å®šä¹‰çš„ä½¿ç”¨èŒƒå›´ï¼Œä½†æ˜¯æ’ä»¶å‘æŒ¥ä½œç”¨çš„å¸¸è§åœºæ™¯ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š é€šè¿‡ app.component() å’Œ app.directive() æ³¨å†Œä¸€åˆ°å¤šä¸ªå…¨å±€ç»„ä»¶æˆ–è‡ªå®šä¹‰æŒ‡ä»¤ã€‚ é€šè¿‡ app.provide() ä½¿ä¸€ä¸ªèµ„æºå¯è¢«æ³¨å…¥è¿›æ•´ä¸ªåº”ç”¨ã€‚ å‘ app.config.globalProperties ä¸­æ·»åŠ ä¸€äº›å…¨å±€å®ä¾‹å±æ€§æˆ–æ–¹æ³• ä»¥ä¸€ä¸ªå…¨å±€çš„ Loading ç»„ä»¶ä¸ºä¾‹ï¼š 12345678910111213141516171819202122// Loading/index.tsimport type &#123; App, VNode &#125; from &#x27;vue&#x27;import &#123; createVNode, render &#125; from &#x27;vue&#x27;import Loading from &#x27;./index.vue&#x27;export default &#123; install (app: App) &#123; // Loading éœ€è¦è½¬æˆ VNode const VNode: VNode = createVNode(Loading) // å°†ç»„ä»¶æŒ‚åœ¨åˆ°æŸä¸ªå…ƒç´ ä¸‹ render(VNode, document.body) // Loading ç»„ä»¶é€šè¿‡ defineExpose æ–¹æ³•ï¼Œæš´éœ²å†…éƒ¨æ–¹æ³•ä¼šåœ¨ exposed å­—æ®µä¸Š app.config.globalProperties.$loading = &#123; onShow: VNode.component?.exposed?.onShow, onHide: VNode.component?.exposed?.onHide &#125; &#125;&#125; Loading ç»„ä»¶å†…éƒ¨å®ç° 1234567891011121314151617181920212223242526272829303132&lt;template&gt; &lt;div class=&quot;loading&quot; v-if=&quot;show&quot; @click=&quot;onHide&quot;&gt; &lt;img src=&quot;../../assets/imgs/loading.gif&quot; alt=&quot;&quot; /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup lang=&#x27;ts&#x27;&gt;import &#123;ref, reactive&#125; from &#x27;vue&#x27;const show = ref(false)const onShow = () =&gt; show.value = trueconst onHide = () =&gt; show.value = false// æš´éœ²å†…éƒ¨æ–¹æ³•ä¾›å¤–éƒ¨è°ƒç”¨defineExpose(&#123; onShow, onHide,&#125;)&lt;/script&gt;&lt;style scoped lang=&quot;less&quot;&gt;.loading &#123; width: 100%; height: 100%; background-color: #1f2123; position: absolute; top: 0; left: 0; text-align: center;&#125;&lt;/style&gt; è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ å…¨å±€ Loading äº†ã€‚ 123456789// setupconst instance = getCurrentInstance()const showLoading = () =&gt; &#123; instance?.proxy?.$loading.onShow()&#125;// or ç›´æ¥åœ¨ template ä¸­ä½¿ç”¨&lt;button @click=&quot;$loading.onShow&quot;&gt;show loading&lt;/button&gt; å¦‚æœè°ƒç”¨ $loading æŠ¥tsé”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜å…¨å±€ç±»å‹ 12345678declare module &#x27;vue&#x27; &#123; export interface ComponentCustomProperties &#123; $loading: &#123; onShow(): void; onHide(): void; &#125; &#125;&#125; ScopedåŸç† &amp; æ ·å¼ç©¿é€ ç»™ HTML DOMèŠ‚ç‚¹åŠ ä¸€ä¸ªä¸é‡å¤çš„ data å±æ€§ï¼ˆå½¢å¦‚: data-v-xxxxxï¼‰ï¼Œæ¥è¡¨ç¤ºå®ƒçš„å”¯ä¸€æ€§ åœ¨æ¯å¥ CSS é€‰æ‹©å™¨çš„æœ«å°¾ï¼ŒåŠ ä¸€ä¸ªå½“å‰ç»„ä»¶çš„ data å±æ€§é€‰æ‹©å™¨ï¼Œæ¥ç§æœ‰åŒ–æ ·å¼ å¦‚æœç»„ä»¶å†…éƒ¨åŒ…å«å…¶ä»–ç»„ä»¶ï¼Œåªä¼šç»™å…¶ä»–ç»„ä»¶çš„æœ€å¤–å±‚æ ‡ç­¾åŠ ä¸Šå½“å‰ç»„ä»¶çš„ data å±æ€§. æƒ³è¦ç›´æ¥ä¿®æ”¹å¼€æºç»„ä»¶çš„æ ·å¼ï¼Œå¤§æ¦‚ç‡æ˜¯å¤±è´¥çš„ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯è¦ä½¿ç”¨æ ·å¼ç©¿é€ 123456789/deep/ .input &#123; ...&#125;// or:deep(.input) &#123; ...&#125; cssæ–°ç‰¹æ€§æ’æ§½é€‰æ‹©å™¨æˆ‘ä»¬åœ¨ä½¿ç”¨æ’æ§½æ—¶ï¼Œå¦‚ä½•åœ¨å­ç»„ä»¶ä¸­ä¿®æ”¹æ’æ§½å†…å®¹çš„æ ·å¼ 123:slotted(.p-footer) &#123; color: red;&#125; å®šä¹‰å…¨å±€æ ·å¼123:global(div) &#123; color: red;&#125; åŠ¨æ€ css123456789101112// jsconst color = ref(&#x27;red&#x27;)const font = ref(&#123; fontSize: &#x27;24px&#x27;, fontWeight: &#x27;bold&#x27;,&#125;)// css.box &#123; color: v-bind(color); font-size: v-bind(&#x27;font.fontSize&#x27;);&#125; æ¨¡å—åŒ– cssç»™ style æ ‡ç­¾åŠ ä¸Š module å±æ€§ 123456789101112// template// å¦‚æœæœ‰å¤šä¸ªï¼Œå°±å†™æˆæ•°ç»„å½¢å¼&lt;div :class=&quot;[$style.box]&quot;&gt; æ¨¡å— css&lt;/div&gt;// css&lt;style module&gt;.box &#123; color: red&#125;&lt;/style&gt; $style æ˜¯å›ºå®šçš„å†™æ³•ï¼Œå¦‚æœä¸æƒ³ç”¨è¿™ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š module=&quot;myStyle&quot; ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ useCssModule è·å–å½“å‰ç»„ä»¶ä¸‹çš„æ ·å¼ç±»å 123456// é»˜è®¤const class = useCssModule()const class = useCssModule(&#x27;$style&#x27;)// å¦‚æœæŒ‡å®šäº† moduleconst class = useCssModule(&#x27;myStyle&#x27;) é›†æˆ Tailwind CSS https://blog.csdn.net/qq1195566313/article/details/124951311?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167109189716782427434983%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167109189716782427434983&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-124951311-null-null.nonecase&amp;utm_term=tailwind&amp;spm=1018.2226.3001.4450 å®‰è£… vscode æç¤ºæ’ä»¶ Tailwind CSS IntelliSense hå‡½æ•°1234567891011import &#123; h &#125; from &#x27;vue&#x27;const Btn = (props, ctx) =&gt; &#123; return h(&#x27;div&#x27;, &#123; class: [...], onClick: () =&gt; &#123; ctx.emit(&#x27;on-click&#x27;, &#x27;hello world&#x27;) &#125;, &#125;, ctx.slots.default())&#125; å‚è€ƒèµ„æ–™Vue3+Vite+Ts é¡¹ç›®å®æˆ˜ 01 Vite åˆ›å»ºé¡¹ç›®ã€ESLint+TS+GitCommité…ç½®ã€Vue3æ–°ç‰¹æ€§ä»‹ç» â†©","categories":[],"tags":[{"name":"JS,Vue3","slug":"JS-Vue3","permalink":"http://yoursite.com/tags/JS-Vue3/"}]},{"title":"é«˜æ€§èƒ½æ¸²æŸ“åä¸‡æ¡æ•°æ®(è™šæ‹Ÿåˆ—è¡¨)","slug":"virtual-list","date":"2022-11-23T12:43:13.000Z","updated":"2022-11-28T03:19:11.257Z","comments":true,"path":"/post/virtual-list.html","link":"","permalink":"http://yoursite.com/post/virtual-list.html","excerpt":"ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨çš„æ–¹å¼ï¼Œæ¥åŒæ—¶åŠ è½½å¤§é‡æ•°æ®ã€‚","text":"å‰è¨€åœ¨å·¥ä½œä¸­ï¼Œæœ‰æ—¶ä¼šé‡åˆ°éœ€è¦ä¸€äº›ä¸èƒ½ä½¿ç”¨åˆ†é¡µæ–¹å¼æ¥åŠ è½½åˆ—è¡¨æ•°æ®çš„ä¸šåŠ¡æƒ…å†µï¼Œå¯¹äºæ­¤ï¼Œæˆ‘ä»¬ç§°è¿™ç§åˆ—è¡¨å«åšé•¿åˆ—è¡¨ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€äº›å¤–æ±‡äº¤æ˜“ç³»ç»Ÿä¸­ï¼Œå‰ç«¯ä¼šå®æ—¶çš„å±•ç¤ºç”¨æˆ·çš„æŒä»“æƒ…å†µ(æ”¶ç›Šã€äºæŸã€æ‰‹æ•°ç­‰)ï¼Œæ­¤æ—¶å¯¹äºç”¨æˆ·çš„æŒä»“åˆ—è¡¨ä¸€èˆ¬æ˜¯ä¸èƒ½åˆ†é¡µçš„ã€‚ æ—¶é—´åˆ†ç‰‡ æåˆ°äº†å¯ä»¥ä½¿ç”¨æ—¶é—´åˆ†ç‰‡çš„æ–¹å¼æ¥å¯¹é•¿åˆ—è¡¨è¿›è¡Œæ¸²æŸ“ï¼Œä½†è¿™ç§æ–¹å¼æ›´é€‚ç”¨äºåˆ—è¡¨é¡¹çš„DOMç»“æ„ååˆ†ç®€å•çš„æƒ…å†µã€‚æœ¬æ–‡ä¼šä»‹ç»ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨çš„æ–¹å¼ï¼Œæ¥åŒæ—¶åŠ è½½å¤§é‡æ•°æ®ã€‚ å½“æˆ‘ä»¬æ¸²æŸ“10wæ¡æ•°æ®æ—¶ï¼Œå…¶å®ä¸»è¦æ˜¯çš„æ—¶é—´èŠ±è´¹åœ¨ Recalculate Style å’Œ Layout ä¸Š Recalculate Styleï¼šæ ·å¼è®¡ç®—ï¼Œæµè§ˆå™¨æ ¹æ®cssé€‰æ‹©å™¨è®¡ç®—å“ªäº›å…ƒç´ åº”è¯¥åº”ç”¨å“ªäº›è§„åˆ™ï¼Œç¡®å®šæ¯ä¸ªå…ƒç´ å…·ä½“çš„æ ·å¼ã€‚ Layoutï¼šå¸ƒå±€ï¼ŒçŸ¥é“å…ƒç´ åº”ç”¨å“ªäº›è§„åˆ™ä¹‹åï¼Œæµè§ˆå™¨å¼€å§‹è®¡ç®—å®ƒè¦å æ®çš„ç©ºé—´å¤§å°åŠå…¶åœ¨å±å¹•çš„ä½ç½®ã€‚ åœ¨å®é™…çš„å·¥ä½œä¸­ï¼Œåˆ—è¡¨é¡¹å¿…ç„¶ä¸ä¼šåƒä¾‹å­ä¸­ä»…ä»…åªç”±ä¸€ä¸ªliæ ‡ç­¾ç»„æˆï¼Œå¿…ç„¶æ˜¯ç”±å¤æ‚DOMèŠ‚ç‚¹ç»„æˆçš„ã€‚ é‚£ä¹ˆå¯ä»¥æƒ³è±¡çš„æ˜¯ï¼Œå½“åˆ—è¡¨é¡¹æ•°è¿‡å¤šå¹¶ä¸”åˆ—è¡¨é¡¹ç»“æ„å¤æ‚çš„æ—¶å€™ï¼ŒåŒæ—¶æ¸²æŸ“æ—¶ï¼Œä¼šåœ¨Recalculate Styleå’ŒLayouté˜¶æ®µæ¶ˆè€—å¤§é‡çš„æ—¶é—´ã€‚ è€Œè™šæ‹Ÿåˆ—è¡¨å°±æ˜¯è§£å†³è¿™ä¸€é—®é¢˜çš„ä¸€ç§å®ç°ã€‚ ä»€ä¹ˆæ˜¯è™šæ‹Ÿåˆ—è¡¨è™šæ‹Ÿåˆ—è¡¨å…¶å®æ˜¯æŒ‰éœ€æ˜¾ç¤ºçš„ä¸€ç§å®ç°ï¼Œå³åªå¯¹å¯è§åŒºåŸŸè¿›è¡Œæ¸²æŸ“ï¼Œå¯¹éå¯è§åŒºåŸŸä¸­çš„æ•°æ®ä¸æ¸²æŸ“æˆ–éƒ¨åˆ†æ¸²æŸ“çš„æŠ€æœ¯ï¼Œä»è€Œè¾¾åˆ°æé«˜çš„æ¸²æŸ“æ€§èƒ½ã€‚ å‡è®¾æœ‰1ä¸‡æ¡è®°å½•éœ€è¦åŒæ—¶æ¸²æŸ“ï¼Œæˆ‘ä»¬å±å¹•çš„å¯è§åŒºåŸŸçš„é«˜åº¦ä¸º1000px,è€Œåˆ—è¡¨é¡¹çš„é«˜åº¦ä¸º50pxï¼Œåˆ™æ­¤æ—¶æˆ‘ä»¬åœ¨å±å¹•ä¸­æœ€å¤šåªèƒ½çœ‹åˆ°20ä¸ªåˆ—è¡¨é¡¹ï¼Œé‚£ä¹ˆåœ¨é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€åŠ è½½20æ¡å³å¯ã€‚ è¯´å®Œé¦–æ¬¡åŠ è½½ï¼Œå†åˆ†æä¸€ä¸‹å½“æ»šåŠ¨å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—å½“å‰æ»šåŠ¨å€¼å¾—çŸ¥æ­¤æ—¶åœ¨å±å¹•å¯è§åŒºåŸŸåº”è¯¥æ˜¾ç¤ºçš„åˆ—è¡¨é¡¹ã€‚ å‡è®¾æ»šåŠ¨å‘ç”Ÿï¼Œæ»šåŠ¨æ¡è·é¡¶éƒ¨çš„ä½ç½®ä¸º150px,åˆ™æˆ‘ä»¬å¯å¾—çŸ¥åœ¨å¯è§åŒºåŸŸå†…çš„åˆ—è¡¨é¡¹ä¸ºç¬¬4é¡¹è‡³`ç¬¬13é¡¹ã€‚ å®ç°è™šæ‹Ÿåˆ—è¡¨çš„å®ç°ï¼Œå®é™…ä¸Šæ˜¯åœ¨é¦–å±åŠ è½½çš„æ—¶å€™ï¼ŒåªåŠ è½½ å¯è§†åŒºåŸŸ å†…éœ€è¦çš„åˆ—è¡¨é¡¹ï¼Œå½“æ»šåŠ¨å‘ç”Ÿæ—¶ï¼Œé€šè¿‡è®¡ç®—åŠ¨æ€è·å¾—å¯è§†åŒºåŸŸå†…çš„åˆ—è¡¨é¡¹ï¼Œå¹¶å°†éå¯è§†åŒºåŸŸå†…å­˜åœ¨çš„åˆ—è¡¨é¡¹åˆ é™¤ã€‚ è®¡ç®—å½“å‰å¯è§†åŒºåŸŸèµ·å§‹æ•°æ®ç´¢å¼•ï¼ˆstartIndexï¼‰ è®¡ç®—å½“å‰å¯è§†åŒºåŸŸç»“æŸæ•°æ®ç´¢å¼•ï¼ˆendIndexï¼‰ è®¡ç®—å½“å‰å¯è§†åŒºåŸŸçš„æ•°æ®ï¼Œå¹¶æ¸²æŸ“åˆ°é¡µé¢ä¸­ è®¡ç®—startIndexå¯¹åº”çš„æ•°æ®åœ¨æ•´ä¸ªåˆ—è¡¨ä¸­çš„åç§»ä½ç½®startOffsetå¹¶è®¾ç½®åˆ°åˆ—è¡¨ä¸Š ç”±äºåªæ˜¯å¯¹å¯è§†åŒºåŸŸå†…çš„åˆ—è¡¨é¡¹è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥ä¸ºäº†ä¿æŒåˆ—è¡¨å®¹å™¨çš„é«˜åº¦å¹¶å¯æ­£å¸¸çš„è§¦å‘æ»šåŠ¨ï¼Œå°†Htmlç»“æ„è®¾è®¡æˆå¦‚ä¸‹ç»“æ„ï¼š 1234567891011121314151617181920&lt;div ref=&quot;list&quot; class=&quot;infinite-list-container&quot; @scroll=&quot;scrollEvent($event)&quot;&gt; &lt;!-- æ‰€æœ‰æ•°æ®çš„æ€»é«˜åº¦ --&gt; &lt;div class=&quot;infinite-list-phantom&quot; :style=&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;&gt;&lt;/div&gt; &lt;!-- å¯è§†åŒºåŒºåŸŸï¼Œå¯ä»¥å½“åšæ»‘å—çœ‹å¾… --&gt; &lt;div class=&quot;infinite-list&quot; :style=&quot;&#123; transform: getTransform &#125;&quot;&gt; &lt;!-- æ¯ä¸€é¡¹æ•°æ® --&gt; &lt;div ref=&quot;items&quot; class=&quot;infinite-list-item&quot; v-for=&quot;item in visibleData&quot; :key=&quot;item.id&quot; :style=&quot;&#123; height: itemSize + &#x27;px&#x27;, lineHeight: itemSize + &#x27;px&#x27; &#125;&quot; &gt; &#123;&#123; item.value &#125;&#125; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; æ¥ç€ï¼Œç›‘å¬infinite-list-containerçš„ scrolläº‹ä»¶ï¼Œè·å–æ»šåŠ¨ä½ç½® scrollTopã€‚ åˆ—è¡¨æ€»é«˜åº¦ listHeight = listData.length * itemSize å¯æ˜¾ç¤ºçš„åˆ—è¡¨é¡¹æ•° visibleCount = Math.ceil(screenHeight / itemSize) æ•°æ®çš„èµ·å§‹ç´¢å¼• startIndex = Math.floor(scrollTop / itemSize) æ•°æ®çš„ç»“æŸç´¢å¼• endIndex = startIndex + visibleCount åˆ—è¡¨æ˜¾ç¤ºæ•°æ®ä¸º visibleData = listData.slice(startIndex,endIndex) 12345678910111213scrollEvent() &#123; //å½“å‰æ»šåŠ¨ä½ç½® let scrollTop = this.$refs.list.scrollTop; //æ­¤æ—¶çš„å¼€å§‹ç´¢å¼•ï¼ˆå‘ä¸‹å–æ•´ï¼‰ï¼ŒitemSize æ˜¯ 100 this.start = Math.floor(scrollTop / this.itemSize); //æ­¤æ—¶çš„ç»“æŸç´¢å¼• this.end = this.start + this.visibleCount; //æ­¤æ—¶çš„åç§»é‡ this.startOffset = scrollTop - (scrollTop % this.itemSize);&#125;, å½“æ»šåŠ¨åï¼Œç”±äº æ¸²æŸ“åŒºåŸŸ ç›¸å¯¹äº å¯è§†åŒºåŸŸ å·²ç»å‘ç”Ÿäº†åç§»ï¼Œæ­¤æ—¶æˆ‘éœ€è¦è·å–ä¸€ä¸ª åç§»é‡startOffsetï¼Œé€šè¿‡æ ·å¼æ§åˆ¶å°†æ¸²æŸ“åŒºåŸŸåç§»è‡³å¯è§†åŒºåŸŸä¸­ï¼Œå½“ç”¨æˆ·åœ¨æ»‘åŠ¨æ—¶ï¼Œæ¸²æŸ“åŒºåŸŸå°±ä¼šæ ¹æ® startOffset è®¡ç®—å‡ºåç§»é‡ï¼Œæ¸²æŸ“åŒºåŸŸå°±ä¼šä¸€ç›´åœ¨å¯è§†åŒºåŸŸå†…å‘ˆç°ã€‚ 1234567this.startOffset = scrollTop - (scrollTop % this.itemSize);// computed//åç§»é‡å¯¹åº”çš„stylegetTransform() &#123; return `translate3d(0,$&#123;this.startOffset&#125;px,0)`;&#125;, å®Œæ•´ä»£ç 12345678910111213141516&lt;style&gt; html&#123; height: 100%; &#125; body&#123; height: 100%; margin:0; &#125; #app&#123; height:100%; &#125;&lt;/style&gt;&lt;div id=&quot;app&quot;&gt; &lt;VirtualList :listData=&quot;state.data&quot; :itemSize=&quot;100&quot; /&gt;&lt;/div&gt; VirtualList comp. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125&lt;script&gt;export default &#123; name: &quot;VirtualList&quot;, props: &#123; //æ‰€æœ‰åˆ—è¡¨æ•°æ® listData: &#123; type: Array, default: () =&gt; [], &#125;, //æ¯é¡¹é«˜åº¦ itemSize: &#123; type: Number, default: 200, &#125;, &#125;, computed: &#123; //åˆ—è¡¨æ€»é«˜åº¦ listHeight() &#123; return this.listData.length * this.itemSize; &#125;, //å¯æ˜¾ç¤ºçš„åˆ—è¡¨é¡¹æ•° visibleCount() &#123; // å‘ä¸Šå–æ•´: Math.ceil(13.06) =&gt; 14ï¼Œè¡¨ç¤ºæ•´ä¸ªå±å¹•ï¼Œå¯ä»¥æ”¾ 14 æ¡æ•°æ® return Math.ceil(this.screenHeight / this.itemSize); &#125;, //åç§»é‡å¯¹åº”çš„style getTransform() &#123; return `translate3d(0,$&#123;this.startOffset&#125;px,0)`; &#125;, //è·å–çœŸå®æ˜¾ç¤ºåˆ—è¡¨æ•°æ® visibleData() &#123; return this.listData.slice( this.start, Math.min(this.end, this.listData.length) ); &#125;, &#125;, mounted() &#123; // this.$el è¡¨ç¤ºå½“å‰ç»„ä»¶çš„æ ¹èŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¯ infinite-list-container this.screenHeight = this.$el.clientHeight; this.start = 0; this.end = this.start + this.visibleCount; &#125;, data() &#123; return &#123; //å¯è§†åŒºåŸŸé«˜åº¦ screenHeight: 0, //åç§»é‡ startOffset: 0, //èµ·å§‹ç´¢å¼• start: 0, //ç»“æŸç´¢å¼• end: null, &#125;; &#125;, methods: &#123; scrollEvent() &#123; //å½“å‰æ»šåŠ¨ä½ç½® let scrollTop = this.$refs.list.scrollTop; //æ­¤æ—¶çš„å¼€å§‹ç´¢å¼•ï¼ˆå‘ä¸‹å–æ•´ï¼‰ï¼ŒitemSize æ˜¯ 100 this.start = Math.floor(scrollTop / this.itemSize); //æ­¤æ—¶çš„ç»“æŸç´¢å¼• this.end = this.start + this.visibleCount; //æ­¤æ—¶çš„åç§»é‡ this.startOffset = scrollTop - (scrollTop % this.itemSize); &#125;, &#125;,&#125;;&lt;/script&gt;&lt;template&gt; &lt;div ref=&quot;list&quot; class=&quot;infinite-list-container&quot; @scroll=&quot;scrollEvent($event)&quot;&gt; &lt;!-- æ‰€æœ‰æ•°æ®çš„æ€»é«˜åº¦ --&gt; &lt;div class=&quot;infinite-list-phantom&quot; :style=&quot;&#123; height: listHeight + &#x27;px&#x27; &#125;&quot;&gt;&lt;/div&gt; &lt;!-- å¯è§†åŒºåŒºåŸŸï¼Œå¯ä»¥å½“åšæ»‘å—çœ‹å¾… --&gt; &lt;div class=&quot;infinite-list&quot; :style=&quot;&#123; transform: getTransform &#125;&quot;&gt; &lt;div ref=&quot;items&quot; class=&quot;infinite-list-item&quot; v-for=&quot;item in visibleData&quot; :key=&quot;item.id&quot; :style=&quot;&#123; height: itemSize + &#x27;px&#x27;, lineHeight: itemSize + &#x27;px&#x27; &#125;&quot; &gt; &#123;&#123; item.value &#125;&#125; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;style scoped&gt;.infinite-list-container &#123; height: 100%; overflow: auto; position: relative; -webkit-overflow-scrolling: touch;&#125;.infinite-list-phantom &#123; position: absolute; left: 0; top: 0; right: 0; z-index: -1;&#125;.infinite-list &#123; left: 0; right: 0; top: 0; position: absolute; text-align: center;&#125;.infinite-list-item &#123; padding: 10px; color: #555; box-sizing: border-box; border-bottom: 1px solid #999;&#125;&lt;/style&gt; åˆ—è¡¨é¡¹åŠ¨æ€é«˜åº¦åœ¨ä¹‹å‰çš„å®ç°ä¸­ï¼Œåˆ—è¡¨é¡¹çš„é«˜åº¦æ˜¯å›ºå®šçš„ï¼Œå› ä¸ºé«˜åº¦å›ºå®šï¼Œæ‰€ä»¥å¯ä»¥å¾ˆè½»æ˜“çš„è·å–åˆ—è¡¨é¡¹çš„æ•´ä½“é«˜åº¦ä»¥åŠæ»šåŠ¨æ—¶çš„æ˜¾ç¤ºæ•°æ®ä¸å¯¹åº”çš„åç§»é‡ã€‚ è€Œå®é™…åº”ç”¨çš„æ—¶å€™ï¼Œå½“åˆ—è¡¨ä¸­åŒ…å«æ–‡æœ¬ä¹‹ç±»çš„å¯å˜å†…å®¹ï¼Œä¼šå¯¼è‡´ åˆ—è¡¨é¡¹çš„é«˜åº¦å¹¶ä¸ç›¸åŒã€‚ æ¯”å¦‚è¿™æ ·ï¼š åœ¨è™šæ‹Ÿåˆ—è¡¨ä¸­åº”ç”¨åŠ¨æ€é«˜åº¦çš„è§£å†³æ–¹æ¡ˆä¸€èˆ¬æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š 1.å¯¹ç»„ä»¶å±æ€§itemSizeè¿›è¡Œæ‰©å±•ï¼Œæ”¯æŒä¼ é€’ç±»å‹ä¸ºæ•°å­—ã€æ•°ç»„ã€å‡½æ•° å¯ä»¥æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œå¦‚ 100ï¼Œæ­¤æ—¶åˆ—è¡¨é¡¹æ˜¯å›ºé«˜çš„ å¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰åˆ—è¡¨é¡¹é«˜åº¦çš„æ•°æ®ï¼Œå¦‚ [50, 20, 100, 80, â€¦] å¯ä»¥æ˜¯ä¸€ä¸ªæ ¹æ®åˆ—è¡¨é¡¹ç´¢å¼•è¿”å›å…¶é«˜åº¦çš„å‡½æ•°ï¼š(index: number): number è¿™ç§æ–¹å¼è™½ç„¶æœ‰æ¯”è¾ƒå¥½çš„çµæ´»åº¦ï¼Œä½†ä»…é€‚ç”¨äºå¯ä»¥é¢„å…ˆçŸ¥é“æˆ–å¯ä»¥é€šè¿‡è®¡ç®—å¾—çŸ¥åˆ—è¡¨é¡¹é«˜åº¦çš„æƒ…å†µï¼Œä¾ç„¶æ— æ³•è§£å†³åˆ—è¡¨é¡¹é«˜åº¦ç”±å†…å®¹æ’‘å¼€çš„æƒ…å†µã€‚ 2.å°†åˆ—è¡¨é¡¹ æ¸²æŸ“åˆ°å±å¹•å¤–ï¼Œå¯¹å…¶é«˜åº¦è¿›è¡Œæµ‹é‡å¹¶ç¼“å­˜ï¼Œç„¶åå†å°†å…¶æ¸²æŸ“è‡³å¯è§†åŒºåŸŸå†…ã€‚ ç”±äº é¢„å…ˆæ¸²æŸ“è‡³å±å¹•å¤–ï¼Œå†æ¸²æŸ“è‡³å±å¹•å†…ï¼Œè¿™å¯¼è‡´æ¸²æŸ“æˆæœ¬å¢åŠ ä¸€å€ï¼Œè¿™å¯¹äºæ•°ç™¾ä¸‡ç”¨æˆ·åœ¨ä½ç«¯ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨çš„äº§å“æ¥è¯´æ˜¯ä¸åˆ‡å®é™…çš„ã€‚ 3.ä»¥é¢„ä¼°é«˜åº¦å…ˆè¡Œæ¸²æŸ“ï¼Œç„¶åè·å–çœŸå®é«˜åº¦å¹¶ç¼“å­˜ã€‚ è¿™æ˜¯å¯ä»¥é€‰æ‹©çš„å®ç°æ–¹å¼ï¼Œå¯ä»¥é¿å…å‰ä¸¤ç§æ–¹æ¡ˆçš„ä¸è¶³ã€‚","categories":[],"tags":[{"name":"JS","slug":"JS","permalink":"http://yoursite.com/tags/JS/"}]},{"title":"é«˜æ€§èƒ½æ¸²æŸ“åä¸‡æ¡æ•°æ®(æ—¶é—´åˆ†ç‰‡)","slug":"time-fragment","date":"2022-11-23T11:53:52.000Z","updated":"2022-11-23T12:52:27.198Z","comments":true,"path":"/post/time-fragment.html","link":"","permalink":"http://yoursite.com/post/time-fragment.html","excerpt":"æ¸²æŸ“å¤§é‡æ•°æ®ã€‚","text":"æœ€ç²—æš´çš„åšæ³•ï¼ˆä¸€æ¬¡æ€§æ¸²æŸ“JSçš„è¿è¡Œæ—¶é—´ä¸º187msï¼Œè¿˜æ˜¯è›®å¿«çš„ï¼Œä½†æ˜¯æœ€ç»ˆæ¸²æŸ“å®Œæˆåçš„æ€»æ—¶é—´ç¡®æ˜¯2844msï¼Œä¸­é—´ä¼šç™½å±ä¸€æ®µæ—¶é—´ã€‚ 1234567891011121314151617// è®°å½•ä»»åŠ¡å¼€å§‹æ—¶é—´let now = Date.now();// æ’å…¥åä¸‡æ¡æ•°æ®const total = 100000;// è·å–å®¹å™¨let ul = document.getElementById(&#x27;container&#x27;);// å°†æ•°æ®æ’å…¥å®¹å™¨ä¸­for (let i = 0; i &lt; total; i++) &#123; let li = document.createElement(&#x27;li&#x27;); li.innerText = i ul.appendChild(li);&#125;console.log(&#x27;JSè¿è¡Œæ—¶é—´ï¼š&#x27;, Date.now() - now);setTimeout(() =&gt; &#123; console.log(&#x27;æ€»è¿è¡Œæ—¶é—´ï¼š&#x27;, Date.now() - now);&#125;, 0) ä½¿ç”¨å®šæ—¶å™¨é¡µé¢çš„å¡é¡¿æ˜¯ç”±äºåŒæ—¶æ¸²æŸ“å¤§é‡DOMæ‰€å¼•èµ·çš„ï¼Œæ‰€ä»¥è€ƒè™‘å°†æ¸²æŸ“è¿‡ç¨‹åˆ†æ‰¹è¿›è¡Œï¼Œè¿™é‡Œç”¨åˆ°çš„å°±æ˜¯ setTimeoutã€‚ 1234567891011121314151617181920212223242526let ul = document.getElementById(&#x27;container&#x27;);// æ’å…¥åä¸‡æ¡æ•°æ®let total = 100000;// ä¸€æ¬¡æ’å…¥ 20 æ¡let once = 20;//æ€»é¡µæ•°let page = total / once//æ¯æ¡è®°å½•çš„ç´¢å¼•let index = 0;//å¾ªç¯åŠ è½½æ•°æ®function loop(curTotal, curIndex) &#123; if (curTotal &lt;= 0) &#123; return false; &#125; //æ¯é¡µå¤šå°‘æ¡ let pageCount = Math.min(curTotal, once); setTimeout(() =&gt; &#123; for (let i = 0; i &lt; pageCount; i++) &#123; let li = document.createElement(&#x27;li&#x27;); li.innerText = curIndex + i + &#x27; : &#x27; + ~~(Math.random() * total) ul.appendChild(li) &#125; loop(curTotal - pageCount, curIndex + pageCount) &#125;, 0)&#125;loop(total, index); é¡µé¢åŠ è½½çš„æ—¶é—´å·²ç»éå¸¸å¿«äº†ï¼Œæ¯æ¬¡åˆ·æ–°æ—¶å¯ä»¥å¾ˆå¿«çš„çœ‹åˆ°ç¬¬ä¸€å±çš„æ‰€æœ‰æ•°æ®ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å¿«é€Ÿæ»šåŠ¨é¡µé¢çš„æ—¶å€™ï¼Œä¼šå‘ç°é¡µé¢å‡ºç°é—ªå±æˆ–ç™½å±çš„ç°è±¡ã€‚ ä¸ºä»€ä¹ˆä¼šå‡ºç°é—ªå±ç°è±¡å‘¢é¦–å…ˆï¼Œç†æ¸…ä¸€äº›æ¦‚å¿µã€‚FPSè¡¨ç¤ºçš„æ˜¯æ¯ç§’é’Ÿç”»é¢æ›´æ–°æ¬¡æ•°ã€‚æˆ‘ä»¬å¹³æ—¶æ‰€çœ‹åˆ°çš„è¿ç»­ç”»é¢éƒ½æ˜¯ç”±ä¸€å¹…å¹…é™æ­¢ç”»é¢ç»„æˆçš„ï¼Œæ¯å¹…ç”»é¢ç§°ä¸ºä¸€å¸§ï¼ŒFPSæ˜¯æè¿°å¸§å˜åŒ–é€Ÿåº¦çš„ç‰©ç†é‡ã€‚ å¤§å¤šæ•°ç”µè„‘æ˜¾ç¤ºå™¨çš„åˆ·æ–°é¢‘ç‡æ˜¯60Hzï¼Œå¤§æ¦‚ç›¸å½“äºæ¯ç§’é’Ÿé‡ç»˜60æ¬¡ï¼ŒFPSä¸º60frame/sï¼Œä¸ºè¿™ä¸ªå€¼çš„è®¾å®šå—å±å¹•åˆ†è¾¨ç‡ã€å±å¹•å°ºå¯¸å’Œæ˜¾å¡çš„å½±å“ã€‚ å› æ­¤ï¼Œå½“ä½ å¯¹ç€ç”µè„‘å±å¹•ä»€ä¹ˆä¹Ÿä¸åšçš„æƒ…å†µä¸‹ï¼Œå¤§å¤šæ˜¾ç¤ºå™¨ä¹Ÿä¼šä»¥æ¯ç§’60æ¬¡çš„é¢‘ç‡æ­£åœ¨ä¸æ–­çš„æ›´æ–°å±å¹•ä¸Šçš„å›¾åƒã€‚ ä¸ºä»€ä¹ˆä½ æ„Ÿè§‰ä¸åˆ°è¿™ä¸ªå˜åŒ–ï¼Ÿ é‚£æ˜¯å› ä¸ºäººçš„çœ¼ç›æœ‰è§†è§‰åœç•™æ•ˆåº”ï¼Œå³å‰ä¸€å‰¯ç”»é¢ç•™åœ¨å¤§è„‘çš„å°è±¡è¿˜æ²¡æ¶ˆå¤±ï¼Œç´§æ¥ç€åä¸€å‰¯ç”»é¢å°±è·Ÿä¸Šæ¥äº†ï¼Œè¿™ä¸­é—´åªé—´éš”äº†16.7ms(1000/60â‰ˆ16.7)ï¼Œæ‰€ä»¥ä¼šè®©ä½ è¯¯ä»¥ä¸ºå±å¹•ä¸Šçš„å›¾åƒæ˜¯é™æ­¢ä¸åŠ¨çš„ã€‚ è€Œå±å¹•ç»™ä½ çš„è¿™ç§æ„Ÿè§‰æ˜¯å¯¹çš„ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœåˆ·æ–°é¢‘ç‡å˜æˆ1æ¬¡/ç§’ï¼Œå±å¹•ä¸Šçš„å›¾åƒå°±ä¼šå‡ºç°ä¸¥é‡çš„é—ªçƒï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å¼•èµ·çœ¼ç›ç–²åŠ³ã€é…¸ç—›å’Œå¤´æ™•ç›®çœ©ç­‰ç—‡çŠ¶ã€‚ å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šå¯¹é‡ç»˜æ“ä½œåŠ ä»¥é™åˆ¶ï¼Œä¸è¶…è¿‡æ˜¾ç¤ºå™¨çš„é‡ç»˜é¢‘ç‡ï¼Œå› ä¸ºå³ä½¿è¶…è¿‡é‚£ä¸ªé¢‘ç‡ç”¨æˆ·ä½“éªŒä¹Ÿä¸ä¼šæœ‰æå‡ã€‚å› æ­¤ï¼Œæœ€å¹³æ»‘åŠ¨ç”»çš„æœ€ä½³å¾ªç¯é—´éš”æ˜¯1000ms/60ï¼Œçº¦ç­‰äº16.6msã€‚ ç›´è§‚æ„Ÿå—ï¼Œä¸åŒå¸§ç‡çš„ä½“éªŒï¼š å¸§ç‡èƒ½å¤Ÿè¾¾åˆ° 50 ï½ 60 FPS çš„åŠ¨ç”»å°†ä¼šç›¸å½“æµç•…ï¼Œè®©äººå€æ„Ÿèˆ’é€‚ï¼› å¸§ç‡åœ¨ 30 ï½ 50 FPS ä¹‹é—´çš„åŠ¨ç”»ï¼Œå› å„äººæ•æ„Ÿç¨‹åº¦ä¸åŒï¼Œèˆ’é€‚åº¦å› äººè€Œå¼‚ï¼› å¸§ç‡åœ¨ 30 FPS ä»¥ä¸‹çš„åŠ¨ç”»ï¼Œè®©äººæ„Ÿè§‰åˆ°æ˜æ˜¾çš„å¡é¡¿å’Œä¸é€‚æ„Ÿï¼› å¸§ç‡æ³¢åŠ¨å¾ˆå¤§çš„åŠ¨ç”»ï¼Œäº¦ä¼šä½¿äººæ„Ÿè§‰åˆ°å¡é¡¿ã€‚ ç®€å•èŠä¸€ä¸‹ setTimeout å’Œé—ªå±ç°è±¡ setTimeoutçš„æ‰§è¡Œæ—¶é—´å¹¶ä¸æ˜¯ç¡®å®šçš„ã€‚åœ¨JSä¸­ï¼ŒsetTimeoutä»»åŠ¡è¢«æ”¾è¿›äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œåªæœ‰ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ‰ä¼šå»æ£€æŸ¥äº‹ä»¶é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ˜¯å¦éœ€è¦æ‰§è¡Œï¼Œå› æ­¤setTimeoutçš„å®é™…æ‰§è¡Œæ—¶é—´å¯èƒ½ä¼šæ¯”å…¶è®¾å®šçš„æ—¶é—´æ™šä¸€äº›ã€‚ åˆ·æ–°é¢‘ç‡å—å±å¹•åˆ†è¾¨ç‡å’Œå±å¹•å°ºå¯¸çš„å½±å“ï¼Œå› æ­¤ä¸åŒè®¾å¤‡çš„åˆ·æ–°é¢‘ç‡å¯èƒ½ä¼šä¸åŒï¼Œè€ŒsetTimeoutåªèƒ½è®¾ç½®ä¸€ä¸ªå›ºå®šæ—¶é—´é—´éš”ï¼Œè¿™ä¸ªæ—¶é—´ä¸ä¸€å®šå’Œå±å¹•çš„åˆ·æ–°æ—¶é—´ç›¸åŒã€‚ ä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½ä¼šå¯¼è‡´setTimeoutçš„æ‰§è¡Œæ­¥è°ƒå’Œå±å¹•çš„åˆ·æ–°æ­¥è°ƒä¸ä¸€è‡´ã€‚ åœ¨setTimeoutä¸­å¯¹domè¿›è¡Œæ“ä½œï¼Œå¿…é¡»è¦ç­‰åˆ°å±å¹•ä¸‹æ¬¡ç»˜åˆ¶æ—¶æ‰èƒ½æ›´æ–°åˆ°å±å¹•ä¸Šï¼Œå¦‚æœä¸¤è€…æ­¥è°ƒä¸ä¸€è‡´ï¼Œå°±å¯èƒ½å¯¼è‡´ä¸­é—´æŸä¸€å¸§çš„æ“ä½œè¢«è·¨è¶Šè¿‡å»ï¼Œè€Œç›´æ¥æ›´æ–°ä¸‹ä¸€å¸§çš„å…ƒç´ ï¼Œä»è€Œå¯¼è‡´ä¸¢å¸§ç°è±¡ã€‚ ä½¿ç”¨ requestAnimationFrameä¸setTimeoutç›¸æ¯”ï¼ŒrequestAnimationFrameæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœºã€‚ å¦‚æœå±å¹•åˆ·æ–°ç‡æ˜¯60Hz,é‚£ä¹ˆå›è°ƒå‡½æ•°å°±æ¯16.7msè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœåˆ·æ–°ç‡æ˜¯75Hzï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´é—´éš”å°±å˜æˆäº†1000/75=13.3msï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼ŒrequestAnimationFrame çš„æ­¥ä¼è·Ÿç€ç³»ç»Ÿçš„åˆ·æ–°æ­¥ä¼èµ°ã€‚å®ƒèƒ½ä¿è¯å›è°ƒå‡½æ•°åœ¨å±å¹•æ¯ä¸€æ¬¡çš„åˆ·æ–°é—´éš”ä¸­åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¸ä¼šå¼•èµ·ä¸¢å¸§ç°è±¡ã€‚ å°† setTimeout æ›¿æ¢æˆ requestAnimationFrame: 123456789101112// å…¶ä»– ...window.requestAnimationFrame(function()&#123; for(let i = 0; i &lt; pageCount; i++)&#123; let li = document.createElement(&#x27;li&#x27;); li.innerText = curIndex + i + &#x27; : &#x27; + ~~(Math.random() * total) ul.appendChild(li) &#125; loop(curTotal - pageCount,curIndex + pageCount)&#125;)// ... ä½¿ç”¨ DocumentFragment DocumentFragmentï¼Œæ–‡æ¡£ç‰‡æ®µæ¥å£ï¼Œè¡¨ç¤ºä¸€ä¸ªæ²¡æœ‰çˆ¶çº§æ–‡ä»¶çš„æœ€å°æ–‡æ¡£å¯¹è±¡ã€‚å®ƒè¢«ä½œä¸ºä¸€ä¸ªè½»é‡ç‰ˆçš„Documentä½¿ç”¨ï¼Œç”¨äºå­˜å‚¨å·²æ’å¥½ç‰ˆçš„æˆ–å°šæœªæ‰“ç†å¥½æ ¼å¼çš„XMLç‰‡æ®µã€‚æœ€å¤§çš„åŒºåˆ«æ˜¯å› ä¸ºDocumentFragmentä¸æ˜¯çœŸå®DOMæ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒçš„å˜åŒ–ä¸ä¼šè§¦å‘DOMæ ‘çš„ï¼ˆé‡æ–°æ¸²æŸ“) ï¼Œä¸”ä¸ä¼šå¯¼è‡´æ€§èƒ½ç­‰é—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨document.createDocumentFragmentæ–¹æ³•æˆ–è€…æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªç©ºçš„DocumentFragment ä»MDNçš„è¯´æ˜ä¸­ï¼Œæˆ‘ä»¬å¾—çŸ¥DocumentFragmentsæ˜¯DOMèŠ‚ç‚¹ï¼Œä½†å¹¶ä¸æ˜¯DOMæ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥å°†å­å…ƒç´ æ’å…¥åˆ°æ–‡æ¡£ç‰‡æ®µæ—¶ä¸ä¼šå¼•èµ·é¡µé¢å›æµï¼ˆä»€ä¹ˆæ˜¯å›æµ? å›æµæ˜¯ä¼šå¯¼è‡´é¡µé¢é‡æ–°æ¸²æŸ“çš„ä¸€äº›å…ƒç´ ,ä»è€Œå½±å“æ€§èƒ½ï¼‰ã€‚ å½“appendå…ƒç´ åˆ°documentä¸­æ—¶ï¼Œè¢«appendè¿›å»çš„å…ƒç´ çš„æ ·å¼è¡¨çš„è®¡ç®—æ˜¯åŒæ­¥å‘ç”Ÿçš„ï¼Œæ­¤æ—¶è°ƒç”¨ getComputedStyle å¯ä»¥å¾—åˆ°æ ·å¼çš„è®¡ç®—å€¼ã€‚ è€Œappendå…ƒç´ åˆ° documentFragment ä¸­æ—¶ï¼Œæ˜¯ä¸ä¼šè®¡ç®—å…ƒç´ çš„æ ·å¼è¡¨ï¼Œæ‰€ä»¥documentFragment æ€§èƒ½æ›´ä¼˜ã€‚å½“ç„¶ç°åœ¨æµè§ˆå™¨çš„ä¼˜åŒ–å·²ç»åšçš„å¾ˆå¥½äº†ï¼Œ å½“appendå…ƒç´ åˆ°documentä¸­åï¼Œæ²¡æœ‰è®¿é—® getComputedStyle ä¹‹ç±»çš„æ–¹æ³•æ—¶ï¼Œç°ä»£æµè§ˆå™¨ä¹Ÿå¯ä»¥æŠŠæ ·å¼è¡¨çš„è®¡ç®—æ¨è¿Ÿåˆ°è„šæœ¬æ‰§è¡Œä¹‹åã€‚ 1234567891011121314// å…¶ä»– ...window.requestAnimationFrame(function()&#123; const fragment = document.createDocumentFragment() for(let i = 0; i &lt; pageCount; i++)&#123; let li = document.createElement(&#x27;li&#x27;); li.innerText = curIndex + i + &#x27; : &#x27; + ~~(Math.random() * total) fragment.appendChild(li) &#125; ul.appendChild(fragment) loop(curTotal - pageCount,curIndex + pageCount)&#125;)// ...","categories":[],"tags":[{"name":"JS","slug":"JS","permalink":"http://yoursite.com/tags/JS/"}]},{"title":"ESM/ESBuild","slug":"ESM-ESBuild","date":"2022-09-13T09:11:35.000Z","updated":"2022-09-16T08:40:53.050Z","comments":true,"path":"/post/ESM-ESBuild.html","link":"","permalink":"http://yoursite.com/post/ESM-ESBuild.html","excerpt":"ç»§ CommonJSã€AMDã€CMD å‡ ç§æ¨¡å—åŒ–è§„èŒƒç”±ç¤¾åŒºæå‡ºåï¼ŒES 2015ï¼ˆES6ï¼‰åœ¨è¯­è¨€å±‚é¢ä¸Šå®ç°äº†æ¨¡å—åŠŸèƒ½ï¼Œä¸”å®ç°ç®€å•ï¼Œå¯ä»¥æ›¿ä»£CommonJSå’ŒAMDè§„èŒƒï¼Œæˆä¸ºåœ¨æœåŠ¡å™¨å’Œæµè§ˆå™¨é€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚","text":"ESModuleç»§ CommonJSã€AMDã€CMD å‡ ç§æ¨¡å—åŒ–è§„èŒƒç”±ç¤¾åŒºæå‡ºåï¼ŒES 2015ï¼ˆES6ï¼‰åœ¨è¯­è¨€å±‚é¢ä¸Šå®ç°äº†æ¨¡å—åŠŸèƒ½ï¼Œä¸”å®ç°ç®€å•ï¼Œå¯ä»¥æ›¿ä»£CommonJSå’ŒAMDè§„èŒƒï¼Œæˆä¸ºåœ¨æœåŠ¡å™¨å’Œæµè§ˆå™¨é€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚ åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ &lt;script type=&quot;module&quot;&gt; åŸç”Ÿæ”¯æŒ ESMã€‚ https://www.cnblogs.com/zhaojian-08/p/14385312.html å¯¼å…¥/å¯¼å‡º12345678// esm_index.jsexport const hello_world = 1export default function() &#123;&#125;&lt;script type=&quot;module&quot;&gt; import fn, &#123; hello_world &#125; from &#x27;./esm_index.js&#x27;&lt;/script&gt; åŠ¨æ€åŠ è½½123456789101112// dynamic-m.jsexport const dynamic_value = &#x27;åŠ¨æ€åŠ è½½&#x27;export default function() &#123; console.log(&#x27;default&#x27;)&#125;mport(&#x27;./dynamic-m.js&#x27;) .then(module =&gt; &#123; // module: &#123; default: fn, dynamic_value: &#x27;åŠ¨æ€åŠ è½½&#x27; &#125; console.log(&#x27;åŠ¨æ€&#x27;, module) &#125;) ESBuild https://esbuild.github.io/api/ ä»‹ç»: https://juejin.cn/post/6918927987056312327","categories":[],"tags":[{"name":"ESM ESModule ESBuild","slug":"ESM-ESModule-ESBuild","permalink":"http://yoursite.com/tags/ESM-ESModule-ESBuild/"}]},{"title":"æ·±å…¥æµ…å‡ºTypeScript","slug":"æ·±å…¥æµ…å‡ºTypeScript","date":"2022-09-09T02:35:36.000Z","updated":"2022-09-13T03:03:59.001Z","comments":true,"path":"/post/æ·±å…¥æµ…å‡ºTypeScript.html","link":"","permalink":"http://yoursite.com/post/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BATypeScript.html","excerpt":"TypeScript","text":"TypeScript.d.ts å’Œ declare æ˜¯å¹²å˜›ç”¨çš„å¦‚æœä¸€ä¸ªæ–‡ä»¶æœ‰æ‰©å±•å .d.tsï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå£°æ˜æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥å£°æ˜å…¨å±€çš„ç±»å‹å®šä¹‰å’Œæ¥å£ï¼Œæˆ–è€…æ˜¯å…¶å®ƒæ¨¡å—ã€‚æ¯”å¦‚ï¼š 1234567891011121314151617181920// global.d.ts// å£°æ˜æ¥å£declare interface Person &#123; name: string; age: number;&#125;// å£°æ˜ç±»å‹ (åˆ«å)declare type TName = string;// å£°æ˜æ¨¡å—declare module &#x27;*.css&#x27;;declare module &#x27;*.less&#x27;;declare module &#x27;*.png&#x27;;// æ‹“å±• window å±æ€§ï¼Œåœ¨ window å¯¹è±¡ä¸Šæ˜¾å¼è®¾ç½®å±æ€§declare interface Window &#123; MyNameSpace: any&#125; ä½†æ˜¯ä¹Ÿä¸æ˜¯è¯´åˆ›å»ºäº†.d.tsæ–‡ä»¶ï¼Œé‡Œé¢å£°æ˜çš„ä¸œè¥¿å°±èƒ½ç”Ÿæ•ˆäº†ï¼Œæ¯•ç«Ÿå½’æ ¹åˆ°åº•ä¹Ÿæ˜¯.tsæ–‡ä»¶ï¼Œéœ€è¦é¢„ç¼–è¯‘ï¼Œæ‰€ä»¥éœ€è¦åœ¨tsconfig.jsonæ–‡ä»¶é‡Œé¢çš„includeæ•°ç»„é‡Œé¢æ·»åŠ  global.d.ts æ–‡ä»¶ã€‚ 1&quot;include&quot;: [&quot;src/**/*.ts&quot;, &quot;src/**/*.d.ts&quot;, &quot;src/**/*.tsx&quot;, &quot;src/**/*.vue&quot;] .d.ts æ–‡ä»¶ä¸­çš„é¡¶çº§å£°æ˜å¿…é¡»ä»¥ â€œdeclareâ€ æˆ– â€œexportâ€ ä¿®é¥°ç¬¦å¼€å¤´ã€‚é€šè¿‡declareå£°æ˜çš„ç±»å‹æˆ–è€…å˜é‡æˆ–è€…æ¨¡å—ï¼Œåœ¨includeåŒ…å«çš„æ–‡ä»¶èŒƒå›´å†…ï¼Œéƒ½å¯ä»¥ç›´æ¥å¼•ç”¨ã€‚ 12345// .vue setup / .tsconst me: Person = &#123; name: &#x27;alex.cheng&#x27;, age: 18&#125; æ³¨æ„.d.tsæ–‡ä»¶é¡¶çº§å£°æ˜declareæœ€å¥½ä¸è¦è·ŸexportåŒçº§ä½¿ç”¨ï¼Œä¸ç„¶åœ¨å…¶ä»–tsæ–‡ä»¶å¼•ç”¨è¿™ä¸ª.d.tsçš„å†…å®¹çš„æ—¶å€™ï¼Œå°±éœ€è¦æ‰‹åŠ¨importå¯¼å…¥äº†ã€‚ 12345678// global.d.tsexport type TName = string;// è¿™ä¸ªæ—¶å€™ï¼Œå¤–éƒ¨ ts å°±æ— æ³•ç›´æ¥ä½¿ç”¨ Person äº†ï¼Œéœ€è¦å¼•å…¥ import &#123; Person &#125; from &#x27;../global.d.ts&#x27;export declare interface Person &#123; name: string; age: number;&#125; ç»™å¯¹è±¡åˆ†é…åŠ¨æ€ï¼ˆæœªçŸ¥ï¼‰å±æ€§1234567891011121314const o: &#123; [key: string]: any &#125; = &#123;&#125;// ä½¿ç”¨ ts å†…ç½®å·¥å…· Recordï¼Œæ•ˆæœåŒä¸Šconst o: Record&lt;string, any&gt; = &#123;&#125;interface IPerson extends Record&lt;string, any&gt; &#123; name: string; age?: number;&#125;const me1: IPerson = &#123; name: &#x27;alex&#x27;, hair: &#x27;black&#x27;&#125; interface å’Œ type æœ‰ä»€ä¹ˆåŒºåˆ« æ¥å£å’Œç±»å‹åˆ«åéƒ½å¯ä»¥ç”¨æ¥æè¿°å¯¹è±¡çš„å½¢çŠ¶æˆ–å‡½æ•°ç­¾åã€‚ ä¸æ¥å£ç±»å‹ä¸ä¸€æ ·çš„æ˜¯ï¼Œç±»å‹åˆ«åå¯ä»¥ç”¨äºä¸€äº›å…¶ä»–ç±»å‹ï¼Œæ¯”å¦‚åŸå§‹ç±»å‹ã€è”åˆç±»å‹ï¼ˆ|ï¼‰å’Œå…ƒç»„ã€‚ æ¥å£å’Œç±»å‹åˆ«åéƒ½èƒ½å¤Ÿè¢«æ‰©å±•ï¼Œä½†è¯­æ³•æœ‰æ‰€ä¸åŒã€‚æ­¤å¤–ï¼Œæ¥å£å’Œç±»å‹åˆ«åä¸æ˜¯äº’æ–¥çš„ã€‚æ¥å£å¯ä»¥æ‰©å±•ç±»å‹åˆ«åï¼Œè€Œåè¿‡æ¥æ˜¯ä¸è¡Œçš„ã€‚ interface æ‰©å±•ï¼ˆæ¥å£ã€ç±»å‹ï¼‰ä½¿ç”¨ extends å…³é”®å­—ï¼Œç±»å‹åˆ«åæ‰©å±•ï¼ˆæ¥å£ã€ç±»å‹ï¼‰ä½¿ç”¨çš„æ˜¯ äº¤å‰ç±»å‹ï¼ˆ&amp;ï¼‰: 123456789101112131415// æ¥å£æ‰©å±•interface IPerson &#123; name: string;&#125;interface IMe extends IPerson &#123; age: number;&#125;// ç±»å‹æ‰©å±•type TPerson = &#123; name: string;&#125;type TMe = TPerson &amp; &#123; age: number;&#125; ç±»å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼å®ç°(implements)æ¥å£æˆ–ç±»å‹åˆ«åï¼Œä½†ç±»ä¸èƒ½å®ç°ä½¿ç”¨ç±»å‹åˆ«åå®šä¹‰çš„è”åˆç±»å‹ 12345678910111213// Error:type PartialPoint = &#123; x: number; &#125; | &#123; y: number; &#125;;class SomePartialPoint implements PartialPoint &#123; // ç±»åªèƒ½å®ç°å…·æœ‰é™æ€å·²çŸ¥æˆå‘˜çš„å¯¹è±¡ç±»å‹æˆ–å¯¹è±¡ç±»å‹çš„äº¤é›†ã€‚ts(2422) x = 1; y = 2;&#125;// Successtype PartialPoint = &#123; x: number; &#125; &amp; &#123; y: number; &#125;;class SomePartialPoint implements PartialPoint &#123; x = 1; y = 2;&#125; ä¸ç±»å‹åˆ«åä¸åŒï¼Œæ¥å£å¯ä»¥å®šä¹‰å¤šæ¬¡ï¼Œä¼šè¢«è‡ªåŠ¨åˆå¹¶ä¸ºå•ä¸ªæ¥å£ã€‚ 123456789101112interface IMerge &#123; a: 1;&#125;interface IMerge &#123; b: 2&#125;const ab: IMerge = &#123;&#125;; // ç±»å‹â€œ&#123;&#125;â€ç¼ºå°‘ç±»å‹â€œIMergeâ€ä¸­çš„ä»¥ä¸‹å±æ€§: a, bts(2739)// Error: æ ‡è¯†ç¬¦â€œTOneâ€é‡å¤ã€‚ts(2300)type TOne = string;type TOne = number; ç±»å‹ä¿æŠ¤ typeof instanceof in å‚è€ƒèµ„æ–™TS å­¦ä¹ æŒ‡å— â†©æ·±å…¥ç†è§£TypeScript â†©","categories":[],"tags":[{"name":"TypeScript TS","slug":"TypeScript-TS","permalink":"http://yoursite.com/tags/TypeScript-TS/"}]},{"title":"ç§»åŠ¨ç«¯å¼€å‘å®è·µ","slug":"app-h5","date":"2022-06-09T06:26:40.000Z","updated":"2022-06-09T06:44:26.042Z","comments":true,"path":"/post/app-h5.html","link":"","permalink":"http://yoursite.com/post/app-h5.html","excerpt":"React Native ã€H5ç§»åŠ¨ç«¯å¼€å‘å®è·µ","text":"WebViewç°åœ¨ Android Appå¤§å¤šåµŒå…¥äº† Android Webview ç»„ä»¶è¿›è¡Œ Hybrid å¼€å‘ï¼Œå®ƒå…·å¤‡å¼€å‘å‘¨æœŸçŸ­ã€çµæ´»æ€§å¥½çš„ä¼˜ç‚¹ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼ŒåŠ è½½é€Ÿåº¦æ…¢ &amp; æ¶ˆè€—æµé‡ã€‚å¼•èµ·ç¼ºç‚¹çš„ä¸»è¦åŸå› å¦‚ä¸‹ï¼š jsè§£ææ•ˆç‡ï¼Œä»¥åŠæ‰‹æœºç¡¬ä»¶è®¾å¤‡çš„æ€§èƒ½ é¡µé¢èµ„æºçš„ä¸‹è½½ï¼ˆå›¾ç‰‡ã€jsæ–‡ä»¶ã€cssæ–‡ä»¶ï¼‰ å‚è€ƒèµ„æ–™Android Webview H5 ç§’å¼€æ–¹æ¡ˆå®ç° â†©","categories":[],"tags":[{"name":"RN H5","slug":"RN-H5","permalink":"http://yoursite.com/tags/RN-H5/"}]},{"title":"å¦‚ä½•ç¼–å†™é«˜æ ‡å‡†çš„ JavaScript ä»£ç ","slug":"js-advice","date":"2022-03-31T02:12:23.000Z","updated":"2022-04-08T02:42:23.957Z","comments":true,"path":"/post/js-advice.html","link":"","permalink":"http://yoursite.com/post/js-advice.html","excerpt":"ä»£ç é‡å°‘ï¼Œè¿è¡Œé€Ÿåº¦ä¸ä¸€å®šå¿«ï¼›ä»£ç é‡å¤šï¼Œè¿è¡Œé€Ÿåº¦ä¹Ÿä¸ä¸€å®šæ…¢ã€‚","text":"æ¦‚è¿°ä½ æ˜¯å¦æ›¾ç»ä¸ºäº†æä¾›ä¸€ä¸ªç®€å•çš„åº”ç”¨è§£å†³æ–¹æ¡ˆè€Œå½»å¤œåœ°æŸ¥çœ‹æºä»£ç ï¼Ÿä½ æ˜¯å¦æ›¾ç»ä¸ºäº†ç†è§£æŸä¸ªæ¡†æ¶è€Œå†¥æ€è‹¦æƒ³ã€é˜…è§ˆç¾¤ä¹¦ï¼Ÿä½ æ˜¯å¦æ›¾ç»ä¸ºäº†æå‡0.1sçš„DOMæ€§èƒ½è€Œå¯¹å¤šç§å®ç°æ–¹æ¡ˆè¿›è¡Œä¸¥æ ¼æµ‹è¯•å’Œå¯¹æ¯”ï¼Ÿä½ æ˜¯å¦æ›¾ç»ä¸ºäº†é¿å…å…¼å®¹é—®é¢˜è€Œéå¯»é«˜æ‰‹å…±åŒâ€œè¯Šæ²»â€ï¼Ÿ è·Ÿæˆ‘ä¸€èµ·ï¼Œä¸“æ³¨é«˜è´¨é‡ JavaScript ä»£ç ï¼Œå°‘å‡º BugğŸ›ï¼Œæ—©ä¸‹ç­ ! æœŸæœ›ä¸ºè¯»è€…å¸¦æ¥å¦‚ä¸‹å¸®åŠ© ğŸ“šï¼š â‘ èƒ½å†™å‡ºç®€å•ã€æ¸…æ™°ã€é«˜æ•ˆçš„ä»£ç ã€‚ â‘ èƒ½æ­å»ºä¸€ä¸ªç¨³å®šã€å¥å£®ã€å¿«æ·çš„åº”ç”¨æ¡†æ¶ã€‚ â‘ èƒ½å›ç­”ä¸€ä¸ªå›°æ‰°å¾ˆå¤šäººçš„æŠ€æœ¯é—®é¢˜ã€‚ â‘ èƒ½ä¿®å¤ä¸€ä¸ªåº”ç”¨å¼€å‘ä¸­é‡åˆ°çš„å¤§çš„Bugã€‚ â‘ èƒ½éå¸¸ç†Ÿæ‚‰æŸä¸ªå¼€æºäº§å“ã€‚ â‘ èƒ½æå‡å®¢æˆ·ç«¯åº”ç”¨æ€§èƒ½ã€‚ JavaScript åŸºç¡€ä»£ç é‡å°‘ï¼Œè¿è¡Œé€Ÿåº¦ä¸ä¸€å®šå¿«ï¼›ä»£ç é‡å¤šï¼Œè¿è¡Œé€Ÿåº¦ä¹Ÿä¸ä¸€å®šæ…¢ã€‚ å‡å°‘å…¨å±€å˜é‡ å¤šä¸ªå…¨å±€å˜é‡éƒ½è¿½åŠ åœ¨ä¸€ä¸ªåç§°ç©ºé—´ä¸‹ï¼Œå°†æ˜¾è‘—é™ä½ä¸å…¶ä»–åº”ç”¨ç¨‹åºäº§ç”Ÿå†²çªçš„æ¦‚ç‡ 123const namespace = &#123;&#125;namespace.name = &#x27;my namespace&#x27; ä½¿ç”¨é—­åŒ…ä½“å°†ä¿¡æ¯éšè—ï¼Œå®ƒæ˜¯å¦ä¸€ç§æœ‰æ•ˆå‡å°‘â€œå…¨å±€æ±¡æŸ“â€çš„æ–¹æ³•ã€‚ 1234567const sayName = function() &#123; const name = &#x27;closure&#x27; return function() &#123; alert(name) &#125;&#125;() ä½œç”¨åŸŸæ§åˆ¶ç€å˜é‡ä¸å‚æ•°çš„å¯è§æ€§åŠç”Ÿå‘½å‘¨æœŸã€‚ JavaScriptæ”¯æŒå‡½æ•°ä½œç”¨åŸŸï¼Œå®šä¹‰åœ¨å‡½æ•°ä¸­çš„å‚æ•°å’Œå˜é‡åœ¨å‡½æ•°å¤–éƒ¨æ˜¯ä¸å¯è§çš„ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªå‡½æ•°ä¸­çš„ä»»ä½•ä½ç½®å®šä¹‰çš„å˜é‡åœ¨è¯¥å‡½æ•°ä¸­çš„ä»»ä½•åœ°æ–¹éƒ½å¯è§ã€‚å®ƒä¸ä»…å‡å°‘äº†åç§°å†²çªï¼Œå¹¶ä¸”æä¾›äº†è‡ªåŠ¨å†…å­˜ç®¡ç†ã€‚ ES6 æ¨¡å—åŒ–ç¼–ç¨‹ä¸­æ¯ä¸ª js æ–‡ä»¶å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œå¤–éƒ¨æ— æ³•è·å–ã€‚å¦‚æœå¤–éƒ¨éœ€è¦æ¨¡å—å†…éƒ¨å˜é‡ï¼Œé€šè¿‡ export å¯¼å‡ºã€‚ 1234567891011&lt;script&gt; var windowA = &#x27;window a&#x27; console.log(window.windowA) // è¾“å‡º &#x27;window a&#x27;&lt;/script&gt;&lt;script type=&quot;module&quot;&gt; var moduleA = &#x27;module a&#x27; console.log(window.moduleA) // è¾“å‡º undefined&lt;/script&gt; è°¨æ…JSæ•°æ®ç±»å‹åœ¨è‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹æ—¶ï¼ŒJavaScriptä¸€èˆ¬éµå¾ªï¼šå¦‚æœæŸä¸ªç±»å‹çš„å€¼è¢«ç”¨äºéœ€è¦å…¶ä»–ç±»å‹çš„å€¼çš„ç¯å¢ƒä¸­ï¼ŒJavaScriptå°±è‡ªåŠ¨å°†è¿™ä¸ªå€¼è½¬æ¢æˆæ‰€éœ€è¦çš„ç±»å‹ã€‚ ç±»å‹è½¬æ¢æ…ç”¨JavaScriptç±»å‹è‡ªåŠ¨è½¬æ¢ï¼Œæ³¨æ„è‡ªåŠ¨è½¬æ¢è§„åˆ™: å¦‚æœæŠŠéç©ºå¯¹è±¡ç”¨åœ¨é€»è¾‘è¿ç®—ç¯å¢ƒä¸­ï¼Œåˆ™å¯¹è±¡è¢«è½¬æ¢ä¸ºtrueã€‚æ­¤æ—¶çš„å¯¹è±¡åŒ…æ‹¬æ‰€æœ‰ç±»å‹çš„å¯¹è±¡ï¼Œå³ä½¿æ˜¯å€¼ä¸ºfalseçš„åŒ…è£…å¯¹è±¡ä¹Ÿè¢«è½¬æ¢ä¸ºtrueã€‚ æœæŠŠå¯¹è±¡ç”¨åœ¨æ•°å€¼è¿ç®—ç¯å¢ƒä¸­ï¼Œåˆ™å¯¹è±¡ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºæ•°å­—ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ï¼Œåˆ™è¿”å›å€¼ä¸ºNaNã€‚ å½“æ•°ç»„è¢«ç”¨åœ¨æ•°å€¼è¿ç®—ç¯å¢ƒä¸­æ—¶ï¼Œæ•°ç»„å°†æ ¹æ®åŒ…å«çš„å…ƒç´ æ¥å†³å®šè½¬æ¢çš„å€¼ã€‚å¦‚æœæ•°ç»„ä¸ºç©ºæ•°ç»„ï¼Œåˆ™è¢«è½¬æ¢ä¸ºæ•°å€¼0ã€‚å¦‚æœæ•°ç»„ä»…åŒ…å«ä¸€ä¸ªæ•°å­—å…ƒç´ ï¼Œåˆ™è¢«è½¬æ¢ä¸ºè¯¥æ•°å­—çš„æ•°å€¼ã€‚å¦‚æœæ•°ç»„åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œæˆ–è€…ä»…åŒ…å«ä¸€ä¸ªéæ•°å­—å…ƒç´ ï¼Œåˆ™è¿”å›NaNã€‚ ğŸŒ° 123456789101112// å¯¹è±¡const obj = &#123;&#125;obj &amp;&amp; 1 &gt;&gt; 1obj + 1 &gt;&gt; &#x27;[object Object]1&#x27;obj.valueOf = function() &#123; return 99 &#125;obj + 1 &gt;&gt; 100// æ•°ç»„è‡ªåŠ¨è½¬æ¢è§„åˆ™+[] &gt;&gt; 0+[1] &gt;&gt; 1+[1,2] &gt;&gt; NaN ç±»å‹åˆ¤æ–­ typeofå¯¹äºä»»ä½•å˜é‡æ¥è¯´ï¼Œä½¿ç”¨typeofè¿ç®—ç¬¦æ€»æ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ä»¥ä¸‹6ç§ç±»å‹ä¹‹ä¸€ï¼šâ‘ â€œnumberâ€â‘ â€œstringâ€â‘ â€œbooleanâ€â‘ â€œobjectâ€â‘ â€œfunctionâ€â‘ â€œundefinedâ€ ä»¤äººç–‘æƒ‘çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ typeof æ£€æµ‹nullå€¼æ—¶ï¼Œè¿”å›çš„æ˜¯â€œobjectâ€ï¼Œè€Œä¸æ˜¯â€œnullâ€ã€‚ 12345typeof null &gt;&gt; &#x27;object&#x27;typeof [] &gt;&gt; &#x27;object&#x27;typeof &#123;&#125; &gt;&gt; &#x27;object&#x27; instanceof instanceof è¿ç®—ç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚ è¿™ä¸ªåœ¨åˆ¤æ–­å¯¹è±¡æ—¶å­˜åœ¨ä¸€äº›ä¸ç¡®å®šæ€§ï¼Œæ¥çœ‹ä¸‹ä¾‹å­ï¼š ğŸŒ° 123456function Person(name) &#123; this.name = name&#125;const p = new Person(&#x27;hello&#x27;)p instanceof Person &gt;&gt; truep instanceof Object &gt;&gt; true å†çœ‹ä¸€ä¸ªğŸŒ°: 123456789101112131415function Person(name) &#123; this.name = name&#125;function Child(name) &#123; this.name = name&#125;Child.prototype = Person.prototypeChild.prototype.constructor = Childconst p = new Child(&#x27;hello child&#x27;)p instanceof Person &gt;&gt; truep instanceof Object &gt;&gt; true å¦‚æœæ˜¯åˆ¤æ–­æ•°ç»„å‘¢? 1234567[] instanceof Array &gt;&gt; true[] instanceof Object &gt;&gt; true// å½“ç„¶è¿™ç§æ–¹å¼å­˜åœ¨ä¸ç¡®å®šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Array.isArray() æ–¹æ³•æ¥åˆ¤æ–­Array.isArray([]) &gt;&gt; trueArray.isArray(&#123;&#125;) &gt;&gt; false ä»ä¸Šé¢ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨ instanceof æ¥åˆ¤æ–­æ—¶å­˜åœ¨ç§ç§ä¸ç¡®å®šæ€§ï¼Œåªè¦å‡ºç°åœ¨åŸå‹é“¾ä¸Šçš„å¯¹è±¡éƒ½ä¼šè¿”å› trueï¼Œä½¿ç”¨çš„æ—¶å€™è¿˜éœ€è¦ç€é‡æ³¨æ„ï¼ ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œæƒ³å¿…å¤§å®¶åº”è¯¥æƒ³èµ·æ¥äº†ï¼ Objectç±»æ˜¯æ‰€æœ‰å¯¹è±¡ç±»å‹çš„çš„çˆ¶ç±»! toString() æ–¹æ³• æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª toString() æ–¹æ³•ï¼Œå½“è¯¥å¯¹è±¡è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªæ–‡æœ¬å€¼æ—¶ï¼Œæˆ–è€…ä¸€ä¸ªå¯¹è±¡ä»¥é¢„æœŸçš„å­—ç¬¦ä¸²æ–¹å¼å¼•ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒtoString() æ–¹æ³•è¢«æ¯ä¸ª Object å¯¹è±¡ç»§æ‰¿ã€‚å¦‚æœæ­¤æ–¹æ³•åœ¨è‡ªå®šä¹‰å¯¹è±¡ä¸­æœªè¢«è¦†ç›–ï¼ŒtoString() è¿”å› â€œ[object type]â€ï¼Œå…¶ä¸­ type æ˜¯å¯¹è±¡çš„ç±»å‹ã€‚ toString() æ–¹æ³•ï¼Œå®ƒå®šä¹‰åœ¨ Object çš„åŸå‹å¯¹è±¡ä¸Šï¼Œå¯¹è±¡åœ¨è°ƒç”¨æ—¶ä¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚ ä½¿ç”¨ toString() æ–¹æ³•æ£€æµ‹å¯¹è±¡ç±»å‹æ˜¯æœ€å®‰å…¨ã€æœ€å‡†ç¡®çš„ã€‚è°ƒç”¨toString()æ–¹æ³•æŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡æ£€æµ‹å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æ•°ç»„æ‰€ç‰¹æœ‰çš„æ ‡å¿—å­—ç¬¦å¯ä»¥ç¡®å®šå¯¹è±¡çš„ç±»å‹ã€‚ ä¸ºä»€ä¹ˆè¯´ toString æ–¹æ³•ç”¨æ¥æ£€æµ‹å¯¹è±¡ç±»å‹æ˜¯æœ€å®‰å…¨ã€æœ€å‡†ç¡®çš„ï¼Œæˆ‘ä»¬æ…¢æ…¢æ¥çœ‹å§~ å…ˆçœ‹çœ‹åœ¨å¯¹è±¡ä¸Šç›´æ¥ä½¿ç”¨ toStringä¼šæ˜¯ä»€ä¹ˆç»“æœï¼š 1234567891011121314const obj = &#123; a: 1 &#125;const arr = [1, 2]obj.toString() &gt;&gt; &#x27;[object Object]&#x27;// å¦‚æœæ˜¯æ•°ç»„çš„è¯ï¼Œåˆ™è¾“å‡ºå­—ç¬¦ä¸²arr.toString() &gt;&gt; &#x27;1,2&#x27;// å½“ç„¶æˆ‘ä»¬å¯ä»¥é‡å†™/è¦†ç›–åŸå‹é“¾ä¸Šçš„ toString æ–¹æ³•obj.toString = function() &#123; return &#x27;overwrite&#x27;&#125;obj.toString() &gt;&gt; &#x27;overwrite&#x27; æ—¢ç„¶ toString æ–¹æ³•å®šä¹‰åœ¨åŸå‹å¯¹è±¡ä¸Šï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚æœå•ç‹¬è°ƒç”¨å®ƒï¼Œä¼šæ˜¯ä»€ä¹ˆç»“æœå‘¢? 1Object.prototype.toString() &gt;&gt; &#x27;[object Object]&#x27; å¦‚æœé€šè¿‡ call/apply æ–¹æ³•ï¼Œæ”¹å˜ toString æ–¹æ³•å†…éƒ¨çš„ this æ‰§è¡Œï¼Œåˆä¼šæ˜¯ä»€ä¹ˆç»“æœå‘¢? çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼Œæˆ‘ç›¸ä¿¡è¿™ç»å¯¹å¯ä»¥å®Œç¾ cover ä½é¡¹ç›®é‡Œé¢æ‰€æœ‰çš„ç±»å‹åˆ¤æ–­äº†ï¼æ‰€ä»¥è¯´å®ƒæ˜¯æœ€å®‰å…¨ã€æœ€å‡†ç¡®çš„ç±»å‹åˆ¤æ–­ï¼Œæ²¡æœ‰å¼‚è®®å§ğŸ˜ 12345678910111213141516171819202122Object.prototype.toString.call(&#123;&#125;) &gt;&gt; &#x27;[object Object]&#x27;Object.prototype.toString.call([]) &gt;&gt; &#x27;[object Array]&#x27;Object.prototype.toString.call(function()&#123;&#125;) &gt;&gt; &#x27;[object Function]&#x27;Object.prototype.toString.call(&#x27;&#x27;) &gt;&gt; &#x27;[object String]&#x27;Object.prototype.toString.call(1) &gt;&gt; &#x27;[object Number]&#x27;Object.prototype.toString.call(true) &gt;&gt; &#x27;[object Boolean]&#x27;Object.prototype.toString.call(null) &gt;&gt; &#x27;[object Null]&#x27;Object.prototype.toString.call(undefined) &gt;&gt; &#x27;[object Undefined]&#x27;Object.prototype.toString.call() &gt;&gt; &#x27;[object Undefined]&#x27;Object.prototype.toString.call(new Date()) &gt;&gt; &#x27;[object Date]&#x27;Object.prototype.toString.call(/at/) &gt;&gt; &#x27;[object RegExp]&#x27; é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Œæˆ‘ä»¬æ¥æ‰’ä¸€æ‰’å®ƒçš„åŸç†ï¼åœ¨ toString æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹å‡ ä¸ªæ“ä½œæ­¥éª¤: è·å–thisæŒ‡å‘çš„é‚£ä¸ªå¯¹è±¡çš„[[Class]]å±æ€§çš„å€¼ã€‚ï¼ˆcall/apply æ”¹å˜ this æŒ‡å‘ï¼‰ è®¡ç®—å‡ºä¸‰ä¸ªå­—ç¬¦ä¸²â€[object â€œã€ ç¬¬ä¸€æ­¥çš„æ“ä½œç»“æœã€ ä»¥åŠ â€œ]â€ è¿æ¥åçš„æ–°å­—ç¬¦ä¸²ã€‚ è¿”å›ç¬¬äºŒæ­¥çš„æ“ä½œç»“æœï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼ &#39;[object Type]&#39; è¿™ç§æ ¼å¼å­—ç¬¦ä¸²ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹è±¡çš„[[Class]]å±æ€§æ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„ï¼Œå®ƒä¸€ä¸ªå†…éƒ¨å±æ€§ï¼Œæ‰€æœ‰çš„å¯¹è±¡(åŸç”Ÿå¯¹è±¡å’Œå®¿ä¸»å¯¹è±¡)éƒ½æ‹¥æœ‰è¯¥å±æ€§ï¼Œä¸”ä¸èƒ½è¢«ä»»ä½•äººä¿®æ”¹ã€‚åœ¨è§„èŒƒä¸­ï¼Œ[[Class]]æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼šå†…éƒ¨å±æ€§æè¿°ã€‚ å¦‚æœè¦å•ç‹¬æˆ–è€…å¯¹è±¡çš„ [[Class]]ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš: 12const targetObj = []Object.prototype.toString.call(targetObj).slice(8, -1) &gt;&gt; &#x27;Array&#x27; æ—¢ç„¶å®ƒå¦‚æ­¤å¥½ç”¨ï¼Œéš¾é“å°±æ²¡æœ‰ç¼ºç‚¹å—ï¼Ÿ ç­”æ¡ˆæ˜¯å½“ç„¶æœ‰çš„ï¼Œæ¯•ç«Ÿå‡¡äº‹éƒ½ä¸å¯èƒ½é‚£ä¹ˆç»å¯¹çš„å˜›ï¼ é‚£ä¹ˆç¼ºç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç¬¬ä¸€ï¼ŒtoString() ä¼šè¿›è¡Œè£…ç®±æ“ä½œï¼Œäº§ç”Ÿå¾ˆå¤šä¸´æ—¶å¯¹è±¡ã€‚ï¼ˆè£…ç®±å°±æ˜¯å°†åŸºæœ¬ç±»å‹çš„æ•°æ®ï¼Œé€šè¿‡å¼•ç”¨ç±»å‹åŒ…è£…èµ·æ¥ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨å¼•ç”¨ç±»ä¸Šçš„æ–¹æ³•ï¼‰ 12345// ä½ è‚¯å®šä¸èƒ½è¿™æ ·ç”¨1.toString() &gt;&gt; SyntaxError: Invalid or unexpected token// ä½ å¿…é¡»è¿™æ ·ç”¨(1).toString() &gt;&gt; &#x27;1&#x27; ç¬¬äºŒï¼Œæ— æ³•åŒºåˆ†è‡ªå®šä¹‰å¯¹è±¡ç±»å‹ï¼Œç”¨æ¥åˆ¤æ–­è¿™ç±»å¯¹è±¡æ—¶ï¼Œè¿”å›çš„éƒ½æ˜¯Objectï¼Œè¿™æ ·æˆ‘ä»¬å°±éœ€è¦é€šè¿‡ instanceof æ¥åˆ¤æ–­äº†ã€‚ 1234function Person()&#123;&#125;const p = new Person()Object.prototype.toString.call(p) &gt;&gt; &#x27;[object Object]&#x27; å­—ç¬¦ä¸²JavaScriptè§£é‡Šå™¨å¼ºåˆ¶çº¦å®šå­—ç¬¦ä¸²åœ¨å †åŒºå­˜å‚¨çš„æ•°æ®æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒJavaScriptè§£é‡Šå™¨å¼ºåˆ¶çº¦å®šå­—ç¬¦ä¸²åœ¨å †åŒºå­˜å‚¨çš„æ•°æ®æ˜¯ä¸å¯å˜çš„ã€‚ å‚è€ƒèµ„æ–™å‚è€ƒèµ„æ–™ â†©å‚è€ƒèµ„æ–™2 â†©","categories":[],"tags":[{"name":"JavaScript, ES6","slug":"JavaScript-ES6","permalink":"http://yoursite.com/tags/JavaScript-ES6/"}]},{"title":"React Hooks","slug":"react-hooks","date":"2022-03-26T10:41:01.000Z","updated":"2022-12-23T04:43:55.402Z","comments":true,"path":"/post/react-hooks.html","link":"","permalink":"http://yoursite.com/post/react-hooks.html","excerpt":"ä»€ä¹ˆæ˜¯React Hooksï¼Œä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿå¦‚ä½•é«˜æ•ˆçš„ä½¿ç”¨React Hooksï¼Ÿå¦‚ä½•è‡ªå®šä¹‰ Hooks ï¼Ÿå¦‚ä½•é€šè¿‡ Hooks åšæ€§èƒ½ä¼˜åŒ–ï¼Ÿ","text":"Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚ åŠ¨æœºHook è§„åˆ™ åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚ï¼ˆæˆ–ï¼šåœ¨è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨å…¶ä»– Hookï¼‰ ä½¿ç”¨ useCallbackã€useMemoã€memo åšæ€§èƒ½ä¼˜åŒ–å°½å¯èƒ½çš„ä¿è¯ç»„ä»¶ä¸å»å‘ç”Ÿå˜åŒ–ï¼Œå‘ç”Ÿå˜åŒ–çš„å› ç´ æœ‰ï¼šstateã€propsã€contextã€‚ é‚£ä¹ˆ React æ˜¯å¦‚ä½•æ¯”è¾ƒè¿™ä¸‰è€…çš„å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ å†…å­˜åœ°å€ã€‚ æ¯”å¦‚è¯´ï¼Œå¯¹æ¯”ä¸€ä¸ª functionï¼Œå¯¹æ¯”çš„å°±æ˜¯è¿™ä¸ªå‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œé€šè¿‡åœ°å€çš„åˆ¤æ–­ï¼Œä»è€Œåˆ¤æ–­ props æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ã€‚ React.memo https://react.docschina.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate React.memo åŒ…è£¹ä¸€ä¸ªç»„ä»¶ï¼Œæ¥å¯¹å®ƒçš„ props è¿›è¡Œæµ…æ¯”è¾ƒã€‚ç­‰æ•ˆäº PureComponentï¼Œä½†å®ƒåªæ¯”è¾ƒ propsã€‚ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°æ¥æ¯”è¾ƒæ–°æ—§ propsã€‚å¦‚æœå‡½æ•°è¿”å› trueï¼Œå°±ä¼šè·³è¿‡æ›´æ–°ã€‚ï¼‰ 123456789101112131415161718192021222324// ä¸ä½¿ç”¨ memoï¼Œæ¯ä¸€æ¬¡ setCountï¼Œéƒ½ä¼šé€ æˆ Child ç»„ä»¶é‡æ–° renderconst Child = () =&gt; &#123; console.log(&#x27;Child&#x27;) return ( &lt;&gt;Child component&lt;/&gt; )&#125;const Demo = () =&gt; &#123; const [count, setCount] = useState(0) return ( &lt;&gt; &lt;button onClick=&#123;() =&gt; setCount(count =&gt; count + 1)&#125;&gt;+&lt;/button&gt; &lt;Child /&gt; &lt;/&gt; )&#125;// é€šè¿‡ memo åŒ…è£¹åï¼ŒChild ç»„ä»¶ä¸ä¼šå†é‡æ–° renderäº†ã€‚const Child = memo(() =&gt; &#123; console.log(&#x27;Child&#x27;) return ( &lt;&gt;Child component&lt;/&gt; )&#125;) å½“ memo æ„ŸçŸ¥ props æ²¡æœ‰å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸ä¼šé‡æ–° render ç»„ä»¶ã€‚å¦‚æœä¼ å…¥ count è¿›æ¥ï¼ŒChildç»„ä»¶å°±ä¼šé‡æ–° renderã€‚ æ€»ç»“ï¼š å¦‚æœæˆ‘ä»¬å°† setCount å½“åš prop ä¼ å…¥è¿›æ¥ï¼ŒChild ä¸ä¼šé‡æ–°renderï¼ˆå› ä¸º setCount åœ¨å†…å­˜ä¸­çš„åœ°å€æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼‰ å¦‚æœä¼ å…¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„æ–¹æ³• (fn)è¿›æ¥ï¼ŒChildä¼šé‡æ–° renderï¼Œå› ä¸º Demo ç»„ä»¶æ¯æ¬¡æ›´æ–° count åï¼Œé‡æ–°ç”Ÿæˆäº† fn å‡½æ•°ã€‚ åªæ˜¯ä¼ äº†ä¸ª fn ï¼Œä¸æƒ³è®© Child ç»„ä»¶æ›´æ–°æ€ä¹ˆåŠï¼Ÿé‚£å°±è¦ç”¨åˆ° useCallback é’©å­äº† useMemoæŠŠâ€œåˆ›å»ºâ€å‡½æ•°å’Œä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ useMemoï¼Œå®ƒä»…ä¼šåœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰é‡æ–°è®¡ç®—ã€‚ 1234// åªæœ‰å½“ count å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—const computedCount = useMemo(() =&gt; &#123; return count * 2&#125;, [count]) useMemo ä¹Ÿå…è®¸ä½ è·³è¿‡ä¸€æ¬¡å­èŠ‚ç‚¹çš„æ˜‚è´µçš„é‡æ–°æ¸²æŸ“ï¼Œæ¯”å¦‚ç»„ä»¶åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦ä¸€æ¬¡å¤§é‡çš„è®¡ç®—ï¼Œåç»­å°±ä¸ä¼šå†æ”¹å˜äº†ï¼š 123456789101112function Parent(&#123; a, b &#125;) &#123; // Only re-rendered if `a` changes: const child1 = useMemo(() =&gt; &lt;Child1 a=&#123;a&#125; /&gt;, [a]); // Only re-rendered if `b` changes: const child2 = useMemo(() =&gt; &lt;Child2 b=&#123;b&#125; /&gt;, [b]); return ( &lt;&gt; &#123;child1&#125; &#123;child2&#125; &lt;/&gt; )&#125; useCallbackæŠŠå†…è”å›è°ƒå‡½æ•°åŠä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ useCallbackï¼Œå®ƒå°†è¿”å›è¯¥å›è°ƒå‡½æ•°çš„ memoized ç‰ˆæœ¬ï¼Œè¯¥å›è°ƒå‡½æ•°ä»…åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°ã€‚ ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå³ä½¿æˆ‘ä»¬ç”¨ memo åŒ…è£¹äº†ç»„ä»¶ï¼Œå› ä¸º setCount æ¯æ¬¡ä¼šå¼•èµ· Demo ç»„ä»¶é‡æ–° renderï¼Œç”Ÿæˆäº†æ–°çš„ fn å‡½æ•°(å†…å­˜åœ°å€å‘ç”Ÿäº†å˜åŒ–)ï¼Œå¯¼è‡´ Child ä¹Ÿä¼šé‡æ–° renderã€‚ 123456789101112131415161718192021interface IChild &#123; fn: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;&#125;const Child = memo((props: IChild) =&gt; &#123; console.log(&#x27;Child&#x27;) return ( &lt;&gt;Child component&lt;/&gt; )&#125;)const Demo = () =&gt; &#123; const [count, setCount] = useState(0) const fn = () =&gt; console.log(&#x27;is fn&#x27;) return ( &lt;&gt; &lt;button onClick=&#123;() =&gt; setCount(count =&gt; count + 1)&#125;&gt;+&lt;/button&gt; &lt;Child fn=&#123;fn&#125; /&gt; &lt;/&gt; )&#125; æˆ‘ä»¬ä¸æƒ³è®© fn å‡½æ•°çš„ å†…å­˜åœ°å€ å‘ç”Ÿå˜åŒ–ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿä½¿ç”¨ useCallback é’©å­å°†å…¶åŒ…è£¹èµ·æ¥å³å¯ã€‚ æ³¨æ„ï¼šuseMemo ä¹Ÿå¯ä»¥è¿™æ ·ç”¨ï¼Œç¼“å­˜ fnï¼Œä»è€Œä½¿å¾— Child ç»„ä»¶ä¸ä¼šé‡å¤ renderã€‚ 1234567// çœç•¥...const fn = useCallback(() =&gt; &#123; console.log(&#x27;is fn&#x27;)&#125;, [])// çœç•¥... è¿™æ · fn å‡½æ•°å°±æ˜¯ä¸€ä¸ªç¼“å­˜å‡½æ•°äº†ï¼Œå³ä½¿ count ä¸åœçš„å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¸ä¼šé€ æˆ Child ç»„ä»¶é‡å¤ renderã€‚ æ€»ç»“: å½“ Demo ç»„ä»¶å†…éƒ¨ state å‘ç”Ÿäº†æ”¹å˜å¼•èµ· Demo å’Œ Child ç»„ä»¶é‡æ–° render å¹¶ä¸” Child ç»„ä»¶æ¥å—äº†ä¸€ä¸ªæ¥è‡ª Demo ç»„ä»¶è‡ªå®šä¹‰çš„æ–¹æ³•ï¼ˆfnï¼‰ å¦‚æœä¸å¸Œæœ› Child ç»„ä»¶é‡æ–° renderï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨ useCallback é’©å­å°†è‡ªå®šä¹‰æ–¹æ³• fn åŒ…è£¹èµ·æ¥ å› ä¸º Child ç»„ä»¶ props é‡Œé¢çš„ fn å’Œ useCallback è¿”å›çš„ fn æŒ‡å‘çš„æ˜¯å†…å­˜ä¸­çš„åŒä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆ Child ç»„ä»¶å°±ä¸ä¼šæ›´æ–° useCallback è¿”å›æ–°å‡½æ•°çš„æ¡ä»¶æ˜¯ï¼šä¾èµ–é¡¹ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰å‘ç”Ÿäº†æ”¹å˜ã€‚ å¦‚æœè¯´æˆ‘ä»¬çš„ Child ç»„ä»¶ï¼Œæœ¬èº«å°±æ˜¯éœ€è¦æ ¹æ® count å˜åŒ–è€Œå˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦åŠ è¿™ä¸ªç¼“å­˜ APIäº†ï¼Œåè€Œå¢åŠ å…¶è®¡ç®—è´Ÿæ‹…ã€‚ è®¾è®¡ç»„ä»¶ä¸è¦ä¸ºäº†ä½¿ç”¨é’©å­ï¼Œè¿‡æ¸¡çš„ä½¿ç”¨é’©å­ï¼Œå¥½çš„é¡µé¢è®¾è®¡ï¼Œä¹Ÿè®¸ç”¨ä¸ä¸Šè¿™äº›é’©å­ã€‚ æŠŠä¸å˜çš„ç»„ä»¶å’Œå˜åŒ–çš„ç»„ä»¶æŠ½ç¦»å‡ºæ¥ï¼ æ¯”å¦‚å¯ä»¥æŠŠ count ç›¸å…³éƒ¨åˆ†æŠ½ç¦»æˆä¸€ä¸ª Count ç»„ä»¶ï¼Œä½¿å…¶å’Œ Child ç»„ä»¶åŒå±‚çº§æ’åˆ—ï¼ŒCount ç»„ä»¶å’Œ Child ç»„ä»¶åˆ†å¼€äº†ï¼Œä¹Ÿä¸ä¼šå¼•èµ· Child ç»„ä»¶åšå¤šä½™çš„ renderã€‚ 12&lt;Count /&gt;&lt;Child prop=&#123;fn&#125; /&gt; æˆ–è€…æ˜¯é€šè¿‡ props.children æ¸²æŸ“ Childï¼Œä¹Ÿä¸ä¼šé€ æˆ Child é‡æ–° renderã€‚ 12345678910111213141516171819202122const Count = (props: any) =&gt; &#123; const [count, setCount] = useState(0) return ( &lt;&gt; &lt;button onClick=&#123;() =&gt; setCount(count =&gt; count + 1)&#125;&gt;+&lt;/button&gt; &#123;/* children ä¸ä¼šé‡æ–° render */&#125; &#123;props.children&#125; &lt;/&gt; )&#125;const Demo = () =&gt; &#123; // fn æ°¸è¿œä¸ä¼šå˜åŒ– const fn = () =&gt; &#123;&#125; return ( &lt;&gt; &lt;Count&gt; &lt;Child fn=&#123;fn&#125; /&gt; &lt;/Count&gt; &lt;/&gt; )&#125; useRef / createRef è®¿é—® DOM èŠ‚ç‚¹ 123456const inputEle = useRef(null)const inputEle = React.createRef()inputEle.current.focus() æµ‹é‡ DOMèŠ‚ç‚¹ï¼Ÿ1234567891011121314151617const getHeight = useMemo(() =&gt; &#123; return (node: HTMLObjectElement) =&gt; &#123; if (node) &#123; setHeight(node.getBoundingClientRect().height) &#125; &#125;&#125;, [])// æˆ–è€…const getHeight = useCallback((node: HTMLObjectElement) =&gt; &#123; if (node) &#123; setHeight(node.getBoundingClientRect().height) &#125;&#125;, []) å°† ref é€»è¾‘æŠ½ç¦»æˆä¸€ä¸ª Hook 1234567891011121314151617181920// hookconst useClientRect = () =&gt; &#123; const [rect, setRect] = useState(null) const ref = useCallback(node =&gt; &#123; if (node) &#123; setRect(node.getBoundingClientRect()) &#125; &#125;, []) return [rect, ref]&#125;// ä½¿ç”¨const [rect, ref] = useClientRect()&lt;h1 ref=&#123;ref&#125;&gt;æ˜¯ H1 æ ‡ç­¾ &#123;count&#125;&lt;/h1&gt;&#123; rect &amp;&amp; &lt;span&gt;&#123;rect.height&#125;&lt;/span&gt;&#125; React.forwardRef React.forwardRef ä¼šåˆ›å»ºä¸€ä¸ªReactç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶èƒ½å¤Ÿå°†å…¶æ¥å—çš„ ref å±æ€§è½¬å‘åˆ°å…¶ç»„ä»¶æ ‘ä¸‹çš„å¦ä¸€ä¸ªç»„ä»¶ä¸­ã€‚ 123456789const FancyInput = forwardRef((props, ref) =&gt; ( &lt;input ref=&#123;inputRef&#125; &#123;...props&#125; /&gt;))// è¿™æ ·å¯ä»¥æ‹¿åˆ° input å…ƒç´ äº†const inputEle = React.createRef()&lt;FancyInput ref=&#123;inputEle&#125; /&gt; useImperativeHandle useImperativeHandle å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚ 12345678910111213141516171819202122232425const FancyInput = forwardRef((props, ref) =&gt; &#123; const inputRef = useRef(); useImperativeHandle(ref, () =&gt; (&#123; focus: () =&gt; &#123; inputRef.current.focus(); &#125;, alert () &#123; alert(1) &#125; &#125;)); return &lt;input ref=&#123;inputRef&#125; &#123;...props&#125; /&gt;;&#125;)const inputEle = React.createRef()&lt;FancyInput ref=&#123;inputEle&#125; /&gt;// é€šè¿‡ inputEle è·å–åˆ° useImperativeHandle å®šä¹‰çš„æ–¹æ³•inputEle.current.focus()inputEle.current.alert() å‚è€ƒèµ„æ–™ahooks å®˜ç½‘ â†©","categories":[],"tags":[{"name":"Reactï¼ŒHooks","slug":"Reactï¼ŒHooks","permalink":"http://yoursite.com/tags/React%EF%BC%8CHooks/"}]},{"title":"Hello_AlexCc","slug":"first-article","date":"2019-07-29T15:37:50.000Z","updated":"2022-04-07T10:04:40.419Z","comments":true,"path":"/post/first-article.html","link":"","permalink":"http://yoursite.com/post/first-article.html","excerpt":"First Article","text":"What This is my first Blog. No.212345if (true) &#123; console.log(&quot;Hello_AlexCc!&quot;)&#125;return &quot;ãƒ¾(â—Â°âˆ‡Â°â—)ï¾‰ï¾&quot;","categories":[],"tags":[{"name":"One","slug":"One","permalink":"http://yoursite.com/tags/One/"}]}],"categories":[],"tags":[{"name":"å·¥ç¨‹åŒ–,Vue3,é€šç”¨åŠŸèƒ½","slug":"å·¥ç¨‹åŒ–-Vue3-é€šç”¨åŠŸèƒ½","permalink":"http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3-%E9%80%9A%E7%94%A8%E5%8A%9F%E8%83%BD/"},{"name":"å·¥ç¨‹åŒ–,Vue3","slug":"å·¥ç¨‹åŒ–-Vue3","permalink":"http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3/"},{"name":"å·¥ç¨‹åŒ–,Vue3,Config","slug":"å·¥ç¨‹åŒ–-Vue3-Config","permalink":"http://yoursite.com/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96-Vue3-Config/"},{"name":"Reactive,Vue3","slug":"Reactive-Vue3","permalink":"http://yoursite.com/tags/Reactive-Vue3/"},{"name":"Nginx","slug":"Nginx","permalink":"http://yoursite.com/tags/Nginx/"},{"name":"Nodejs","slug":"Nodejs","permalink":"http://yoursite.com/tags/Nodejs/"},{"name":"JS,Vue-Router,Vue3,","slug":"JS-Vue-Router-Vue3","permalink":"http://yoursite.com/tags/JS-Vue-Router-Vue3/"},{"name":"JS,Vue3","slug":"JS-Vue3","permalink":"http://yoursite.com/tags/JS-Vue3/"},{"name":"JS","slug":"JS","permalink":"http://yoursite.com/tags/JS/"},{"name":"ESM ESModule ESBuild","slug":"ESM-ESModule-ESBuild","permalink":"http://yoursite.com/tags/ESM-ESModule-ESBuild/"},{"name":"TypeScript TS","slug":"TypeScript-TS","permalink":"http://yoursite.com/tags/TypeScript-TS/"},{"name":"RN H5","slug":"RN-H5","permalink":"http://yoursite.com/tags/RN-H5/"},{"name":"JavaScript, ES6","slug":"JavaScript-ES6","permalink":"http://yoursite.com/tags/JavaScript-ES6/"},{"name":"Reactï¼ŒHooks","slug":"Reactï¼ŒHooks","permalink":"http://yoursite.com/tags/React%EF%BC%8CHooks/"},{"name":"One","slug":"One","permalink":"http://yoursite.com/tags/One/"}]}